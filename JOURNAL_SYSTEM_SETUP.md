# Настройка системы пользовательских журналов

## Обзор изменений

Добавлена система управления пользовательскими журналами, которая позволяет:

1. **Создавать пользовательские журналы** с настраиваемыми полями
2. **Редактировать схемы журналов** (кроме системного журнала "diary")
3. **Удалять журналы** (кроме системного журнала "diary")
4. **Привязывать журналы к конкретному пользователю**

## Новые компоненты

### Backend

1. **Модель JournalSchema** (`server/app/journals/models.py`)
   - Хранит схемы пользовательских журналов
   - Поля: id, user_id, name, display_name, fields, is_default, created_at, updated_at

2. **API маршруты** (`server/app/journals/routes.py`)
   - `GET /api/journals/schemas` - получить все журналы пользователя
   - `POST /api/journals/schemas` - создать новый журнал
   - `PUT /api/journals/schemas/<id>` - редактировать журнал
   - `DELETE /api/journals/schemas/<id>` - удалить журнал

3. **Обновленные маршруты журналов**
   - Добавлена проверка доступа к журналам по user_id
   - Проверка существования схемы журнала перед операциями

### Frontend

1. **JournalManager** (`client/src/components/JournalManager/JournalManager.jsx`)
   - Компонент для управления пользовательскими журналами
   - Создание, редактирование, удаление журналов
   - Настройка полей журналов

2. **Обновленная страница профиля** (`client/src/AccountPage.jsx`)
   - Добавлена вкладка "Мои журналы"
   - Интеграция с JournalManager

## Установка и настройка

### 1. Запуск миграции базы данных

```bash
cd server
python run_migration.py
```

### 2. Инициализация дефолтных журналов для существующих пользователей

```bash
cd server
python init_default_journals.py
```

### 3. Перезапуск сервера

```bash
cd server
python run.py
```

## Использование

### Для пользователей

1. Перейдите в профиль пользователя
2. Выберите вкладку "Мои журналы"
3. Нажмите "Создать журнал" для создания нового журнала
4. Настройте поля журнала:
   - **Системное имя**: используется в URL (только латинские буквы и подчеркивания)
   - **Отображаемое название**: название, которое видит пользователь
   - **Поля**: настройте поля журнала с различными типами данных

### Типы полей

- **Текст**: однострочное текстовое поле
- **Многострочный текст**: текстовая область
- **Число**: числовое поле
- **Дата**: поле для выбора даты
- **Выбор из списка**: выпадающий список с предустановленными вариантами
- **Теги**: поле для добавления тегов
- **Флажок**: чекбокс для булевых значений

### Ограничения

- **Системный журнал "diary"** нельзя удалить или переименовать
- Каждый пользователь видит только свои журналы
- Системное имя журнала должно быть уникальным для пользователя

## Структура данных

### JournalSchema

```json
{
  "id": 1,
  "name": "workout_log",
  "display_name": "Журнал тренировок",
  "fields": [
    {
      "name": "exercise",
      "type": "text",
      "label": "Упражнение",
      "required": true
    },
    {
      "name": "sets",
      "type": "number",
      "label": "Подходы",
      "required": false
    },
    {
      "name": "notes",
      "type": "textarea",
      "label": "Заметки",
      "required": false
    }
  ],
  "is_default": false,
  "created_at": "2025-01-02T12:00:00Z",
  "updated_at": "2025-01-02T12:00:00Z"
}
```

## Безопасность

- Все операции требуют аутентификации
- Пользователи могут управлять только своими журналами
- Системный журнал "diary" защищен от удаления и переименования
- Проверка доступа на уровне API

## Совместимость

Система полностью совместима с существующим функционалом:
- Старые записи в журнале "diary" остаются доступными
- Существующие пользователи автоматически получают дефолтный журнал "diary"
- Все существующие API маршруты продолжают работать