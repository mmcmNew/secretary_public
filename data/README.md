# Структура данных приложения

## Обзор

Данные приложения разделены на две основные категории:
- **Системные данные** - общие для всех пользователей
- **Пользовательские данные** - индивидуальные для каждого пользователя

## Структура папок

```
data/
├── system/                     # Системные данные (общие)
│   ├── defaults/              # Файлы по умолчанию
│   │   ├── scenarios/         # Системные сценарии
│   │   └── settings/          # Системные настройки
│   └── assets/                # Системные ресурсы
│       ├── memory/            # Изображения для памяти
│       ├── sounds/            # Звуковые файлы
│       └── avatars/           # Аватары
├── user_data/                 # Пользовательские данные
│   └── user_{id}/             # Папка конкретного пользователя
│       ├── scenarios/         # Пользовательские сценарии
│       ├── settings/          # Пользовательские настройки
│       ├── memory/            # Пользовательские изображения памяти
│       ├── uploads/           # Загруженные файлы
│       └── temp/              # Временные файлы
└── logs/                      # Логи приложения
```

## Системные данные

### system/defaults/scenarios/
Содержит базовые сценарии, которые копируются каждому новому пользователю:
- `day_result.json` - Сценарий подведения итогов дня
- `demo.json` - Демонстрационный сценарий
- `productivity.json` - Сценарий продуктивности
- `relax.json` - Сценарий отдыха

### system/defaults/settings/
Содержит базовые настройки:
- `commands_list.json` - Список команд
- `command_information.json` - Информация о командах
- `command_num_information.json` - Числовая информация команд
- `modules.json` - Конфигурация модулей

### system/assets/
Содержит общие ресурсы:
- `memory/` - Изображения для системы памяти (числа, месяцы, placeholder)
- `sounds/` - Звуковые эффекты (клики, уведомления)
- `avatars/` - Аватары персонажей

## Пользовательские данные

Каждый пользователь получает свою папку `user_{id}` с копиями системных файлов по умолчанию и возможностью создавать собственные.

### Инициализация пользователя

При регистрации нового пользователя:
1. Создается папка `user_{id}`
2. Копируются системные сценарии и настройки
3. Создаются пустые папки для пользовательских данных

### Приоритет файлов

При поиске файлов система сначала проверяет пользовательскую папку, затем системную:
1. `user_{id}/scenarios/` → `system/defaults/scenarios/`
2. `user_{id}/settings/` → `system/defaults/settings/`
3. `user_{id}/memory/` → `system/assets/memory/`

## Использование в коде

```python
from app.user_data_manager import UserDataManager
from app.data_paths import get_user_data_path, get_system_data_path

# Создание рабочего пространства для нового пользователя
UserDataManager.create_user_workspace(user_id)

# Получение пользовательских сценариев
scenarios = UserDataManager.get_user_scenarios(user_id)

# Получение пути к пользовательским данным
user_scenarios_path = get_user_data_path(user_id, 'scenarios')

# Получение пути к системным данным
system_sounds_path = get_system_data_path('sounds')
```

## Миграция существующих данных

Существующие данные из `data/user_data/` были скопированы в `data/system/` как базовые системные файлы. При первом запуске приложения эти файлы будут автоматически скопированы в папки пользователей.

## Преимущества новой структуры

1. **Разделение ответственности** - системные и пользовательские данные не смешиваются
2. **Масштабируемость** - легко добавлять новых пользователей
3. **Безопасность** - пользователи не могут изменить системные файлы
4. **Обслуживание** - легко обновлять системные файлы по умолчанию
5. **Персонализация** - каждый пользователь может настроить свои данные