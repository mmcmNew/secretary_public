const e="object"==typeof self?self:globalThis,t=t=>((t,n)=>{const r=(e,n)=>(t.set(n,e),e),s=o=>{if(t.has(o))return t.get(o);const[c,a]=n[o];switch(c){case 0:case-1:return r(a,o);case 1:{const e=r([],o);for(const t of a)e.push(s(t));return e}case 2:{const e=r({},o);for(const[t,n]of a)e[s(t)]=s(n);return e}case 3:return r(new Date(a),o);case 4:{const{source:e,flags:t}=a;return r(new RegExp(e,t),o)}case 5:{const e=r(new Map,o);for(const[t,n]of a)e.set(s(t),s(n));return e}case 6:{const e=r(new Set,o);for(const t of a)e.add(s(t));return e}case 7:{const{name:t,message:n}=a;return r(new e[t](n),o)}case 8:return r(BigInt(a),o);case"BigInt":return r(Object(BigInt(a)),o);case"ArrayBuffer":return r(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:e}=new Uint8Array(a);return r(new DataView(e),a)}}return r(new e[c](a),o)};return s})(new Map,t)(0),n="",{toString:r}={},{keys:s}=Object,o=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const s=r.call(e).slice(8,-1);switch(s){case"Array":return[1,n];case"Object":return[2,n];case"Date":return[3,n];case"RegExp":return[4,n];case"Map":return[5,n];case"Set":return[6,n];case"DataView":return[1,s]}return s.includes("Array")?[1,s]:s.includes("Error")?[7,s]:[2,s]},c=([e,t])=>0===e&&("function"===t||"symbol"===t),a=(e,{json:t,lossy:n}={})=>{const r=[];return((e,t,n,r)=>{const a=(e,t)=>{const s=r.push(e)-1;return n.set(t,s),s},u=r=>{if(n.has(r))return n.get(r);let[f,i]=o(r);switch(f){case 0:{let t=r;switch(i){case"bigint":f=8,t=r.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+i);t=null;break;case"undefined":return a([-1],r)}return a([f,t],r)}case 1:{if(i){let e=r;return"DataView"===i?e=new Uint8Array(r.buffer):"ArrayBuffer"===i&&(e=new Uint8Array(r)),a([i,[...e]],r)}const e=[],t=a([f,e],r);for(const n of r)e.push(u(n));return t}case 2:{if(i)switch(i){case"BigInt":return a([i,r.toString()],r);case"Boolean":case"Number":case"String":return a([i,r.valueOf()],r)}if(t&&"toJSON"in r)return u(r.toJSON());const n=[],l=a([f,n],r);for(const t of s(r))!e&&c(o(r[t]))||n.push([u(t),u(r[t])]);return l}case 3:return a([f,r.toISOString()],r);case 4:{const{source:e,flags:t}=r;return a([f,{source:e,flags:t}],r)}case 5:{const t=[],n=a([f,t],r);for(const[s,a]of r)(e||!c(o(s))&&!c(o(a)))&&t.push([u(s),u(a)]);return n}case 6:{const t=[],n=a([f,t],r);for(const s of r)!e&&c(o(s))||t.push(u(s));return n}}const{message:l}=r;return a([f,{name:i,message:l}],r)};return u})(!(t||n),!!t,new Map,r)(e),r},u="function"==typeof structuredClone?(e,n)=>n&&("json"in n||"lossy"in n)?t(a(e,n)):structuredClone(e):(e,n)=>t(a(e,n)),f=l("end"),i=l("start");function l(e){return function(t){const n=t&&t.position&&t.position[e]||{};if("number"==typeof n.line&&n.line>0&&"number"==typeof n.column&&n.column>0)return{line:n.line,column:n.column,offset:"number"==typeof n.offset&&n.offset>-1?n.offset:void 0}}}function w(e){const t=i(e),n=f(e);if(t&&n)return{start:t,end:n}}export{i as a,f as b,w as p,u as s};
