import{a0 as e,a2 as t,$ as n,a3 as i,a4 as s,a5 as r,S as o,a6 as a,r as l,j as c,a7 as u,I as d,m as h,T as p,a8 as f,y as m,P as g,s as v,a9 as y,aa as x,ab as b,ac as w,ad as k,ae as j,af as T,ag as S,W as C,V as _,ah as E,X as L,Z as I,ai as M,Q as O,aj as R,ak as D,al as P,am as z,an as A,ao as B,ap as H,aq as $,ar as F,as as N,at as Y,au as W,av as V,aw as U,ax as q,ay as G,az as K,a as J,o as Z,E as X,aA as Q,J as ee,D as te,aB as ne,A as ie,aC as se,M as re,aD as oe,aE as ae,aF as le,aG as ce,L as ue,w as de,U as he,aH as pe,aI as fe,aJ as me,l as ge,aK as ve,z as ye,k as xe,aL as be,aM as we,aN as ke,aO as je,aP as Te,aQ as Se,aR as Ce,aS as _e,t as Ee,aT as Le,aU as Ie,aV as Me,aW as Oe,aX as Re}from"./mui-Y8rtTM8Z.js";import{u as De,B as Pe,R as ze,a as Ae}from"./react-vendor-AuV3xf3R.js";import{R as Be}from"./dnd-BDmUGvek.js";import{d as He,S as $e,e as Fe,c as Ne,m as Ye,a as We,b as Ve,f as Ue,g as qe}from"./swiper-GGsF7Ke6.js";import{E as Ge,o as Ke}from"./blocknote-wtEUGiBC.js";import{r as Je}from"./utils-BP1Vqtc7.js";import{L as Ze,D as Xe,a as Qe,r as et,S as tt,T as nt}from"./mui-x-vqhMI3SD.js";import{E as it,F as st,i as rt,a as ot,b as at,c as lt,d as ct}from"./fullcalendar-BwQQ2xPA.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var ut,dt={};const ht=t(function(){if(ut)return dt;ut=1;var t=e();return dt.createRoot=t.createRoot,dt.hydrateRoot=t.hydrateRoot,dt}());var pt={},ft={};const mt=n(i);var gt,vt;function yt(){return gt||(gt=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=mt}(ft)),ft}function xt(){if(vt)return pt;vt=1;var e=s();Object.defineProperty(pt,"__esModule",{value:!0}),pt.default=void 0;var t=e(yt()),n=r();return pt.default=(0,t.default)((0,n.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),pt}const bt=t(xt());var wt,kt={};function jt(){if(wt)return kt;wt=1;var e=s();Object.defineProperty(kt,"__esModule",{value:!0}),kt.default=void 0;var t=e(yt()),n=r();return kt.default=(0,t.default)((0,n.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),kt}const Tt=t(jt());var St,Ct={};function _t(){if(St)return Ct;St=1;var e=s();Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.default=void 0;var t=e(yt()),n=r();return Ct.default=(0,t.default)((0,n.jsx)("path",{d:"M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6h1.9c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m0 12H6V10h12z"}),"LockOpen"),Ct}const Et=t(_t());var Lt,It={};function Mt(){if(Lt)return It;Lt=1;var e=s();Object.defineProperty(It,"__esModule",{value:!0}),It.default=void 0;var t=e(yt()),n=r();return It.default=(0,t.default)((0,n.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),It}const Ot=t(Mt());var Rt,Dt={exports:{}};var Pt,zt,At=(Rt||(Rt=1,"undefined"!=typeof self&&self,Dt.exports=(Pt=o(),(()=>{var e={155:e=>{e.exports=Pt}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};n.r(i),n.d(i,{default:()=>p,useStopwatch:()=>d,useTime:()=>h,useTimer:()=>u});var s=n(155);class r{static expiryTimestamp(e){const t=new Date(e).getTime()>0;return t}static onExpire(e){const t=e&&"function"==typeof e;return t}}class o{static getTimeFromSeconds(e){const t=Math.ceil(e),n=Math.floor(t/86400),i=Math.floor(t%86400/3600),s=Math.floor(t%3600/60);return{totalSeconds:t,seconds:Math.floor(t%60),minutes:s,hours:i,days:n}}static getSecondsFromExpiry(e,t){const n=e-(new Date).getTime();if(n>0){const e=n/1e3;return t?Math.round(e):e}return 0}static getSecondsFromPrevTime(e,t){const n=(new Date).getTime()-e;if(n>0){const e=n/1e3;return t?Math.round(e):e}return 0}static getSecondsFromTimeNow(){const e=new Date;return e.getTime()/1e3-60*e.getTimezoneOffset()}static getFormattedTimeFromSeconds(e,t){const{seconds:n,minutes:i,hours:s}=o.getTimeFromSeconds(e);let r="",a=s;return"12-hour"===t&&(r=s>=12?"pm":"am",a=s%12),{seconds:n,minutes:i,hours:a,ampm:r}}}function a(e,t){const n=(0,s.useRef)();(0,s.useEffect)((()=>{n.current=e})),(0,s.useEffect)((()=>{if(!t)return()=>{};const e=setInterval((()=>{n.current&&n.current()}),t);return()=>clearInterval(e)}),[t])}const l=1e3;function c(e){if(!r.expiryTimestamp(e))return null;const t=o.getSecondsFromExpiry(e),n=Math.floor(1e3*(t-Math.floor(t)));return n>0?n:l}function u(){let{expiryTimestamp:e,onExpire:t,autoStart:n=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[i,u]=(0,s.useState)(e),[d,h]=(0,s.useState)(o.getSecondsFromExpiry(i)),[p,f]=(0,s.useState)(n),[m,g]=(0,s.useState)(n),[v,y]=(0,s.useState)(c(i)),x=(0,s.useCallback)((()=>{r.onExpire(t)&&t(),f(!1),y(null)}),[t]),b=(0,s.useCallback)((()=>{f(!1)}),[]),w=(0,s.useCallback)((function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];y(c(e)),g(t),f(t),u(e),h(o.getSecondsFromExpiry(e))}),[]),k=(0,s.useCallback)((()=>{const e=new Date;e.setMilliseconds(e.getMilliseconds()+1e3*d),w(e)}),[d,w]),j=(0,s.useCallback)((()=>{m?(h(o.getSecondsFromExpiry(i)),f(!0)):k()}),[i,m,k]);return a((()=>{v!==l&&y(l);const e=o.getSecondsFromExpiry(i);h(e),e<=0&&x()}),p?v:null),{...o.getTimeFromSeconds(d),start:j,pause:b,resume:k,restart:w,isRunning:p}}function d(){let{autoStart:e,offsetTimestamp:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[n,i]=(0,s.useState)(o.getSecondsFromExpiry(t,!0)||0),[r,l]=(0,s.useState)(new Date),[c,u]=(0,s.useState)(n+o.getSecondsFromPrevTime(r||0,!0)),[d,h]=(0,s.useState)(e);a((()=>{u(n+o.getSecondsFromPrevTime(r,!0))}),d?1e3:null);const p=(0,s.useCallback)((()=>{const e=new Date;l(e),h(!0),u(n+o.getSecondsFromPrevTime(e,!0))}),[n]),f=(0,s.useCallback)((()=>{i(c),h(!1)}),[c]),m=(0,s.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=o.getSecondsFromExpiry(e,!0)||0,s=new Date;l(s),i(n),h(t),u(n+o.getSecondsFromPrevTime(s,!0))}),[]);return{...o.getTimeFromSeconds(c),start:p,pause:f,reset:m,isRunning:d}}function h(){let{format:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[t,n]=(0,s.useState)(o.getSecondsFromTimeNow());return a((()=>{n(o.getSecondsFromTimeNow())}),1e3),{...o.getFormattedTimeFromSeconds(t,e)}}function p(e){if((0,s.useEffect)((()=>{}),[]),e.expiryTimestamp){const t=u(e);return{...t,startTimer:t.start,stopTimer:t.pause,resetTimer:()=>{}}}const t=d(e);return{...t,startTimer:t.start,stopTimer:t.pause,resetTimer:t.reset}}return i})())),Dt.exports),Bt={};function Ht(){if(zt)return Bt;zt=1;var e=s();Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.default=void 0;var t=e(yt()),n=r();return Bt.default=(0,t.default)((0,n.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),Bt}const $t=t(Ht());var Ft,Nt={};function Yt(){if(Ft)return Nt;Ft=1;var e=s();Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.default=void 0;var t=e(yt()),n=r();return Nt.default=(0,t.default)((0,n.jsx)("path",{d:"M6 19h4V5H6zm8-14v14h4V5z"}),"Pause"),Nt}const Wt=t(Yt());var Vt,Ut={};function qt(){if(Vt)return Ut;Vt=1;var e=s();Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.default=void 0;var t=e(yt()),n=r();return Ut.default=(0,t.default)((0,n.jsx)("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8m-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91"}),"RestartAlt"),Ut}const Gt=t(qt());function Kt({id:e,initialTimeProp:t,initialEndTimeProp:n,resultText:i,isRunningProp:s=!1,onExpireFunc:r=null,handleCloseTimer:o=null,handleUpdateTimers:a=null,playSoundProp:p=!0,soundUrl:f="/sounds/endTimer.mp3",currentActionId:m=null}){const[g,v]=l.useState(!0),[y,x]=l.useState(i||"Таймер завершился"),b=s?n?new Date(n):new Date:t?new Date((new Date).getTime()+1e3*t):new Date,w=b.getTime()-(new Date).getTime(),[k,j]=l.useState({days:Math.trunc(w/864e5),hours:Math.trunc(w%864e5/36e5),minutes:Math.trunc(w%36e5/6e4),seconds:Math.trunc(w%6e4/1e3)});l.useEffect((()=>{if(m===e){if(!(T+60*S+3600*C+86400*_)&&r)return void r(e);O()}}),[m]);const{seconds:T,minutes:S,hours:C,days:_,isRunning:E,pause:L,restart:I}=At.useTimer({expiryTimestamp:b,onExpire:function(){let t=Promise.resolve();if(p&&f){const e=new Audio(f);t=new Promise((t=>{e.onended=t,e.play()}))}t.then((()=>{fetch("/get_tts_audio",{method:"POST",body:new URLSearchParams({text:y}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{if(!e.ok)throw new Error("Network response was not ok "+e.statusText);return e.blob()})).then((e=>new Promise((t=>{const n=URL.createObjectURL(e),i=new Audio(n);i.onended=t,i.play()})))).catch((e=>{}))})).then((()=>{R(),r&&r(e)}))},autoStart:!1});function M(e){const{name:t,value:n}=e.target;j((e=>({...e,[t]:parseInt(n,10)||0})))}function O(){const e=new Date;e.setSeconds(e.getSeconds()+k.seconds+60*k.minutes+3600*k.hours+86400*k.days),e>new Date&&I(e)}function R(){j({days:0,hours:0,minutes:0,seconds:0})}return l.useEffect((()=>{E&&j({days:_,hours:C,minutes:S,seconds:T})}),[E,_,C,S,T]),l.useEffect((()=>{if(g)v(!1);else{if(!E){a&&a(e,{initialTimeProp:T+60*S+3600*C+86400*_,resultText:y,isRunningProp:!1})}if(E){const t=new Date;t.setSeconds(t.getSeconds()+T+60*S+3600*C+86400*_),a&&a(e,{initialEndTimeProp:t.toISOString(),isRunningProp:!0})}}}),[E]),l.useEffect((()=>{s&&O()}),[s]),c.jsxs(u,{textAlign:"center",border:1,padding:"3px",sx:{maxWidth:"450px"},children:[c.jsx(u,{textAlign:"right",children:c.jsx(d,{size:"small",onClick:()=>{o&&o(e)},children:c.jsx(bt,{fontSize:"inherit"})})}),c.jsx(h,{size:"small",value:y,onChange:e=>x(e.target.value),onBlur:()=>{a&&a(e,{resultText:y})},style:{width:"calc(100% - 20px)",margin:"0px 0px"}}),c.jsxs(u,{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"30px",marginTop:1,children:[c.jsxs(u,{children:[c.jsx(d,{onClick:E?L:O,children:E?c.jsx(Wt,{}):c.jsx($t,{})}),c.jsx(d,{onClick:function(){L(),R()},children:c.jsx(Gt,{})})]}),c.jsx(h,{size:"small",type:"number",name:"hours",value:k.hours+24*k.days,onChange:M,disabled:E,inputProps:{min:0},style:{width:"70px"}}),":",c.jsx(h,{size:"small",type:"number",name:"minutes",value:k.minutes,onChange:M,disabled:E,inputProps:{min:0,max:59},style:{width:"70px"}}),":",c.jsx(h,{size:"small",type:"number",name:"seconds",value:k.seconds,onChange:M,disabled:E,inputProps:{min:0,max:59},style:{width:"70px"}})]})]})}Kt.propTypes={id:a.PropTypes.string,initialTimeProp:a.PropTypes.number,initialEndTimeProp:a.PropTypes.string,resultText:a.PropTypes.string,isRunningProp:a.PropTypes.bool,playSoundProp:a.PropTypes.bool,soundUrl:a.PropTypes.string,onExpireFunc:a.PropTypes.func,handleCloseTimer:a.PropTypes.func,handleUpdateTimers:a.PropTypes.func,currentActionId:a.PropTypes.string};var Jt,Zt={};function Xt(){if(Jt)return Zt;Jt=1;var e=s();Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.default=void 0;var t=e(yt()),n=r();return Zt.default=(0,t.default)((0,n.jsx)("path",{d:"M6 6h12v12H6z"}),"Stop"),Zt}const Qt=t(Xt());function en({id:e,initialName:t="Metronome",initialBpm:n=120,initialCount:i=0,isRunningProp:s=!1,onExpireFunc:r=null,currentActionId:o=null}){const[a,d]=l.useState(t),[g,v]=l.useState(parseInt(n)),[y,x]=l.useState(parseInt(i)),[b,w]=l.useState(s),k=l.useRef(null),j=l.useRef(0),T=new Audio("/sounds/click1.mp3");function S(){if(k.current)return;const e=60/g*1e3;j.current=0,k.current=setInterval((()=>{T.play(),j.current+=1,j.current>=y&&y>1&&(C(),w(!1),j.current=0,r&&r(o))}),e)}l.useEffect((()=>(b?S():C(),()=>C())),[b,g,y]),l.useEffect((()=>{o===e&&S()}),[o]);const C=()=>{k.current&&(clearInterval(k.current),k.current=null)};return c.jsxs(u,{sx:{p:2,textAlign:"center",border:1,height:"320px"},children:[c.jsx(h,{fullWidth:!0,size:"small",value:a,onChange:e=>d(e.target.value),variant:"outlined",label:"Name"}),c.jsxs(p,{variant:"h6",sx:{mt:2},children:[g," BPM"]}),c.jsx(f,{value:g,onChange:(e,t)=>{v(t)},min:1,max:240,step:1,valueLabelDisplay:"auto",sx:{mt:2}}),c.jsxs(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:2},children:[c.jsx(m,{onClick:()=>w(!0),variant:"outlined",startIcon:c.jsx($t,{}),children:"Start"}),c.jsx(m,{onClick:()=>w(!1),variant:"outlined",startIcon:c.jsx(Qt,{}),sx:{ml:2},children:"Stop"})]}),c.jsx(h,{fullWidth:!0,size:"small",type:"number",value:y,onChange:e=>{x(e.target.value)},variant:"outlined",label:"Ticks Count",sx:{mt:2}})]})}en.propTypes={id:a.PropTypes.string,initialName:a.PropTypes.string,initialBpm:a.PropTypes.oneOfType([a.PropTypes.number,a.PropTypes.string]),initialCount:a.PropTypes.oneOfType([a.PropTypes.number,a.PropTypes.string]),isRunningProp:a.PropTypes.bool,onExpireFunc:a.PropTypes.func,currentActionId:a.PropTypes.string};var tn,nn={};function sn(){if(tn)return nn;tn=1;var e=s();Object.defineProperty(nn,"__esModule",{value:!0}),nn.default=void 0;var t=e(yt()),n=r();return nn.default=(0,t.default)((0,n.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),nn}const rn=t(sn());var on,an={};function ln(){if(on)return an;on=1;var e=s();Object.defineProperty(an,"__esModule",{value:!0}),an.default=void 0;var t=e(yt()),n=r();return an.default=(0,t.default)((0,n.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),an}const cn=t(ln()),un=Object.create(null);un.open="0",un.close="1",un.ping="2",un.pong="3",un.message="4",un.upgrade="5",un.noop="6";const dn=Object.create(null);Object.keys(un).forEach((e=>{dn[un[e]]=e}));const hn={type:"error",data:"parser error"},pn="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),fn="function"==typeof ArrayBuffer,mn=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,gn=({type:e,data:t},n,i)=>pn&&t instanceof Blob?n?i(t):vn(t,i):fn&&(t instanceof ArrayBuffer||mn(t))?n?i(t):vn(new Blob([t]),i):i(un[e]+(t||"")),vn=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function yn(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let xn;const bn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",wn="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let mp=0;mp<64;mp++)wn[bn.charCodeAt(mp)]=mp;const kn="function"==typeof ArrayBuffer,jn=(e,t)=>{if("string"!=typeof e)return{type:"message",data:Sn(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:Tn(e.substring(1),t)};return dn[n]?e.length>1?{type:dn[n],data:e.substring(1)}:{type:dn[n]}:hn},Tn=(e,t)=>{if(kn){const n=(e=>{let t,n,i,s,r,o=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const c=new ArrayBuffer(o),u=new Uint8Array(c);for(t=0;t<a;t+=4)n=wn[e.charCodeAt(t)],i=wn[e.charCodeAt(t+1)],s=wn[e.charCodeAt(t+2)],r=wn[e.charCodeAt(t+3)],u[l++]=n<<2|i>>4,u[l++]=(15&i)<<4|s>>2,u[l++]=(3&s)<<6|63&r;return c})(e);return Sn(n,t)}return{base64:!0,data:e}},Sn=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,Cn=String.fromCharCode(30);function _n(){return new TransformStream({transform(e,t){!function(e,t){pn&&e.data instanceof Blob?e.data.arrayBuffer().then(yn).then(t):fn&&(e.data instanceof ArrayBuffer||mn(e.data))?t(yn(e.data)):gn(e,!1,(e=>{xn||(xn=new TextEncoder),t(xn.encode(e))}))}(e,(n=>{const i=n.length;let s;if(i<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,i);else if(i<65536){s=new Uint8Array(3);const e=new DataView(s.buffer);e.setUint8(0,126),e.setUint16(1,i)}else{s=new Uint8Array(9);const e=new DataView(s.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!=typeof e.data&&(s[0]|=128),t.enqueue(s),t.enqueue(n)}))}})}let En;function Ln(e){return e.reduce(((e,t)=>e+t.length),0)}function In(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let i=0;for(let s=0;s<t;s++)n[s]=e[0][i++],i===e[0].length&&(e.shift(),i=0);return e.length&&i<e[0].length&&(e[0]=e[0].slice(i)),n}function Mn(e){if(e)return function(e){for(var t in Mn.prototype)e[t]=Mn.prototype[t];return e}(e)}Mn.prototype.on=Mn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Mn.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Mn.prototype.off=Mn.prototype.removeListener=Mn.prototype.removeAllListeners=Mn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<i.length;s++)if((n=i[s])===t||n.fn===t){i.splice(s,1);break}return 0===i.length&&delete this._callbacks["$"+e],this},Mn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(n){i=0;for(var s=(n=n.slice(0)).length;i<s;++i)n[i].apply(this,t)}return this},Mn.prototype.emitReserved=Mn.prototype.emit,Mn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Mn.prototype.hasListeners=function(e){return!!this.listeners(e).length};const On="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Rn="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Dn(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const Pn=Rn.setTimeout,zn=Rn.clearTimeout;function An(e,t){t.useNativeTimers?(e.setTimeoutFn=Pn.bind(Rn),e.clearTimeoutFn=zn.bind(Rn)):(e.setTimeoutFn=Rn.setTimeout.bind(Rn),e.clearTimeoutFn=Rn.clearTimeout.bind(Rn))}function Bn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class Hn extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class $n extends Mn{constructor(e){super(),this.writable=!1,An(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new Hn(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=jn(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}class Fn extends $n{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(Cn),i=[];for(let s=0;s<n.length;s++){const e=jn(n[s],t);if(i.push(e),"error"===e.type)break}return i})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,i=new Array(n);let s=0;e.forEach(((e,r)=>{gn(e,!1,(e=>{i[r]=e,++s===n&&t(i.join(Cn))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=Bn()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let Nn=!1;try{Nn="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(fp){}const Yn=Nn;function Wn(){}class Vn extends Fn{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}class Un extends Mn{constructor(e,t,n){super(),this.createRequest=e,An(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var e;const t=Dn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(Pt){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Pt){}try{n.setRequestHeader("Accept","*/*")}catch(Pt){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn((()=>{this._onError("number"==typeof n.status?n.status:0)}),0))},n.send(this._data)}catch(Pt){return void this.setTimeoutFn((()=>{this._onError(Pt)}),0)}"undefined"!=typeof document&&(this._index=Un.requestsCount++,Un.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=Wn,e)try{this._xhr.abort()}catch(Pt){}"undefined"!=typeof document&&delete Un.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(Un.requestsCount=0,Un.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",qn);else if("function"==typeof addEventListener){addEventListener("onpagehide"in Rn?"pagehide":"unload",qn,!1)}function qn(){for(let e in Un.requests)Un.requests.hasOwnProperty(e)&&Un.requests[e].abort()}const Gn=function(){const e=Kn({xdomain:!1});return e&&null!==e.responseType}();function Kn(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||Yn))return new XMLHttpRequest}catch(Pt){}if(!t)try{return new(Rn[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(Pt){}}const Jn="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Zn extends $n{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=Jn?{}:Dn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(fp){return this.emitReserved("error",fp)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;gn(n,this.supportsBinary,(e=>{try{this.doWrite(n,e)}catch(Pt){}i&&On((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Bn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Xn=Rn.WebSocket||Rn.MozWebSocket;const Qn={websocket:class extends Zn{createSocket(e,t,n){return Jn?new Xn(e,t,n):t?new Xn(e,t):new Xn(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends $n{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(fp){return this.emitReserved("error",fp)}this._transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this._transport.ready.then((()=>{this._transport.createBidirectionalStream().then((e=>{const t=function(e,t){En||(En=new TextDecoder);const n=[];let i=0,s=-1,r=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(0===i){if(Ln(n)<1)break;const e=In(n,1);r=!(128&~e[0]),s=127&e[0],i=s<126?3:126===s?1:2}else if(1===i){if(Ln(n)<2)break;const e=In(n,2);s=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),i=3}else if(2===i){if(Ln(n)<8)break;const e=In(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),r=t.getUint32(0);if(r>Math.pow(2,21)-1){a.enqueue(hn);break}s=r*Math.pow(2,32)+t.getUint32(4),i=3}else{if(Ln(n)<s)break;const e=In(n,s);a.enqueue(jn(r?e:En.decode(e),t)),i=0}if(0===s||s>e){a.enqueue(hn);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=_n();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const s=()=>{n.read().then((({done:e,value:t})=>{e||(this.onPacket(t),s())})).catch((e=>{}))};s();const r={type:"open"};this.query.sid&&(r.data=`{"sid":"${this.query.sid}"}`),this._writer.write(r).then((()=>this.onOpen()))}))}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;this._writer.write(n).then((()=>{i&&On((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends Vn{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Gn&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Un(Kn,this.uri(),e)}}},ei=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ti=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ni(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));let s=ei.exec(e||""),r={},o=14;for(;o--;)r[ti[o]]=s[o]||"";return-1!=n&&-1!=i&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=function(e,t){const n=/\/{2,9}/g,i=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||i.splice(0,1);"/"==t.slice(-1)&&i.splice(i.length-1,1);return i}(0,r.path),r.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,i){t&&(n[t]=i)})),n}(0,r.query),r}const ii="function"==typeof addEventListener&&"function"==typeof removeEventListener,si=[];ii&&addEventListener("offline",(()=>{si.forEach((e=>e()))}),!1);class ri extends Mn{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const n=ni(e);t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=ni(t.host).host);An(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach((e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e})),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let i=0,s=n.length;i<s;i++){let e=n[i].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),ii&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},si.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);const e=this.opts.rememberUpgrade&&ri.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(e=>this._onClose("transport close",e)))}onOpen(){this.readyState="open",ri.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn((()=>{this._onClose("ping timeout")}),e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(e+="string"==typeof(t=i)?function(e){let t=0,n=0;for(let i=0,s=e.length;i<s;i++)t=e.charCodeAt(i),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(i++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this._maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,On((()=>{this._onClose("ping timeout")}),this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,i){if("function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}_onError(e){if(ri.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ii&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=si.indexOf(this._offlineEventListener);-1!==e&&si.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}ri.protocol=4;class oi extends ri{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;ri.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ri.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function s(){n||(n=!0,c(),t.close(),t=null)}const r=e=>{const n=new Error("probe error: "+e);n.transport=t.name,s(),this.emitReserved("upgradeError",n)};function o(){r("transport closed")}function a(){r("socket closed")}function l(e){t&&e.name!==t.name&&s()}const c=()=>{t.removeListener("open",i),t.removeListener("error",r),t.removeListener("close",o),this.off("close",a),this.off("upgrading",l)};t.once("open",i),t.once("error",r),t.once("close",o),this.once("close",a),this.once("upgrading",l),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{n||t.open()}),200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}let ai=class extends oi{constructor(e,t={}){const n="object"==typeof e?e:t;(!n.transports||n.transports&&"string"==typeof n.transports[0])&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map((e=>Qn[e])).filter((e=>!!e))),super(e,n)}};const li="function"==typeof ArrayBuffer,ci=Object.prototype.toString,ui="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ci.call(Blob),di="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ci.call(File);function hi(e){return li&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||ui&&e instanceof Blob||di&&e instanceof File}function pi(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(pi(e[t]))return!0;return!1}if(hi(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return pi(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&pi(e[n]))return!0;return!1}function fi(e){const t=[],n=e.data,i=e;return i.data=mi(n,t),i.attachments=t.length,{packet:i,buffers:t}}function mi(e,t){if(!e)return e;if(hi(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let i=0;i<e.length;i++)n[i]=mi(e[i],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=mi(e[i],t));return n}return e}function gi(e,t){return e.data=vi(e.data,t),delete e.attachments,e}function vi(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=vi(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=vi(e[n],t));return e}const yi=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var xi,bi;(bi=xi||(xi={}))[bi.CONNECT=0]="CONNECT",bi[bi.DISCONNECT=1]="DISCONNECT",bi[bi.EVENT=2]="EVENT",bi[bi.ACK=3]="ACK",bi[bi.CONNECT_ERROR=4]="CONNECT_ERROR",bi[bi.BINARY_EVENT=5]="BINARY_EVENT",bi[bi.BINARY_ACK=6]="BINARY_ACK";function wi(e){return"[object Object]"===Object.prototype.toString.call(e)}class ki extends Mn{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===xi.BINARY_EVENT;n||t.type===xi.BINARY_ACK?(t.type=n?xi.EVENT:xi.ACK,this.reconstructor=new ji(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!hi(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===xi[n.type])throw new Error("unknown packet type "+n.type);if(n.type===xi.BINARY_EVENT||n.type===xi.BINARY_ACK){const i=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const s=e.substring(i,t);if(s!=Number(s)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(s)}if("/"===e.charAt(t+1)){const i=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(i,t)}else n.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const i=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(!ki.isPayloadValid(n.type,i))throw new Error("invalid payload");n.data=i}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(Pt){return!1}}static isPayloadValid(e,t){switch(e){case xi.CONNECT:return wi(t);case xi.DISCONNECT:return void 0===t;case xi.CONNECT_ERROR:return"string"==typeof t||wi(t);case xi.EVENT:case xi.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===yi.indexOf(t[0]));case xi.ACK:case xi.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ji{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=gi(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Ti=Object.freeze(Object.defineProperty({__proto__:null,Decoder:ki,Encoder:class{constructor(e){this.replacer=e}encode(e){return e.type!==xi.EVENT&&e.type!==xi.ACK||!pi(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===xi.EVENT?xi.BINARY_EVENT:xi.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==xi.BINARY_EVENT&&e.type!==xi.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=fi(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}},get PacketType(){return xi},protocol:5},Symbol.toStringTag,{value:"Module"}));function Si(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Ci=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class _i extends Mn{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Si(e,"open",this.onopen.bind(this)),Si(e,"packet",this.onpacket.bind(this)),Si(e,"error",this.onerror.bind(this)),Si(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var n,i,s;if(Ci.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:xi.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,n=t.pop();this._registerAckCallback(e,n),r.id=e}const o=null===(i=null===(n=this.io.engine)||void 0===n?void 0:n.transport)||void 0===i?void 0:i.writable,a=this.connected&&!(null===(s=this.io.engine)||void 0===s?void 0:s._hasPingExpired());return this.flags.volatile&&!o||(a?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var n;const i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const s=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),i),r=(...e)=>{this.io.clearTimeoutFn(s),t.apply(this,e)};r.withError=!0,this.acks[e]=r}emitWithAck(e,...t){return new Promise(((n,i)=>{const s=(e,t)=>e?i(e):n(t);s.withError=!0,t.push(s),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...i)=>{if(n!==this._queue[0])return;return null!==e?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...i)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:xi.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((e=>{if(!this.sendBuffer.some((t=>String(t.id)===e))){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}}))}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case xi.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case xi.EVENT:case xi.BINARY_EVENT:this.onevent(e);break;case xi.ACK:case xi.BINARY_ACK:this.onack(e);break;case xi.DISCONNECT:this.ondisconnect();break;case xi.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:xi.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:xi.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Ei(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ei.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},Ei.prototype.reset=function(){this.attempts=0},Ei.prototype.setMin=function(e){this.ms=e},Ei.prototype.setMax=function(e){this.max=e},Ei.prototype.setJitter=function(e){this.jitter=e};class Li extends Mn{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,An(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new Ei({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Ti;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ai(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=Si(t,"open",(function(){n.onopen(),e&&e()})),s=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},r=Si(t,"error",s);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{i(),s(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(i),this.subs.push(r),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Si(e,"ping",this.onping.bind(this)),Si(e,"data",this.ondata.bind(this)),Si(e,"error",this.onerror.bind(this)),Si(e,"close",this.onclose.bind(this)),Si(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(Pt){this.onclose("parse error",Pt)}}ondecoded(e){On((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new _i(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t){if(this.nsps[n].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ii={};function Mi(e,t){"object"==typeof e&&(t=e,e=void 0);const n=function(e,t="",n){let i=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),i=ni(e)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const s=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+s+":"+i.port+t,i.href=i.protocol+"://"+s+(n&&n.port===i.port?"":":"+i.port),i}(e,(t=t||{}).path||"/socket.io"),i=n.source,s=n.id,r=n.path,o=Ii[s]&&r in Ii[s].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new Li(i,t):(Ii[s]||(Ii[s]=new Li(i,t)),a=Ii[s]),n.query&&!t.query&&(t.query=n.queryKey),a.socket(n.path,t)}Object.assign(Mi,{Manager:Li,Socket:_i,io:Mi,connect:Mi});const Oi=l.createContext(null),Ri=({children:e})=>{const[t,n]=l.useState(null),[i,s]=l.useState([]),[r,o]=l.useState(!1),[a,u]=l.useState([]),{setUpdates:d,addContainer:h}=Kd();l.useEffect((()=>{var e;const t=i[i.length-1];t&&t.context&&t.context.UPDATES&&d((e=>[...e,...t.context.UPDATES])),t&&t.context&&(null==(e=t.context)?void 0:e.component)&&h(t.context.component,t.context.params)}),[r]),l.useEffect((()=>{const e=Mi("/chat",{transports:["websocket"]});return e.on("connect",(()=>{e.emit("request_messages")})),e.on("all_messages",(e=>{s(e)})),e.on("message",(e=>{s((t=>[...t,e])),o(!0)})),e.on("disconnect",(()=>{})),n(e),()=>{e.disconnect()}}),[]);return c.jsx(Oi.Provider,{value:{messages:i,isNewMessage:r,setIsNewMessage:o,sendMessage:async function(e){return new Promise(((n,i)=>{t?(t.emit("new_message",e),t.on("message",(async e=>{if(e.error)i(new Error(e.error));else try{n(e)}catch(t){i(t)}}))):i(new Error("Socket is not connected"))}))},sendMessageAPI:async function(e,t,n){const i=(new Date).getTimezoneOffset();n||(n=a);const r=new FormData;r.append("user_id",e),r.append("text",t),r.append("timeZone",i),n.forEach(((e,t)=>{r.append(`files[${t}]`,e)}));const l=await fetch("/chat/new_message",{method:"POST",body:r}),c=await l.json();if(201!=c.status_code)throw new Error("Message sending failed");u([]),s((e=>[...e,...c.messages])),o(!0)},sendTranscript:function(e){const n=(new Date).getTimezoneOffset();if(t)try{const i={...e,timeZone:n};t.emit("new_transcript",i)}catch(i){}},sendEditedRecord:e=>{const n=(new Date).getTimezoneOffset();return new Promise(((i,s)=>{if(!t)return void s(new Error("Socket is not connected"));const r=setTimeout((()=>{s(new Error("Server timeout"))}),5e3);t.emit("post_edited_record",e,n),t.on("post_edited_record_response",(e=>{clearTimeout(r),"OK"===e.status?i(e):s(new Error(e.message||"An unexpected error occurred"))}))}))},files:a,setFiles:u},children:e})};Ri.propTypes={children:g.node.isRequired};const Di=()=>l.useContext(Oi),Pi=v((e=>{const{...t}=e;return c.jsx(d,{...t})}))((({theme:e,expand:t})=>({transform:t?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})})));function zi({message:e,message_time:t}){const[n,i]=l.useState(!1),{user:s,text:r,files:o,params:a}=e,{user_name:u,avatar_src:f}=s,g=`/avatars/${f}`,[v,L]=l.useState(a),[I,M]=l.useState(!1),[O,R]=l.useState(!1),{sendEditedRecord:D}=Di(),[P,z]=l.useState(!1);return c.jsxs(y,{sx:{width:"90%",mb:.5,border:I?`2px solid ${x[500]}`:"none",boxShadow:2},children:[c.jsx(b,{avatar:c.jsx(k,{sx:{bgcolor:x[500]},"aria-label":"avatar",children:f?c.jsx("img",{src:g,alt:"avatar",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%"}}):u.charAt(0).toUpperCase()}),action:c.jsx(d,{"aria-label":"settings",children:c.jsx(w,{children:"more_vert"})}),title:u,subheader:t}),o&&c.jsx(j,{component:"img",height:"194",image:o,alt:"image"}),c.jsx(T,{children:c.jsx(p,{variant:"body2",color:"text.secondary",children:r})}),c.jsx(S,{disableSpacing:!0,children:a&&c.jsx(Pi,{expand:n?"true":void 0,onClick:function(){i(!n)},"aria-expanded":n,"aria-label":"show more",children:c.jsx(cn,{})})}),a&&c.jsx(C,{in:n,timeout:"auto",unmountOnExit:!0,children:c.jsxs(T,{children:[Object.keys(a).map((e=>"id"!==e&&"date"!==e&&"files"!==e&&"time"!==e&&"table_name"!==e&&c.jsx("div",{style:{marginBottom:"1rem"},children:c.jsx(h,{id:e+"_message_id",label:e,multiline:!0,maxRows:15,fullWidth:!0,value:v[e]||"",onChange:t=>function(e,t){L((n=>({...n,[e]:t})))}(e,t.target.value)})},e))),O?c.jsx(_,{size:24}):c.jsx(m,{onClick:async function(){M(!1),R(!0);try{await D(v),z(!0)}catch(e){M(e.message||"An unexpected error occurred")}finally{R(!1)}},disabled:O,children:"Отправить"}),I&&c.jsx("p",{style:{color:"red"},children:I}),P&&c.jsx(E,{icon:c.jsx(rn,{fontSize:"inherit"}),severity:"success",children:"Запись обновлена"})]})})]})}zi.propTypes={message_time:g.string.isRequired,message:g.shape({message_id:g.string,user:g.shape({user_name:g.string.isRequired,avatar_src:g.string}).isRequired,files:g.string,text:g.string.isRequired,params:g.object}).isRequired,error:g.shape({text:g.string,code:g.string})};function Ai(e){return()=>e}function Bi(e){e()}function Hi(e,t){return n=>e(t(n))}function $i(e,t){return()=>e(t)}function Fi(e,t){return n=>e(t,n)}function Ni(e){return void 0!==e}function Yi(){}function Wi(e,t){return t(e),e}function Vi(e,t){return t(e)}function Ui(...e){return e}function qi(e,t){return e(1,t)}function Gi(e,t){e(0,t)}function Ki(e){e(2)}function Ji(e){return e(4)}function Zi(e,t){return qi(e,Fi(t,0))}function Xi(e,t){const n=e(1,(e=>{n(),t(e)}));return n}function Qi(e){let t,n;return i=>s=>{t=s,n&&clearTimeout(n),n=setTimeout((()=>{i(t)}),e)}}function es(e,t){return e===t}function ts(e=es){let t;return n=>i=>{e(t,i)||(t=i,n(i))}}function ns(e){return t=>n=>{e(n)&&t(n)}}function is(e){return t=>Hi(t,e)}function ss(e){return t=>()=>{t(e)}}function rs(e,...t){const n=function(...e){return t=>e.reduceRight(Vi,t)}(...t);return(t,i)=>{switch(t){case 2:return void Ki(e);case 1:return qi(e,n(i))}}}function os(e,t){return n=>i=>{n(t=e(t,i))}}function as(e){return t=>n=>{e>0?e--:t(n)}}function ls(e){let t,n=null;return i=>s=>{n=s,!t&&(t=setTimeout((()=>{t=void 0,i(n)}),e))}}function cs(...e){const t=new Array(e.length);let n=0,i=null;const s=Math.pow(2,e.length)-1;return e.forEach(((e,r)=>{const o=Math.pow(2,r);qi(e,(e=>{const a=n;n|=o,t[r]=e,a!==s&&n===s&&i&&(i(),i=null)}))})),e=>r=>{const o=()=>{e([r].concat(t))};n===s?o():i=o}}function us(e){let t=e;const n=hs();return(e,i)=>{switch(e){case 0:t=i;break;case 1:i(t);break;case 4:return t}return n(e,i)}}function ds(e,t){return Wi(us(t),(t=>Zi(e,t)))}function hs(){const e=[];return(t,n)=>{switch(t){case 0:return void e.slice().forEach((e=>{e(n)}));case 2:return void e.splice(0,e.length);case 1:return e.push(n),()=>{const t=e.indexOf(n);t>-1&&e.splice(t,1)}}}}function ps(e){return Wi(hs(),(t=>Zi(e,t)))}function fs(e,t=[],{singleton:n}={singleton:!0}){return{constructor:e,dependencies:t,id:ms(),singleton:n}}const ms=()=>Symbol();function gs(...e){const t=hs(),n=new Array(e.length);let i=0;const s=Math.pow(2,e.length)-1;return e.forEach(((e,r)=>{const o=Math.pow(2,r);qi(e,(e=>{n[r]=e,i|=o,i===s&&Gi(t,n)}))})),function(e,r){switch(e){case 2:return void Ki(t);case 1:return i===s&&r(n),qi(t,r)}}}function vs(e,t=es){return rs(e,ts(t))}function ys(...e){return function(t,n){switch(t){case 2:return;case 1:return function(...e){return()=>{e.map(Bi)}}(...e.map((e=>qi(e,n))))}}}var xs=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(xs||{});const bs=fs((()=>{const e=us(3);return{log:us(((t,n,i=1)=>{var s;null!=(s=(typeof globalThis>"u"?window:globalThis).VIRTUOSO_LOG_LEVEL)||Ji(e)})),logLevel:e}}),[],{singleton:!0});function ws(e,t,n){return ks(e,t,n).callbackRef}function ks(e,t,n){const i=L.useRef(null);let s=e=>{};if(typeof ResizeObserver<"u"){const r=L.useMemo((()=>new ResizeObserver((t=>{const i=()=>{const n=t[0].target;null!==n.offsetParent&&e(n)};n?i():requestAnimationFrame(i)}))),[e]);s=e=>{e&&t?(r.observe(e),i.current=e):(i.current&&r.unobserve(i.current),i.current=null)}}return{callbackRef:s,ref:i}}function js(e,t,n,i,s,r,o,a,l){const c=L.useCallback((n=>{const l=function(e,t,n,i){const s=e.length;if(0===s)return null;const r=[];for(let o=0;o<s;o++){const s=e.item(o);if(void 0===s.dataset.index)continue;const a=parseInt(s.dataset.index),l=parseFloat(s.dataset.knownSize),c=t(s,n);if(0===c&&i("Zero-sized element, this should not happen",{child:s},xs.ERROR),c===l)continue;const u=r[r.length-1];0===r.length||u.size!==c||u.endIndex!==a-1?r.push({endIndex:a,size:c,startIndex:a}):r[r.length-1].endIndex++}return r}(n.children,t,a?"offsetWidth":"offsetHeight",s);let c=n.parentElement;for(;!c.dataset.virtuosoScroller;)c=c.parentElement;const u="window"===c.lastElementChild.dataset.viewportType;let d;u&&(d=c.ownerDocument.defaultView);const h=o?a?o.scrollLeft:o.scrollTop:u?a?d.scrollX||d.document.documentElement.scrollLeft:d.scrollY||d.document.documentElement.scrollTop:a?c.scrollLeft:c.scrollTop,p=o?a?o.scrollWidth:o.scrollHeight:u?a?d.document.documentElement.scrollWidth:d.document.documentElement.scrollHeight:a?c.scrollWidth:c.scrollHeight,f=o?a?o.offsetWidth:o.offsetHeight:u?a?d.innerWidth:d.innerHeight:a?c.offsetWidth:c.offsetHeight;i({scrollHeight:p,scrollTop:Math.max(h,0),viewportHeight:f}),null==r||r(a?Ts("column-gap",getComputedStyle(n).columnGap,s):Ts("row-gap",getComputedStyle(n).rowGap,s)),null!==l&&e(l)}),[e,t,s,r,o,i]);return ks(c,n,l)}function Ts(e,t,n){return"normal"!==t&&!(null!=t&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,xs.WARN),"normal"===t?0:parseInt(null!=t?t:"0",10)}function Ss(e,t,n){const i=L.useRef(null),s=L.useCallback((n=>{if(null==n||!n.offsetParent)return;const s=n.getBoundingClientRect(),r=s.width;let a,l;if(t){const e=t.getBoundingClientRect(),n=s.top-e.top;l=e.height-Math.max(0,n),a=n+t.scrollTop}else{const e=o.current.ownerDocument.defaultView;l=e.innerHeight-Math.max(0,s.top),a=s.top+e.scrollY}i.current={offsetTop:a,visibleHeight:l,visibleWidth:r},e(i.current)}),[e,t]),{callbackRef:r,ref:o}=ks(s,!0,n),a=L.useCallback((()=>{s(o.current)}),[s,o]);return L.useEffect((()=>{var e;if(t){t.addEventListener("scroll",a);const e=new ResizeObserver((()=>{requestAnimationFrame(a)}));return e.observe(t),()=>{t.removeEventListener("scroll",a),e.unobserve(t)}}{const t=null==(e=o.current)?void 0:e.ownerDocument.defaultView;return null==t||t.addEventListener("scroll",a),null==t||t.addEventListener("resize",a),()=>{null==t||t.removeEventListener("scroll",a),null==t||t.removeEventListener("resize",a)}}}),[a,t]),r}const Cs=fs((()=>{const e=hs(),t=hs(),n=us(0),i=hs(),s=us(0),r=hs(),o=hs(),a=us(0),l=us(0),c=us(0),u=us(0),d=hs(),h=hs(),p=us(!1),f=us(!1),m=us(!1);return Zi(rs(e,is((({scrollTop:e})=>e))),t),Zi(rs(e,is((({scrollHeight:e})=>e))),o),Zi(t,s),{deviation:n,fixedFooterHeight:c,fixedHeaderHeight:l,footerHeight:u,headerHeight:a,horizontalDirection:f,scrollBy:h,scrollContainerState:e,scrollHeight:o,scrollingInProgress:p,scrollTo:d,scrollTop:t,skipAnimationFrameInResizeObserver:m,smoothScrollTargetReached:i,statefulScrollTop:s,viewportHeight:r}}),[],{singleton:!0}),_s={lvl:0};function Es(e,t){const n=e.length;if(0===n)return[];let{index:i,value:s}=t(e[0]);const r=[];for(let o=1;o<n;o++){const{index:n,value:a}=t(e[o]);r.push({end:n-1,start:i,value:s}),i=n,s=a}return r.push({end:1/0,start:i,value:s}),r}function Ls(e){return e===_s}function Is(e,t){if(!Ls(e))return t===e.k?e.v:t<e.k?Is(e.l,t):Is(e.r,t)}function Ms(e,t,n="k"){if(Ls(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const i=Ms(e.r,t,n);return i[0]===-1/0?[e.k,e.v]:i}return Ms(e.l,t,n)}function Os(e,t,n){return Ls(e)?Ys(t,n,1):t===e.k?Hs(e,{k:t,v:n}):t<e.k?Ws(Hs(e,{l:Os(e.l,t,n)})):Ws(Hs(e,{r:Os(e.r,t,n)}))}function Rs(){return _s}function Ds(e,t,n){if(Ls(e))return[];return function(e){return Es(e,(({k:e,v:t})=>({index:e,value:t})))}(As(e,Ms(e,t)[0],n))}function Ps(e,t){if(Ls(e))return _s;const{k:n,l:i,r:s}=e;if(t===n){if(Ls(i))return s;if(Ls(s))return i;{const[t,n]=Ns(i);return Bs(Hs(e,{k:t,l:$s(i),v:n}))}}return Bs(Hs(e,t<n?{l:Ps(i,t)}:{r:Ps(s,t)}))}function zs(e){return Ls(e)?[]:[...zs(e.l),{k:e.k,v:e.v},...zs(e.r)]}function As(e,t,n){if(Ls(e))return[];const{k:i,l:s,r:r,v:o}=e;let a=[];return i>t&&(a=a.concat(As(s,t,n))),i>=t&&i<=n&&a.push({k:i,v:o}),i<=n&&(a=a.concat(As(r,t,n))),a}function Bs(e){const{l:t,lvl:n,r:i}=e;if(i.lvl>=n-1&&t.lvl>=n-1)return e;if(n>i.lvl+1){if(Fs(t))return Vs(Hs(e,{lvl:n-1}));if(!Ls(t)&&!Ls(t.r))return Hs(t.r,{l:Hs(t,{r:t.r.l}),lvl:n,r:Hs(e,{l:t.r.r,lvl:n-1})});throw new Error("Unexpected empty nodes")}if(Fs(e))return Us(Hs(e,{lvl:n-1}));if(Ls(i)||Ls(i.l))throw new Error("Unexpected empty nodes");{const t=i.l,s=Fs(t)?i.lvl-1:i.lvl;return Hs(t,{l:Hs(e,{lvl:n-1,r:t.l}),lvl:t.lvl+1,r:Us(Hs(i,{l:t.r,lvl:s}))})}}function Hs(e,t){return Ys(void 0!==t.k?t.k:e.k,void 0!==t.v?t.v:e.v,void 0!==t.lvl?t.lvl:e.lvl,void 0!==t.l?t.l:e.l,void 0!==t.r?t.r:e.r)}function $s(e){return Ls(e.r)?e.l:Bs(Hs(e,{r:$s(e.r)}))}function Fs(e){return Ls(e)||e.lvl>e.r.lvl}function Ns(e){return Ls(e.r)?[e.k,e.v]:Ns(e.r)}function Ys(e,t,n,i=_s,s=_s){return{k:e,l:i,lvl:n,r:s,v:t}}function Ws(e){return Us(Vs(e))}function Vs(e){const{l:t}=e;return Ls(t)||t.lvl!==e.lvl?e:Hs(t,{r:Hs(e,{l:t.r})})}function Us(e){const{lvl:t,r:n}=e;return Ls(n)||Ls(n.r)||n.lvl!==t||n.r.lvl!==t?e:Hs(n,{l:Hs(e,{r:n.l}),lvl:t+1})}function qs(e,t){return!(!e||e.startIndex!==t.startIndex||e.endIndex!==t.endIndex)}function Gs(e,t){return!(!e||e[0]!==t[0]||e[1]!==t[1])}const Ks=fs((()=>({recalcInProgress:us(!1)})),[],{singleton:!0});function Js(e,t,n){return e[Zs(e,t,n)]}function Zs(e,t,n,i=0){let s=e.length-1;for(;i<=s;){const r=Math.floor((i+s)/2),o=n(e[r],t);if(0===o)return r;if(-1===o){if(s-i<2)return r-1;s=r-1}else{if(s===i)return r;i=r+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function Xs(e,t){return Math.round(e.getBoundingClientRect()[t])}function Qs(e){return!Ls(e.groupOffsetTree)}function er({index:e},t){return t===e?0:t<e?-1:1}function tr({offset:e},t){return t===e?0:t<e?-1:1}function nr(e,t,n){if(0===t.length)return 0;const{index:i,offset:s,size:r}=Js(t,e,er),o=e-i,a=r*o+(o-1)*n+s;return a>0?a+n:a}function ir(e,t){if(!Qs(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function sr(e,t,n){if(function(e){return typeof e.groupIndex<"u"}(e))return t.groupIndices[e.groupIndex]+1;{let i=ir("LAST"===e.index?n:e.index,t);return i=Math.max(0,i,Math.min(n,i)),i}}function rr(e,t,n,i=0){return i>0&&(t=Math.max(t,Js(e,i,er).offset)),Es(function(e,t,n,i){const s=Zs(e,t,i),r=Zs(e,n,i,s);return e.slice(s,r+1)}(e,t,n,tr),cr)}function or(e,[t,n,i,s]){t.length>0&&i("received item sizes",t,xs.DEBUG);const r=e.sizeTree;let o=r,a=0;if(n.length>0&&Ls(r)&&2===t.length){const e=t[0].size,i=t[1].size;o=n.reduce(((t,n)=>Os(Os(t,n,e),n+1,i)),o)}else[o,a]=function(e,t){let n=Ls(e)?0:1/0;for(const i of t){const{endIndex:t,size:s,startIndex:r}=i;if(n=Math.min(n,r),Ls(e)){e=Os(e,0,s);continue}const o=Ds(e,r-1,t+1);if(o.some(ur(i)))continue;let a=!1,l=!1;for(const{end:n,start:i,value:c}of o)a?(t>=i||s===c)&&(e=Ps(e,i)):(l=c!==s,a=!0),n>t&&t>=i&&c!==s&&(e=Os(e,t+1,c));l&&(e=Os(e,r,s))}return[e,n]}(o,t);if(o===r)return e;const{lastIndex:l,lastOffset:c,lastSize:u,offsetTree:d}=lr(e.offsetTree,a,o,s);return{groupIndices:n,groupOffsetTree:n.reduce(((e,t)=>Os(e,t,nr(t,d,s))),Rs()),lastIndex:l,lastOffset:c,lastSize:u,offsetTree:d,sizeTree:o}}function ar(e,t){let n=0,i=0;for(;n<e;)n+=t[i+1]-t[i]-1,i++;return i-(n===e?0:1)}function lr(e,t,n,i){let s=e,r=0,o=0,a=0,l=0;if(0!==t){l=Zs(s,t-1,er),a=s[l].offset;const e=Ms(n,t-1);r=e[0],o=e[1],s.length&&s[l].size===Ms(n,t)[1]&&(l-=1),s=s.slice(0,l+1)}else s=[];for(const{start:c,value:u}of Ds(n,t,1/0)){const e=c-r,t=e*o+a+e*i;s.push({index:c,offset:t,size:u}),r=c,a=t,o=u}return{lastIndex:r,lastOffset:a,lastSize:o,offsetTree:s}}function cr(e){return{index:e.index,value:e}}function ur(e){const{endIndex:t,size:n,startIndex:i}=e;return e=>e.start===i&&(e.end===t||e.end===1/0)&&e.value===n}const dr={offsetHeight:"height",offsetWidth:"width"},hr=fs((([{log:e},{recalcInProgress:t}])=>{const n=hs(),i=hs(),s=ds(i,0),r=hs(),o=hs(),a=us(0),l=us([]),c=us(void 0),u=us(void 0),d=us(((e,t)=>Xs(e,dr[t]))),h=us(void 0),p=us(0),f={groupIndices:[],groupOffsetTree:Rs(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:Rs()},m=ds(rs(n,cs(l,e,p),os(or,f),ts()),f),g=ds(rs(l,ts(),os(((e,t)=>({current:t,prev:e.current})),{current:[],prev:[]}),is((({prev:e})=>e))),[]);Zi(rs(l,ns((e=>e.length>0)),cs(m,p),is((([e,t,n])=>{const i=e.reduce(((e,i,s)=>Os(e,i,nr(i,t.offsetTree,n)||s)),Rs());return{...t,groupIndices:e,groupOffsetTree:i}}))),m),Zi(rs(i,cs(m),ns((([e,{lastIndex:t}])=>e<t)),is((([e,{lastIndex:t,lastSize:n}])=>[{endIndex:t,size:n,startIndex:e}]))),n),Zi(c,u);const v=ds(rs(c,is((e=>void 0===e))),!0);Zi(rs(u,ns((e=>void 0!==e&&Ls(Ji(m).sizeTree))),is((e=>[{endIndex:0,size:e,startIndex:0}]))),n);const y=ps(rs(n,cs(m),os((({sizes:e},[t,n])=>({changed:n!==e,sizes:n})),{changed:!1,sizes:f}),is((e=>e.changed))));qi(rs(a,os(((e,t)=>({diff:e.prev-t,prev:t})),{diff:0,prev:0}),is((e=>e.diff))),(e=>{const{groupIndices:n}=Ji(m);if(e>0)Gi(t,!0),Gi(r,e+ar(e,n));else if(e<0){const t=Ji(g);t.length>0&&(e-=ar(-e,t)),Gi(o,e)}})),qi(rs(a,cs(e)),(([e,t])=>{e<0&&t("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:a},xs.ERROR)}));const x=ps(r);Zi(rs(r,cs(m),is((([e,t])=>{const n=t.groupIndices.length>0,i=[],s=t.lastSize;if(n){const n=Is(t.sizeTree,0);let r=0,o=0;for(;r<e;){const e=t.groupIndices[o],a=t.groupIndices.length===o+1?1/0:t.groupIndices[o+1]-e-1;i.push({endIndex:e,size:n,startIndex:e}),i.push({endIndex:e+1+a-1,size:s,startIndex:e+1}),o++,r+=a+1}const a=zs(t.sizeTree);return r!==e&&a.shift(),a.reduce(((t,{k:n,v:i})=>{let s=t.ranges;return 0!==t.prevSize&&(s=[...t.ranges,{endIndex:n+e-1,size:t.prevSize,startIndex:t.prevIndex}]),{prevIndex:n+e,prevSize:i,ranges:s}}),{prevIndex:e,prevSize:0,ranges:i}).ranges}return zs(t.sizeTree).reduce(((t,{k:n,v:i})=>({prevIndex:n+e,prevSize:i,ranges:[...t.ranges,{endIndex:n+e-1,size:t.prevSize,startIndex:t.prevIndex}]})),{prevIndex:0,prevSize:s,ranges:[]}).ranges}))),n);const b=ps(rs(o,cs(m,p),is((([e,{offsetTree:t},n])=>nr(-e,t,n)))));return Zi(rs(o,cs(m,p),is((([e,t,n])=>{if(t.groupIndices.length>0){if(Ls(t.sizeTree))return t;let i=Rs();const s=Ji(g);let r=0,o=0,a=0;for(;r<-e;){a=s[o];const e=s[o+1]-a-1;o++,r+=e+1}if(i=zs(t.sizeTree).reduce(((t,{k:n,v:i})=>Os(t,Math.max(0,n+e),i)),i),r!==-e){i=Os(i,0,Is(t.sizeTree,a));i=Os(i,1,Ms(t.sizeTree,1-e)[1])}return{...t,sizeTree:i,...lr(t.offsetTree,0,i,n)}}{const i=zs(t.sizeTree).reduce(((t,{k:n,v:i})=>Os(t,Math.max(0,n+e),i)),Rs());return{...t,sizeTree:i,...lr(t.offsetTree,0,i,n)}}}))),m),{beforeUnshiftWith:x,data:h,defaultItemSize:u,firstItemIndex:a,fixedItemSize:c,gap:p,groupIndices:l,itemSize:d,listRefresh:y,shiftWith:o,shiftWithOffset:b,sizeRanges:n,sizes:m,statefulTotalCount:s,totalCount:i,trackItemSizes:v,unshiftWith:r}}),Ui(bs,Ks),{singleton:!0});function pr(e){return e.reduce(((e,t)=>(e.groupIndices.push(e.totalCount),e.totalCount+=t+1,e)),{groupIndices:[],totalCount:0})}const fr=fs((([{groupIndices:e,sizes:t,totalCount:n},{headerHeight:i,scrollTop:s}])=>{const r=hs(),o=hs(),a=ps(rs(r,is(pr)));return Zi(rs(a,is((e=>e.totalCount))),n),Zi(rs(a,is((e=>e.groupIndices))),e),Zi(rs(gs(s,t,i),ns((([e,t])=>Qs(t))),is((([e,t,n])=>Ms(t.groupOffsetTree,Math.max(e-n,0),"v")[0])),ts(),is((e=>[e]))),o),{groupCounts:r,topItemsIndexes:o}}),Ui(hr,Cs)),mr=fs((([{log:e}])=>{const t=us(!1),n=ps(rs(t,ns((e=>e)),ts()));return qi(t,(t=>{t&&Ji(e)("props updated",{},xs.DEBUG)})),{didMount:n,propsReady:t}}),Ui(bs),{singleton:!0}),gr=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function vr(e){const t="number"==typeof e?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!gr)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const yr=fs((([{gap:e,listRefresh:t,sizes:n,totalCount:i},{fixedFooterHeight:s,fixedHeaderHeight:r,footerHeight:o,headerHeight:a,scrollingInProgress:l,scrollTo:c,smoothScrollTargetReached:u,viewportHeight:d},{log:h}])=>{const p=hs(),f=hs(),m=us(0);let g=null,v=null,y=null;function x(){g&&(g(),g=null),y&&(y(),y=null),v&&(clearTimeout(v),v=null),Gi(l,!1)}return Zi(rs(p,cs(n,d,i,m,a,o,h),cs(e,r,s),is((([[e,n,i,s,r,o,a,c],d,h,m])=>{const b=vr(e),{align:w,behavior:k,offset:j}=b,T=s-1,S=sr(b,n,T);let C=nr(S,n.offsetTree,d)+o;"end"===w?(C+=h+Ms(n.sizeTree,S)[1]-i+m,S===T&&(C+=a)):"center"===w?C+=(h+Ms(n.sizeTree,S)[1]-i+m)/2:C-=r,j&&(C+=j);const _=t=>{x(),t?(c("retrying to scroll to",{location:e},xs.DEBUG),Gi(p,e)):(Gi(f,!0),c("list did not change, scroll successful",{},xs.DEBUG))};if(x(),"smooth"===k){let e=!1;y=qi(t,(t=>{e=e||t})),g=Xi(u,(()=>{_(e)}))}else g=Xi(rs(t,function(e){return t=>{const n=setTimeout((()=>{t(!1)}),e);return e=>{e&&(t(!0),clearTimeout(n))}}}(150)),_);return v=setTimeout((()=>{x()}),1200),Gi(l,!0),c("scrolling from index to",{behavior:k,index:S,top:C},xs.DEBUG),{behavior:k,top:C}}))),c),{scrollTargetReached:f,scrollToIndex:p,topListHeight:m}}),Ui(hr,Cs,bs),{singleton:!0});function xr(e,t){0==e?t():requestAnimationFrame((()=>{xr(e-1,t)}))}function br(e,t){const n=t-1;return"number"==typeof e?e:"LAST"===e.index?n:e.index}const wr=fs((([{defaultItemSize:e,listRefresh:t,sizes:n},{scrollTop:i},{scrollTargetReached:s,scrollToIndex:r},{didMount:o}])=>{const a=us(!0),l=us(0),c=us(!0);return Zi(rs(o,cs(l),ns((([e,t])=>!!t)),ss(!1)),a),Zi(rs(o,cs(l),ns((([e,t])=>!!t)),ss(!1)),c),qi(rs(gs(t,o),cs(a,n,e,c),ns((([[,e],t,{sizeTree:n},i,s])=>e&&(!Ls(n)||Ni(i))&&!t&&!s)),cs(l)),(([,e])=>{Xi(s,(()=>{Gi(c,!0)})),xr(4,(()=>{Xi(i,(()=>{Gi(a,!0)})),Gi(r,e)}))})),{initialItemFinalLocationReached:c,initialTopMostItemIndex:l,scrolledToInitialItem:a}}),Ui(hr,Cs,yr,mr),{singleton:!0});function kr(e,t){return Math.abs(e-t)<1.01}const jr="up",Tr="down",Sr={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},Cr=fs((([{footerHeight:e,headerHeight:t,scrollBy:n,scrollContainerState:i,scrollTop:s,viewportHeight:r}])=>{const o=us(!1),a=us(!0),l=hs(),c=hs(),u=us(4),d=us(0),h=ds(rs(ys(rs(vs(s),as(1),ss(!0)),rs(vs(s),as(1),ss(!1),Qi(100))),ts()),!1),p=ds(rs(ys(rs(n,ss(!0)),rs(n,ss(!1),Qi(200))),ts()),!1);Zi(rs(gs(vs(s),vs(d)),is((([e,t])=>e<=t)),ts()),a),Zi(rs(a,ls(50)),c);const f=ps(rs(gs(i,vs(r),vs(t),vs(e),vs(u)),os(((e,[{scrollHeight:t,scrollTop:n},i,s,r,o])=>{const a={scrollHeight:t,scrollTop:n,viewportHeight:i};if(n+i-t>-o){let t,i;return n>e.state.scrollTop?(t="SCROLLED_DOWN",i=e.state.scrollTop-n):(t="SIZE_DECREASED",i=e.state.scrollTop-n||e.scrollTopDelta),{atBottom:!0,atBottomBecause:t,scrollTopDelta:i,state:a}}let l;return l=a.scrollHeight>e.state.scrollHeight?"SIZE_INCREASED":i<e.state.viewportHeight?"VIEWPORT_HEIGHT_DECREASING":n<e.state.scrollTop?"SCROLLING_UPWARDS":"NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:l,state:a}}),Sr),ts(((e,t)=>e&&e.atBottom===t.atBottom)))),m=ds(rs(i,os(((e,{scrollHeight:t,scrollTop:n,viewportHeight:i})=>{if(kr(e.scrollHeight,t))return{changed:!1,jump:0,scrollHeight:t,scrollTop:n};{const s=t-(n+i)<1;return e.scrollTop!==n&&s?{changed:!0,jump:e.scrollTop-n,scrollHeight:t,scrollTop:n}:{changed:!0,jump:0,scrollHeight:t,scrollTop:n}}}),{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),ns((e=>e.changed)),is((e=>e.jump))),0);Zi(rs(f,is((e=>e.atBottom))),o),Zi(rs(o,ls(50)),l);const g=us(Tr);Zi(rs(i,is((({scrollTop:e})=>e)),ts(),os(((e,t)=>Ji(p)?{direction:e.direction,prevScrollTop:t}:{direction:t<e.prevScrollTop?jr:Tr,prevScrollTop:t}),{direction:Tr,prevScrollTop:0}),is((e=>e.direction))),g),Zi(rs(i,ls(50),ss("none")),g);const v=us(0);return Zi(rs(h,ns((e=>!e)),ss(0)),v),Zi(rs(s,ls(100),cs(h),ns((([e,t])=>!!t)),os((([e,t],[n])=>[t,n]),[0,0]),is((([e,t])=>t-e))),v),{atBottomState:f,atBottomStateChange:l,atBottomThreshold:u,atTopStateChange:c,atTopThreshold:d,isAtBottom:o,isAtTop:a,isScrolling:h,lastJumpDueToItemResize:m,scrollDirection:g,scrollVelocity:v}}),Ui(Cs)),_r="top",Er="bottom",Lr="none";function Ir(e,t,n){return"number"==typeof e?n===jr&&t===_r||n===Tr&&t===Er?e:0:n===jr?t===_r?e.main:e.reverse:t===Er?e.main:e.reverse}function Mr(e,t){var n;return"number"==typeof e?e:null!=(n=e[t])?n:0}const Or=fs((([{deviation:e,fixedHeaderHeight:t,headerHeight:n,scrollTop:i,viewportHeight:s}])=>{const r=hs(),o=us(0),a=us(0),l=us(0);return{increaseViewportBy:a,listBoundary:r,overscan:l,topListHeight:o,visibleRange:ds(rs(gs(vs(i),vs(s),vs(n),vs(r,Gs),vs(l),vs(o),vs(t),vs(e),vs(a)),is((([e,t,n,[i,s],r,o,a,l,c])=>{const u=e-l,d=o+a,h=Math.max(n-u,0);let p=Lr;const f=Mr(c,_r),m=Mr(c,Er);return i-=l,s+=n+a,(i+=n+a)>e+d-f&&(p=jr),(s-=l)<e-h+t+m&&(p=Tr),p!==Lr?[Math.max(u-n-Ir(r,_r,p)-f,0),u-h-a+t+Ir(r,Er,p)+m]:null})),ns((e=>null!=e)),ts(Gs)),[0,0])}}),Ui(Cs),{singleton:!0});const Rr={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function Dr(e,t,n,i,s,r){const{lastIndex:o,lastOffset:a,lastSize:l}=s;let c=0,u=0;if(e.length>0){c=e[0].offset;const t=e[e.length-1];u=t.offset+t.size}const d=n-o,h=c,p=a+d*l+(d-1)*i-u;return{bottom:u,firstItemIndex:r,items:zr(e,s,r),offsetBottom:p,offsetTop:c,top:h,topItems:zr(t,s,r),topListHeight:t.reduce(((e,t)=>t.size+e),0),totalCount:n}}function Pr(e,t,n,i,s,r){let o=0;if(n.groupIndices.length>0)for(const c of n.groupIndices){if(c-o>=e)break;o++}const a=e+o,l=br(t,a);return Dr(Array.from({length:a}).map(((e,t)=>({data:r[t+l],index:t+l,offset:0,size:0}))),[],a,s,n,i)}function zr(e,t,n){if(0===e.length)return[];if(!Qs(t))return e.map((e=>({...e,index:e.index+n,originalIndex:e.index})));const i=e[0].index,s=e[e.length-1].index,r=[],o=Ds(t.groupOffsetTree,i,s);let a,l=0;for(const c of e){let e;(!a||a.end<c.index)&&(a=o.shift(),l=t.groupIndices.indexOf(a.start)),e=c.index===a.start?{index:l,type:"group"}:{groupIndex:l,index:c.index-(l+1)+n},r.push({...e,data:c.data,offset:c.offset,originalIndex:c.index,size:c.size})}return r}const Ar=fs((([{data:e,firstItemIndex:t,gap:n,sizes:i,totalCount:s},r,{listBoundary:o,topListHeight:a,visibleRange:l},{initialTopMostItemIndex:c,scrolledToInitialItem:u},{topListHeight:d},h,{didMount:p},{recalcInProgress:f}])=>{const m=us([]),g=us(0),v=hs();Zi(r.topItemsIndexes,m);const y=ds(rs(gs(p,f,vs(l,Gs),vs(s),vs(i),vs(c),u,vs(m),vs(t),vs(n),e),ns((([e,t,,n,,,,,,,i])=>{const s=i&&i.length!==n;return e&&!t&&!s})),is((([,,[e,t],n,i,s,r,o,a,l,c])=>{const u=i,{offsetTree:d,sizeTree:h}=u,p=Ji(g);if(0===n)return{...Rr,totalCount:n};if(0===e&&0===t)return 0===p?{...Rr,totalCount:n}:Pr(p,s,i,a,l,c||[]);if(Ls(h))return p>0?null:Dr(function(e,t,n){if(Qs(t)){const i=ir(e,t);return[{index:Ms(t.groupOffsetTree,i)[0],offset:0,size:0},{data:null==n?void 0:n[0],index:i,offset:0,size:0}]}return[{data:null==n?void 0:n[0],index:e,offset:0,size:0}]}(br(s,n),u,c),[],n,l,u,a);const f=[];if(o.length>0){const e=o[0],t=o[o.length-1];let n=0;for(const i of Ds(h,e,t)){const s=i.value,r=Math.max(i.start,e),o=Math.min(i.end,t);for(let e=r;e<=o;e++)f.push({data:null==c?void 0:c[e],index:e,offset:n,size:s}),n+=s}}if(!r)return Dr([],f,n,l,u,a);const m=o.length>0?o[o.length-1]+1:0,v=rr(d,e,t,m);if(0===v.length)return null;const y=n-1;return Dr(Wi([],(n=>{for(const i of v){const s=i.value;let r=s.offset,o=i.start;const a=s.size;if(s.offset<e){o+=Math.floor((e-s.offset+l)/(a+l));const t=o-i.start;r+=t*a+t*l}o<m&&(r+=(m-o)*a,o=m);const u=Math.min(i.end,y);for(let e=o;e<=u&&!(r>=t);e++)n.push({data:null==c?void 0:c[e],index:e,offset:r,size:a}),r+=a+l}})),f,n,l,u,a)})),ns((e=>null!==e)),ts()),Rr);Zi(rs(e,ns(Ni),is((e=>null==e?void 0:e.length))),s),Zi(rs(y,is((e=>e.topListHeight))),d),Zi(d,a),Zi(rs(y,is((e=>[e.top,e.bottom]))),o),Zi(rs(y,is((e=>e.items))),v);const x=ps(rs(y,ns((({items:e})=>e.length>0)),cs(s,e),ns((([{items:e},t])=>e[e.length-1].originalIndex===t-1)),is((([,e,t])=>[e-1,t])),ts(Gs),is((([e])=>e)))),b=ps(rs(y,ls(200),ns((({items:e,topItems:t})=>e.length>0&&e[0].originalIndex===t.length)),is((({items:e})=>e[0].index)),ts())),w=ps(rs(y,ns((({items:e})=>e.length>0)),is((({items:e})=>{let t=0,n=e.length-1;for(;"group"===e[t].type&&t<n;)t++;for(;"group"===e[n].type&&n>t;)n--;return{endIndex:e[n].index,startIndex:e[t].index}})),ts(qs)));return{endReached:x,initialItemCount:g,itemsRendered:v,listState:y,rangeChanged:w,startReached:b,topItemsIndexes:m,...h}}),Ui(hr,fr,Or,wr,yr,Cr,mr,Ks),{singleton:!0}),Br=fs((([{fixedFooterHeight:e,fixedHeaderHeight:t,footerHeight:n,headerHeight:i},{listState:s}])=>{const r=hs(),o=ds(rs(gs(n,e,i,t,s),is((([e,t,n,i,s])=>e+t+n+i+s.offsetBottom+s.bottom))),0);return Zi(vs(o),r),{totalListHeight:o,totalListHeightChanged:r}}),Ui(Cs,Ar),{singleton:!0}),Hr=fs((([{viewportHeight:e},{totalListHeight:t}])=>{const n=us(!1);return{alignToBottom:n,paddingTopAddition:ds(rs(gs(n,e,t),ns((([e])=>e)),is((([,e,t])=>Math.max(0,e-t))),ls(0),ts()),0)}}),Ui(Cs,Br),{singleton:!0});function $r(e){return!!e&&("smooth"===e?"smooth":"auto")}const Fr=fs((([{listRefresh:e,totalCount:t},{atBottomState:n,isAtBottom:i},{scrollToIndex:s},{scrolledToInitialItem:r},{didMount:o,propsReady:a},{log:l},{scrollingInProgress:c}])=>{const u=us(!1),d=hs();let h=null;function p(e){Gi(s,{align:"end",behavior:e,index:"LAST"})}function f(e){const t=Xi(n,(t=>{e&&!t.atBottom&&"SIZE_INCREASED"===t.notAtBottomBecause&&!h&&(Ji(l)("scrolling to bottom due to increased size",{},xs.DEBUG),p("auto"))}));setTimeout(t,100)}return qi(rs(gs(rs(vs(t),as(1)),o),cs(vs(u),i,r,c),is((([[e,t],n,i,s,r])=>{let o=t&&s,a="auto";return o&&(a=((e,t)=>"function"==typeof e?$r(e(t)):t&&$r(e))(n,i||r),o=o&&!!a),{followOutputBehavior:a,shouldFollow:o,totalCount:e}})),ns((({shouldFollow:e})=>e))),(({followOutputBehavior:t,totalCount:n})=>{h&&(h(),h=null),h=Xi(e,(()=>{Ji(l)("following output to ",{totalCount:n},xs.DEBUG),p(t),h=null}))})),qi(rs(gs(vs(u),t,a),ns((([e,,t])=>e&&t)),os((({value:e},[,t])=>({refreshed:e===t,value:t})),{refreshed:!1,value:0}),ns((({refreshed:e})=>e)),cs(u,t)),(([,e])=>{Ji(r)&&f(!1!==e)})),qi(d,(()=>{f(!1!==Ji(u))})),qi(gs(vs(u),n),(([e,t])=>{e&&!t.atBottom&&"VIEWPORT_HEIGHT_DECREASING"===t.notAtBottomBecause&&p("auto")})),{autoscrollToBottom:d,followOutput:u}}),Ui(hr,Cr,yr,wr,mr,bs,Cs)),Nr=fs((([{data:e,firstItemIndex:t,gap:n,sizes:i},{initialTopMostItemIndex:s},{initialItemCount:r,listState:o},{didMount:a}])=>(Zi(rs(a,cs(r),ns((([,e])=>0!==e)),cs(s,i,t,n,e),is((([[,e],t,n,i,s,r=[]])=>Pr(e,t,n,i,s,r)))),o),{})),Ui(hr,wr,Ar,mr),{singleton:!0}),Yr=fs((([{didMount:e},{scrollTo:t},{listState:n}])=>{const i=us(0);return qi(rs(e,cs(i),ns((([,e])=>0!==e)),is((([,e])=>({top:e})))),(e=>{Xi(rs(n,as(1),ns((e=>e.items.length>1))),(()=>{requestAnimationFrame((()=>{Gi(t,e)}))}))})),{initialScrollTop:i}}),Ui(mr,Cs,Ar),{singleton:!0}),Wr=({itemBottom:e,itemTop:t,locationParams:{align:n,behavior:i,...s},viewportBottom:r,viewportTop:o})=>t<o?{...s,align:null!=n?n:"start",behavior:i}:e>r?{...s,align:null!=n?n:"end",behavior:i}:null,Vr=fs((([{gap:e,sizes:t,totalCount:n},{fixedFooterHeight:i,fixedHeaderHeight:s,headerHeight:r,scrollingInProgress:o,scrollTop:a,viewportHeight:l},{scrollToIndex:c}])=>{const u=hs();return Zi(rs(u,cs(t,l,n,r,s,i,a),cs(e),is((([[e,t,n,i,s,r,a,l],c])=>{const{align:u,behavior:d,calculateViewLocation:h=Wr,done:p,...f}=e,m=sr(e,t,i-1),g=nr(m,t.offsetTree,c)+s+r,v=h({itemBottom:g+Ms(t.sizeTree,m)[1],itemTop:g,locationParams:{align:u,behavior:d,...f},viewportBottom:l+n-a,viewportTop:l+r});return v?p&&Xi(rs(o,ns((e=>!e)),as(Ji(o)?1:2)),p):p&&p(),v})),ns((e=>null!==e))),c),{scrollIntoView:u}}),Ui(hr,Cs,yr,Ar,bs),{singleton:!0}),Ur=fs((([{scrollVelocity:e}])=>{const t=us(!1),n=hs(),i=us(!1);return Zi(rs(e,cs(i,t,n),ns((([e,t])=>!!t)),is((([e,t,n,i])=>{const{enter:s,exit:r}=t;if(n){if(r(e,i))return!1}else if(s(e,i))return!0;return n})),ts()),t),qi(rs(gs(t,e,n),cs(i)),(([[e,t,n],i])=>{e&&i&&i.change&&i.change(t,n)})),{isSeeking:t,scrollSeekConfiguration:i,scrollSeekRangeChanged:n,scrollVelocity:e}}),Ui(Cr),{singleton:!0}),qr=fs((([{scrollContainerState:e,scrollTo:t}])=>{const n=hs(),i=hs(),s=hs(),r=us(!1),o=us(void 0);return Zi(rs(gs(n,i),is((([{scrollHeight:e,scrollTop:t,viewportHeight:n},{offsetTop:i}])=>({scrollHeight:e,scrollTop:Math.max(0,t-i),viewportHeight:n})))),e),Zi(rs(t,cs(i),is((([e,{offsetTop:t}])=>({...e,top:e.top+t})))),s),{customScrollParent:o,useWindowScroll:r,windowScrollContainerState:n,windowScrollTo:s,windowViewportRect:i}}),Ui(Cs)),Gr=fs((([{sizeRanges:e,sizes:t},{headerHeight:n,scrollTop:i},{initialTopMostItemIndex:s},{didMount:r},{useWindowScroll:o,windowScrollContainerState:a,windowViewportRect:l}])=>{const c=hs(),u=us(void 0),d=us(null),h=us(null);return Zi(a,d),Zi(l,h),qi(rs(c,cs(t,i,o,d,h,n)),(([e,t,n,i,s,r,o])=>{const a=function(e){return zs(e).map((({k:e,v:t},n,i)=>{const s=i[n+1];return{endIndex:s?s.k-1:1/0,size:t,startIndex:e}}))}(t.sizeTree);i&&null!==s&&null!==r&&(n=s.scrollTop-r.offsetTop),e({ranges:a,scrollTop:n-=o})})),Zi(rs(u,ns(Ni),is(Kr)),s),Zi(rs(r,cs(u),ns((([,e])=>void 0!==e)),ts(),is((([,e])=>e.ranges))),e),{getState:c,restoreStateFrom:u}}),Ui(hr,Cs,wr,mr,qr));function Kr(e){return{align:"start",index:0,offset:e.scrollTop}}const Jr=fs((([{topItemsIndexes:e}])=>{const t=us(0);return Zi(rs(t,ns((e=>e>=0)),is((e=>Array.from({length:e}).map(((e,t)=>t))))),e),{topItemCount:t}}),Ui(Ar));function Zr(e){let t,n=!1;return()=>(n||(n=!0,t=e()),t)}const Xr=Zr((()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent))),Qr=fs((([{deviation:e,scrollBy:t,scrollingInProgress:n,scrollTop:i},{isAtBottom:s,isScrolling:r,lastJumpDueToItemResize:o,scrollDirection:a},{listState:l},{beforeUnshiftWith:c,gap:u,shiftWithOffset:d,sizes:h},{log:p},{recalcInProgress:f}])=>{const m=ps(rs(l,cs(o),os((([,e,t,n],[{bottom:i,items:s,offsetBottom:r,totalCount:o},a])=>{const l=i+r;let c=0;return t===o&&e.length>0&&s.length>0&&(0===s[0].originalIndex&&0===e[0].originalIndex||(c=l-n,0!==c&&(c+=a))),[c,s,o,l]}),[0,[],0,0]),ns((([e])=>0!==e)),cs(i,a,n,s,p,f),ns((([,e,t,n,,,i])=>!i&&!n&&0!==e&&t===jr)),is((([[e],,,,,t])=>(t("Upward scrolling compensation",{amount:e},xs.DEBUG),e)))));function g(n){n>0?(Gi(t,{behavior:"auto",top:-n}),Gi(e,0)):(Gi(e,0),Gi(t,{behavior:"auto",top:-n}))}return qi(rs(m,cs(e,r)),(([t,n,i])=>{i&&Xr()?Gi(e,n-t):g(-t)})),qi(rs(gs(ds(r,!1),e,f),ns((([e,t,n])=>!e&&!n&&0!==t)),is((([e,t])=>t)),ls(1)),g),Zi(rs(d,is((e=>({top:-e})))),t),qi(rs(c,cs(h,u),is((([e,{groupIndices:t,lastSize:n,sizeTree:i},s])=>{function r(e){return e*(n+s)}if(0===t.length)return r(e);{let n=0;const s=Is(i,0);let o=0,a=0;for(;o<e;){o++,n+=s;let i=t.length===a+1?1/0:t[a+1]-t[a]-1;o+i>e&&(n-=s,i=e-o+1),o+=i,n+=r(i),a++}return n}}))),(n=>{Gi(e,n),requestAnimationFrame((()=>{Gi(t,{top:n}),requestAnimationFrame((()=>{Gi(e,0),Gi(f,!1)}))}))})),{deviation:e}}),Ui(Cs,Cr,Ar,hr,bs,Ks)),eo=fs((([e,t,n,i,s,r,o,a,l,c])=>({...e,...t,...n,...i,...s,...r,...o,...a,...l,...c})),Ui(Or,Nr,mr,Ur,Br,Yr,Hr,qr,Vr,bs)),to=fs((([{data:e,defaultItemSize:t,firstItemIndex:n,fixedItemSize:i,gap:s,groupIndices:r,itemSize:o,sizeRanges:a,sizes:l,statefulTotalCount:c,totalCount:u,trackItemSizes:d},{initialItemFinalLocationReached:h,initialTopMostItemIndex:p,scrolledToInitialItem:f},m,g,v,{listState:y,topItemsIndexes:x,...b},{scrollToIndex:w},k,{topItemCount:j},{groupCounts:T},S])=>(Zi(b.rangeChanged,S.scrollSeekRangeChanged),Zi(rs(S.windowViewportRect,is((e=>e.visibleHeight))),m.viewportHeight),{data:e,defaultItemHeight:t,firstItemIndex:n,fixedItemHeight:i,gap:s,groupCounts:T,initialItemFinalLocationReached:h,initialTopMostItemIndex:p,scrolledToInitialItem:f,sizeRanges:a,topItemCount:j,topItemsIndexes:x,totalCount:u,...v,groupIndices:r,itemSize:o,listState:y,scrollToIndex:w,statefulTotalCount:c,trackItemSizes:d,...b,...S,...m,sizes:l,...g})),Ui(hr,wr,Cs,Gr,Fr,Ar,yr,Qr,Jr,fr,eo));function no(e,t){const n={},i={};let s=0;const r=e.length;for(;s<r;)i[e[s]]=1,s+=1;for(const o in t)Object.hasOwn(i,o)||(n[o]=t[o]);return n}const io=typeof document<"u"?L.useLayoutEffect:L.useEffect;function so(e,t,n){const i=Object.keys(t.required||{}),s=Object.keys(t.optional||{}),r=Object.keys(t.methods||{}),o=Object.keys(t.events||{}),a=L.createContext({});function l(e,n){e.propsReady&&Gi(e.propsReady,!1);for(const s of i){Gi(e[t.required[s]],n[s])}for(const i of s)if(i in n){Gi(e[t.optional[i]],n[i])}e.propsReady&&Gi(e.propsReady,!0)}function u(e){return o.reduce(((n,i)=>(n[i]=function(e){let t,n;const i=()=>null==t?void 0:t();return function(s,r){switch(s){case 1:return r?n===r?void 0:(i(),n=r,t=qi(e,r),t):(i(),Yi);case 2:return i(),void(n=null)}}}(e[t.events[i]]),n)),{})}const d=L.forwardRef(((d,h)=>{const{children:p,...f}=d,[m]=L.useState((()=>Wi(function(e){const t=new Map,n=({constructor:e,dependencies:i,id:s,singleton:r})=>{if(r&&t.has(s))return t.get(s);const o=e(i.map((e=>n(e))));return r&&t.set(s,o),o};return n(e)}(e),(e=>{l(e,f)})))),[g]=L.useState($i(u,m));io((()=>{for(const e of o)e in f&&qi(g[e],f[e]);return()=>{Object.values(g).map(Ki)}}),[f,g,m]),io((()=>{l(m,f)})),L.useImperativeHandle(h,Ai(function(e){return r.reduce(((n,i)=>(n[i]=n=>{Gi(e[t.methods[i]],n)},n)),{})}(m)));const v=n;return c.jsx(a.Provider,{value:m,children:n?c.jsx(v,{...no([...i,...s,...o],f),children:p}):p})}));return{Component:d,useEmitter:(e,t)=>{const n=L.useContext(a)[e];io((()=>qi(n,t)),[t,n])},useEmitterValue:L.version.startsWith("18")?e=>{const t=L.useContext(a)[e],n=L.useCallback((e=>qi(t,e)),[t]);return L.useSyncExternalStore(n,(()=>Ji(t)),(()=>Ji(t)))}:e=>{const t=L.useContext(a)[e],[n,i]=L.useState($i(Ji,t));return io((()=>qi(t,(e=>{e!==n&&i(Ai(e))}))),[t,n]),n},usePublisher:e=>L.useCallback(Fi(Gi,L.useContext(a)[e]),[e])}}const ro=L.createContext(void 0),oo=L.createContext(void 0),ao=typeof document<"u"?L.useLayoutEffect:L.useEffect;function lo(e){return"self"in e}function co(e,t,n,i=Yi,s,r){const o=L.useRef(null),a=L.useRef(null),l=L.useRef(null),c=L.useCallback((n=>{let i,s,o;const c=n.target;if(function(e){return"body"in e}(c)||lo(c)){const e=lo(c)?c:c.defaultView;o=r?e.scrollX:e.scrollY,i=r?e.document.documentElement.scrollWidth:e.document.documentElement.scrollHeight,s=r?e.innerWidth:e.innerHeight}else o=r?c.scrollLeft:c.scrollTop,i=r?c.scrollWidth:c.scrollHeight,s=r?c.offsetWidth:c.offsetHeight;const u=()=>{e({scrollHeight:i,scrollTop:Math.max(o,0),viewportHeight:s})};n.suppressFlushSync?u():I.flushSync(u),null!==a.current&&(o===a.current||o<=0||o===i-s)&&(a.current=null,t(!0),l.current&&(clearTimeout(l.current),l.current=null))}),[e,t]);return L.useEffect((()=>{const e=s||o.current;return i(s||o.current),c({suppressFlushSync:!0,target:e}),e.addEventListener("scroll",c,{passive:!0}),()=>{i(null),e.removeEventListener("scroll",c)}}),[o,c,n,i,s]),{scrollByCallback:function(e){r&&(e={behavior:e.behavior,left:e.top}),o.current.scrollBy(e)},scrollerRef:o,scrollToCallback:function(n){const i=o.current;if(!i||(r?"offsetWidth"in i&&0===i.offsetWidth:"offsetHeight"in i&&0===i.offsetHeight))return;const s="smooth"===n.behavior;let c,u,d;lo(i)?(u=Math.max(Xs(i.document.documentElement,r?"width":"height"),r?i.document.documentElement.scrollWidth:i.document.documentElement.scrollHeight),c=r?i.innerWidth:i.innerHeight,d=r?window.scrollX:window.scrollY):(u=i[r?"scrollWidth":"scrollHeight"],c=Xs(i,r?"width":"height"),d=i[r?"scrollLeft":"scrollTop"]);const h=u-c;if(n.top=Math.ceil(Math.max(Math.min(h,n.top),0)),kr(c,u)||n.top===d)return e({scrollHeight:u,scrollTop:d,viewportHeight:c}),void(s&&t(!0));s?(a.current=n.top,l.current&&clearTimeout(l.current),l.current=setTimeout((()=>{l.current=null,a.current=null,t(!0)}),1e3)):a.current=null,r&&(n={behavior:n.behavior,left:n.top}),i.scrollTo(n)}}}const uo="-webkit-sticky",ho="sticky",po=Zr((()=>{if(typeof document>"u")return ho;const e=document.createElement("div");return e.style.position=uo,e.style.position===uo?uo:ho}));function fo(e){return e}const mo=fs((()=>{const e=us((e=>`Item ${e}`)),t=us(null),n=us((e=>`Group ${e}`)),i=us({}),s=us(fo),r=us("div"),o=us(Yi),a=(e,t=null)=>ds(rs(i,is((t=>t[e])),ts()),t);return{components:i,computeItemKey:s,context:t,EmptyPlaceholder:a("EmptyPlaceholder"),FooterComponent:a("Footer"),GroupComponent:a("Group","div"),groupContent:n,HeaderComponent:a("Header"),HeaderFooterTag:r,ItemComponent:a("Item","div"),itemContent:e,ListComponent:a("List","div"),ScrollerComponent:a("Scroller","div"),scrollerRef:o,ScrollSeekPlaceholder:a("ScrollSeekPlaceholder"),TopItemListComponent:a("TopItemList")}})),go=fs((([e,t])=>({...e,...t})),Ui(to,mo)),vo=({height:e})=>c.jsx("div",{style:{height:e}}),yo={overflowAnchor:"none",position:po(),zIndex:1},xo={overflowAnchor:"none"},bo={...xo,display:"inline-block",height:"100%"},wo=L.memo((function({showTopList:e=!1}){const t=Bo("listState"),n=Ho("sizeRanges"),i=Bo("useWindowScroll"),s=Bo("customScrollParent"),r=Ho("windowScrollContainerState"),o=Ho("scrollContainerState"),a=s||i?r:o,u=Bo("itemContent"),d=Bo("context"),h=Bo("groupContent"),p=Bo("trackItemSizes"),f=Bo("itemSize"),m=Bo("log"),g=Ho("gap"),v=Bo("horizontalDirection"),{callbackRef:y}=js(n,f,p,e?Yi:a,m,g,s,v,Bo("skipAnimationFrameInResizeObserver")),[x,b]=L.useState(0);Ao("deviation",(e=>{x!==e&&b(e)}));const w=Bo("EmptyPlaceholder"),k=Bo("ScrollSeekPlaceholder")||vo,j=Bo("ListComponent"),T=Bo("ItemComponent"),S=Bo("GroupComponent"),C=Bo("computeItemKey"),_=Bo("isSeeking"),E=Bo("groupIndices").length>0,I=Bo("alignToBottom"),M=Bo("initialItemFinalLocationReached"),O=e?{}:{boxSizing:"border-box",...v?{display:"inline-block",height:"100%",marginLeft:0!==x?x:I?"auto":0,paddingLeft:t.offsetTop,paddingRight:t.offsetBottom,whiteSpace:"nowrap"}:{marginTop:0!==x?x:I?"auto":0,paddingBottom:t.offsetBottom,paddingTop:t.offsetTop},...M?{}:{visibility:"hidden"}};return!e&&0===t.totalCount&&w?c.jsx(w,{...Co(w,d)}):c.jsx(j,{...Co(j,d),"data-testid":e?"virtuoso-top-item-list":"virtuoso-item-list",ref:y,style:O,children:(e?t.topItems:t.items).map((e=>{const n=e.originalIndex,i=C(n+t.firstItemIndex,e.data,d);return _?l.createElement(k,{...Co(k,d),height:e.size,index:e.index,key:i,type:e.type||"item",..."group"===e.type?{}:{groupIndex:e.groupIndex}}):"group"===e.type?l.createElement(S,{...Co(S,d),"data-index":n,"data-item-index":e.index,"data-known-size":e.size,key:i,style:yo},h(e.index,d)):l.createElement(T,{...Co(T,d),..._o(T,e.data),"data-index":n,"data-item-group-index":e.groupIndex,"data-item-index":e.index,"data-known-size":e.size,key:i,style:v?bo:xo},E?u(e.index,e.groupIndex,e.data,d):u(e.index,e.data,d))}))})})),ko={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},jo={outline:"none",overflowX:"auto",position:"relative"},To=e=>({height:"100%",position:"absolute",top:0,width:"100%",...e?{display:"flex",flexDirection:"column"}:{}}),So={position:po(),top:0,width:"100%",zIndex:1};function Co(e,t){if("string"!=typeof e)return{context:t}}function _o(e,t){return{item:"string"==typeof e?void 0:t}}const Eo=L.memo((function(){const e=Bo("HeaderComponent"),t=Ho("headerHeight"),n=Bo("HeaderFooterTag"),i=ws(L.useMemo((()=>e=>{t(Xs(e,"height"))}),[t]),!0,Bo("skipAnimationFrameInResizeObserver")),s=Bo("context");return e?c.jsx(n,{ref:i,children:c.jsx(e,{...Co(e,s)})}):null})),Lo=L.memo((function(){const e=Bo("FooterComponent"),t=Ho("footerHeight"),n=Bo("HeaderFooterTag"),i=ws(L.useMemo((()=>e=>{t(Xs(e,"height"))}),[t]),!0,Bo("skipAnimationFrameInResizeObserver")),s=Bo("context");return e?c.jsx(n,{ref:i,children:c.jsx(e,{...Co(e,s)})}):null}));function Io({useEmitter:e,useEmitterValue:t,usePublisher:n}){return L.memo((function({children:i,style:s,...r}){const o=n("scrollContainerState"),a=t("ScrollerComponent"),l=n("smoothScrollTargetReached"),u=t("scrollerRef"),d=t("context"),h=t("horizontalDirection")||!1,{scrollByCallback:p,scrollerRef:f,scrollToCallback:m}=co(o,l,a,u,void 0,h);return e("scrollTo",m),e("scrollBy",p),c.jsx(a,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:f,style:{...h?jo:ko,...s},tabIndex:0,...r,...Co(a,d),children:i})}))}function Mo({useEmitter:e,useEmitterValue:t,usePublisher:n}){return L.memo((function({children:i,style:s,...r}){const o=n("windowScrollContainerState"),a=t("ScrollerComponent"),l=n("smoothScrollTargetReached"),u=t("totalListHeight"),d=t("deviation"),h=t("customScrollParent"),p=t("context"),f=L.useRef(null),m=t("scrollerRef"),{scrollByCallback:g,scrollerRef:v,scrollToCallback:y}=co(o,l,a,m,h);return ao((()=>{var e;return v.current=h||(null==(e=f.current)?void 0:e.ownerDocument.defaultView),()=>{v.current=null}}),[v,h]),e("windowScrollTo",y),e("scrollBy",g),c.jsx(a,{ref:f,"data-virtuoso-scroller":!0,style:{position:"relative",...s,...0!==u?{height:u+d}:{}},...r,...Co(a,p),children:i})}))}const Oo=({children:e})=>{const t=L.useContext(ro),n=Ho("viewportHeight"),i=Ho("fixedItemHeight"),s=Bo("alignToBottom"),r=Bo("horizontalDirection"),o=ws(L.useMemo((()=>Hi(n,(e=>Xs(e,r?"width":"height")))),[n,r]),!0,Bo("skipAnimationFrameInResizeObserver"));return L.useEffect((()=>{t&&(n(t.viewportHeight),i(t.itemHeight))}),[t,n,i]),c.jsx("div",{"data-viewport-type":"element",ref:o,style:To(s),children:e})},Ro=({children:e})=>{const t=L.useContext(ro),n=Ho("windowViewportRect"),i=Ho("fixedItemHeight"),s=Bo("customScrollParent"),r=Ss(n,s,Bo("skipAnimationFrameInResizeObserver")),o=Bo("alignToBottom");return L.useEffect((()=>{t&&(i(t.itemHeight),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))}),[t,n,i]),c.jsx("div",{"data-viewport-type":"window",ref:r,style:To(o),children:e})},Do=({children:e})=>{const t=Bo("TopItemListComponent")||"div",n=Bo("headerHeight"),i={...So,marginTop:`${n}px`},s=Bo("context");return c.jsx(t,{style:i,...Co(t,s),children:e})},Po=L.memo((function(e){const t=Bo("useWindowScroll"),n=Bo("topItemsIndexes").length>0,i=Bo("customScrollParent"),s=Bo("context"),r=i||t?Fo:$o,o=i||t?Ro:Oo;return c.jsxs(r,{...e,...Co(r,s),children:[n&&c.jsx(Do,{children:c.jsx(wo,{showTopList:!0})}),c.jsxs(o,{children:[c.jsx(Eo,{}),c.jsx(wo,{}),c.jsx(Lo,{})]})]})})),{Component:zo,useEmitter:Ao,useEmitterValue:Bo,usePublisher:Ho}=so(go,{events:{atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",endReached:"endReached",groupIndices:"groupIndices",isScrolling:"isScrolling",itemsRendered:"itemsRendered",rangeChanged:"rangeChanged",startReached:"startReached",totalListHeightChanged:"totalListHeightChanged"},methods:{autoscrollToBottom:"autoscrollToBottom",getState:"getState",scrollBy:"scrollBy",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollToIndex:"scrollToIndex"},optional:{alignToBottom:"alignToBottom",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",components:"components",computeItemKey:"computeItemKey",context:"context",customScrollParent:"customScrollParent",data:"data",defaultItemHeight:"defaultItemHeight",firstItemIndex:"firstItemIndex",fixedItemHeight:"fixedItemHeight",followOutput:"followOutput",groupContent:"groupContent",groupCounts:"groupCounts",headerFooterTag:"HeaderFooterTag",horizontalDirection:"horizontalDirection",increaseViewportBy:"increaseViewportBy",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",initialTopMostItemIndex:"initialTopMostItemIndex",itemContent:"itemContent",itemSize:"itemSize",logLevel:"logLevel",overscan:"overscan",restoreStateFrom:"restoreStateFrom",scrollerRef:"scrollerRef",scrollSeekConfiguration:"scrollSeekConfiguration",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver",topItemCount:"topItemCount",totalCount:"totalCount",useWindowScroll:"useWindowScroll"},required:{}},Po),$o=Io({useEmitter:Ao,useEmitterValue:Bo,usePublisher:Ho}),Fo=Mo({useEmitter:Ao,useEmitterValue:Bo,usePublisher:Ho}),No=zo,Yo=fs((()=>{const e=us((e=>c.jsxs("td",{children:["Item $",e]}))),t=us(null),n=us(null),i=us(null),s=us({}),r=us(fo),o=us(Yi),a=(e,t=null)=>ds(rs(s,is((t=>t[e])),ts()),t);return{components:s,computeItemKey:r,context:t,EmptyPlaceholder:a("EmptyPlaceholder"),FillerRow:a("FillerRow"),fixedFooterContent:i,fixedHeaderContent:n,itemContent:e,ScrollerComponent:a("Scroller","div"),scrollerRef:o,ScrollSeekPlaceholder:a("ScrollSeekPlaceholder"),TableBodyComponent:a("TableBody","tbody"),TableComponent:a("Table","table"),TableFooterComponent:a("TableFoot","tfoot"),TableHeadComponent:a("TableHead","thead"),TableRowComponent:a("TableRow","tr")}}));Ui(to,Yo);const Wo={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},Vo={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:Uo,floor:qo,max:Go,min:Ko,round:Jo}=Math;function Zo(e,t,n){return Array.from({length:t-e+1}).map(((t,i)=>({data:null===n?null:n[i+e],index:i+e})))}function Xo(e,t){return e&&e.width===t.width&&e.height===t.height}function Qo(e,t){return e&&e.column===t.column&&e.row===t.row}const ea=fs((([{increaseViewportBy:e,listBoundary:t,overscan:n,visibleRange:i},{footerHeight:s,headerHeight:r,scrollBy:o,scrollContainerState:a,scrollTo:l,scrollTop:c,smoothScrollTargetReached:u,viewportHeight:d},h,p,{didMount:f,propsReady:m},{customScrollParent:g,useWindowScroll:v,windowScrollContainerState:y,windowScrollTo:x,windowViewportRect:b},w])=>{const k=us(0),j=us(0),T=us(Wo),S=us({height:0,width:0}),C=us({height:0,width:0}),_=hs(),E=hs(),L=us(0),I=us(null),M=us({column:0,row:0}),O=hs(),R=hs(),D=us(!1),P=us(0),z=us(!0),A=us(!1),B=us(!1);qi(rs(f,cs(P),ns((([e,t])=>!!t))),(()=>{Gi(z,!1)})),qi(rs(gs(f,z,C,S,P,A),ns((([e,t,n,i,,s])=>e&&!t&&0!==n.height&&0!==i.height&&!s))),(([,,,,e])=>{Gi(A,!0),xr(1,(()=>{Gi(_,e)})),Xi(rs(c),(()=>{Gi(t,[0,0]),Gi(z,!0)}))})),Zi(rs(R,ns((e=>null!=e&&e.scrollTop>0)),ss(0)),j),qi(rs(f,cs(R),ns((([,e])=>null!=e))),(([,e])=>{e&&(Gi(S,e.viewport),Gi(C,e.item),Gi(M,e.gap),e.scrollTop>0&&(Gi(D,!0),Xi(rs(c,as(1)),(e=>{Gi(D,!1)})),Gi(l,{top:e.scrollTop})))})),Zi(rs(S,is((({height:e})=>e))),d),Zi(rs(gs(vs(S,Xo),vs(C,Xo),vs(M,((e,t)=>e&&e.column===t.column&&e.row===t.row)),vs(c)),is((([e,t,n,i])=>({gap:n,item:t,scrollTop:i,viewport:e})))),O),Zi(rs(gs(vs(k),i,vs(M,Qo),vs(C,Xo),vs(S,Xo),vs(I),vs(j),vs(D),vs(z),vs(P)),ns((([,,,,,,,e])=>!e)),is((([e,[t,n],i,s,r,o,a,,l,c])=>{const{column:u,row:d}=i,{height:h,width:p}=s,{width:f}=r;if(0===a&&(0===e||0===f))return Wo;if(0===p){const t=br(c,e);return function(e){return{...Vo,items:e}}(Zo(t,t+Math.max(a-1,0),o))}const m=ta(f,p,u);let g,v;l?0===t&&0===n&&a>0?(g=0,v=a-1):(g=m*qo((t+d)/(h+d)),v=m*Uo((n+d)/(h+d))-1,v=Ko(e-1,Go(v,m-1)),g=Ko(v,Go(0,g))):(g=0,v=-1);const y=Zo(g,v,o),{bottom:x,top:b}=na(r,i,s,y),w=Uo(e/m);return{bottom:x,itemHeight:h,items:y,itemWidth:p,offsetBottom:w*h+(w-1)*d-x,offsetTop:b,top:b}}))),T),Zi(rs(I,ns((e=>null!==e)),is((e=>e.length))),k),Zi(rs(gs(S,C,T,M),ns((([e,t,{items:n}])=>n.length>0&&0!==t.height&&0!==e.height)),is((([e,t,{items:n},i])=>{const{bottom:s,top:r}=na(e,i,t,n);return[r,s]})),ts(Gs)),t);const H=us(!1);Zi(rs(c,cs(H),is((([e,t])=>t||0!==e))),H);const $=ps(rs(gs(T,k),ns((([{items:e}])=>e.length>0)),cs(H),ns((([[e,t],n])=>{const i=e.items[e.items.length-1].index===t-1;return(n||e.bottom>0&&e.itemHeight>0&&0===e.offsetBottom&&e.items.length===t)&&i})),is((([[,e]])=>e-1)),ts())),F=ps(rs(vs(T),ns((({items:e})=>e.length>0&&0===e[0].index)),ss(0),ts())),N=ps(rs(vs(T),cs(D),ns((([{items:e},t])=>e.length>0&&!t)),is((([{items:e}])=>({endIndex:e[e.length-1].index,startIndex:e[0].index}))),ts(qs),ls(0)));Zi(N,p.scrollSeekRangeChanged),Zi(rs(_,cs(S,C,k,M),is((([e,t,n,i,s])=>{const r=vr(e),{align:o,behavior:a,offset:l}=r;let c=r.index;"LAST"===c&&(c=i-1),c=Go(0,c,Ko(i-1,c));let u=ia(t,s,n,c);return"end"===o?u=Jo(u-t.height+n.height):"center"===o&&(u=Jo(u-t.height/2+n.height/2)),l&&(u+=l),{behavior:a,top:u}}))),l);const Y=ds(rs(T,is((e=>e.offsetBottom+e.bottom))),0);return Zi(rs(b,is((e=>({height:e.visibleHeight,width:e.visibleWidth})))),S),{customScrollParent:g,data:I,deviation:L,footerHeight:s,gap:M,headerHeight:r,increaseViewportBy:e,initialItemCount:j,itemDimensions:C,overscan:n,restoreStateFrom:R,scrollBy:o,scrollContainerState:a,scrollHeight:E,scrollTo:l,scrollToIndex:_,scrollTop:c,smoothScrollTargetReached:u,totalCount:k,useWindowScroll:v,viewportDimensions:S,windowScrollContainerState:y,windowScrollTo:x,windowViewportRect:b,...p,gridState:T,horizontalDirection:B,initialTopMostItemIndex:P,totalListHeight:Y,...h,endReached:$,propsReady:m,rangeChanged:N,startReached:F,stateChanged:O,stateRestoreInProgress:D,...w}}),Ui(Or,Cs,Cr,Ur,mr,qr,bs));function ta(e,t,n){return Go(1,qo((e+n)/(qo(t)+n)))}function na(e,t,n,i){const{height:s}=n;if(void 0===s||0===i.length)return{bottom:0,top:0};const r=ia(e,t,n,i[0].index);return{bottom:ia(e,t,n,i[i.length-1].index)+s,top:r}}function ia(e,t,n,i){const s=ta(e.width,n.width,t.column),r=qo(i/s),o=r*n.height+Go(0,r-1)*t.row;return o>0?o+t.row:o}const sa=fs((()=>{const e=us((e=>`Item ${e}`)),t=us({}),n=us(null),i=us("virtuoso-grid-item"),s=us("virtuoso-grid-list"),r=us(fo),o=us("div"),a=us(Yi),l=(e,n=null)=>ds(rs(t,is((t=>t[e])),ts()),n),c=us(!1),u=us(!1);return Zi(vs(u),c),{components:t,computeItemKey:r,context:n,FooterComponent:l("Footer"),HeaderComponent:l("Header"),headerFooterTag:o,itemClassName:i,ItemComponent:l("Item","div"),itemContent:e,listClassName:s,ListComponent:l("List","div"),readyStateChanged:c,reportReadyState:u,ScrollerComponent:l("Scroller","div"),scrollerRef:a,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder","div")}})),ra=fs((([e,t])=>({...e,...t})),Ui(ea,sa)),oa=L.memo((function(){const e=pa("gridState"),t=pa("listClassName"),n=pa("itemClassName"),i=pa("itemContent"),s=pa("computeItemKey"),r=pa("isSeeking"),o=fa("scrollHeight"),a=pa("ItemComponent"),u=pa("ListComponent"),d=pa("ScrollSeekPlaceholder"),h=pa("context"),p=fa("itemDimensions"),f=fa("gap"),m=pa("log"),g=pa("stateRestoreInProgress"),v=fa("reportReadyState"),y=ws(L.useMemo((()=>e=>{const t=e.parentElement.parentElement.scrollHeight;o(t);const n=e.firstChild;if(n){const{height:e,width:t}=n.getBoundingClientRect();p({height:e,width:t})}f({column:va("column-gap",getComputedStyle(e).columnGap,m),row:va("row-gap",getComputedStyle(e).rowGap,m)})}),[o,p,f,m]),!0,!1);return ao((()=>{e.itemHeight>0&&e.itemWidth>0&&v(!0)}),[e]),g?null:c.jsx(u,{className:t,ref:y,...Co(u,h),"data-testid":"virtuoso-item-list",style:{paddingBottom:e.offsetBottom,paddingTop:e.offsetTop},children:e.items.map((t=>{const o=s(t.index,t.data,h);return r?c.jsx(d,{...Co(d,h),height:e.itemHeight,index:t.index,width:e.itemWidth},o):l.createElement(a,{...Co(a,h),className:n,"data-index":t.index,key:o},i(t.index,t.data,h))}))})})),aa=L.memo((function(){const e=pa("HeaderComponent"),t=fa("headerHeight"),n=pa("headerFooterTag"),i=ws(L.useMemo((()=>e=>{t(Xs(e,"height"))}),[t]),!0,!1),s=pa("context");return e?c.jsx(n,{ref:i,children:c.jsx(e,{...Co(e,s)})}):null})),la=L.memo((function(){const e=pa("FooterComponent"),t=fa("footerHeight"),n=pa("headerFooterTag"),i=ws(L.useMemo((()=>e=>{t(Xs(e,"height"))}),[t]),!0,!1),s=pa("context");return e?c.jsx(n,{ref:i,children:c.jsx(e,{...Co(e,s)})}):null})),ca=({children:e})=>{const t=L.useContext(oo),n=fa("itemDimensions"),i=fa("viewportDimensions"),s=ws(L.useMemo((()=>e=>{i(e.getBoundingClientRect())}),[i]),!0,!1);return L.useEffect((()=>{t&&(i({height:t.viewportHeight,width:t.viewportWidth}),n({height:t.itemHeight,width:t.itemWidth}))}),[t,i,n]),c.jsx("div",{ref:s,style:To(!1),children:e})},ua=({children:e})=>{const t=L.useContext(oo),n=fa("windowViewportRect"),i=fa("itemDimensions"),s=pa("customScrollParent"),r=Ss(n,s,!1);return L.useEffect((()=>{t&&(i({height:t.itemHeight,width:t.itemWidth}),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))}),[t,n,i]),c.jsx("div",{ref:r,style:To(!1),children:e})},da=L.memo((function({...e}){const t=pa("useWindowScroll"),n=pa("customScrollParent"),i=n||t?ga:ma,s=n||t?ua:ca,r=pa("context");return c.jsx(i,{...e,...Co(i,r),children:c.jsxs(s,{children:[c.jsx(aa,{}),c.jsx(oa,{}),c.jsx(la,{})]})})})),{useEmitter:ha,useEmitterValue:pa,usePublisher:fa}=so(ra,{events:{atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",endReached:"endReached",isScrolling:"isScrolling",rangeChanged:"rangeChanged",readyStateChanged:"readyStateChanged",startReached:"startReached",stateChanged:"stateChanged"},methods:{scrollBy:"scrollBy",scrollTo:"scrollTo",scrollToIndex:"scrollToIndex"},optional:{components:"components",computeItemKey:"computeItemKey",context:"context",customScrollParent:"customScrollParent",data:"data",headerFooterTag:"headerFooterTag",increaseViewportBy:"increaseViewportBy",initialItemCount:"initialItemCount",initialTopMostItemIndex:"initialTopMostItemIndex",itemClassName:"itemClassName",itemContent:"itemContent",listClassName:"listClassName",logLevel:"logLevel",overscan:"overscan",restoreStateFrom:"restoreStateFrom",scrollerRef:"scrollerRef",scrollSeekConfiguration:"scrollSeekConfiguration",totalCount:"totalCount",useWindowScroll:"useWindowScroll"}},da),ma=Io({useEmitter:ha,useEmitterValue:pa,usePublisher:fa}),ga=Mo({useEmitter:ha,useEmitterValue:pa,usePublisher:fa});function va(e,t,n){return"normal"!==t&&!(null!=t&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,xs.WARN),"normal"===t?0:parseInt(null!=t?t:"0",10)}function ya(){const e=l.useRef(null),t=l.useRef(null),{messages:n,isNewMessage:i,setIsNewMessage:s}=Di(),{setIsSecretarySpeak:r}=Kd(),[o,a]=l.useState(!1),[h,p]=l.useState(!1),[f,m]=l.useState(0);function g(){if(o||h)return;const t=n[n.length-1];if(1===t.user.id)return;const i=`/temp/edge_audio_${t.message_id}.mp3`;e.current.src=i,e.current&&(o?(e.current.pause(),r(!1)):(e.current.play(),r(!0)),a(!o))}l.useEffect((()=>{i&&(s(!1),g())}),[n]),l.useEffect((()=>{function t(){if(e.current){const t=e.current.currentTime,n=e.current.duration;n>0&&m(t/n*100)}}const n=e.current;return n&&(n.addEventListener("timeupdate",t),n.addEventListener("ended",(()=>{a(!1),r(!1)}))),()=>{n&&(n.removeEventListener("timeupdate",t),n.removeEventListener("ended",(()=>{a(!1),r(!1)})))}}),[]),l.useEffect((()=>{t.current&&t.current.scrollToIndex({index:n.length-1,behavior:"smooth"})}),[n]);let v="";return c.jsxs(u,{sx:{height:"90%",display:"flex",flexDirection:"column"},children:[c.jsxs(u,{sx:{display:"flex",alignItems:"center",p:1},children:[c.jsx(d,{onClick:g,"aria-label":"play",children:h?c.jsx(w,{children:"hourglass_empty"}):o?c.jsx(w,{children:"pause"}):c.jsx(w,{children:"play_arrow"})}),c.jsx("audio",{ref:e,onCanPlay:()=>p(!1),onPlay:()=>a(!0),onPause:()=>a(!1),onEnded:()=>a(!1),onLoadStart:()=>p(!0)}),c.jsx(M,{variant:"determinate",value:f,style:{width:"100%"}})]}),c.jsx(u,{sx:{overflowY:"auto",p:1,flexGrow:1},children:c.jsx(No,{ref:t,data:n,initialTopMostItemIndex:n.length-1,itemContent:(e,t)=>{const n=function(e){const t=new Date(e);return new Intl.DateTimeFormat("default",{year:"numeric",month:"long",day:"numeric"}).format(t)}(t.datetime),i=function(e){const t=new Date(e);return new Intl.DateTimeFormat("default",{hour:"2-digit",minute:"2-digit"}).format(t)}(t.datetime),s=n!==v;return v=n,c.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[s&&c.jsx(O,{children:n}),c.jsx(zi,{message:t,message_time:i})]},e)}})})]})}var xa,ba={exports:{}};xa||(xa=1,function(){var e=function(e){var t,n=Object.prototype,i=n.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(fp){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var r=t&&t.prototype instanceof v?t:v,o=Object.create(r.prototype),a=new I(i||[]);return s(o,"_invoke",{value:C(e,n,a)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(fp){return{type:"throw",arg:fp}}}e.wrap=u;var h="suspendedStart",p="suspendedYield",f="executing",m="completed",g={};function v(){}function y(){}function x(){}var b={};c(b,o,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(M([])));k&&k!==n&&i.call(k,o)&&(b=k);var j=x.prototype=v.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(s,r,o,a){var l=d(e[s],e,r);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(u).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,a)}))}a(l.arg)}var r;s(this,"_invoke",{value:function(e,i){function s(){return new t((function(t,s){n(e,i,t,s)}))}return r=r?r.then(s,s):s()}})}function C(e,n,i){var s=h;return function(r,o){if(s===f)throw new Error("Generator is already running");if(s===m){if("throw"===r)throw o;return{value:t,done:!0}}for(i.method=r,i.arg=o;;){var a=i.delegate;if(a){var l=_(a,i);if(l){if(l===g)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(s===h)throw s=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s=f;var c=d(e,n,i);if("normal"===c.type){if(s=i.done?m:p,c.arg===g)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(s=m,i.method="throw",i.arg=c.arg)}}}function _(e,n){var i=n.method,s=e.iterator[i];if(s===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var r=d(s,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function M(e){if(null!=e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,r=function n(){for(;++s<e.length;)if(i.call(e,s))return n.value=e[s],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(typeof e+" is not iterable")}return y.prototype=x,s(j,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:y,configurable:!0}),y.displayName=c(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c(e,l,"GeneratorFunction")),e.prototype=Object.create(j),e},e.awrap=function(e){return{__await:e}},T(S.prototype),c(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,i,s,r){void 0===r&&(r=Promise);var o=new S(u(t,n,i,s),r);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(j),c(j,l,"Generator"),c(j,o,(function(){return this})),c(j,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=M,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function s(i,s){return a.type="throw",a.arg=e,n.next=i,s&&(n.method="next",n.arg=t),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return s("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return s(o.catchLoc,!0);if(this.prev<o.finallyLoc)return s(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return s(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return s(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var s=i.arg;L(n)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:M(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}(ba.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}());var wa,ka={},ja={},Ta={};function Sa(){if(wa)return Ta;wa=1,Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.browserSupportsPolyfills=Ta.compareTwoStringsUsingDiceCoefficient=Ta.commandToRegExp=Ta.concatTranscripts=Ta.debounce=void 0;Ta.debounce=function(e,t,n){var i;return function(){var s=this,r=arguments,o=n&&!i;clearTimeout(i),i=setTimeout((function(){i=null,n||e.apply(s,r)}),t),o&&e.apply(s,r)}};Ta.concatTranscripts=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return e.trim()})).join(" ").trim()};var e=/\s*\((.*?)\)\s*/g,t=/(\(\?:[^)]+\))\?/g,n=/(\(\?)?:\w+/g,i=/\*/g,s=/[-{}[\]+?.,\\^$|#]/g;Ta.commandToRegExp=function(r){return r instanceof RegExp?new RegExp(r.source,"i"):(r=r.replace(s,"\\$&").replace(e,"(?:$1)?").replace(n,(function(e,t){return t?e:"([^\\s]+)"})).replace(i,"(.*?)").replace(t,"\\s*$1?\\s*"),new RegExp("^"+r+"$","i"))};Ta.compareTwoStringsUsingDiceCoefficient=function(e,t){if(e=e.replace(/\s+/g,"").toLowerCase(),t=t.replace(/\s+/g,"").toLowerCase(),!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e===t)return 1;if(1===e.length&&1===t.length)return 0;if(e.length<2||t.length<2)return 0;for(var n=new Map,i=0;i<e.length-1;i++){var s=e.substring(i,i+2),r=n.has(s)?n.get(s)+1:1;n.set(s,r)}for(var o=0,a=0;a<t.length-1;a++){var l=t.substring(a,a+2),c=n.has(l)?n.get(l):0;c>0&&(n.set(l,c-1),o++)}return 2*o/(e.length+t.length-2)};return Ta.browserSupportsPolyfills=function(){return"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.mediaDevices&&void 0!==window.navigator.mediaDevices.getUserMedia&&(void 0!==window.AudioContext||void 0!==window.webkitAudioContext)},Ta}var Ca,_a,Ea={},La={};function Ia(){if(Ca)return La;Ca=1,Object.defineProperty(La,"__esModule",{value:!0}),La.APPEND_TRANSCRIPT=La.CLEAR_TRANSCRIPT=void 0;La.CLEAR_TRANSCRIPT="CLEAR_TRANSCRIPT";return La.APPEND_TRANSCRIPT="APPEND_TRANSCRIPT",La}var Ma,Oa={};var Ra,Da={},Pa={};function za(){return Ra||(Ra=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=function(){return/(android)/i.test("undefined"!=typeof navigator?navigator.userAgent:"")}}(Pa)),Pa}var Aa,Ba,Ha,$a,Fa={};function Na(){return Aa||(Aa=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.isNative=void 0;var t="undefined"!=typeof window&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition);e.isNative=function(e){return e===t};var n=t;e.default=n}(Fa)),Fa}function Ya(){return Ba||(Ba=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t,n=(t=za())&&t.__esModule?t:{default:t},i=Sa(),s=Na();function r(e,t,n,i,s,r,o){try{var a=e[r](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(i,s)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(i,s){var o=e.apply(t,n);function a(e){r(o,i,s,a,l,"next",e)}function l(e){r(o,i,s,a,l,"throw",e)}a(void 0)}))}}function a(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(e.prototype,t),e}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recognition=null,this.pauseAfterDisconnect=!1,this.interimTranscript="",this.finalTranscript="",this.listening=!1,this.isMicrophoneAvailable=!0,this.subscribers={},this.onStopListening=function(){},this.previousResultWasFinalOnly=!1,this.resetTranscript=this.resetTranscript.bind(this),this.startListening=this.startListening.bind(this),this.stopListening=this.stopListening.bind(this),this.abortListening=this.abortListening.bind(this),this.setSpeechRecognition=this.setSpeechRecognition.bind(this),this.disableRecognition=this.disableRecognition.bind(this),this.setSpeechRecognition(t),(0,n.default)()&&(this.updateFinalTranscript=(0,i.debounce)(this.updateFinalTranscript,250,!0))}var t,r,l,c;return a(e,[{key:"setSpeechRecognition",value:function(e){var t=!!e&&((0,s.isNative)(e)||(0,i.browserSupportsPolyfills)());t&&(this.disableRecognition(),this.recognition=new e,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.onresult=this.updateTranscript.bind(this),this.recognition.onend=this.onRecognitionDisconnect.bind(this),this.recognition.onerror=this.onError.bind(this)),this.emitBrowserSupportsSpeechRecognitionChange(t)}},{key:"subscribe",value:function(e,t){this.subscribers[e]=t}},{key:"unsubscribe",value:function(e){delete this.subscribers[e]}},{key:"emitListeningChange",value:function(e){var t=this;this.listening=e,Object.keys(this.subscribers).forEach((function(n){(0,t.subscribers[n].onListeningChange)(e)}))}},{key:"emitMicrophoneAvailabilityChange",value:function(e){var t=this;this.isMicrophoneAvailable=e,Object.keys(this.subscribers).forEach((function(n){(0,t.subscribers[n].onMicrophoneAvailabilityChange)(e)}))}},{key:"emitTranscriptChange",value:function(e,t){var n=this;Object.keys(this.subscribers).forEach((function(i){(0,n.subscribers[i].onTranscriptChange)(e,t)}))}},{key:"emitClearTranscript",value:function(){var e=this;Object.keys(this.subscribers).forEach((function(t){(0,e.subscribers[t].onClearTranscript)()}))}},{key:"emitBrowserSupportsSpeechRecognitionChange",value:function(e){var t=this;Object.keys(this.subscribers).forEach((function(n){var i=t.subscribers[n],s=i.onBrowserSupportsSpeechRecognitionChange,r=i.onBrowserSupportsContinuousListeningChange;s(e),r(e)}))}},{key:"disconnect",value:function(e){if(this.recognition&&this.listening)switch(e){case"ABORT":this.pauseAfterDisconnect=!0,this.abort();break;case"RESET":this.pauseAfterDisconnect=!1,this.abort();break;default:this.pauseAfterDisconnect=!0,this.stop()}}},{key:"disableRecognition",value:function(){this.recognition&&(this.recognition.onresult=function(){},this.recognition.onend=function(){},this.recognition.onerror=function(){},this.listening&&this.stopListening())}},{key:"onError",value:function(e){e&&e.error&&"not-allowed"===e.error&&(this.emitMicrophoneAvailabilityChange(!1),this.disableRecognition())}},{key:"onRecognitionDisconnect",value:function(){this.onStopListening(),this.listening=!1,this.pauseAfterDisconnect?this.emitListeningChange(!1):this.recognition&&(this.recognition.continuous?this.startListening({continuous:this.recognition.continuous}):this.emitListeningChange(!1)),this.pauseAfterDisconnect=!1}},{key:"updateTranscript",value:function(e){var t=e.results,s=e.resultIndex,r=void 0===s?t.length-1:s;this.interimTranscript="",this.finalTranscript="";for(var o=r;o<t.length;++o)t[o].isFinal&&(!(0,n.default)()||t[o][0].confidence>0)?this.updateFinalTranscript(t[o][0].transcript):this.interimTranscript=(0,i.concatTranscripts)(this.interimTranscript,t[o][0].transcript);var a=!1;""===this.interimTranscript&&""!==this.finalTranscript?(this.previousResultWasFinalOnly&&(a=!0),this.previousResultWasFinalOnly=!0):this.previousResultWasFinalOnly=!1,a||this.emitTranscriptChange(this.interimTranscript,this.finalTranscript)}},{key:"updateFinalTranscript",value:function(e){this.finalTranscript=(0,i.concatTranscripts)(this.finalTranscript,e)}},{key:"resetTranscript",value:function(){this.disconnect("RESET")}},{key:"startListening",value:(c=o(regeneratorRuntime.mark((function e(){var t,n,i,s,r,o,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(t=a.length>0&&void 0!==a[0]?a[0]:{}).continuous,i=void 0!==n&&n,s=t.language,this.recognition){e.next=3;break}return e.abrupt("return");case 3:if(r=i!==this.recognition.continuous,o=s&&s!==this.recognition.lang,!r&&!o){e.next=11;break}if(!this.listening){e.next=9;break}return e.next=9,this.stopListening();case 9:this.recognition.continuous=r?i:this.recognition.continuous,this.recognition.lang=o?s:this.recognition.lang;case 11:if(this.listening){e.next=22;break}return this.recognition.continuous||(this.resetTranscript(),this.emitClearTranscript()),e.prev=13,e.next=16,this.start();case 16:this.emitListeningChange(!0),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(13),e.t0 instanceof DOMException||this.emitMicrophoneAvailabilityChange(!1);case 22:case"end":return e.stop()}}),e,this,[[13,19]])}))),function(){return c.apply(this,arguments)})},{key:"abortListening",value:(l=o(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disconnect("ABORT"),this.emitListeningChange(!1),e.next=4,new Promise((function(e){t.onStopListening=e}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"stopListening",value:(r=o(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disconnect("STOP"),this.emitListeningChange(!1),e.next=4,new Promise((function(e){t.onStopListening=e}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getRecognition",value:function(){return this.recognition}},{key:"start",value:(t=o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.recognition||this.listening){e.next=4;break}return e.next=3,this.recognition.start();case 3:this.listening=!0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"stop",value:function(){this.recognition&&this.listening&&(this.recognition.stop(),this.listening=!1)}},{key:"abort",value:function(){this.recognition&&this.listening&&(this.recognition.abort(),this.listening=!1)}}]),e}();e.default=l}(Da)),Da}function Wa(){return Ha||(Ha=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.useSpeechRecognition=void 0;var t=o(),n=Sa(),i=function(){if(_a)return Ea;_a=1,Object.defineProperty(Ea,"__esModule",{value:!0}),Ea.appendTranscript=Ea.clearTranscript=void 0;var e=Ia();return Ea.clearTranscript=function(){return{type:e.CLEAR_TRANSCRIPT}},Ea.appendTranscript=function(t,n){return{type:e.APPEND_TRANSCRIPT,payload:{interimTranscript:t,finalTranscript:n}}},Ea}(),s=function(){if(Ma)return Oa;Ma=1,Object.defineProperty(Oa,"__esModule",{value:!0}),Oa.transcriptReducer=void 0;var e=Ia(),t=Sa();return Oa.transcriptReducer=function(n,i){switch(i.type){case e.CLEAR_TRANSCRIPT:return{interimTranscript:"",finalTranscript:""};case e.APPEND_TRANSCRIPT:return{interimTranscript:i.payload.interimTranscript,finalTranscript:(0,t.concatTranscripts)(n.finalTranscript,i.payload.finalTranscript)};default:throw new Error}},Oa}(),r=c(Ya()),a=c(za()),l=c(Na());function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t,n,i,s,r,o){try{var a=e[r](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(i,s)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(i,s){var r=e.apply(t,n);function o(e){u(r,i,s,o,a,"next",e)}function a(e){u(r,i,s,o,a,"throw",e)}o(void 0)}))}}function h(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||m(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,s=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(fp){s=!0,r=fp}finally{try{i||null==a.return||a.return()}finally{if(s)throw r}}return n}(e,t)||m(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var v,y=!!l.default,x=y&&!(0,a.default)();e.useSpeechRecognition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.transcribing,o=void 0===r||r,a=e.clearTranscriptOnListen,l=void 0===a||a,c=e.commands,u=void 0===c?[]:c,d=f((0,t.useState)(j.getRecognitionManager()),1)[0],m=f((0,t.useState)(y),2),g=m[0],v=m[1],b=f((0,t.useState)(x),2),w=b[0],k=b[1],T=f((0,t.useReducer)(s.transcriptReducer,{interimTranscript:d.interimTranscript,finalTranscript:""}),2),S=T[0],C=S.interimTranscript,_=S.finalTranscript,E=T[1],L=f((0,t.useState)(d.listening),2),I=L[0],M=L[1],O=f((0,t.useState)(d.isMicrophoneAvailable),2),R=O[0],D=O[1],P=(0,t.useRef)(u);P.current=u;var z=function(){E((0,i.clearTranscript)())},A=(0,t.useCallback)((function(){d.resetTranscript(),z()}),[d]),B=(0,t.useCallback)((function(e,t){P.current.forEach((function(i){var s=i.command,r=i.callback,o=i.matchInterim,a=void 0!==o&&o,l=i.isFuzzyMatch,c=void 0!==l&&l,u=i.fuzzyMatchingThreshold,d=void 0===u?.8:u,f=i.bestMatchOnly,m=void 0!==f&&f,g=!t&&a?e.trim():t.trim(),v=(Array.isArray(s)?s:[s]).map((function(e){return c?function(e,t,i){var s=("object"===p(e)?e.toString():e).replace(/[&/\\#,+()!$~%.'":*?<>{}]/g,"").replace(/  +/g," ").trim(),r=(0,n.compareTwoStringsUsingDiceCoefficient)(s,t);return r>=i?{command:e,commandWithoutSpecials:s,howSimilar:r,isFuzzyMatch:!0}:null}(e,g,d):function(e,t){var i=(0,n.commandToRegExp)(e).exec(t);return i?{command:e,parameters:i.slice(1)}:null}(e,g)})).filter((function(e){return e}));if(c&&m&&v.length>=2){v.sort((function(e,t){return t.howSimilar-e.howSimilar}));var y=v[0],x=y.command,b=y.commandWithoutSpecials,w=y.howSimilar;r(b,g,w,{command:x,resetTranscript:A})}else v.forEach((function(e){if(e.isFuzzyMatch){var t=e.command,n=e.commandWithoutSpecials,i=e.howSimilar;r(n,g,i,{command:t,resetTranscript:A})}else{var s=e.command,o=e.parameters;r.apply(void 0,h(o).concat([{command:s,resetTranscript:A}]))}}))}))}),[A]),H=(0,t.useCallback)((function(e,t){o&&E((0,i.appendTranscript)(e,t)),B(e,t)}),[B,o]),$=(0,t.useCallback)((function(){l&&z()}),[l]);return(0,t.useEffect)((function(){var e=j.counter;j.counter+=1;var t={onListeningChange:M,onMicrophoneAvailabilityChange:D,onTranscriptChange:H,onClearTranscript:$,onBrowserSupportsSpeechRecognitionChange:v,onBrowserSupportsContinuousListeningChange:k};return d.subscribe(e,t),function(){d.unsubscribe(e)}}),[o,l,d,H,$]),{transcript:(0,n.concatTranscripts)(_,C),interimTranscript:C,finalTranscript:_,listening:I,isMicrophoneAvailable:R,resetTranscript:A,browserSupportsSpeechRecognition:g,browserSupportsContinuousListening:w}};var b,w,k,j={counter:0,applyPolyfill:function(e){v?v.setSpeechRecognition(e):v=new r.default(e);var t=!!e&&(0,n.browserSupportsPolyfills)();y=t,x=t},removePolyfill:function(){v?v.setSpeechRecognition(l.default):v=new r.default(l.default),y=!!l.default,x=y&&!(0,a.default)()},getRecognitionManager:function(){return v||(v=new r.default(l.default)),v},getRecognition:function(){return j.getRecognitionManager().getRecognition()},startListening:(k=d(regeneratorRuntime.mark((function e(){var t,n,i,s,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=r.length>0&&void 0!==r[0]?r[0]:{}).continuous,i=t.language,s=j.getRecognitionManager(),e.next=4,s.startListening({continuous:n,language:i});case 4:case"end":return e.stop()}}),e)}))),function(){return k.apply(this,arguments)}),stopListening:(w=d(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=j.getRecognitionManager(),e.next=3,t.stopListening();case 3:case"end":return e.stop()}}),e)}))),function(){return w.apply(this,arguments)}),abortListening:(b=d(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=j.getRecognitionManager(),e.next=3,t.abortListening();case 3:case"end":return e.stop()}}),e)}))),function(){return b.apply(this,arguments)}),browserSupportsSpeechRecognition:function(){return y},browserSupportsContinuousListening:function(){return x}},T=j;e.default=T}(ja)),ja}var Va=($a||($a=1,function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"useSpeechRecognition",{enumerable:!0,get:function(){return n.useSpeechRecognition}}),e.default=void 0;var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==t(e)&&"function"!=typeof e)return{default:e};var n=i();if(n&&n.has(e))return n.get(e);var s={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=r?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(s,o,a):s[o]=e[o]}return s.default=e,n&&n.set(e,s),s}(Wa());function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}var s=n.default;e.default=s}(ka)),ka);const Ua=t(Va);var qa,Ga={};function Ka(){if(qa)return Ga;qa=1;var e=s();Object.defineProperty(Ga,"__esModule",{value:!0}),Ga.default=void 0;var t=e(yt()),n=r();return Ga.default=(0,t.default)((0,n.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),Ga}const Ja=t(Ka());function Za({files:e,setFiles:t}){return c.jsx(u,{sx:{display:"flex",alignItems:"flex-end",gap:1,position:"relative",bottom:0,left:0,right:0,zIndex:1,backgroundColor:"background.paper",p:1,mb:0,overflow:"auto"},children:c.jsx(u,{sx:{display:"flex",gap:2},children:e.map((n=>c.jsxs(u,{sx:{position:"relative",textAlign:"center"},children:[c.jsx(Ja,{fontSize:"large"}),c.jsx(p,{variant:"caption",children:n.name}),c.jsx(d,{size:"small",sx:{position:"absolute",top:0,right:0},onClick:()=>{return i=n.lastModified,void t(e.filter((e=>e.lastModified!==i)));var i},children:c.jsx(bt,{fontSize:"small"})})]},n.lastModified)))})})}Za.propTypes={files:a.PropTypes.array.isRequired,setFiles:a.PropTypes.func.isRequired};const Xa="1";function Qa(){const[e,t]=l.useState(""),[n,i]=l.useState(!1),[s,r]=l.useState(!1),[o,a]=l.useState(!1),p=l.useRef(null),f=l.useRef(null),{transcript:m,resetTranscript:g}=Va.useSpeechRecognition(),{sendMessageAPI:v,sendTranscript:y,files:x,setFiles:b}=Di();return l.useEffect((()=>(clearTimeout(f.current),f.current=setTimeout((()=>{if(m){if("останови прослушивание"===m.toLowerCase()||m.toLowerCase().includes("стоп стоп стоп"))return Ua.stopListening(),void g();o?(t(m),a(!1)):y({user_id:Xa,text:m}),g()}}),1100),()=>clearTimeout(f.current))),[m,g,y]),c.jsxs(c.Fragment,{children:[c.jsx(Za,{files:x,setFiles:b}),c.jsxs(u,{sx:{display:"flex",alignItems:"flex-end",gap:1,position:"relative",bottom:0,left:0,right:0,zIndex:1,backgroundColor:"background.paper",mt:0,p:1},children:[c.jsx("input",{type:"file",multiple:!0,ref:p,style:{display:"none"},onChange:function(e){const t=Array.from(e.target.files);b((e=>{const n=t.filter((t=>!e.some((e=>e.name===t.name&&e.lastModified===t.lastModified))));return[...e,...n]})),p.current.value=""}}),c.jsx(d,{"aria-label":"add",onClick:()=>p.current.click(),children:c.jsx(w,{children:"add_circle_outline"})}),c.jsx(h,{id:"message_field",label:"Сообщение",multiline:!0,maxRows:15,fullWidth:!0,error:!!n,value:e,onChange:e=>t(e.target.value),helperText:n||""}),c.jsx(d,{onClick:function(){o?(Ua.stopListening(),a(!1)):(Ua.startListening({continuous:!1}),a(!0))},children:c.jsx(w,{children:o?"stop":"mic"})}),c.jsx(d,{onClick:async function(){if(e.trim()){i(!1),r(!0);try{await v(Xa,e),t("")}catch(n){i(n.message||"An unexpected error occurred"),r(!1)}finally{r(!1)}}else i("Введите сообщение")},disabled:s,children:s?c.jsx(_,{size:24}):c.jsx(w,{children:"send"})})]})]})}function el(){return c.jsxs(R,{sx:{position:"fixed",bottom:0,right:0,width:"600px",maxWidth:"100%",zIndex:999},children:[c.jsx(D,{expandIcon:c.jsx(w,{children:"expand_less"}),sx:{border:"1px solid"},children:c.jsx(p,{children:"Chat"})}),c.jsx(P,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"70vh"},children:c.jsxs(Ri,{children:[c.jsx(ya,{}),c.jsx(Qa,{})]})})]})}const tl=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function nl(e){return"object"==typeof e&&null!==e&&e.constructor&&"Object"===Object.prototype.toString.call(e).slice(8,-1)&&!e.__swiper__}function il(e,t){const n=["__proto__","constructor","prototype"];Object.keys(t).filter((e=>n.indexOf(e)<0)).forEach((n=>{void 0===e[n]?e[n]=t[n]:nl(t[n])&&nl(e[n])&&Object.keys(t[n]).length>0?t[n].__swiper__?e[n]=t[n]:il(e[n],t[n]):e[n]=t[n]}))}function sl(e){return void 0===e&&(e={}),e.navigation&&void 0===e.navigation.nextEl&&void 0===e.navigation.prevEl}function rl(e){return void 0===e&&(e={}),e.pagination&&void 0===e.pagination.el}function ol(e){return void 0===e&&(e={}),e.scrollbar&&void 0===e.scrollbar.el}function al(e){void 0===e&&(e="");const t=e.split(" ").map((e=>e.trim())).filter((e=>!!e)),n=[];return t.forEach((e=>{n.indexOf(e)<0&&n.push(e)})),n.join(" ")}function ll(e){return void 0===e&&(e=""),e?e.includes("swiper-wrapper")?e:`swiper-wrapper ${e}`:"swiper-wrapper"}function cl(){return cl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},cl.apply(this,arguments)}function ul(e){return e.type&&e.type.displayName&&e.type.displayName.includes("SwiperSlide")}function dl(e){const t=[];return L.Children.toArray(e).forEach((e=>{ul(e)?t.push(e):e.props&&e.props.children&&dl(e.props.children).forEach((e=>t.push(e)))})),t}function hl(e){const t=[],n={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return L.Children.toArray(e).forEach((e=>{if(ul(e))t.push(e);else if(e.props&&e.props.slot&&n[e.props.slot])n[e.props.slot].push(e);else if(e.props&&e.props.children){const i=dl(e.props.children);i.length>0?i.forEach((e=>t.push(e))):n["container-end"].push(e)}else n["container-end"].push(e)})),{slides:t,slots:n}}function pl(e,t){return"undefined"==typeof window?l.useEffect(e,t):l.useLayoutEffect(e,t)}const fl=l.createContext(null),ml=l.createContext(null),gl=l.forwardRef((function(e,t){let{className:n,tag:i="div",wrapperTag:s="div",children:r,onSwiper:o,...a}=void 0===e?{}:e,c=!1;const[u,d]=l.useState("swiper"),[h,p]=l.useState(null),[f,m]=l.useState(!1),g=l.useRef(!1),v=l.useRef(null),y=l.useRef(null),x=l.useRef(null),b=l.useRef(null),w=l.useRef(null),k=l.useRef(null),j=l.useRef(null),T=l.useRef(null),{params:S,passedParams:C,rest:_,events:E}=function(e,t){void 0===e&&(e={}),void 0===t&&(t=!0);const n={on:{}},i={},s={};il(n,He),n._emitClasses=!0,n.init=!1;const r={},o=tl.map((e=>e.replace(/_/,""))),a=Object.assign({},e);return Object.keys(a).forEach((a=>{void 0!==e[a]&&(o.indexOf(a)>=0?nl(e[a])?(n[a]={},s[a]={},il(n[a],e[a]),il(s[a],e[a])):(n[a]=e[a],s[a]=e[a]):0===a.search(/on[A-Z]/)&&"function"==typeof e[a]?t?i[`${a[2].toLowerCase()}${a.substr(3)}`]=e[a]:n.on[`${a[2].toLowerCase()}${a.substr(3)}`]=e[a]:r[a]=e[a])})),["navigation","pagination","scrollbar"].forEach((e=>{!0===n[e]&&(n[e]={}),!1===n[e]&&delete n[e]})),{params:n,passedParams:s,rest:r,events:i}}(a),{slides:I,slots:M}=hl(r),O=()=>{m(!f)};Object.assign(S.on,{_containerClasses(e,t){d(t)}});const R=()=>{Object.assign(S.on,E),c=!0;const e={...S};if(delete e.wrapperClass,y.current=new $e(e),y.current.virtual&&y.current.params.virtual.enabled){y.current.virtual.slides=I;const e={cache:!1,slides:I,renderExternal:p,renderExternalUpdate:!1};il(y.current.params.virtual,e),il(y.current.originalParams.virtual,e)}};v.current||R(),y.current&&y.current.on("_beforeBreakpoint",O);return l.useEffect((()=>()=>{y.current&&y.current.off("_beforeBreakpoint",O)})),l.useEffect((()=>{!g.current&&y.current&&(y.current.emitSlidesClasses(),g.current=!0)})),pl((()=>{if(t&&(t.current=v.current),v.current)return y.current.destroyed&&R(),function(e,t){let{el:n,nextEl:i,prevEl:s,paginationEl:r,scrollbarEl:o,swiper:a}=e;sl(t)&&i&&s&&(a.params.navigation.nextEl=i,a.originalParams.navigation.nextEl=i,a.params.navigation.prevEl=s,a.originalParams.navigation.prevEl=s),rl(t)&&r&&(a.params.pagination.el=r,a.originalParams.pagination.el=r),ol(t)&&o&&(a.params.scrollbar.el=o,a.originalParams.scrollbar.el=o),a.init(n)}({el:v.current,nextEl:w.current,prevEl:k.current,paginationEl:j.current,scrollbarEl:T.current,swiper:y.current},S),o&&!y.current.destroyed&&o(y.current),()=>{y.current&&!y.current.destroyed&&y.current.destroy(!0,!1)}}),[]),pl((()=>{!c&&E&&y.current&&Object.keys(E).forEach((e=>{y.current.on(e,E[e])}));const e=function(e,t,n,i,s){const r=[];if(!t)return r;const o=e=>{r.indexOf(e)<0&&r.push(e)};if(n&&i){const e=i.map(s),t=n.map(s);e.join("")!==t.join("")&&o("children"),i.length!==n.length&&o("children")}return tl.filter((e=>"_"===e[0])).map((e=>e.replace(/_/,""))).forEach((n=>{if(n in e&&n in t)if(nl(e[n])&&nl(t[n])){const i=Object.keys(e[n]),s=Object.keys(t[n]);i.length!==s.length?o(n):(i.forEach((i=>{e[n][i]!==t[n][i]&&o(n)})),s.forEach((i=>{e[n][i]!==t[n][i]&&o(n)})))}else e[n]!==t[n]&&o(n)})),r}(C,x.current,I,b.current,(e=>e.key));return x.current=C,b.current=I,e.length&&y.current&&!y.current.destroyed&&function(e){let{swiper:t,slides:n,passedParams:i,changedParams:s,nextEl:r,prevEl:o,scrollbarEl:a,paginationEl:l}=e;const c=s.filter((e=>"children"!==e&&"direction"!==e&&"wrapperClass"!==e)),{params:u,pagination:d,navigation:h,scrollbar:p,virtual:f,thumbs:m}=t;let g,v,y,x,b,w,k,j;s.includes("thumbs")&&i.thumbs&&i.thumbs.swiper&&!i.thumbs.swiper.destroyed&&u.thumbs&&(!u.thumbs.swiper||u.thumbs.swiper.destroyed)&&(g=!0),s.includes("controller")&&i.controller&&i.controller.control&&u.controller&&!u.controller.control&&(v=!0),s.includes("pagination")&&i.pagination&&(i.pagination.el||l)&&(u.pagination||!1===u.pagination)&&d&&!d.el&&(y=!0),s.includes("scrollbar")&&i.scrollbar&&(i.scrollbar.el||a)&&(u.scrollbar||!1===u.scrollbar)&&p&&!p.el&&(x=!0),s.includes("navigation")&&i.navigation&&(i.navigation.prevEl||o)&&(i.navigation.nextEl||r)&&(u.navigation||!1===u.navigation)&&h&&!h.prevEl&&!h.nextEl&&(b=!0);const T=e=>{t[e]&&(t[e].destroy(),"navigation"===e?(t.isElement&&(t[e].prevEl.remove(),t[e].nextEl.remove()),u[e].prevEl=void 0,u[e].nextEl=void 0,t[e].prevEl=void 0,t[e].nextEl=void 0):(t.isElement&&t[e].el.remove(),u[e].el=void 0,t[e].el=void 0))};s.includes("loop")&&t.isElement&&(u.loop&&!i.loop?w=!0:!u.loop&&i.loop?k=!0:j=!0),c.forEach((e=>{if(nl(u[e])&&nl(i[e]))Object.assign(u[e],i[e]),"navigation"!==e&&"pagination"!==e&&"scrollbar"!==e||!("enabled"in i[e])||i[e].enabled||T(e);else{const t=i[e];!0!==t&&!1!==t||"navigation"!==e&&"pagination"!==e&&"scrollbar"!==e?u[e]=i[e]:!1===t&&T(e)}})),c.includes("controller")&&!v&&t.controller&&t.controller.control&&u.controller&&u.controller.control&&(t.controller.control=u.controller.control),s.includes("children")&&n&&f&&u.virtual.enabled?(f.slides=n,f.update(!0)):s.includes("virtual")&&f&&u.virtual.enabled&&(n&&(f.slides=n),f.update(!0)),s.includes("children")&&n&&u.loop&&(j=!0),g&&m.init()&&m.update(!0);v&&(t.controller.control=u.controller.control),y&&(!t.isElement||l&&"string"!=typeof l||(l=document.createElement("div"),l.classList.add("swiper-pagination"),l.part.add("pagination"),t.el.appendChild(l)),l&&(u.pagination.el=l),d.init(),d.render(),d.update()),x&&(!t.isElement||a&&"string"!=typeof a||(a=document.createElement("div"),a.classList.add("swiper-scrollbar"),a.part.add("scrollbar"),t.el.appendChild(a)),a&&(u.scrollbar.el=a),p.init(),p.updateSize(),p.setTranslate()),b&&(t.isElement&&(r&&"string"!=typeof r||(r=document.createElement("div"),r.classList.add("swiper-button-next"),r.innerHTML=t.hostEl.constructor.nextButtonSvg,r.part.add("button-next"),t.el.appendChild(r)),o&&"string"!=typeof o||(o=document.createElement("div"),o.classList.add("swiper-button-prev"),o.innerHTML=t.hostEl.constructor.prevButtonSvg,o.part.add("button-prev"),t.el.appendChild(o))),r&&(u.navigation.nextEl=r),o&&(u.navigation.prevEl=o),h.init(),h.update()),s.includes("allowSlideNext")&&(t.allowSlideNext=i.allowSlideNext),s.includes("allowSlidePrev")&&(t.allowSlidePrev=i.allowSlidePrev),s.includes("direction")&&t.changeDirection(i.direction,!1),(w||j)&&t.loopDestroy(),(k||j)&&t.loopCreate(),t.update()}({swiper:y.current,slides:I,passedParams:C,changedParams:e,nextEl:w.current,prevEl:k.current,scrollbarEl:T.current,paginationEl:j.current}),()=>{E&&y.current&&Object.keys(E).forEach((e=>{y.current.off(e,E[e])}))}})),pl((()=>{var e;!(e=y.current)||e.destroyed||!e.params.virtual||e.params.virtual&&!e.params.virtual.enabled||(e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.parallax&&e.params.parallax&&e.params.parallax.enabled&&e.parallax.setTranslate())}),[h]),L.createElement(i,cl({ref:v,className:al(`${u}${n?` ${n}`:""}`)},_),L.createElement(ml.Provider,{value:y.current},M["container-start"],L.createElement(s,{className:ll(S.wrapperClass)},M["wrapper-start"],S.virtual?function(e,t,n){if(!n)return null;const i=e=>{let n=e;return e<0?n=t.length+e:n>=t.length&&(n-=t.length),n},s=e.isHorizontal()?{[e.rtlTranslate?"right":"left"]:`${n.offset}px`}:{top:`${n.offset}px`},{from:r,to:o}=n,a=e.params.loop?-t.length:0,l=e.params.loop?2*t.length:t.length,c=[];for(let u=a;u<l;u+=1)u>=r&&u<=o&&c.push(t[i(u)]);return c.map(((t,n)=>L.cloneElement(t,{swiper:e,style:s,key:t.props.virtualIndex||t.key||`slide-${n}`})))}(y.current,I,h):I.map(((e,t)=>L.cloneElement(e,{swiper:y.current,swiperSlideIndex:t}))),M["wrapper-end"]),sl(S)&&L.createElement(L.Fragment,null,L.createElement("div",{ref:k,className:"swiper-button-prev"}),L.createElement("div",{ref:w,className:"swiper-button-next"})),ol(S)&&L.createElement("div",{ref:T,className:"swiper-scrollbar"}),rl(S)&&L.createElement("div",{ref:j,className:"swiper-pagination"}),M["container-end"]))}));gl.displayName="Swiper";const vl=l.forwardRef((function(e,t){let{tag:n="div",children:i,className:s="",swiper:r,zoom:o,lazy:a,virtualIndex:c,swiperSlideIndex:u,...d}=void 0===e?{}:e;const h=l.useRef(null),[p,f]=l.useState("swiper-slide"),[m,g]=l.useState(!1);function v(e,t,n){t===h.current&&f(n)}pl((()=>{if(void 0!==u&&(h.current.swiperSlideIndex=u),t&&(t.current=h.current),h.current&&r){if(!r.destroyed)return r.on("_slideClass",v),()=>{r&&r.off("_slideClass",v)};"swiper-slide"!==p&&f("swiper-slide")}})),pl((()=>{r&&h.current&&!r.destroyed&&f(r.getSlideClasses(h.current))}),[r]);const y={isActive:p.indexOf("swiper-slide-active")>=0,isVisible:p.indexOf("swiper-slide-visible")>=0,isPrev:p.indexOf("swiper-slide-prev")>=0,isNext:p.indexOf("swiper-slide-next")>=0},x=()=>"function"==typeof i?i(y):i;return L.createElement(n,cl({ref:h,className:al(`${p}${s?` ${s}`:""}`),"data-swiper-slide-index":c,onLoad:()=>{g(!0)}},d),o&&L.createElement(fl.Provider,{value:y},L.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":"number"==typeof o?o:void 0},x(),a&&!m&&L.createElement("div",{className:"swiper-lazy-preloader"}))),!o&&L.createElement(fl.Provider,{value:y},x(),a&&!m&&L.createElement("div",{className:"swiper-lazy-preloader"})))}));function yl(e,t,n,i){return e.params.createElements&&Object.keys(i).forEach((s=>{if(!n[s]&&!0===n.auto){let r=Fe(e.el,`.${i[s]}`)[0];r||(r=Ne("div",i[s]),r.className=i[s],e.el.append(r)),n[s]=r,t[s]=r}})),n}function xl(e){let{swiper:t,extendParams:n,on:i,emit:s}=e;function r(e){let n;return e&&"string"==typeof e&&t.isElement&&(n=t.el.querySelector(e)||t.hostEl.querySelector(e),n)?n:(e&&("string"==typeof e&&(n=[...document.querySelectorAll(e)]),t.params.uniqueNavElements&&"string"==typeof e&&n&&n.length>1&&1===t.el.querySelectorAll(e).length?n=t.el.querySelector(e):n&&1===n.length&&(n=n[0])),e&&!n?e:n)}function o(e,n){const i=t.params.navigation;(e=Ye(e)).forEach((e=>{e&&(e.classList[n?"add":"remove"](...i.disabledClass.split(" ")),"BUTTON"===e.tagName&&(e.disabled=n),t.params.watchOverflow&&t.enabled&&e.classList[t.isLocked?"add":"remove"](i.lockClass))}))}function a(){const{nextEl:e,prevEl:n}=t.navigation;if(t.params.loop)return o(n,!1),void o(e,!1);o(n,t.isBeginning&&!t.params.rewind),o(e,t.isEnd&&!t.params.rewind)}function l(e){e.preventDefault(),(!t.isBeginning||t.params.loop||t.params.rewind)&&(t.slidePrev(),s("navigationPrev"))}function c(e){e.preventDefault(),(!t.isEnd||t.params.loop||t.params.rewind)&&(t.slideNext(),s("navigationNext"))}function u(){const e=t.params.navigation;if(t.params.navigation=yl(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!e.nextEl&&!e.prevEl)return;let n=r(e.nextEl),i=r(e.prevEl);Object.assign(t.navigation,{nextEl:n,prevEl:i}),n=Ye(n),i=Ye(i);const s=(n,i)=>{n&&n.addEventListener("click","next"===i?c:l),!t.enabled&&n&&n.classList.add(...e.lockClass.split(" "))};n.forEach((e=>s(e,"next"))),i.forEach((e=>s(e,"prev")))}function d(){let{nextEl:e,prevEl:n}=t.navigation;e=Ye(e),n=Ye(n);const i=(e,n)=>{e.removeEventListener("click","next"===n?c:l),e.classList.remove(...t.params.navigation.disabledClass.split(" "))};e.forEach((e=>i(e,"next"))),n.forEach((e=>i(e,"prev")))}n({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null},i("init",(()=>{!1===t.params.navigation.enabled?h():(u(),a())})),i("toEdge fromEdge lock unlock",(()=>{a()})),i("destroy",(()=>{d()})),i("enable disable",(()=>{let{nextEl:e,prevEl:n}=t.navigation;e=Ye(e),n=Ye(n),t.enabled?a():[...e,...n].filter((e=>!!e)).forEach((e=>e.classList.add(t.params.navigation.lockClass)))})),i("click",((e,n)=>{let{nextEl:i,prevEl:r}=t.navigation;i=Ye(i),r=Ye(r);const o=n.target;let a=r.includes(o)||i.includes(o);if(t.isElement&&!a){const e=n.path||n.composedPath&&n.composedPath();e&&(a=e.find((e=>i.includes(e)||r.includes(e))))}if(t.params.navigation.hideOnClick&&!a){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===o||t.pagination.el.contains(o)))return;let e;i.length?e=i[0].classList.contains(t.params.navigation.hiddenClass):r.length&&(e=r[0].classList.contains(t.params.navigation.hiddenClass)),s(!0===e?"navigationShow":"navigationHide"),[...i,...r].filter((e=>!!e)).forEach((e=>e.classList.toggle(t.params.navigation.hiddenClass)))}}));const h=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),d()};Object.assign(t.navigation,{enable:()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),u(),a()},disable:h,update:a,init:u,destroy:d})}function bl(e){return void 0===e&&(e=""),`.${e.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`}function wl(e){let{swiper:t,extendParams:n,on:i,emit:s}=e;const r="swiper-pagination";let o;n({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:e=>e,formatFractionTotal:e=>e,bulletClass:`${r}-bullet`,bulletActiveClass:`${r}-bullet-active`,modifierClass:`${r}-`,currentClass:`${r}-current`,totalClass:`${r}-total`,hiddenClass:`${r}-hidden`,progressbarFillClass:`${r}-progressbar-fill`,progressbarOppositeClass:`${r}-progressbar-opposite`,clickableClass:`${r}-clickable`,lockClass:`${r}-lock`,horizontalClass:`${r}-horizontal`,verticalClass:`${r}-vertical`,paginationDisabledClass:`${r}-disabled`}}),t.pagination={el:null,bullets:[]};let a=0;function l(){return!t.params.pagination.el||!t.pagination.el||Array.isArray(t.pagination.el)&&0===t.pagination.el.length}function c(e,n){const{bulletActiveClass:i}=t.params.pagination;e&&(e=e[("prev"===n?"previous":"next")+"ElementSibling"])&&(e.classList.add(`${i}-${n}`),(e=e[("prev"===n?"previous":"next")+"ElementSibling"])&&e.classList.add(`${i}-${n}-${n}`))}function u(e){const n=e.target.closest(bl(t.params.pagination.bulletClass));if(!n)return;e.preventDefault();const i=Ue(n)*t.params.slidesPerGroup;if(t.params.loop){if(t.realIndex===i)return;const e=(s=t.realIndex,r=i,o=t.slides.length,(r%=o)==1+(s%=o)?"next":r===s-1?"previous":void 0);"next"===e?t.slideNext():"previous"===e?t.slidePrev():t.slideToLoop(i)}else t.slideTo(i);var s,r,o}function d(){const e=t.rtl,n=t.params.pagination;if(l())return;let i,r,u=t.pagination.el;u=Ye(u);const d=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.slides.length,h=t.params.loop?Math.ceil(d/t.params.slidesPerGroup):t.snapGrid.length;if(t.params.loop?(r=t.previousRealIndex||0,i=t.params.slidesPerGroup>1?Math.floor(t.realIndex/t.params.slidesPerGroup):t.realIndex):void 0!==t.snapIndex?(i=t.snapIndex,r=t.previousSnapIndex):(r=t.previousIndex||0,i=t.activeIndex||0),"bullets"===n.type&&t.pagination.bullets&&t.pagination.bullets.length>0){const s=t.pagination.bullets;let l,d,h;if(n.dynamicBullets&&(o=Ve(s[0],t.isHorizontal()?"width":"height"),u.forEach((e=>{e.style[t.isHorizontal()?"width":"height"]=o*(n.dynamicMainBullets+4)+"px"})),n.dynamicMainBullets>1&&void 0!==r&&(a+=i-(r||0),a>n.dynamicMainBullets-1?a=n.dynamicMainBullets-1:a<0&&(a=0)),l=Math.max(i-a,0),d=l+(Math.min(s.length,n.dynamicMainBullets)-1),h=(d+l)/2),s.forEach((e=>{const t=[...["","-next","-next-next","-prev","-prev-prev","-main"].map((e=>`${n.bulletActiveClass}${e}`))].map((e=>"string"==typeof e&&e.includes(" ")?e.split(" "):e)).flat();e.classList.remove(...t)})),u.length>1)s.forEach((e=>{const s=Ue(e);s===i?e.classList.add(...n.bulletActiveClass.split(" ")):t.isElement&&e.setAttribute("part","bullet"),n.dynamicBullets&&(s>=l&&s<=d&&e.classList.add(...`${n.bulletActiveClass}-main`.split(" ")),s===l&&c(e,"prev"),s===d&&c(e,"next"))}));else{const e=s[i];if(e&&e.classList.add(...n.bulletActiveClass.split(" ")),t.isElement&&s.forEach(((e,t)=>{e.setAttribute("part",t===i?"bullet-active":"bullet")})),n.dynamicBullets){const e=s[l],t=s[d];for(let i=l;i<=d;i+=1)s[i]&&s[i].classList.add(...`${n.bulletActiveClass}-main`.split(" "));c(e,"prev"),c(t,"next")}}if(n.dynamicBullets){const i=Math.min(s.length,n.dynamicMainBullets+4),r=(o*i-o)/2-h*o,a=e?"right":"left";s.forEach((e=>{e.style[t.isHorizontal()?a:"top"]=`${r}px`}))}}u.forEach(((e,r)=>{if("fraction"===n.type&&(e.querySelectorAll(bl(n.currentClass)).forEach((e=>{e.textContent=n.formatFractionCurrent(i+1)})),e.querySelectorAll(bl(n.totalClass)).forEach((e=>{e.textContent=n.formatFractionTotal(h)}))),"progressbar"===n.type){let s;s=n.progressbarOpposite?t.isHorizontal()?"vertical":"horizontal":t.isHorizontal()?"horizontal":"vertical";const r=(i+1)/h;let o=1,a=1;"horizontal"===s?o=r:a=r,e.querySelectorAll(bl(n.progressbarFillClass)).forEach((e=>{e.style.transform=`translate3d(0,0,0) scaleX(${o}) scaleY(${a})`,e.style.transitionDuration=`${t.params.speed}ms`}))}"custom"===n.type&&n.renderCustom?(e.innerHTML=n.renderCustom(t,i+1,h),0===r&&s("paginationRender",e)):(0===r&&s("paginationRender",e),s("paginationUpdate",e)),t.params.watchOverflow&&t.enabled&&e.classList[t.isLocked?"add":"remove"](n.lockClass)}))}function h(){const e=t.params.pagination;if(l())return;const n=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.grid&&t.params.grid.rows>1?t.slides.length/Math.ceil(t.params.grid.rows):t.slides.length;let i=t.pagination.el;i=Ye(i);let r="";if("bullets"===e.type){let i=t.params.loop?Math.ceil(n/t.params.slidesPerGroup):t.snapGrid.length;t.params.freeMode&&t.params.freeMode.enabled&&i>n&&(i=n);for(let n=0;n<i;n+=1)e.renderBullet?r+=e.renderBullet.call(t,n,e.bulletClass):r+=`<${e.bulletElement} ${t.isElement?'part="bullet"':""} class="${e.bulletClass}"></${e.bulletElement}>`}"fraction"===e.type&&(r=e.renderFraction?e.renderFraction.call(t,e.currentClass,e.totalClass):`<span class="${e.currentClass}"></span> / <span class="${e.totalClass}"></span>`),"progressbar"===e.type&&(r=e.renderProgressbar?e.renderProgressbar.call(t,e.progressbarFillClass):`<span class="${e.progressbarFillClass}"></span>`),t.pagination.bullets=[],i.forEach((n=>{"custom"!==e.type&&(n.innerHTML=r||""),"bullets"===e.type&&t.pagination.bullets.push(...n.querySelectorAll(bl(e.bulletClass)))})),"custom"!==e.type&&s("paginationRender",i[0])}function p(){t.params.pagination=yl(t,t.originalParams.pagination,t.params.pagination,{el:"swiper-pagination"});const e=t.params.pagination;if(!e.el)return;let n;"string"==typeof e.el&&t.isElement&&(n=t.el.querySelector(e.el)),n||"string"!=typeof e.el||(n=[...document.querySelectorAll(e.el)]),n||(n=e.el),n&&0!==n.length&&(t.params.uniqueNavElements&&"string"==typeof e.el&&Array.isArray(n)&&n.length>1&&(n=[...t.el.querySelectorAll(e.el)],n.length>1&&(n=n.find((e=>We(e,".swiper")[0]===t.el)))),Array.isArray(n)&&1===n.length&&(n=n[0]),Object.assign(t.pagination,{el:n}),n=Ye(n),n.forEach((n=>{"bullets"===e.type&&e.clickable&&n.classList.add(...(e.clickableClass||"").split(" ")),n.classList.add(e.modifierClass+e.type),n.classList.add(t.isHorizontal()?e.horizontalClass:e.verticalClass),"bullets"===e.type&&e.dynamicBullets&&(n.classList.add(`${e.modifierClass}${e.type}-dynamic`),a=0,e.dynamicMainBullets<1&&(e.dynamicMainBullets=1)),"progressbar"===e.type&&e.progressbarOpposite&&n.classList.add(e.progressbarOppositeClass),e.clickable&&n.addEventListener("click",u),t.enabled||n.classList.add(e.lockClass)})))}function f(){const e=t.params.pagination;if(l())return;let n=t.pagination.el;n&&(n=Ye(n),n.forEach((n=>{n.classList.remove(e.hiddenClass),n.classList.remove(e.modifierClass+e.type),n.classList.remove(t.isHorizontal()?e.horizontalClass:e.verticalClass),e.clickable&&(n.classList.remove(...(e.clickableClass||"").split(" ")),n.removeEventListener("click",u))}))),t.pagination.bullets&&t.pagination.bullets.forEach((t=>t.classList.remove(...e.bulletActiveClass.split(" "))))}i("changeDirection",(()=>{if(!t.pagination||!t.pagination.el)return;const e=t.params.pagination;let{el:n}=t.pagination;n=Ye(n),n.forEach((n=>{n.classList.remove(e.horizontalClass,e.verticalClass),n.classList.add(t.isHorizontal()?e.horizontalClass:e.verticalClass)}))})),i("init",(()=>{!1===t.params.pagination.enabled?m():(p(),h(),d())})),i("activeIndexChange",(()=>{void 0===t.snapIndex&&d()})),i("snapIndexChange",(()=>{d()})),i("snapGridLengthChange",(()=>{h(),d()})),i("destroy",(()=>{f()})),i("enable disable",(()=>{let{el:e}=t.pagination;e&&(e=Ye(e),e.forEach((e=>e.classList[t.enabled?"remove":"add"](t.params.pagination.lockClass))))})),i("lock unlock",(()=>{d()})),i("click",((e,n)=>{const i=n.target,r=Ye(t.pagination.el);if(t.params.pagination.el&&t.params.pagination.hideOnClick&&r&&r.length>0&&!i.classList.contains(t.params.pagination.bulletClass)){if(t.navigation&&(t.navigation.nextEl&&i===t.navigation.nextEl||t.navigation.prevEl&&i===t.navigation.prevEl))return;const e=r[0].classList.contains(t.params.pagination.hiddenClass);s(!0===e?"paginationShow":"paginationHide"),r.forEach((e=>e.classList.toggle(t.params.pagination.hiddenClass)))}}));const m=()=>{t.el.classList.add(t.params.pagination.paginationDisabledClass);let{el:e}=t.pagination;e&&(e=Ye(e),e.forEach((e=>e.classList.add(t.params.pagination.paginationDisabledClass)))),f()};Object.assign(t.pagination,{enable:()=>{t.el.classList.remove(t.params.pagination.paginationDisabledClass);let{el:e}=t.pagination;e&&(e=Ye(e),e.forEach((e=>e.classList.remove(t.params.pagination.paginationDisabledClass)))),p(),h(),d()},disable:m,render:h,update:d,init:p,destroy:f})}function kl(e){let t,n,{swiper:i,extendParams:s,on:r,emit:o,params:a}=e;i.autoplay={running:!1,paused:!1,timeLeft:0},s({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let l,c,u,d,h,p,f,m,g=a&&a.autoplay?a.autoplay.delay:3e3,v=a&&a.autoplay?a.autoplay.delay:3e3,y=(new Date).getTime();function x(e){i&&!i.destroyed&&i.wrapperEl&&e.target===i.wrapperEl&&(i.wrapperEl.removeEventListener("transitionend",x),m||e.detail&&e.detail.bySwiperTouchMove||S())}const b=()=>{if(i.destroyed||!i.autoplay.running)return;i.autoplay.paused?c=!0:c&&(v=l,c=!1);const e=i.autoplay.paused?l:y+v-(new Date).getTime();i.autoplay.timeLeft=e,o("autoplayTimeLeft",e,e/g),n=requestAnimationFrame((()=>{b()}))},w=e=>{if(i.destroyed||!i.autoplay.running)return;cancelAnimationFrame(n),b();let s=void 0===e?i.params.autoplay.delay:e;g=i.params.autoplay.delay,v=i.params.autoplay.delay;const r=(()=>{let e;if(e=i.virtual&&i.params.virtual.enabled?i.slides.find((e=>e.classList.contains("swiper-slide-active"))):i.slides[i.activeIndex],!e)return;return parseInt(e.getAttribute("data-swiper-autoplay"),10)})();!Number.isNaN(r)&&r>0&&void 0===e&&(s=r,g=r,v=r),l=s;const a=i.params.speed,c=()=>{i&&!i.destroyed&&(i.params.autoplay.reverseDirection?!i.isBeginning||i.params.loop||i.params.rewind?(i.slidePrev(a,!0,!0),o("autoplay")):i.params.autoplay.stopOnLastSlide||(i.slideTo(i.slides.length-1,a,!0,!0),o("autoplay")):!i.isEnd||i.params.loop||i.params.rewind?(i.slideNext(a,!0,!0),o("autoplay")):i.params.autoplay.stopOnLastSlide||(i.slideTo(0,a,!0,!0),o("autoplay")),i.params.cssMode&&(y=(new Date).getTime(),requestAnimationFrame((()=>{w()}))))};return s>0?(clearTimeout(t),t=setTimeout((()=>{c()}),s)):requestAnimationFrame((()=>{c()})),s},k=()=>{y=(new Date).getTime(),i.autoplay.running=!0,w(),o("autoplayStart")},j=()=>{i.autoplay.running=!1,clearTimeout(t),cancelAnimationFrame(n),o("autoplayStop")},T=(e,n)=>{if(i.destroyed||!i.autoplay.running)return;clearTimeout(t),e||(f=!0);const s=()=>{o("autoplayPause"),i.params.autoplay.waitForTransition?i.wrapperEl.addEventListener("transitionend",x):S()};if(i.autoplay.paused=!0,n)return p&&(l=i.params.autoplay.delay),p=!1,void s();const r=l||i.params.autoplay.delay;l=r-((new Date).getTime()-y),i.isEnd&&l<0&&!i.params.loop||(l<0&&(l=0),s())},S=()=>{i.isEnd&&l<0&&!i.params.loop||i.destroyed||!i.autoplay.running||(y=(new Date).getTime(),f?(f=!1,w(l)):w(),i.autoplay.paused=!1,o("autoplayResume"))},C=()=>{if(i.destroyed||!i.autoplay.running)return;const e=qe();"hidden"===e.visibilityState&&(f=!0,T(!0)),"visible"===e.visibilityState&&S()},_=e=>{"mouse"===e.pointerType&&(f=!0,m=!0,i.animating||i.autoplay.paused||T(!0))},E=e=>{"mouse"===e.pointerType&&(m=!1,i.autoplay.paused&&S())};r("init",(()=>{i.params.autoplay.enabled&&(i.params.autoplay.pauseOnMouseEnter&&(i.el.addEventListener("pointerenter",_),i.el.addEventListener("pointerleave",E)),qe().addEventListener("visibilitychange",C),k())})),r("destroy",(()=>{i.el&&"string"!=typeof i.el&&(i.el.removeEventListener("pointerenter",_),i.el.removeEventListener("pointerleave",E)),qe().removeEventListener("visibilitychange",C),i.autoplay.running&&j()})),r("_freeModeStaticRelease",(()=>{(d||f)&&S()})),r("_freeModeNoMomentumRelease",(()=>{i.params.autoplay.disableOnInteraction?j():T(!0,!0)})),r("beforeTransitionStart",((e,t,n)=>{!i.destroyed&&i.autoplay.running&&(n||!i.params.autoplay.disableOnInteraction?T(!0,!0):j())})),r("sliderFirstMove",(()=>{!i.destroyed&&i.autoplay.running&&(i.params.autoplay.disableOnInteraction?j():(u=!0,d=!1,f=!1,h=setTimeout((()=>{f=!0,d=!0,T(!0)}),200)))})),r("touchEnd",(()=>{if(!i.destroyed&&i.autoplay.running&&u){if(clearTimeout(h),clearTimeout(t),i.params.autoplay.disableOnInteraction)return d=!1,void(u=!1);d&&i.params.cssMode&&S(),d=!1,u=!1}})),r("slideChange",(()=>{!i.destroyed&&i.autoplay.running&&(p=!0)})),Object.assign(i.autoplay,{start:k,stop:j,pause:T,resume:S})}vl.displayName="SwiperSlide";const jl=({initInterval:e=6e3,initItems:t=[]})=>{const[n,i]=l.useState(!0),[s,r]=l.useState(!1),[o,a]=l.useState(e),[g,v]=l.useState(!0),[y,x]=l.useState(!1),[b,w]=l.useState(50),[k,j]=l.useState(""),[T,S]=l.useState(""),[C,L]=l.useState(""),[I,M]=l.useState([]),[O,V]=l.useState(t),[U,q]=l.useState(!1),[G,K]=l.useState(!1),[J,Z]=l.useState(!1),X=l.useRef(null),Q=l.useRef(null),ee=l.useRef(null);function te(e){let t=[],n=0;i(!0),X.current.swiper.autoplay.stop(),X.current.swiper.slideTo(0),M([]),S(""),"numbers"===e||"images"===e?(t=Array.from({length:b},(()=>(n=Math.floor(100*Math.random())+1,{text:n.toString(),url:`${n}.png`}))),x("images"!==e),j(t.map((e=>e.text)).join(" "))):"base"===e&&(t=Array.from({length:b},(()=>({text:`${Math.ceil(5*Math.random())}.${Math.ceil(5*Math.random())}.${Math.ceil(5*Math.random())}`,url:""}))),x(!0));const s=t.concat([{text:"",url:""}]);V(s)}return c.jsxs(u,{sx:{margin:2,display:"flex",flexDirection:"column",maxHeight:"95vh",maxWidth:"700px",minWidth:"300px"},children:[c.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[c.jsx(h,{label:"Количество слов",type:"number",variant:"outlined",size:"small",min:1,max:1e3,value:b,onChange:e=>w(e.target.value)}),c.jsxs(u,{display:"flex",gap:1,children:[c.jsx(m,{variant:"outlined",size:"small",onClick:()=>te("images"),children:"Опорные образы"}),c.jsx(m,{variant:"outlined",size:"small",onClick:()=>te("numbers"),children:"Числа"}),c.jsx(m,{variant:"outlined",size:"small",onClick:()=>te("base"),children:"База"})]})]}),c.jsxs(R,{expanded:s,onChange:()=>r(!s),children:[c.jsx(D,{expandIcon:c.jsx(z,{}),children:c.jsx(p,{children:"Набор слов для запоминания"})}),c.jsxs(P,{children:[c.jsx(h,{label:"Введите текст",multiline:!0,maxRows:10,variant:"outlined",fullWidth:!0,value:k,onChange:e=>j(e.target.value)}),c.jsx(h,{label:"Введите разделитель",variant:"outlined",fullWidth:!0,value:C,onChange:e=>L(e.target.value),sx:{marginTop:2}}),c.jsx(m,{variant:"outlined",size:"small",onClick:function(){if(S(""),""===k.trim())return;M([]),X.current.swiper.slideTo(0),X.current.swiper.autoplay.start(),i(!1),x(!0),r(!1);const e=C||" ",t=k.split(e).filter((e=>""!==e.trim())).map((e=>({text:e,url:""})));V(t)},sx:{marginTop:2},children:"Начать запоминание"})]})]}),c.jsx(u,{sx:{flexGrow:1,marginTop:2,height:"100%",width:"100%"},children:c.jsxs(gl,{ref:X,spaceBetween:30,centeredSlides:!0,autoplay:{enabled:!n,delay:o,disableOnInteraction:!1},lazy:"true",pagination:{type:"fraction"},height:"100%",navigation:!0,modules:[kl,wl,xl],onAutoplayTimeLeft:(e,t,n)=>{Q.current.style.setProperty("--progress",1-n),ee.current.textContent=`${Math.ceil(t/1e3)}s`},onSlideChange:()=>(X.current.swiper.activeIndex===O.length-1&&(i(!0),X.current.swiper.autoplay.stop()),void(g&&new Audio("sounds/click1.mp3").play())),children:[O.map(((e,t)=>c.jsx(vl,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:y?c.jsx(p,{variant:"h3",children:e.text}):c.jsx("img",{src:e.url?`memory/${e.url}`:"memory/placeholder.jpg",alt:e.text,style:{width:"100%",height:"100%"}})},t))),c.jsxs("div",{className:"autoplay-progress",slot:"container-end",children:[c.jsx("svg",{viewBox:"0 0 48 48",ref:Q,children:c.jsx("circle",{cx:"24",cy:"24",r:"20"})}),c.jsx("span",{ref:ee})]})]})}),c.jsxs(u,{sx:{display:"flex",alignItems:"center",marginTop:2,width:"100%"},children:[c.jsxs(A,{size:"small",children:[c.jsx(d,{onClick:function(){O.length<1||(n?X.current.swiper.autoplay.start():X.current.swiper.autoplay.stop(),i(!n))},children:n?c.jsx(B,{}):c.jsx(H,{})}),c.jsx(d,{onClick:function(){O.length<1||(X.current.swiper.slideTo(0),X.current.swiper.autoplay.start(),i(!1))},children:c.jsx($,{})})]}),c.jsx(f,{min:500,max:15e3,step:500,value:o,onChange:function(e,t){a(t),X.current.swiper.params.autoplay.delay=t},valueLabelDisplay:"auto",valueLabelFormat:e=>e/1e3+"s","aria-labelledby":"interval-slider",sx:{width:"150px",marginLeft:2,marginRight:2}}),c.jsx(F,{checked:g,onChange:function(){v(!g)},icon:c.jsx(Y,{}),checkedIcon:c.jsx(N,{})}),c.jsx(F,{checked:y,onChange:function(){x(!y)},icon:c.jsx(W,{}),checkedIcon:c.jsx(W,{})})]}),c.jsx(h,{label:"Введите текст для проверки",multiline:!0,maxRows:10,variant:"outlined",fullWidth:!0,value:T,onChange:e=>S(e.target.value),sx:{marginTop:2}}),c.jsx(m,{variant:"outlined",size:"large",onClick:async function(){const e=C||" ",t=k.split(e).filter((e=>""!==e.trim())),n=T.split(e).filter((e=>""!==e.trim()));let i=[],s=0;for(let u=0;u<t.length;u++)t[u]===n[u]?(i.push({word:t[u],correct:!0}),s++):i.push({word:t[u],correct:!1});const r=i.map((e=>e.correct?e.word:`<span style="color: red;">${e.word}</span>`)).join(" "),o=(s/t.length*100).toFixed(2),a=`Результат: ${s} из ${t.length} (${o}%)`;M({summary:a,words:i,resultString:r});let l=null;try{if(K(!0),l=await async function(e,t){const n=(new Date).getTimezoneOffset();let i=null;const s=new FormData;s.append("table_name",e),s.append("time_zone",n),s.append("record_info",JSON.stringify(t));try{const e=await fetch("/post_new_record",{method:"POST",body:s});if(!e.ok)throw new Error("Ошибка при отправке новой записи на сервер");i=await e.json()}catch(r){}return i}("diary",{reason:"Memory",comment:`Результат: ${s} из ${t.length} (${o}%)`}),K(!1),!l)throw new Error("Ошибка при отправке");Z(!0)}catch(c){q(c.message||"An unexpected error occurred")}finally{K(!1)}setTimeout((()=>{Z(!1),q(!1)}),5e3)},sx:{marginTop:2},children:"Проверить"}),c.jsxs(u,{sx:{height:"100px"},children:[c.jsx(p,{children:I.summary}),c.jsx(p,{sx:{color:"green"},dangerouslySetInnerHTML:{__html:I.resultString}}),G&&c.jsx(_,{size:24}),U&&c.jsx("p",{style:{color:"red"},children:U}),J&&c.jsx(E,{icon:c.jsx(rn,{fontSize:"inherit"}),severity:"success",children:"Результат записан в личный дневник"})]})]})};function Tl(){const{timers:e,setTimers:t,sendTimersToServer:n,addContainer:i}=Kd();if(!e)return null;function s(i,s){const r=e.map((e=>e.id===i?{...e,...s}:e));t(r),n(r)}function r(i){const s=e.filter((e=>e.id!==i));t(s),n(s)}return e?c.jsxs(V,{sx:{overflowY:"auto",maxHeight:"80vh"},children:[c.jsx(m,{onClick:()=>i("timersToolbar"),children:"Add Timer"}),e.map((e=>c.jsx(Kt,{id:e.id,...e,handleUpdateTimers:s,handleCloseTimer:r},e.id)))]}):null}function Sl({element:e,elementId:t,isStartPlay:n=null,onExpireFunc:i=null,currentActionId:s=null}){const[r,o]=l.useState(!1),[a,u]=l.useState(null),[h,p]=l.useState(!1);async function f(){if(a&&r)a.pause(),o(!1);else if(a)a.play(),o(!0);else{p(!0);const n=await fetch("/get_tts_audio",{method:"POST",body:new URLSearchParams({text:e.text})});if(!n.ok)return void p(!1);const s=await n.blob(),r=URL.createObjectURL(s),a=new Audio(r);u(a),a.onended=()=>{o(!1),i&&i(t)},p(!1),a.play(),o(!0)}}return l.useEffect((()=>{n?(o(!0),f()):(o(!1),a&&a.pause())}),[n]),l.useEffect((()=>{s===t&&(o(!0),f())}),[s]),c.jsxs(U,{sx:{margin:0,padding:0},children:[c.jsx(q,{onClick:h?null:f,children:c.jsx(d,{"aria-label":r?"pause":"play",color:"primary",disabled:h,children:h?c.jsx(_,{size:24}):r?c.jsx(Wt,{}):c.jsx($t,{})})}),c.jsx(G,{id:t,primary:e.text})]})}function Cl({element:e,elementId:t,isStartPlay:n=null,onExpireFunc:i=null,currentActionId:s=null}){return l.useEffect((()=>{n&&document.getElementById(t).play()}),[n]),l.useEffect((()=>{s===t&&document.getElementById(t).play()}),[s]),e?c.jsx("audio",{id:t,controls:!0,src:`audio/${e.url}`,onEnded:()=>{i(t)}}):null}function _l({id:e,survey:t,activeElementId:n=null,onExpireFunc:i=null,autosend:s=!0,taskId:r=null}){const o=null==t?void 0:t.fields,a=["id","date","files","time","table_name","task_id"],u=o.filter((e=>!a.includes(e.field_id))),d=u.reduce(((e,t)=>(e[t.field_id]=t.value||"",e)),{}),[p,f]=l.useState(d),[g,v]=l.useState(!1),[y,x]=l.useState(!1),[b,w]=l.useState(!1),[k,j]=l.useState(!1),[T,S]=l.useState(0),[C,L]=l.useState(null),I=l.useRef(null),[M,O]=l.useState([]),{finalTranscript:R,resetTranscript:D,listening:P}=Va.useSpeechRecognition();if(l.useEffect((()=>{n===e&&L(e+t.table_name)}),[n,e,t.table_name]),l.useEffect((()=>{k&&!P&&j(!1)}),[k,P]),l.useEffect((()=>{if(k){Ua.stopListening();const e=u[T-1].field_id;let t=p;"дальше"!==R.toLocaleLowerCase()&&(z(e,R),t={...p,[e]:R}),D(),j(!1),B(T,t)}}),[R]),!u)return null;function z(e,t){f((n=>({...n,[e]:t})))}async function A(n,s=null){v(!1),x(!0),s||(s=p),null!==r&&(s.task_id=r);let o=null;try{if(o=s.id?await async function(e,t,n){const i=(new Date).getTimezoneOffset();let s=null;const r=new FormData;r.append("table_name",e),r.append("time_zone",i),r.append("record_info",JSON.stringify(t)),n.forEach(((e,t)=>{r.append(`files[${t}]`,e)}));try{const e=await fetch("/post_edited_record_api",{method:"POST",body:r});if(!e.ok)throw new Error("Ошибка при отправке обновленной записи на сервер");s=await e.json()}catch(o){}return s}(t.table_name,s,M):await async function(e,t,n){const i=(new Date).getTimezoneOffset();let s=null;const r=new FormData;r.append("table_name",e),r.append("time_zone",i),r.append("record_info",JSON.stringify(t)),n.forEach(((e,t)=>{r.append(`files[${t}]`,e)}));try{const e=await fetch("/post_new_record",{method:"POST",body:r});if(!e.ok)throw new Error("Ошибка при отправке новой записи на сервер");s=await e.json()}catch(o){}return s}(t.table_name,s,M),!o)throw new Error("Ошибка при отправке");O([]),f(o),w(!0)}catch(a){v(a.message||"An unexpected error occurred")}finally{x(!1),i&&i(e)}}async function B(n,i=null){i||(i=p);let r=T;n==e+t.table_name&&(r=0,S(0));let o=u[r];for(;o&&"false"===o.check;)r++,o=u[r];if(S(r+1),r>=u.length)return void(s&&A(0,i));const a=await(l=o.field_name,fetch("/get_tts_audio_filename",{method:"POST",body:new URLSearchParams({text:l}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{if(!e.ok)throw new Error("Network response was not ok "+e.statusText);return e.json()})).then((e=>e.filename)).catch((e=>{})));var l;const c=new Audio(`temp/${a}`);c.onended=()=>{j(!0),Ua.startListening()},c.play()}return c.jsxs(V,{children:[c.jsxs("p",{children:["Имя таблицы: ",t.table_name]}),c.jsx(Sl,{element:{text:t.text},elementId:e+t.table_name,onExpireFunc:B,currentActionId:C},e+t.table_name),u.map((t=>c.jsx("div",{style:{marginBottom:"1rem"},children:c.jsx(h,{id:e+t.field_id,label:t.field_name,multiline:!0,maxRows:15,fullWidth:!0,value:p[t.field_id]||"",onChange:e=>z(t.field_id,e.target.value)})},e+t.field_id))),y?c.jsx(_,{size:24}):c.jsxs(V,{children:[M&&M.length>0&&c.jsx(Za,{files:M,setFiles:O}),c.jsx("input",{type:"file",multiple:!0,ref:I,style:{display:"none"},onChange:function(e){const t=Array.from(e.target.files);O((e=>{const n=t.filter((t=>!e.some((e=>e.name===t.name&&e.lastModified===t.lastModified))));return[...e,...n]})),I.current.value=""}}),c.jsx(m,{onClick:A,disabled:y,children:"Записать"}),c.jsx(m,{onClick:()=>I.current.click(),disabled:y,children:"Прикрепить файл"})]}),g&&c.jsx("p",{style:{color:"red"},children:g}),b&&c.jsx(E,{icon:c.jsx(rn,{fontSize:"inherit"}),severity:"success",children:"Запись обновлена"})]})}function El({isRunningProp:e=!1,updateProgress:t}){var n;const[i,s]=l.useState(e),[r,o]=l.useState(null),[a,f]=l.useState(!1),[m,g]=l.useState(null),[v,y]=l.useState("my_day"),x=l.useMemo((()=>[{label:"Демонстрация",src:"demo"},{label:"Продуктивность",src:"productivity"},{label:"Расслабление",src:"relax"},{label:"Мой день",src:"my_day"}]),[]);async function b(e,t){y(t),g(null),s(!1),o(null),f(!1);const n=await async function(e){try{const t=await fetch(`/get_scenario/${e}`);if(!t.ok)throw new Error("Network response was not ok");return(await t.json()).scenario}catch(t){return null}}(t);g(n)}function w(e){if(!i)return;const t=e.split("_"),n=t[1];let r=parseInt(t[2]);if(r>=m.steps[n].actions.length-1)return r=0,n>=m.steps.length-1?void s(!1):(o(`el_${parseInt(n)+1}_0`),void f(`panel_${parseInt(n)+1}`));o(`el_${n}_${r+1}`)}function k(e,t,n){const s=`el_${n}_${t}`;let o=0,a=null,l=!1;switch(e.type){case"timer":if(e.endtime)a=e.endtime,l=!0;else for(let t=0;t<e.time.length;t++)o+=parseInt(e.time[t])*Math.pow(60,e.time.length-1-t);return c.jsx(Kt,{id:s,resultText:e.name,initialEndTimeProp:a,initialTimeProp:a?void 0:o,onExpireFunc:w,currentActionId:r,isRunningProp:l},s);case"metronome":return c.jsx(en,{intialName:e.name,initialCount:e.count,initialBpm:e.bpm,id:s,onExpireFunc:w,currentActionId:r},s);case"text":return c.jsx(Sl,{element:e,elementId:s,isScenarioRunning:i,onExpireFunc:w,currentActionId:r},s);case"audio":return c.jsx(Cl,{element:e,elementId:s,isStartPlay:!1,onExpireFunc:w,currentActionId:r},s);case"survey":return c.jsx(_l,{id:s,survey:e,onExpireFunc:w,activeElementId:r},s);default:return null}}function j(e,t){const n=a===`panel_${t}`;return c.jsxs(R,{expanded:n,onChange:()=>f(!n&&`panel_${t}`),children:[c.jsx(D,{expandIcon:c.jsx(cn,{}),sx:{padding:0},children:c.jsxs(U,{sx:{margin:0,padding:0},children:[c.jsx(q,{onClick:e=>{e.stopPropagation(),function(e){i?s(!1):(o(`el_${e}_0`),s(!0),f(`panel_${e}`))}(t)},children:c.jsx(d,{"aria-label":"play",color:"primary",children:i?c.jsx(Wt,{}):c.jsx($t,{})})}),c.jsx(G,{id:t,primary:"Этап "+parseInt(t+1)+". "+e.name})]})}),c.jsx(P,{sx:{border:1,borderColor:"divider"},children:e.actions.map(((e,n)=>c.jsx(u,{my:2,width:"100%",sx:{alignItems:"center",display:"flex",justifyContent:"center"},children:k(e,n,t)},n)))})]},t)}return l.useEffect((()=>{r||o("el_0_0"),s(e)}),[e]),l.useEffect((()=>{var e;const n=(null==r?void 0:r.split("_")[1])||0,i=null==m?void 0:m.steps[n].name,s=6e5,o=(null==(e=x.find((e=>e.src===v)))?void 0:e.label)||"Выберите сценарий";t&&t(o,60,s,i)}),[i,t,r,m,v,x]),c.jsxs(u,{sx:{maxWidth:"700px",minWidth:"300px",margin:"auto"},children:[c.jsx(K,{disablePortal:!0,id:"combo-box-demo",options:x,sx:{width:"100%",padding:1},renderInput:e=>c.jsx(h,{...e,label:"Сценарии"}),onChange:(e,t)=>{b(0,(null==t?void 0:t.src)||null)}}),m&&c.jsxs(c.Fragment,{children:[c.jsx(p,{variant:"h4",sx:{textAlign:"center",m:1},children:m.name}),null==(n=m.steps)?void 0:n.map(((e,t)=>j(e,t)))]})]})}jl.propTypes={initInterval:g.number,initItems:g.arrayOf(g.shape({text:g.string,url:g.string}))},Sl.propTypes={element:a.PropTypes.object.isRequired,elementId:a.PropTypes.string.isRequired,isStartPlay:a.PropTypes.bool,onExpireFunc:a.PropTypes.func,currentActionId:a.PropTypes.string},Cl.propTypes={element:a.PropTypes.object,elementId:a.PropTypes.string,isStartPlay:a.PropTypes.bool,onExpireFunc:a.PropTypes.func,currentActionId:a.PropTypes.string},_l.propTypes={id:a.PropTypes.string.isRequired,survey:a.PropTypes.object.isRequired,activeElementId:a.PropTypes.string,onExpireFunc:a.PropTypes.func,autosend:a.PropTypes.bool,taskId:a.PropTypes.oneOfType([a.PropTypes.string,a.PropTypes.number])},El.propTypes={scenario:a.PropTypes.object,isRunningProp:a.PropTypes.bool,updateProgress:a.PropTypes.func};const Ll=()=>{const{listening:e}=Va.useSpeechRecognition(),{isSecretarySpeak:t}=Kd(),n=t?"avatars/speak-anime.gif":e?"avatars/noted.webp":"avatars/sleep.webp";return c.jsx(y,{sx:{maxWidth:240},children:c.jsx(j,{component:"img",height:"250",image:n,alt:"status image"})})};const Il=t(Je());var Ml,Ol={exports:{}};var Rl=(Ml||(Ml=1,Ol.exports=function(){var e="week",t="year";return function(n,i,s){var r=i.prototype;r.week=function(n){if(void 0===n&&(n=null),null!==n)return this.add(7*(n-this.week()),"day");var i=this.$locale().yearStart||1;if(11===this.month()&&this.date()>25){var r=s(this).startOf(t).add(1,t).date(i),o=s(this).endOf(e);if(r.isBefore(o))return 1}var a=s(this).startOf(t).date(i).startOf(e).subtract(1,"millisecond"),l=this.diff(a,e,!0);return l<0?s(this).startOf("week").week():Math.ceil(l)},r.weeks=function(e){return void 0===e&&(e=null),this.week(e)}}}()),Ol.exports);const Dl=t(Rl);var Pl,zl={exports:{}};var Al=(Pl||(Pl=1,zl.exports=function(){var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},t=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,n=/\d/,i=/\d\d/,s=/\d\d?/,r=/\d*[^-_:/,()\s\d]+/,o={},a=function(e){return(e=+e)+(e>68?1900:2e3)},l=function(e){return function(t){this[e]=+t}},c=[/[+-]\d\d:?(\d\d)?|Z/,function(e){(this.zone||(this.zone={})).offset=function(e){if(!e)return 0;if("Z"===e)return 0;var t=e.match(/([+-]|\d\d)/g),n=60*t[1]+(+t[2]||0);return 0===n?0:"+"===t[0]?-n:n}(e)}],u=function(e){var t=o[e];return t&&(t.indexOf?t:t.s.concat(t.f))},d=function(e,t){var n,i=o.meridiem;if(i){for(var s=1;s<=24;s+=1)if(e.indexOf(i(s,0,t))>-1){n=s>12;break}}else n=e===(t?"pm":"PM");return n},h={A:[r,function(e){this.afternoon=d(e,!1)}],a:[r,function(e){this.afternoon=d(e,!0)}],Q:[n,function(e){this.month=3*(e-1)+1}],S:[n,function(e){this.milliseconds=100*+e}],SS:[i,function(e){this.milliseconds=10*+e}],SSS:[/\d{3}/,function(e){this.milliseconds=+e}],s:[s,l("seconds")],ss:[s,l("seconds")],m:[s,l("minutes")],mm:[s,l("minutes")],H:[s,l("hours")],h:[s,l("hours")],HH:[s,l("hours")],hh:[s,l("hours")],D:[s,l("day")],DD:[i,l("day")],Do:[r,function(e){var t=o.ordinal,n=e.match(/\d+/);if(this.day=n[0],t)for(var i=1;i<=31;i+=1)t(i).replace(/\[|\]/g,"")===e&&(this.day=i)}],w:[s,l("week")],ww:[i,l("week")],M:[s,l("month")],MM:[i,l("month")],MMM:[r,function(e){var t=u("months"),n=(u("monthsShort")||t.map((function(e){return e.slice(0,3)}))).indexOf(e)+1;if(n<1)throw new Error;this.month=n%12||n}],MMMM:[r,function(e){var t=u("months").indexOf(e)+1;if(t<1)throw new Error;this.month=t%12||t}],Y:[/[+-]?\d+/,l("year")],YY:[i,function(e){this.year=a(e)}],YYYY:[/\d{4}/,l("year")],Z:c,ZZ:c};function p(n){var i,s;i=n,s=o&&o.formats;for(var r=(n=i.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(t,n,i){var r=i&&i.toUpperCase();return n||s[i]||e[i]||s[r].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(e,t,n){return t||n.slice(1)}))}))).match(t),a=r.length,l=0;l<a;l+=1){var c=r[l],u=h[c],d=u&&u[0],p=u&&u[1];r[l]=p?{regex:d,parser:p}:c.replace(/^\[|\]$/g,"")}return function(e){for(var t={},n=0,i=0;n<a;n+=1){var s=r[n];if("string"==typeof s)i+=s.length;else{var o=s.regex,l=s.parser,c=e.slice(i),u=o.exec(c)[0];l.call(t,u),e=e.replace(u,"")}}return function(e){var t=e.afternoon;if(void 0!==t){var n=e.hours;t?n<12&&(e.hours+=12):12===n&&(e.hours=0),delete e.afternoon}}(t),t}}return function(e,t,n){n.p.customParseFormat=!0,e&&e.parseTwoDigitYear&&(a=e.parseTwoDigitYear);var i=t.prototype,s=i.parse;i.parse=function(e){var t=e.date,i=e.utc,r=e.args;this.$u=i;var a=r[1];if("string"==typeof a){var l=!0===r[2],c=!0===r[3],u=l||c,d=r[2];c&&(d=r[2]),o=this.$locale(),!l&&d&&(o=n.Ls[d]),this.$d=function(e,t,n,i){try{if(["x","X"].indexOf(t)>-1)return new Date(("X"===t?1e3:1)*e);var s=p(t)(e),r=s.year,o=s.month,a=s.day,l=s.hours,c=s.minutes,u=s.seconds,d=s.milliseconds,h=s.zone,f=s.week,m=new Date,g=a||(r||o?1:m.getDate()),v=r||m.getFullYear(),y=0;r&&!o||(y=o>0?o-1:m.getMonth());var x,b=l||0,w=c||0,k=u||0,j=d||0;return h?new Date(Date.UTC(v,y,g,b,w,k,j+60*h.offset*1e3)):n?new Date(Date.UTC(v,y,g,b,w,k,j)):(x=new Date(v,y,g,b,w,k,j),f&&(x=i(x).week(f).toDate()),x)}catch(T){return new Date("")}}(t,a,i,n),this.init(),d&&!0!==d&&(this.$L=this.locale(d).$L),u&&t!=this.format(a)&&(this.$d=new Date("")),o={}}else if(a instanceof Array)for(var h=a.length,f=1;f<=h;f+=1){r[1]=a[f-1];var m=n.apply(this,r);if(m.isValid()){this.$d=m.$d,this.$L=m.$L,this.init();break}f===h&&(this.$d=new Date(""))}else s.call(this,e)}}}()),zl.exports);const Bl=t(Al);var Hl,$l={exports:{}};var Fl=(Hl||(Hl=1,$l.exports=function(){var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(t,n,i){var s=n.prototype,r=s.format;i.en.formats=e,s.format=function(t){void 0===t&&(t="YYYY-MM-DDTHH:mm:ssZ");var n,i=this.$locale().formats,s=(n=void 0===i?{}:i,t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(t,i,s){var r=s&&s.toUpperCase();return i||n[s]||e[s]||n[r].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(e,t,n){return t||n.slice(1)}))})));return r.call(this,s)}}}()),$l.exports);const Nl=t(Fl);var Yl,Wl={exports:{}};const Vl=t(Yl?Wl.exports:(Yl=1,Wl.exports=function(e,t,n){t.prototype.isBetween=function(e,t,i,s){var r=n(e),o=n(t),a="("===(s=s||"()")[0],l=")"===s[1];return(a?this.isAfter(r,i):!this.isBefore(r,i))&&(l?this.isBefore(o,i):!this.isAfter(o,i))||(a?this.isBefore(r,i):!this.isAfter(r,i))&&(l?this.isAfter(o,i):!this.isBefore(o,i))}}));var Ul,ql={exports:{}};const Gl=t(Ul?ql.exports:(Ul=1,ql.exports=function(e,t){var n=t.prototype,i=n.format;n.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return i.bind(this)(e);var s=this.$utils(),r=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return n.ordinal(t.week(),"W");case"w":case"ww":return s.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return s.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return s.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return i.bind(this)(r)}}));Il.extend(Nl),Il.extend(Dl),Il.extend(Vl),Il.extend(Gl);const Kl={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},Jl={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",dayOfMonthFull:"Do",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},Zl=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join("\n"),Xl=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join("\n");class Ql{constructor({locale:e,formats:t}={}){var n,i;this.isMUIAdapter=!0,this.isTimezoneCompatible=!0,this.lib="dayjs",this.dayjs=void 0,this.locale=void 0,this.formats=void 0,this.escapedCharacters={start:"[",end:"]"},this.formatTokenMap=Kl,this.setLocaleToValue=e=>{const t=this.getCurrentLocaleCode();return t===e.locale()?e:e.locale(t)},this.hasUTCPlugin=()=>void 0!==Il.utc,this.hasTimezonePlugin=()=>void 0!==Il.tz,this.isSame=(e,t,n)=>{const i=this.setTimezone(t,this.getTimezone(e));return e.format(n)===i.format(n)},this.cleanTimezone=e=>{switch(e){case"default":return;case"system":return Il.tz.guess();default:return e}},this.createSystemDate=e=>{if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const t=Il.tz.guess();return"UTC"!==t?Il.tz(e,t):Il(e)}return Il(e)},this.createUTCDate=e=>{if(!this.hasUTCPlugin())throw new Error(Zl);return Il.utc(e)},this.createTZDate=(e,t)=>{if(!this.hasUTCPlugin())throw new Error(Zl);if(!this.hasTimezonePlugin())throw new Error(Xl);const n=void 0!==e&&!e.endsWith("Z");return Il(e).tz(this.cleanTimezone(t),n)},this.getLocaleFormats=()=>{const e=Il.Ls;let t=e[this.locale||"en"];return void 0===t&&(t=e.en),t.formats},this.adjustOffset=e=>{if(!this.hasTimezonePlugin())return e;const t=this.getTimezone(e);if("UTC"!==t){const n=e.tz(this.cleanTimezone(t),!0);if(n.$offset===(e.$offset??0))return e;e.$offset=n.$offset}return e},this.date=(e,t="default")=>{if(null===e)return null;let n;return n="UTC"===t?this.createUTCDate(e):"system"===t||"default"===t&&!this.hasTimezonePlugin()?this.createSystemDate(e):this.createTZDate(e,t),void 0===this.locale?n:n.locale(this.locale)},this.getInvalidDate=()=>Il(new Date("Invalid date")),this.getTimezone=e=>{var t;if(this.hasTimezonePlugin()){const n=null==(t=e.$x)?void 0:t.$timezone;if(n)return n}return this.hasUTCPlugin()&&e.isUTC()?"UTC":"system"},this.setTimezone=(e,t)=>{if(this.getTimezone(e)===t)return e;if("UTC"===t){if(!this.hasUTCPlugin())throw new Error(Zl);return e.utc()}if("system"===t)return e.local();if(!this.hasTimezonePlugin()){if("default"===t)return e;throw new Error(Xl)}return Il.tz(e,this.cleanTimezone(t))},this.toJsDate=e=>e.toDate(),this.parse=(e,t)=>""===e?null:this.dayjs(e,t,this.locale,!0),this.getCurrentLocaleCode=()=>this.locale||"en",this.is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||""),this.expandFormat=e=>{const t=this.getLocaleFormats();return e.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,((e,n,i)=>{const s=i&&i.toUpperCase();return n||t[i]||t[s].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,((e,t,n)=>t||n.slice(1)))}))},this.isValid=e=>null!=e&&e.isValid(),this.format=(e,t)=>this.formatByString(e,this.formats[t]),this.formatByString=(e,t)=>this.dayjs(e).format(t),this.formatNumber=e=>e,this.isEqual=(e,t)=>null===e&&null===t||null!==e&&null!==t&&e.toDate().getTime()===t.toDate().getTime(),this.isSameYear=(e,t)=>this.isSame(e,t,"YYYY"),this.isSameMonth=(e,t)=>this.isSame(e,t,"YYYY-MM"),this.isSameDay=(e,t)=>this.isSame(e,t,"YYYY-MM-DD"),this.isSameHour=(e,t)=>e.isSame(t,"hour"),this.isAfter=(e,t)=>e>t,this.isAfterYear=(e,t)=>this.hasUTCPlugin()?!this.isSameYear(e,t)&&e.utc()>t.utc():e.isAfter(t,"year"),this.isAfterDay=(e,t)=>this.hasUTCPlugin()?!this.isSameDay(e,t)&&e.utc()>t.utc():e.isAfter(t,"day"),this.isBefore=(e,t)=>e<t,this.isBeforeYear=(e,t)=>this.hasUTCPlugin()?!this.isSameYear(e,t)&&e.utc()<t.utc():e.isBefore(t,"year"),this.isBeforeDay=(e,t)=>this.hasUTCPlugin()?!this.isSameDay(e,t)&&e.utc()<t.utc():e.isBefore(t,"day"),this.isWithinRange=(e,[t,n])=>e>=t&&e<=n,this.startOfYear=e=>this.adjustOffset(e.startOf("year")),this.startOfMonth=e=>this.adjustOffset(e.startOf("month")),this.startOfWeek=e=>this.adjustOffset(this.setLocaleToValue(e).startOf("week")),this.startOfDay=e=>this.adjustOffset(e.startOf("day")),this.endOfYear=e=>this.adjustOffset(e.endOf("year")),this.endOfMonth=e=>this.adjustOffset(e.endOf("month")),this.endOfWeek=e=>this.adjustOffset(this.setLocaleToValue(e).endOf("week")),this.endOfDay=e=>this.adjustOffset(e.endOf("day")),this.addYears=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"year"):e.add(t,"year")),this.addMonths=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"month"):e.add(t,"month")),this.addWeeks=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"week"):e.add(t,"week")),this.addDays=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"day"):e.add(t,"day")),this.addHours=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"hour"):e.add(t,"hour")),this.addMinutes=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"minute"):e.add(t,"minute")),this.addSeconds=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"second"):e.add(t,"second")),this.getYear=e=>e.year(),this.getMonth=e=>e.month(),this.getDate=e=>e.date(),this.getHours=e=>e.hour(),this.getMinutes=e=>e.minute(),this.getSeconds=e=>e.second(),this.getMilliseconds=e=>e.millisecond(),this.setYear=(e,t)=>this.adjustOffset(e.set("year",t)),this.setMonth=(e,t)=>this.adjustOffset(e.set("month",t)),this.setDate=(e,t)=>this.adjustOffset(e.set("date",t)),this.setHours=(e,t)=>this.adjustOffset(e.set("hour",t)),this.setMinutes=(e,t)=>this.adjustOffset(e.set("minute",t)),this.setSeconds=(e,t)=>this.adjustOffset(e.set("second",t)),this.setMilliseconds=(e,t)=>this.adjustOffset(e.set("millisecond",t)),this.getDaysInMonth=e=>e.daysInMonth(),this.getWeekArray=e=>{const t=this.startOfWeek(this.startOfMonth(e)),n=this.endOfWeek(this.endOfMonth(e));let i=0,s=t;const r=[];for(;s<n;){const e=Math.floor(i/7);r[e]=r[e]||[],r[e].push(s),s=this.addDays(s,1),i+=1}return r},this.getWeekNumber=e=>e.week(),this.getYearRange=([e,t])=>{const n=this.startOfYear(e),i=this.endOfYear(t),s=[];let r=n;for(;this.isBefore(r,i);)s.push(r),r=this.addYears(r,1);return s},this.dayjs=(n=Il,(i=e)?(...e)=>n(...e).locale(i):n),this.locale=e,this.formats=J({},Jl,t),Il.extend(Bl)}getDayOfWeek(e){return e.day()+1}}const ec=l.forwardRef(((e,t)=>{const n=Z(),i=Ge({initialContent:Array.isArray(e.initialBlocks)&&e.initialBlocks.length>0?e.initialBlocks:[{id:Math.random().toString(36).slice(2),type:"paragraph",content:[],children:[]}]});return i.onEditorContentChange((()=>{e.onChange&&e.onChange()})),l.useImperativeHandle(t,(()=>({getBlocks:()=>i.document,setBlocks(e){var t;i.removeBlocks(i.document),i.insertBlocks(e,(null==(t=i.document[0])?void 0:t.id)||void 0)},blocksToMarkdownLossy:async e=>await i.blocksToMarkdownLossy(e),blocksToHTMLLossy:async e=>await i.blocksToHTMLLossy(e)}))),c.jsx(Ke,{style:{padding:2},editor:i,theme:n.palette.mode})}));ec.displayName="NotionEditor",ec.propTypes={initialBlocks:g.arrayOf(g.object),onChange:g.func};var tc,nc={exports:{}};var ic=(tc||(tc=1,nc.exports=function(){var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(i,s,r){var o=s.prototype;r.utc=function(e){return new s({date:e,utc:!0,args:arguments})},o.utc=function(t){var n=r(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},o.local=function(){return r(this.toDate(),{locale:this.$L,utc:!1})};var a=o.parse;o.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),a.call(this,e)};var l=o.init;o.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else l.call(this)};var c=o.utcOffset;o.utcOffset=function(i,s){var r=this.$utils().u;if(r(i))return this.$u?0:r(this.$offset)?c.call(this):this.$offset;if("string"==typeof i&&null===(i=function(e){void 0===e&&(e="");var i=e.match(t);if(!i)return null;var s=(""+i[0]).match(n)||["-",0,0],r=s[0],o=60*+s[1]+ +s[2];return 0===o?0:"+"===r?o:-o}(i)))return this;var o=Math.abs(i)<=16?60*i:i,a=this;if(s)return a.$offset=o,a.$u=0===i,a;if(0!==i){var l=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(a=this.local().add(o+l,e)).$offset=o,a.$x.$localOffset=l}else a=this.utc();return a};var u=o.format;o.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return u.call(this,t)},o.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var d=o.toDate;o.toDate=function(e){return"s"===e&&this.$offset?r(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():d.call(this)};var h=o.diff;o.diff=function(e,t,n){if(e&&this.$u===e.$u)return h.call(this,e,t,n);var i=this.local(),s=r(e).local();return h.call(i,s,t,n)}}}()),nc.exports);const sc=t(ic);function rc({open:e,handleClose:t,taskId:n=null,tableSurvey:i=null,tablesList:s=null,onTableChange:r}){const[o,a]=l.useState(s||[]),[u,d]=l.useState(i||null);function p(){t&&t()}async function f(e,t=null){if(r)r(e);else{if(!e)return;const n=Il().utc().startOf("day"),i=n.month()+1,s=n.year();t||(t=(new Date).getTimezoneOffset());const r=await async function(e,t,n,i){const s=t<10?`0${t}`:`${t}`;try{const t=await fetch(`/get_days?table_name=${e}&month=${s}&year=${n}&timezone=${i}`);if(!t.ok)throw new Error(`Network response was not ok: ${t.statusText}`);return await t.json()||[]}catch(r){}}(e,i,s,t),o=r.survey;d(o)}}return l.useEffect((()=>{s||(async()=>{const e=await async function(){try{const e=await fetch("/get_tables");if(!e.ok)throw new Error("Network response was not ok");return(await e.json()).tables}catch(e){}}();a(e)})()}),[]),l.useEffect((()=>{s&&a(s)}),[s]),l.useEffect((()=>{i&&d(i)}),[i]),c.jsxs(X,{open:e,onClose:p,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[c.jsx(Q,{id:"scroll-dialog-title",children:"Добавить новую запись"}),c.jsxs(ee,{dividers:"paper"===scroll,style:{width:"500px",minHeight:"500px"},children:[o&&o.length>0&&c.jsx(K,{disablePortal:!0,id:"combo-box-demo",options:o||[],sx:{width:"100%",padding:1},renderInput:e=>c.jsx(h,{...e,label:"Таблица"}),onChange:(e,t)=>f((null==t?void 0:t.src)||null)}),u&&c.jsx(V,{children:c.jsx(_l,{id:"addRecordSurvey",survey:u,activeElementId:null,onExpireFunc:null,autosend:!1,taskId:n},"addRecordSurvey")})]}),c.jsx(te,{children:c.jsx(m,{onClick:p,children:"Закрыть"})})]})}async function oc(e,t){try{const n=6e4*(new Date).getTimezoneOffset(),i=await fetch(`/get_table_data?table_name=${e}&date=${t}&timezone_offset=${n}`);if(!i.ok)throw new Error("Network response was not ok");return await i.json()}catch(n){}}function ac(){const[e,t]=l.useState(),[n,i]=l.useState([]),[s,r]=l.useState(Il().utc().startOf("day")),[o,a]=l.useState([]),[u,d]=l.useState([]),[p,f]=l.useState(!1),[g,v]=l.useState(!1),[y,x]=l.useState(null),[b,w]=l.useState(-1),k=l.useRef();async function j(e,t,n,i){i||(i=(new Date).getTimezoneOffset());const s=await async function(e,t,n,i){const s=t<10?`0${t}`:`${t}`;try{const t=await fetch(`/get_days?table_name=${e}&month=${s}&year=${n}&timezone=${i}`);if(!t.ok)throw new Error(`Network response was not ok: ${t.statusText}`);return await t.json()||[]}catch(r){}}(e,t,n,i),r=s.days||[],o=s.survey,a=s.unique_dates||[];d(a),x(o);return r.map((e=>Il(e).format("YYYY-MM-DD")))}async function T(t){const n=Il(t).utc().startOf("day");if(r(n),!e)return;const i=await oc(e,n.toISOString());null==k||k.current.setBlocks(i);const s=n.format("YYYY-MM-DD"),o=u.findIndex((e=>Il(e).format("YYYY-MM-DD")===s));-1!==o&&w(o+1)}async function S(e){var n;if(t(e),!e)return;null==(n=null==k?void 0:k.current)||n.setBlocks([{}]);const i=s.month()+1,r=s.year(),o=await j(e,i,r);a(o)}l.useMemo((async()=>{const e=await async function(){try{const e=await fetch("/get_tables");if(!e.ok)throw new Error("Network response was not ok");return(await e.json()).tables}catch(e){}}();i(e)}),[]);return c.jsxs(V,{display:"flex",justifyContent:"space-between",gap:.5,height:"100%",width:"100%",children:[c.jsxs(V,{children:[c.jsx(K,{disablePortal:!0,id:"combo-box-demo",options:n||[],sx:{width:"100%",padding:1},renderInput:e=>c.jsx(h,{...e,label:"Таблица"}),onChange:(e,t)=>S((null==t?void 0:t.src)||null)}),c.jsx(Ze,{dateAdapter:Ql,children:c.jsx(Xe,{value:s,onChange:e=>T(e),onMonthChange:async function(t){const n=t.month()+1,i=t.year();if(e){const t=await j(e,n,i);a(t)}},shouldDisableDate:e=>{const t=Il(e).format("YYYY-MM-DD");return!(null==o?void 0:o.includes(t))}})}),c.jsx(m,{onClick:async function(){if(!k.current)return;(await async function(e,t){try{const n=await fetch("/update_record_from_blocks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({table_name:e,blocks:t})});if(!n.ok)throw new Error("Network response was not ok");return await n.json()}catch(n){}}(e,k.current.getBlocks())).success&&(f(!0),setTimeout((()=>f(!1)),5e3))},children:"Сохранить"}),p&&c.jsx(E,{icon:c.jsx(rn,{fontSize:"inherit"}),severity:"success",children:"Запись обновлена"})]}),c.jsxs(V,{sx:{flexGrow:1,overflow:"auto",height:"100%",width:"100%",flexDirection:"column",display:"flex",paddingBottom:2},children:[c.jsxs(V,{sx:{height:"95%",width:"100%"},children:[c.jsx(m,{onClick:()=>{v(!0)},children:"Добавить запись на сегодня"}),c.jsx(V,{sx:{flexGrow:1,overflowY:"auto",height:"90%"},children:c.jsx(ec,{ref:k})})]}),(null==u?void 0:u.length)>0?c.jsx(ne,{count:u.length,page:b,onChange:async function(t,n){w(n);const i=u[n-1],s=Il(i).local().startOf("day");if(r(s),!e)return;const o=await oc(e,i);null==k||k.current.setBlocks(o)},variant:"outlined"}):null]}),c.jsx(rc,{open:g,handleClose:()=>{v(!1),async function(){v(!1);const t=Il().utc().startOf("day");r(t),await S(e),await T(t.toDate())}()},tableSurvey:y,tablesList:n,onTableChange:S})]})}function lc(){return c.jsx(u,{sx:{position:"relative",display:"flex",flexDirection:"column",gap:1,height:"100%",width:"100%"},children:c.jsxs(Ri,{children:[c.jsx(ya,{}),c.jsx(Qa,{})]})})}Il.extend(sc),rc.propTypes={open:a.PropTypes.bool.isRequired,handleClose:a.PropTypes.func,tableSurvey:a.PropTypes.object,tablesList:a.PropTypes.array,onTableChange:a.PropTypes.func,taskId:a.PropTypes.oneOfType([a.PropTypes.string,a.PropTypes.number])},Il.extend(sc);var cc,uc={};function dc(){if(cc)return uc;cc=1;var e=s();Object.defineProperty(uc,"__esModule",{value:!0}),uc.default=void 0;var t=e(yt()),n=r();return uc.default=(0,t.default)((0,n.jsx)("path",{d:"M3 5H1v16c0 1.1.9 2 2 2h16v-2H3zm18-4H7c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2m0 16H7V3h14z"}),"FilterNone"),uc}const hc=t(dc());function pc({selectedListId:e,listsList:t,defaultLists:n,projects:i,updateList:s,isNeedContextMenu:r=!1,setSelectedListId:o=null,deleteFromChildes:a=null,setSelectedTaskId:u=null,linkListGroup:d=null,updateAll:p=null,updateEvents:f=null}){var g,v,y;const[x,b]=l.useState({}),[w,k]=l.useState(null),[j,T]=l.useState(null),[S,_]=l.useState(null),[E,L]=l.useState(""),[I,R]=l.useState(null),[D,P]=l.useState(null),[A,B]=l.useState(null),[H,$]=l.useState(null),F=l.useRef(null);function N(e,t,n){e.preventDefault(),T(null),k(e.currentTarget),R(n),_(t.id),L(t.title)}function Y(){k(null),R(null)}function W(){T(S),k(null)}function V(e){L(e.target.value)}function K(e){k(null),"function"==typeof a&&a(e,I)}async function J(e,n){if(k(null),!I||String(e).startsWith("project_")){let r=String(e).startsWith("project_")?i:t.filter((e=>1==e.inGeneralList&&!e.deleted));const o=r.findIndex((t=>t.id===e));if(-1===o||"up"===n&&0===o||"down"===n&&o===r.length-1)return;let a=r[o].order,l=r["up"===n?o-1:o+1],c=l.order;return"function"==typeof s&&(await s(e,{order:c}),await s(l.id,{order:a})),"function"==typeof p&&await p(),void("function"==typeof f&&await f())}let r=i.find((e=>e.id===I))||t.find((e=>e.id===I));if(!r)return;const o=r.childes_order.indexOf(e);-1!==o&&("up"===n&&o>0?[r.childes_order[o-1],r.childes_order[o]]=[r.childes_order[o],r.childes_order[o-1]]:"down"===n&&o<r.childes_order.length-1&&([r.childes_order[o+1],r.childes_order[o]]=[r.childes_order[o],r.childes_order[o+1]]),s(r.id,{childes_order:r.childes_order}))}async function Z(e){P(null),B(null),k(null),$(null),Y(),"move"===H?("function"==typeof d&&await d(S,e),"function"==typeof a&&await a(S,I)):"link"===H&&"function"==typeof d&&d(S,e)}function X(e,t){$(t),P(e.currentTarget)}function Q(e,t){$(t),B(e.currentTarget)}function ee(e){"Enter"===e.key&&(e.preventDefault(),s(j,{title:E}),T(null),F.current=null)}function te(){s(j,{title:E}),T(null),F.current=null}function ne(t,n,i=!0,s=!1,r=!0){let a=0;if(s&&Array.isArray(t.childes_order)&&t.childes_order.length>0){const e="number"==typeof t.unfinished_tasks_count?t.unfinished_tasks_count:0;a=(t.childes_order.length-e)/t.childes_order.length*100}const l=c.jsxs("div",{children:[c.jsxs(U,{selected:e===t.id,onClick:e=>{return n=t.id,void(j||(S!==n&&(_(null),T(null)),"function"==typeof o&&o(n),"function"==typeof u&&u(null)));var n},onContextMenu:r?e=>N(e,t,n):void 0,children:[c.jsx(q,{sx:{minWidth:35},children:c.jsx(oe,{})}),j===t.id?c.jsx(h,{size:"small",sx:{p:0,m:0,width:"100%"},value:E,onChange:V,onKeyDown:ee,onBlur:te,inputRef:F}):c.jsx(G,{primary:t.title,sx:{mr:2}}),0!==t.childes_order.length&&(0!==t.unfinished_tasks_count?c.jsx(ae,{badgeContent:t.unfinished_tasks_count,color:"primary",sx:{mr:1}}):c.jsx(rn,{fontSize:"small",style:{color:"green"}}))]},`div_${t.id}_${n}`),s&&0!==t.unfinished_tasks_count&&c.jsx(M,{variant:"determinate",value:a,sx:{m:0}},t.id)]},`div_${t.id}_${n}`);return i?c.jsx("div",{children:l},t.id):l}function ue(e,n,i=!0,s=!1,r=!0){let o=0;s&&(o=(e.tasks_count-e.unfinished_tasks_count)/e.tasks_count*100);const a=c.jsxs("div",{style:{left:"auto !important",top:"auto !important"},children:[c.jsxs(U,{onClick:()=>{return t=e.id,void b((e=>({...e,[t]:!e[t]})));var t},onContextMenu:r?t=>N(t,e,n):void 0,children:[c.jsx(q,{sx:{minWidth:35},children:"project"===e.type?c.jsx(le,{}):c.jsx(hc,{})}),j===e.id?c.jsx(h,{size:"small",sx:{p:0,m:0,width:"100%"},value:E,onClick:e=>e.stopPropagation(),onChange:V,onKeyDown:ee,onBlur:te,inputRef:F}):c.jsx(G,{primary:e.title}),100===o?c.jsx(rn,{fontSize:"small",style:{color:"green"}}):null,x[e.id]?c.jsx(ce,{}):c.jsx(z,{})]},e.id),s&&100!==o&&0!==e.tasks_count&&c.jsx(M,{variant:"determinate",value:o,sx:{m:0}}),c.jsx(C,{in:x[e.id],timeout:"auto",unmountOnExit:!0,children:c.jsx(ie,{component:"nav",sx:{ml:1.5},children:e.childes_order.map((n=>{const i=t.find((e=>e.id===n));return i?"group"===i.type?ue(i,e.id,!0,s):ne(i,e.id,!0):null}))})})]},e.id);return i?c.jsx("div",{children:a},e.id):a}return l.useEffect((()=>{null!==F.current&&F.current.focus()}),[j]),c.jsxs(c.Fragment,{children:[("function"==typeof p||"function"==typeof f)&&c.jsx(m,{onClick:async function(){"function"==typeof p&&p(),"function"==typeof f&&f()},children:"Update"}),c.jsx(ie,{sx:{width:"100%",pt:0},component:"nav",children:null==n?void 0:n.map((e=>ne(e,null,!1,!1,!1)))}),c.jsx(O,{}),c.jsx(ie,{sx:{width:"100%",pt:0},component:"nav",children:null==i?void 0:i.map((e=>ue(e,e.id,!0,!0,r)))}),c.jsx(O,{}),c.jsx(ie,{sx:{width:"100%",pt:0},component:"nav",children:null==t?void 0:t.map((e=>"group"==e.type?e.inGeneralList&&!e.deleted&&ue(e,null,!0,!1,r):e.inGeneralList&&!e.deleted&&ne(e,null,!0,!1,r)))}),c.jsxs(se,{anchorEl:w,open:Boolean(w),onClose:Y,children:[S&&"list"===(null==(g=t.find((e=>e.id===S)))?void 0:g.type)&&[c.jsx(re,{onClick:W,children:"Переименовать"},"rename"),c.jsx(re,{onClick:e=>X(e,"move"),children:"Переместить в группу"},"moveToGroup"),c.jsx(re,{onClick:e=>X(e,"link"),children:"Связать с группой"},"linkToGroup"),c.jsx(re,{onClick:e=>Q(e,"move"),children:"Переместить в проект"},"moveToProject"),c.jsx(re,{onClick:e=>Q(e,"link"),children:"Связать с проектом"},"linkToProject"),c.jsx(O,{},"divider1"),c.jsx(re,{onClick:()=>J(S,"up"),children:"Переместить выше"},"moveUp"),c.jsx(re,{onClick:()=>J(S,"down"),children:"Переместить ниже"},"moveDown"),c.jsx(re,{onClick:()=>K(S),children:"Удалить из этой группы"},"toggleInList")],S&&"group"===(null==(v=t.find((e=>e.id===S)))?void 0:v.type)&&[c.jsx(re,{onClick:W,children:"Переименовать"},"rename"),c.jsx(re,{onClick:e=>Q(e,"move"),children:"Переместить в проект"},"moveToProject"),c.jsx(re,{onClick:e=>Q(e,"link"),children:"Связать с проектом"},"linkToProject"),c.jsx(O,{},"divider2"),c.jsx(re,{onClick:()=>J(S,"up"),children:"Переместить выше"},"moveUp"),c.jsx(re,{onClick:()=>J(S,"down"),children:"Переместить ниже"},"moveDown"),c.jsx(re,{onClick:()=>K(S),children:"Удалить из этой группы"},"toggleInList")],S&&!(null==(y=t.find((e=>e.id===S)))?void 0:y.inGeneralList)&&[c.jsx(re,{onClick:function(){s(S,{inGeneralList:1}),k(null)},children:"Добавить в основной список"},"ingenetallist")],S&&i.find((e=>e.id===S))&&[c.jsx(re,{onClick:W,children:"Переименовать"},"rename"),c.jsx(re,{onClick:()=>J(S,"up"),children:"Переместить выше"},"moveUp"),c.jsx(re,{onClick:()=>J(S,"down"),children:"Переместить ниже"},"moveDown")]]}),c.jsx(se,{anchorEl:D,open:Boolean(D),onClose:function(){P(null)},children:t&&t.filter((e=>"group"===e.type)).map((e=>c.jsx(re,{onClick:()=>Z(e.id),children:e.title},e.id)))}),c.jsx(se,{anchorEl:A,open:Boolean(A),onClose:function(){B(null)},children:null==i?void 0:i.map((e=>c.jsx(re,{onClick:()=>Z(e.id),children:e.title},e.id)))})]})}pc.propTypes={selectedListId:g.oneOfType([g.string,g.number]),setSelectedListId:g.func,setSelectedTaskId:g.func,isNeedContextMenu:g.bool,updateAll:g.func,listsList:g.array,projects:g.array,defaultLists:g.array,updateList:g.func,updateEvents:g.func,linkListGroup:g.func,deleteFromChildes:g.func};var fc,mc={};function gc(){if(fc)return mc;fc=1;var e=s();Object.defineProperty(mc,"__esModule",{value:!0}),mc.default=void 0;var t=e(yt()),n=r();return mc.default=(0,t.default)((0,n.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder"),mc}const vc=t(gc());var yc,xc={};function bc(){if(yc)return xc;yc=1;var e=s();Object.defineProperty(xc,"__esModule",{value:!0}),xc.default=void 0;var t=e(yt()),n=r();return xc.default=(0,t.default)((0,n.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),xc}const wc=t(bc());function kc({containerId:e,tasks:t,selectedTaskId:n,listsList:i,selectedList:s,isNeedContextMenu:r=!1,setSelectedTaskId:o=null,updateList:a=null,linkTaskList:u=null,additionalButtonClick:h=null,changeTaskStatus:p=null,deleteFromChildes:f=null,additionalButton:m=null}){var g,v;const[y,x]=l.useState({}),[b,w]=l.useState(!0),[k,j]=l.useState(null),[T,S]=l.useState(null),[_,E]=l.useState(null),[I,M]=l.useState(null);if(l.useEffect((()=>{const n=document.getElementById(`tasksList${e}`);if(!n)return;const i=new it(n,{itemSelector:".draggable-task",eventData:e=>{const n=e.getAttribute("data-id"),i=t.find((e=>String(e.id)===n));return{title:i.title,id:i.id,start:i.start||null,end:i.end||null,allDay:!i.start}}});return()=>i.destroy()}),[t,e]),!t||!s)return null;function R(){S(null),j(null),E(null)}async function D(e,t){if(!s)return;const n=s.childes_order.indexOf(e);-1!==n&&("up"===t&&n>0?[s.childes_order[n-1],s.childes_order[n]]=[s.childes_order[n],s.childes_order[n-1]]:"down"===t&&n<s.childes_order.length-1&&([s.childes_order[n+1],s.childes_order[n]]=[s.childes_order[n],s.childes_order[n+1]]),j(null),"function"==typeof a&&a(s.id,{childes_order:s.childes_order}))}async function P(e,t=null){t||(t=_),"move"===t?("function"==typeof u&&await u(I,e),"function"==typeof f&&await f(`task_${I}`,s.id)):"link"===t&&"function"==typeof u&&await u(I,e),R()}function A(e,t){E(t),S(e.currentTarget)}function B(e){const i=`checkbox-list-label-${e.id}`,s=e.childes_order&&e.childes_order.length>0;return c.jsxs("div",{children:[c.jsx(ue,{disablePadding:!0,children:c.jsx(de,{sx:{mb:1,width:"100%"},children:c.jsxs(U,{className:"draggable-task","data-id":e.id,draggable:"true",selected:n===e.id,onClick:()=>{"function"==typeof o&&o(e.id)},onDragStart:t=>function(e,t){e.dataTransfer.setData("task",JSON.stringify(t))}(t,e),onContextMenu:r?t=>function(e,t){e.preventDefault(),j(e.currentTarget),M(t.id)}(t,e):void 0,children:[c.jsx(q,{onClick:e=>e.stopPropagation(),children:c.jsx(he,{edge:"start",checked:2===e.status_id,tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":i},onChange:t=>{t.stopPropagation(),function(e,t){const n=t?2:1;2==n&&new Audio("/sounds/isComplited.wav").play();const i={status_id:n};2==n&&(i.end_date=Il().toISOString()),"function"==typeof p&&p(e,i)}(e.id,t.target.checked)}})}),c.jsx(G,{id:i,primary:e.title}),s&&c.jsx(d,{edge:"end",onClick:t=>{var n;t.stopPropagation(),n=e.id,x((e=>({...e,[n]:!e[n]})))},children:y[e.id]?c.jsx(ce,{}):c.jsx(z,{})}),c.jsx(d,{onClick:t=>{t.stopPropagation(),function(e){"function"==typeof h&&h(e)}(e)},children:m?L.createElement(m):3===e.priority_id?c.jsx(wc,{}):c.jsx(vc,{})})]})})}),s&&c.jsx(C,{in:y[e.id],timeout:"auto",unmountOnExit:!0,children:c.jsx(ie,{disablePadding:!0,sx:{pl:3},children:e.childes_order.map((e=>{const n=t.find((t=>t.id===e));return n?B(n):null}))})})]},e.id)}const H=s.childes_order.map((e=>null==t?void 0:t.find((t=>t.id===e&&2!=t.status_id)))).filter(Boolean),$=s.childes_order.map((e=>null==t?void 0:t.find((t=>t.id===e&&2==t.status_id)))).filter(Boolean);return c.jsxs(c.Fragment,{children:[c.jsxs(ie,{sx:{width:"100%",pt:0},component:"nav",id:`tasksList${e}`,children:[H.map((e=>B(e))),$.length>0&&c.jsxs("div",{children:[c.jsxs(U,{onClick:()=>w(!b),children:[c.jsx(G,{primary:"Completed Tasks"}),b?c.jsx(ce,{}):c.jsx(z,{})]}),c.jsx(C,{in:b,timeout:"auto",unmountOnExit:!0,children:c.jsx(ie,{disablePadding:!0,children:$.map((e=>B(e)))})})]})]}),r&&c.jsxs(se,{anchorEl:k,open:Boolean(k),onClose:R,children:[(null==i?void 0:i.filter((e=>"list"==e.type)))&&[c.jsx(re,{onClick:e=>A(e,"move"),children:"Переместить в список"},"moveToList"),c.jsx(re,{onClick:e=>A(e,"link"),children:"Связать со списком"},"linkToList")],!(null==(g=null==s?void 0:s.childes_order)?void 0:g.includes(I))&&[c.jsx(re,{onClick:()=>(s.id,void P(s.id,"link")),children:"Поднять до задачи"},"upToTask")],(null==(v=null==s?void 0:s.childes_order)?void 0:v.includes(I))&&[c.jsx(O,{},"divider2"),c.jsx(re,{onClick:()=>D(I,"up"),children:"Переместить выше"},"moveUp"),c.jsx(re,{onClick:()=>D(I,"down"),children:"Переместить ниже"},"moveDown"),c.jsx(re,{onClick:()=>{return e=I,"function"==typeof f&&f(`task_${e}`,s.id),void j(null);var e},children:"Удалить из этого списка"},"toggleInList")]]}),r&&c.jsx(se,{anchorEl:T,open:Boolean(T),onClose:function(){S(null)},children:i.filter((e=>"list"===e.type)).map((e=>c.jsx(re,{onClick:()=>P(e.id),children:e.title},e.id)))})]})}kc.propTypes={containerId:g.oneOfType([g.string,g.number]),tasks:g.array,selectedTaskId:g.number,listsList:g.array,isNeedContextMenu:g.bool,selectedList:g.object,setSelectedTaskId:g.func,updateList:g.func,linkTaskList:g.func,additionalButtonClick:g.func,changeTaskStatus:g.func,deleteFromChildes:g.func,additionalButton:g.object};var jc,Tc={};function Sc(){if(jc)return Tc;jc=1;var e=s();Object.defineProperty(Tc,"__esModule",{value:!0}),Tc.default=void 0;var t=e(yt()),n=r();return Tc.default=(0,t.default)((0,n.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),Tc}const Cc=t(Sc());var _c,Ec={};function Lc(){if(_c)return Ec;_c=1;var e=s();Object.defineProperty(Ec,"__esModule",{value:!0}),Ec.default=void 0;var t=e(yt()),n=r();return Ec.default=(0,t.default)((0,n.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2m-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckBox"),Ec}const Ic=t(Lc());var Mc,Oc={};function Rc(){if(Mc)return Oc;Mc=1;var e=s();Object.defineProperty(Oc,"__esModule",{value:!0}),Oc.default=void 0;var t=e(yt()),n=r();return Oc.default=(0,t.default)((0,n.jsx)("path",{d:"M19 5v14H5V5zm0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2"}),"CheckBoxOutlineBlank"),Oc}const Dc=t(Rc());var Pc,zc={};function Ac(){if(Pc)return zc;Pc=1;var e=s();Object.defineProperty(zc,"__esModule",{value:!0}),zc.default=void 0;var t=e(yt()),n=r();return zc.default=(0,t.default)((0,n.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle"),zc}const Bc=t(Ac()),Hc=({fieldKey:e,fieldName:t,selectedColorProp:n,onColorChange:i})=>{const[s,r]=l.useState(null),[o,a]=l.useState(!1),[d,h]=l.useState(n||"#3788D8");l.useEffect((()=>{n&&h(n)}),[n]);return c.jsxs(u,{sx:{position:"relative"},children:[c.jsxs(m,{variant:"outlined",onClick:e=>{r(e.currentTarget),a((e=>!e))},sx:{display:"flex",alignItems:"center",width:"100%",justifyContent:"flex-start",border:"1px solid",borderColor:"grey.400",pl:.7},children:[c.jsx(Bc,{sx:{color:d,fontSize:24,ml:0}})," ",c.jsx(p,{variant:"body1",sx:{ml:1,textTransform:"none",color:"grey"},children:t})]}),c.jsx(pe,{id:e,open:o,anchorEl:s,onClose:()=>{r(null),a(!1)},anchorOrigin:{vertical:"bottom",horizontal:"left"},children:c.jsx(u,{sx:{p:1,bgcolor:"background.paper",borderRadius:1,boxShadow:3},children:c.jsx(fe,{container:!0,spacing:1,sx:{width:150},children:["#FF0000","#009900","#0000FF","#FF00FF","#A52A2A","#000080","#800000","#808000","#800080","#008080","#FFA500","#DFD030","#3788D8"].map((t=>c.jsx(fe,{item:!0,xs:3,children:c.jsx(m,{onClick:()=>(t=>{h(t),i(e,t),a(!1)})(t),sx:{minWidth:0,padding:0,borderRadius:"50%",backgroundColor:t,width:24,height:24}})},t)))})})})]})};function $c({tasks:e,selectedTaskId:t,taskFields:n,addSubTask:i=null,updateTask:s=null,changeTaskStatus:r=null,deleteTask:o=null}){var a;const[f,g]=l.useState({}),[v,y]=l.useState({}),[x,b]=l.useState(""),[w,k]=l.useState(!1),j=(null==e?void 0:e.find((e=>e.id==t)))||null;if(l.useEffect((()=>{if(!j)return;const e={title:j.title,...j};g(e)}),[j,e]),l.useEffect((()=>{if(j&&j.childes_order){const t=j.childes_order.reduce(((t,n)=>{const i=null==e?void 0:e.find((e=>e.id==n));return i&&(t[i.id]=i.title),t}),{});y(t)}}),[j,e]),!j)return null;function T(e,t){S(e,t),C(e,t)}function S(e,t){g((n=>({...n,[e]:t})))}function C(e,n){const i={[e]:n};j[e]!==n&&(g((t=>({...t,[e]:n}))),s(t,i))}function _(t){const n=v[t],i=null==e?void 0:e.find((e=>e.id==t));if(!i||i.title==n)return;const r={title:v[t]};s(t,r)}function E(e,t,n=null){"Enter"==e.key&&(e.preventDefault(),n?_(n):C(t,e.target.value))}function L(e,t){const n=t?2:1;if(2==n){new Audio("/sounds/isComplited.wav").play()}const i={status_id:n};2==n&&(i.end_date=Il().toISOString()),r(e,i)}return c.jsxs(u,{sx:{width:"100%",height:"96%",pb:2},children:[c.jsxs(de,{variant:"outlined",sx:{p:1,my:1},children:[c.jsxs(u,{sx:{display:"flex",alignItems:"center"},children:[c.jsx(he,{id:`task-checkbox-${j.id}`,checked:2==j.status_id,tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":j.id},sx:{mr:1,p:0},onChange:e=>L(j.id,e.target.checked)}),c.jsx(h,{id:"task-title",label:"Title",sx:{width:"100%",my:1},value:f.title||"",onChange:e=>S("title",e.target.value),onBlur:e=>C("title",e.target.value),onKeyDown:e=>E(e,"title"),onClick:()=>S("title",j.title),multiline:!0,maxRows:3,variant:"outlined"})]}),c.jsx(u,{sx:{marginY:0},children:null==(a=null==j?void 0:j.childes_order)?void 0:a.map((t=>{const n=null==e?void 0:e.find((e=>e.id==t));return n?c.jsx(fe,{container:!0,alignItems:"center",spacing:.5,sx:{marginY:.5},children:c.jsxs(fe,{item:!0,xs:!0,children:[c.jsxs(u,{component:"form",sx:{display:"flex",alignItems:"center",width:"100%"},children:[c.jsx(he,{id:`subtask-checkbox-${n.id}`,edge:"start",checked:2==n.status_id,tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":n.id},sx:{m:0,p:0},onChange:e=>L(n.id,e.target.checked)}),c.jsx(me,{id:`subtask-input-${n.id}`,sx:{ml:1,flex:1,textDecoration:2==n.status_id?"line-through":"none"},placeholder:"Подзадача",value:v[n.id]||"",onChange:e=>function(e,t){y((n=>({...n,[e]:t})))}(n.id,e.target.value),onBlur:()=>_(n.id),onKeyDown:e=>E(e,"title",n.id),inputProps:{"aria-label":"subtask"}}),c.jsx(O,{sx:{height:15,m:.5},orientation:"vertical"}),c.jsx(d,{sx:{m:0,p:0},"aria-label":"delete",onClick:()=>o(n.id),children:c.jsx(bt,{})})]}),c.jsx(O,{sx:{m:.5},orientation:"horizontal"})]})},n.id):null}))}),c.jsx(fe,{item:!0,xs:!0,children:e&&c.jsxs(u,{component:"form",sx:{display:"flex",alignItems:"center",width:"100%"},children:[c.jsx(d,{sx:{m:0,p:0},"aria-label":"add",onClick:()=>{i(x,j.id),b("")},children:c.jsx(Cc,{})}),c.jsx(me,{id:"new-subtask-input",sx:{ml:1,flex:1},placeholder:"Добавить подзадачу",inputProps:{"aria-label":"add subtask"},value:x,onChange:e=>b(e.target.value),onKeyDown:e=>{if("Enter"==e.key){if(e.preventDefault(),""==x.trim())return;i(x,j.id),b("")}}})]})})]}),2==(null==j?void 0:j.status_id)&&c.jsxs(p,{variant:"body2",sx:{mt:2,textAlign:"center"},children:["Завершено: ",j.end_date?Il(j.end_date).format("DD/MM/YYYY HH:mm"):""]}),c.jsxs(de,{variant:"outlined",sx:{p:1,display:"flex",flexDirection:"column",gap:1.5,paddingY:2},children:[c.jsx(m,{variant:"outlined",onClick:()=>{k(!0)},children:" Добавить запись в журнал проекта "}),n?Object.keys(n).map(((e,i)=>{const r=n[e],o="datetime"==r.type&&f[e]?Il(f[e]):null;return c.jsx(u,{sx:{},children:"datetime"==r.type?c.jsx(ge,{fullWidth:!0,children:c.jsx(Ze,{dateAdapter:Ql,children:c.jsx(Qe,{viewRenderers:{hours:et,minutes:et,seconds:et},ampm:!1,id:`${e}-picker`,label:r.name,value:o,format:"DD/MM/YYYY HH:mm",onChange:t=>function(e,t){const n=Il(t);n.isValid()&&S(e,n.toISOString())}(e,t),onAccept:t=>C(e,t.$d.toISOString()),slotProps:{textField:{onBlur:()=>function(e,n){if(!Il(n).isValid()&&null!==n)return;const i={[e]:n};j[e]!==n&&(g((t=>({...t,[e]:n}))),s(t,i))}(e,o)}},onKeyDown:t=>E(t,e)})})}):"select"==r.type?c.jsx(K,{id:`${e}-select`,value:r.options.find((t=>t.value===f[e]))||null,options:r.groupBy?[...r.options].sort(((e,t)=>{const n=e.type||"",i=t.type||"";return n.localeCompare(i)})):r.options,groupBy:r.groupBy?e=>e.groupLabel||"Без группы":void 0,getOptionLabel:e=>e.label||"",onChange:(t,n)=>{S(e,n?n.value:null),C(e,n?n.value:null)},renderInput:e=>c.jsx(h,{...e,label:r.name,variant:"outlined"})}):"text"==r.type?c.jsx(h,{id:`${e}-textarea`,fullWidth:!0,label:r.name,multiline:!0,rows:5,value:f[e]||"",onChange:t=>S(e,t.target.value),onBlur:t=>C(e,t.target.value),variant:"outlined"}):"toggle"==r.type?c.jsx(ge,{fullWidth:!0,children:c.jsxs(ve,{value:"check",size:"small",selected:!!f[e],onChange:()=>{S(e,!f[e]),C(e,!f[e])},sx:{border:"1px solid",borderColor:f[e]?"darkgrey":"grey.400",justifyContent:"flex-start"},children:[f[e]?c.jsx(Ic,{}):c.jsx(Dc,{}),c.jsx(p,{sx:{ml:1,textTransform:"none"},children:r.name})]})},i):"color"==r.type?c.jsx(Hc,{fieldKey:e,fieldName:r.name,selectedColorProp:f[e],onColorChange:T}):"divider"==r.type?c.jsx(O,{sx:{},orientation:"horizontal"}):"multiselect"==r.type?c.jsx(K,{multiple:!0,id:`${r.name}Multiselect`,options:r.options,getOptionLabel:e=>e.title,isOptionEqualToValue:(e,t)=>e.id===t.id,defaultValue:r.selected_options,onChange:(t,n)=>{S(e,n)},onBlur:(t,n)=>{C(e,n)},renderInput:e=>c.jsx(h,{...e,label:r.name}),renderTags:(e,t)=>e.map(((e,n)=>{const{key:i,...s}=t({index:n});return c.jsx(ye,{variant:"outlined",label:e.title,...s},i)}))}):c.jsx(h,{id:`${e}-input`,fullWidth:!0,label:r.name,type:r.type,value:f[e]||"",onChange:t=>S(e,t.target.value),onBlur:t=>C(e,t.target.value),onKeyDown:t=>E(t,e),variant:"outlined"})},i)})):null]}),c.jsx(rc,{open:w,handleClose:()=>{k(!1)},taskId:t})]})}Hc.propTypes={fieldKey:g.string,fieldName:g.string,selectedColorProp:g.string,onColorChange:g.func},$c.propTypes={tasks:g.array,selectedTaskId:g.oneOfType([g.string,g.number]),taskFields:g.object,addSubTask:g.func,updateTask:g.func,changeTaskStatus:g.func,deleteTask:g.func};var Fc,Nc={};function Yc(){if(Fc)return Nc;Fc=1;var e=s();Object.defineProperty(Nc,"__esModule",{value:!0}),Nc.default=void 0;var t=e(yt()),n=r();return Nc.default=(0,t.default)((0,n.jsx)("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-1 9h-4v4h-2v-4H9V9h4V5h2v4h4z"}),"Queue"),Nc}const Wc=t(Yc()),Vc=l.createContext(),Uc=({children:e})=>{const[t,n]=l.useState([]),[i,s]=l.useState([]),[r,o]=l.useState([]),[a,u]=l.useState(null),[d,h]=l.useState(null),[p,f]=l.useState(null),[m,g]=l.useState({}),[v,y]=l.useState([]),[x,b]=l.useState([]),{updates:w,setUpdates:k}=Kd();async function j(){const e=await L("events");s(e)}async function T(){await E();const e=await L();n(e)}async function S(e,r){if(t&&n((t=>t.map((t=>t.id===e?{...t,...r}:t)))),i){let t=i.find((t=>t.id==e)),n=[];t?n=i.map((t=>t.id==e?{...t,...r}:t)):(t={id:e,...r},n=[...i,t]),s(n)}await C(e,r)}async function C(e,t,n=""){let i=null;""===n&&(n="/tasks/edit_task");try{const s=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:e,...t})});if(!s.ok)throw new Error("Failed to update task");const r=await s.json();r.success&&(i=r)}catch(s){}return i}async function _(e,t){let n=null;try{const i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw new Error("Failed to create new task");const s=await i.json();s.success&&(n=s)}catch(i){}return n}async function E(e=null){e||(e=(new Date).getTimezoneOffset());try{const t=await fetch(`/tasks/get_lists?time_zone=${e}`);if(!t.ok)throw new Error("Network response was not ok");const n=await t.json();return o(n.lists),y(n.projects),b(n.default_lists),n}catch(t){}}async function L(e=a,t=null){if(e){t||(t=(new Date).getTimezoneOffset());try{const n=await fetch(`/tasks/get_tasks?list_id=${e}&time_zone=${t}`);if(!n.ok)throw new Error("Network response was not ok");return(await n.json()).tasks}catch(n){return null}}}return l.useEffect((()=>{!async function(){const e=await new Promise((e=>setTimeout((()=>e({start:{type:"datetime",name:"Дата начала"},deadline:{type:"datetime",name:"Дата завершения"},divider1:{type:"divider"},is_background:{type:"toggle",name:"Фоновая задача"},color:{type:"color",name:"Цвет на календаре"},divider2:{type:"divider"},priority_id:{type:"select",name:"Приоритет",options:[{value:1,label:"Low"},{value:2,label:"Medium"},{value:3,label:"High"}]},interval_id:{type:"select",name:"Повтор",options:[{value:1,label:"День"},{value:2,label:"Неделя"},{value:3,label:"Месяц"},{value:4,label:"Год"},{value:5,label:"Рабочие дни"},{value:null,label:"Без повтора"}]},is_infinite:{type:"toggle",name:"Бескончно повторять на календаре"},divider3:{type:"divider"},type_id:{type:"select",name:"Тип задачи",groupBy:"type",options:[{value:1,type:"work",label:"Продуктивная работа",groupLabel:"Работа"},{value:2,type:"work",label:"Повседневные задачи",groupLabel:"Работа"},{value:3,type:"rest",label:"Перерыв",groupLabel:"Отдых"},{value:4,type:"meals",label:"Обед",groupLabel:"Питание"},{value:5,type:"study",label:"Учеба",groupLabel:"Учёба"},{value:6,type:"rest",label:"Прогулка",groupLabel:"Отдых"},{value:7,type:"personal",label:"Личные дела",groupLabel:"Личное"},{value:8,type:"personal",label:"Домашние дела",groupLabel:"Личное"},{value:9,type:"rest",label:"Сон",groupLabel:"Отдых"},{value:10,type:"social",label:"Переписки",groupLabel:"Общение"},{value:11,type:"everyday",label:"Планирование",groupLabel:"Повседневное"},{value:12,type:"work",label:"Составление отчетов",groupLabel:"Работа"},{value:13,type:"meals",label:"Ужин",groupLabel:"Питание"},{value:14,type:"meals",label:"Перекус",groupLabel:"Питание"},{value:15,type:"study",label:"Чтение",groupLabel:"Учёба"},{value:16,type:"personal",label:"Анализ записей",groupLabel:"Личное"},{value:17,type:"study",label:"Изучение языков",groupLabel:"Учёба"},{value:18,type:"personal",label:"Покупки",groupLabel:"Личное"},{value:19,type:"everyday",label:"Умывание",groupLabel:"Повседневное"},{value:20,type:"rest",label:"Отдых",groupLabel:"Отдых"},{value:21,type:"rest",label:"Развлечения",groupLabel:"Отдых"},{value:22,type:"work",label:"Совещание",groupLabel:"Работа"},{value:null,label:"Без типа",groupLabel:"Без группы"}]},attachments:{type:"string",name:"Добавить файл"},note:{type:"text",name:"Заметка"}})),1)));g(e)}()}),[]),l.useEffect((()=>{if(w.includes("todo")){T();const e=w.filter((e=>"todo"!==e));k(e)}if(w.includes("calendar")){j();const e=w.filter((e=>"calendar"!==e));k(e)}}),[w]),l.useEffect((()=>{let e=r.find((e=>e.id===a));e||(e=x.find((e=>e.id===a))),h(e)}),[a,r]),l.useEffect((()=>{T(),j()}),[]),l.useEffect((()=>{(async()=>{try{const e=await L(a);n(e)}catch(e){}})()}),[a]),c.jsx(Vc.Provider,{value:{updateAll:T,updateEvents:j,tasks:t,fetchTasks:L,fetchListsList:E,calendarEvents:i,setCalendarEvents:s,getAntiSchedule:async function(){try{const e=await fetch("/tasks/get_anti_schedule");if(!e.ok)throw new Error("Network response was not ok");return await e.json()}catch(e){}},taskFields:m,addAntiTask:async function(e){const t={...e};let n=null;try{const e=await _(t,"/tasks/add_anti_task");e&&e.task&&(n=e.task)}catch(i){}return n},deleteAntiTask:async function(e){try{if(!(await fetch("/tasks/del_anti_task",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:e})})).ok)throw new Error("Failed to delete anti_task")}catch(t){}},addTask:async function({title:e,listId:i,start:s=null,end:r=null,type:l=null}){const c={title:e,listId:i=i||a,order:l?-1:t.length||-1,end:r,start:s};try{const e=await _(c,"/tasks/add_task");e&&t&&(n((t=>[...t,e.new_object])),o((t=>t.map((t=>t.id===a?{...t,...e.task_list}:t))))),x.some((e=>e.id===i))&&k((e=>e.includes("todo")?e:[...e,"todo"])),k((e=>[...e,"calendar"]))}catch(u){}},sendUpdatedTaskToServer:C,addSubTask:async function(e,i){_({title:e,listId:a,parentTaskId:i},"/tasks/add_subtask").then((e=>{e&&(t&&n((t=>[...t,e.new_object])),S(i,{...e.parent_task}))})).catch((e=>{}))},deleteTask:async function(e){try{const t=await fetch("/tasks/del_task",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_id:e})});if(!t.ok)throw new Error("Failed to delete task");if((await t.json()).success&&a){const e=await L();n(e)}}catch(t){}},updateTask:S,changeTaskStatus:async function(e,r){if(t&&n((t=>t.map((t=>t.id==e?{...t,...r}:t)))),i){const t=2==r.status_id?"green":"#3788D8";s((n=>n.map((n=>n.id==e?{...n,...r,color:t}:n))))}try{const i=await C(e,r,"/tasks/change_status");E(),"all"===i.task?(T(),j()):t&&(n((t=>t.map((t=>t.id===e?{...t,...i.task}:t)))),s((t=>t.map((t=>t.id===e?{...t,color:"#3788D8"}:t)))))}catch(o){}},linkListGroup:async function(e,t){try{const n=await fetch("/tasks/link_group_list",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_id:e,target_id:t})});if(!n.ok)throw new Error("Failed to update list");(await n.json()).success&&T()}catch(n){}return null},linkTaskList:async function(e,t){try{const n=await fetch("/tasks/link_task",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({task_id:e,list_id:t})});if(!n.ok)throw new Error("Failed to update list");(await n.json()).success&&T()}catch(n){}return null},deleteFromChildes:async function(e,t){try{const n=await fetch("/tasks/delete_from_childes",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_id:e,group_id:t})});if(!n.ok)throw new Error("Failed to update list");(await n.json()).success&&T()}catch(n){}return null},defaultLists:x,listsList:r,addList:async function(e){const t={title:`New_${e}`,type:e,order:"project"!==e?r.length:v.length},n=await async function(e){let t=null;try{const n=await fetch("/tasks/add_list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error("Failed to create new list");const i=await n.json();i.success&&(t=i.new_object)}catch(n){}return t}(t);"project"==n.type?y((e=>[...e,n])):o((e=>[...e,n]))},updateList:function(e,t){(async function(e,t){let n=null;try{const i=await fetch("/tasks/edit_list",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({listId:e,...t})});if(!i.ok)throw new Error("Failed to update list");const s=await i.json();s.success&&(n=s.updated_list)}catch(i){}return n})(e,t).then((n=>{"project"==n.type?y((n=>n.map((n=>n.id===e?{...n,...t}:n)))):o((n=>n.map((n=>n.id===e?{...n,...t}:n))))})).catch((e=>{}))},projects:v,selectedListId:a,setSelectedListId:u,selectedTaskId:p,setSelectedTaskId:f,selectedList:d},children:e})};Uc.propTypes={children:g.node.isRequired};const qc=()=>l.useContext(Vc);function Gc(){const{selectedTaskId:e,addTask:t,addList:n}=qc(),{listsList:i,selectedListId:s,setSelectedListId:r,updateList:o,deleteFromChildes:a,defaultLists:h,setSelectedTaskId:p,projects:f,updateAll:g,updateEvents:v,linkListGroup:y}=qc(),{tasks:x,taskFields:b,addSubTask:w,updateTask:k,changeTaskStatus:j,deleteTask:T}=qc(),{linkTaskList:S,selectedList:C}=qc(),[_,E]=l.useState("");return c.jsx(c.Fragment,{children:s?e?e&&c.jsx(u,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",width:"100%"},children:c.jsxs(u,{sx:{px:1,flexGrow:1,overflowY:"auto",height:"100%"},children:[c.jsx(m,{onClick:()=>p(null),children:"Назад"}),c.jsx($c,{tasks:x,selectedTaskId:e,taskFields:b,addSubTask:w,updateTask:k,changeTaskStatus:j,deleteTask:T})]})}):c.jsxs(u,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",width:"100%"},children:[c.jsxs(u,{sx:{px:2,flexGrow:1,overflowY:"auto",height:"100%"},children:[c.jsx(m,{onClick:()=>r(null),children:"Назад"}),c.jsx(kc,{tasks:x,selectedTaskId:e,listsList:i,selectedList:C,isNeedContextMenu:!0,setSelectedTaskId:p,updateList:o,linkTaskList:S,additionalButtonClick:function(e){const t=3===e.priority_id?1:3;"function"==typeof k&&k(e.id,{priority_id:t})},changeTaskStatus:j,deleteFromChildes:a})]}),c.jsxs(de,{component:"form",sx:{display:"flex",flexDirection:"row",flexGrow:1,alignItems:"center",mt:1,mx:1},children:[c.jsx(d,{"aria-label":"menu",onClick:()=>{t(_),E("")},children:c.jsx(Cc,{})}),c.jsx(me,{sx:{flex:1},placeholder:"Добавить задачу",inputProps:{"aria-label":"add task"},value:_,onKeyDown:e=>function(e){if("Enter"===e.key){if(e.preventDefault(),""===_.trim())return;t({title:_}),E("")}}(e),onChange:e=>E(e.target.value)})]})]}):c.jsxs(u,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",width:"100%"},children:[c.jsx(u,{sx:{flexGrow:1,overflowY:"auto",height:"100%"},children:c.jsx(pc,{selectedListId:s,listsList:i,defaultLists:h,projects:f,updateList:o,isNeedContextMenu:!0,setSelectedListId:r,deleteFromChildes:a,setSelectedTaskId:p,linkListGroup:y,updateAll:g,updateEvents:v})}),c.jsxs(u,{sx:{display:"flex",flexDirection:"row",width:"100%",mt:1},children:[c.jsx(m,{variant:"outlined",sx:{width:"100%"},onClick:()=>{n("list"),r(null)},children:"Создать список"}),c.jsx(d,{variant:"outlined",sx:{alignSelf:"center"},onClick:()=>{n("group"),r(null)},children:c.jsx(Wc,{})}),c.jsx(d,{variant:"outlined",sx:{alignSelf:"center"},onClick:()=>{n("project"),r(null)},children:c.jsx(le,{})})]})]})})}var Kc,Jc={};function Zc(){if(Kc)return Jc;Kc=1;var e=s();Object.defineProperty(Jc,"__esModule",{value:!0}),Jc.default=void 0;var t=e(yt()),n=r();return Jc.default=(0,t.default)((0,n.jsx)("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"ChevronLeft"),Jc}const Xc=t(Zc());var Qc,eu={};function tu(){if(Qc)return eu;Qc=1;var e=s();Object.defineProperty(eu,"__esModule",{value:!0}),eu.default=void 0;var t=e(yt()),n=r();return eu.default=(0,t.default)((0,n.jsx)("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"ChevronRight"),eu}const nu=t(tu());var iu,su={};function ru(){if(iu)return su;iu=1;var e=s();Object.defineProperty(su,"__esModule",{value:!0}),su.default=void 0;var t=e(yt()),n=r();return su.default=(0,t.default)((0,n.jsx)("path",{d:"M17 12h-5v5h5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1zm3 18H5V8h14z"}),"Event"),su}const ou=t(ru());var au,lu={};function cu(){if(au)return lu;au=1;var e=s();Object.defineProperty(lu,"__esModule",{value:!0}),lu.default=void 0;var t=e(yt()),n=r();return lu.default=(0,t.default)((0,n.jsx)("path",{d:"M18 13v7H4V6h5.02c.05-.71.22-1.38.48-2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-5zm-1.5 5h-11l2.75-3.53 1.96 2.36 2.75-3.54zm2.8-9.11c.44-.7.7-1.51.7-2.39C20 4.01 17.99 2 15.5 2S11 4.01 11 6.5s2.01 4.5 4.49 4.5c.88 0 1.7-.26 2.39-.7L21 13.42 22.42 12zM15.5 9C14.12 9 13 7.88 13 6.5S14.12 4 15.5 4 18 5.12 18 6.5 16.88 9 15.5 9"}),"ImageSearch"),lu}const uu=t(cu());var du,hu={};function pu(){if(du)return hu;du=1;var e=s();Object.defineProperty(hu,"__esModule",{value:!0}),hu.default=void 0;var t=e(yt()),n=r();return hu.default=(0,t.default)((0,n.jsx)("path",{d:"M4.25 5.61C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"}),"FilterAlt"),hu}const fu=t(pu());var mu,gu={};function vu(){if(mu)return gu;mu=1;var e=s();Object.defineProperty(gu,"__esModule",{value:!0}),gu.default=void 0;var t=e(yt()),n=r();return gu.default=(0,t.default)((0,n.jsx)("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"}),"AutoFixHigh"),gu}const yu=t(vu());var xu,bu={};function wu(){if(xu)return bu;xu=1;var e=s();Object.defineProperty(bu,"__esModule",{value:!0}),bu.default=void 0;var t=e(yt()),n=r();return bu.default=(0,t.default)((0,n.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile"),bu}const ku=t(wu());var ju,Tu={};function Su(){if(ju)return Tu;ju=1;var e=s();Object.defineProperty(Tu,"__esModule",{value:!0}),Tu.default=void 0;var t=e(yt()),n=r();return Tu.default=(0,t.default)((0,n.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"ReportProblem"),Tu}const Cu=t(Su());var _u,Eu={};function Lu(){if(_u)return Eu;_u=1;var e=s();Object.defineProperty(Eu,"__esModule",{value:!0}),Eu.default=void 0;var t=e(yt()),n=r();return Eu.default=(0,t.default)((0,n.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),Eu}const Iu=t(Lu());var Mu,Ou={};function Ru(){if(Mu)return Ou;Mu=1;var e=s();Object.defineProperty(Ou,"__esModule",{value:!0}),Ou.default=void 0;var t=e(yt()),n=r();return Ou.default=(0,t.default)((0,n.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Ou}const Du=t(Ru());async function Pu(e,{method:t="GET",body:n,headers:i={}}={}){const s={method:t,headers:{"Content-Type":"application/json",...i}};n&&(s.body=JSON.stringify(n));const r=await fetch(e,s);if(!r.ok){let e="";try{const t=await r.json();e=t.message||JSON.stringify(t)}catch{e=r.statusText}throw new Error(e||"Ошибка запроса")}return r.json()}async function zu(e,t){try{const n=6e4*(new Date).getTimezoneOffset();return await Pu(`/get_table_data?table_name=${e}&date=${t}&timezone_offset=${n}`)}catch(n){}}function Au({initialMarkdown:e}){const t=Ge();return l.useEffect((()=>{(async()=>{const n=await t.tryParseMarkdownToBlocks(e);t.replaceBlocks(t.document,n)})()}),[t,e]),c.jsx(Ke,{editor:t})}Au.propTypes={initialMarkdown:a.PropTypes.string};const Bu=({showFilters:e,filtersConfig:t,filters:n,dropdownValues:i,handleFilterChange:s,resetFilters:r,applyFilters:o,loadingFilteredRecords:a})=>{var l,d,f,g;return e&&t?c.jsxs(u,{sx:{marginBottom:2,padding:2,border:"1px solid #ccc",borderRadius:2},children:[c.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Фильтры"}),null==(l=t.date)?void 0:l.map((e=>c.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2,marginBottom:2},children:[c.jsx(h,{label:`${e} от`,type:"date",InputLabelProps:{shrink:!0},value:n[`${e}_from`]||"",onChange:t=>s(`${e}_from`,t.target.value),disabled:a}),c.jsx(h,{label:`${e} до`,type:"date",InputLabelProps:{shrink:!0},value:n[`${e}_to`]||"",onChange:t=>s(`${e}_to`,t.target.value),disabled:a})]},e))),null==(d=t.dropdown)?void 0:d.map((e=>{var t;return c.jsxs(ge,{sx:{minWidth:150,marginRight:2,marginBottom:2},disabled:a,children:[c.jsx(xe,{children:e}),c.jsx(be,{multiple:!0,value:n[e]||[],onChange:t=>s(e,t.target.value),renderValue:e=>e.join(", "),label:e,children:null==(t=i[e])?void 0:t.map((t=>c.jsxs(re,{value:t,children:[c.jsx(he,{checked:(n[e]||[]).includes(t)}),c.jsx(G,{primary:t})]},t)))})]},e)})),null==(f=t.text)?void 0:f.map((e=>c.jsx(h,{label:e,variant:"outlined",value:n[e]||"",onChange:t=>s(e,t.target.value),sx:{marginRight:2,marginBottom:2},disabled:a},e))),null==(g=t.range)?void 0:g.map((e=>c.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1,marginBottom:2},children:[c.jsx(h,{label:`${e} от`,type:"number",value:n[`${e}_min`]||"",onChange:t=>s(`${e}_min`,t.target.value),disabled:a}),c.jsx(h,{label:`${e} до`,type:"number",value:n[`${e}_max`]||"",onChange:t=>s(`${e}_max`,t.target.value),disabled:a})]},e))),c.jsxs(u,{sx:{display:"flex",gap:2,marginTop:2},children:[c.jsx(m,{variant:"outlined",onClick:r,disabled:a,children:"Сбросить фильтры"}),c.jsx(m,{variant:"contained",onClick:o,disabled:a,children:"Загрузить"})]})]}):null};Bu.propTypes={showFilters:g.bool,filtersConfig:g.object,filters:g.object,handleFilterChange:g.func,resetFilters:g.func,applyFilters:g.func,loadingFilteredRecords:g.bool,dropdownValues:g.object},Il.extend(sc);const Hu=v("main",{shouldForwardProp:e=>"open"!==e})((({theme:e})=>({flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:"-300px",variants:[{props:({open:e})=>e,style:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginLeft:0}}]}))),$u=v("div")((({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing(0,1),...e.mixins.toolbar,justifyContent:"flex-end"})));function Fu(){var e;const t=Z(),[n,i]=l.useState(!0),[s,r]=l.useState(),[o,a]=l.useState([]),[p,f]=l.useState(Il().utc().startOf("day")),[g,v]=l.useState([]),[y,x]=l.useState(!1),[b,w]=l.useState(null),[k,j]=l.useState([]),[T,S]=l.useState(-1),[C,E]=l.useState([]),[L,I]=l.useState("wait"),[M,R]=l.useState(!1),[D,P]=l.useState({}),[z,A]=l.useState(!1),[B,H]=l.useState({}),[$,F]=l.useState([]),N=l.useRef([]);l.useMemo((async()=>{const e=await async function(){try{return(await Pu("/get_tables")).tables}catch(e){}}();a(e)}),[]),l.useEffect((()=>{N.current=C.map(((e,t)=>(N.current[t]||(N.current[t]=l.createRef()),N.current[t])));const e=C.map(((e,t)=>({ref:N.current[t],blocks:e,saveStatus:"idle",aiResponseStatus:"idle",sendToSocialsStatus:"idle",aiResponse:null,checked:!1,hasUnsavedChanges:!1})));F(e)}),[C]);async function Y(e,t,n,i){i||(i=(new Date).getTimezoneOffset());const s=await async function(e,t,n,i){const s=t<10?`0${t}`:`${t}`;try{return await Pu(`/get_days?table_name=${e}&month=${s}&year=${n}&timezone=${i}`)||[]}catch(r){}}(e,t,n,i),r=s.days||[],o=s.survey;w(o);const a=s.unique_dates||[];j(a);return r.map((e=>Il(e).format("YYYY-MM-DD")))}async function W(e){F([]);const t=Il(e).utc().startOf("day");if(f(t),P({}),!s)return;const n=await zu(s,t.toISOString());E(n);const i=t.format("YYYY-MM-DD"),r=k.findIndex((e=>Il(e).format("YYYY-MM-DD")===i));-1!==r&&S(r+1)}async function V(e){if(r(e),E([]),P({}),H({}),!e)return;const t=p.month()+1,n=p.year(),i=await Y(e,t,n);v(i);const s=await(async e=>{try{return await Pu(`/get_tables_filters/${e}`)}catch(fp){return{}}})(e);H(s)}const U=async e=>{var t;F((t=>t.map(((t,n)=>n===e?{...t,saveStatus:"saving"}:t))));const n=$[e].ref;if(null==(t=null==n?void 0:n.current)?void 0:t.getBlocks){const t=await n.current.getBlocks(),i=[];for(const e of t)if(e.children&&e.children.length>0){let t="";for(const i of e.children){const e=[i];t+=(await n.current.blocksToMarkdownLossy(e)).trim()+"\n"}t=t.trim(),i.push({...e,markdownContent:t})}else i.push({...e,markdownContent:""});await async function(e,t){try{return await Pu("/update_record_from_blocks",{method:"POST",body:{table_name:e,blocks:t}})}catch(n){}}(s,i),F((t=>t.map(((t,n)=>n===e?{...t,hasUnsavedChanges:!1,saveStatus:"success"}:t)))),setTimeout((()=>{F((t=>t.map(((t,n)=>n===e?{...t,saveStatus:"idle"}:t))))}),3e3)}};const q=async(e,t="post")=>{var n,i,r,o;const a=null==(i=null==(n=$[e])?void 0:n.ref)?void 0:i.current;if(!a)return;const l=a.getBlocks(),c=null==(o=null==(r=null==l?void 0:l[0])?void 0:r.id)?void 0:o.split("-")[1];if("posts_journal"===s&&c)try{F((t=>{const n=[...t];return n[e]={...n[e],sendToSocialsStatus:"loading"},n}));await async function(e){const t=await Pu("/api/messengers/post_record_to_socials",{method:"POST",body:e});if(!t.result)throw new Error("Некорректный ответ от AI");return t.result}({records_ids:[c],table_name:s,type:t});F((t=>{const n=[...t];return n[e]={...n[e],sendToSocialsStatus:"success"},n})),setTimeout((()=>{F((t=>t.map(((t,n)=>n===e?{...t,sendToSocialsStatus:"idle"}:t))))}),3e3)}catch(Pt){F((t=>{const n=[...t];return n[e]={...n[e],sendToSocialsStatus:"fail"},n})),setTimeout((()=>{F((t=>t.map(((t,n)=>n===e?{...t,sendToSocialsStatus:"idle"}:t))))}),3e3)}},G=async(e,t="fix")=>{var n,i,r,o;const a=null==(i=null==(n=$[e])?void 0:n.ref)?void 0:i.current;if(!a)return;const l=a.getBlocks(),c=null==(o=null==(r=null==l?void 0:l[0])?void 0:r.id)?void 0:o.split("-")[1],u=await a.blocksToMarkdownLossy(l);if(u&&c&&s)try{F((t=>{const n=[...t];return n[e]={...n[e],aiResponseStatus:"loading"},n}));const n=await async function(e){const t=await Pu("/api/ai_record_fix",{method:"POST",body:e});if(!t.result)throw new Error("Некорректный ответ от AI");return t.result}({record:u,table_name:s,type:t});F((t=>{const i=[...t];return i[e]={...i[e],aiResponse:n||"Нет ответа",aiResponseStatus:"idle"},i}))}catch(Pt){F((t=>{const n=[...t];return n[e]={...n[e],aiResponse:"Возникла ошибка при получении ответа от ИИ. Повтрорите запрос",aiResponseStatus:"idle"},n}))}};async function J(e){var t,n,i;F((t=>{const n=[...t];return n[e]={...n[e],imageGenerateStatus:"loading"},n}));const r=null==(t=N.current[e])?void 0:t.current;if(!r)return;const o=await r.getBlocks(),a=await r.blocksToMarkdownLossy(o),l=null==(i=null==(n=null==o?void 0:o[0])?void 0:n.id)?void 0:i.split("-")[1];try{const t=await async function({table_name:e,record_id:t,text:n}){try{const i=await Pu("/api/generate-image",{method:"POST",body:{table_name:e,record_id:t,text:n}});if(!Array.isArray(i.blocks))throw new Error("Некорректный ответ от сервера");return i.blocks}catch(Pt){throw Pt}}({table_name:s,record_id:l,text:a}),n=Array.isArray(t)&&Array.isArray(t[0])?t[0]:t;E((t=>{const i=[...t];return i[e]=n,i})),r.setBlocks&&r.setBlocks(n),F((t=>{const n=[...t];return n[e]={...n[e],imageGenerateStatus:"idle"},n}))}catch(Pt){alert("Ошибка генерации изображения: "+((null==Pt?void 0:Pt.message)||Pt)),F((t=>{const n=[...t];return n[e]={...n[e],imageGenerateStatus:"idle"},n}))}}return c.jsxs(u,{sx:{display:"flex",width:"100%",height:"100%"},children:[c.jsx(we,{}),c.jsx(d,{color:"inherit","aria-label":"open drawer",onClick:()=>{i(!0)},edge:"start",sx:[{ml:2},n&&{display:"none"}],children:c.jsx(ou,{})}),c.jsxs(ke,{sx:{width:300,flexShrink:0,"& .MuiDrawer-paper":{width:330,boxSizing:"border-box",borderRadius:"10px"}},variant:"persistent",anchor:"left",open:n,children:[c.jsx($u,{children:c.jsx(d,{onClick:()=>{i(!1)},children:"ltr"===t.direction?c.jsx(Xc,{}):c.jsx(nu,{})})}),c.jsx(O,{}),c.jsxs(u,{children:[c.jsx(K,{options:(o||[]).map((({label:e,src:t})=>({label:e,src:t}))),getOptionLabel:e=>e.label||"",isOptionEqualToValue:(e,t)=>(null==e?void 0:e.src)===(null==t?void 0:t.src),onChange:(e,t)=>V((null==t?void 0:t.src)||null),renderInput:e=>c.jsx(h,{...e,label:"Журнал"})}),c.jsx(Ze,{dateAdapter:Ql,children:c.jsx(Xe,{value:p,onChange:e=>W(e),onMonthChange:async function(e){const t=e.month()+1,n=e.year();if(s){const e=await Y(s,t,n);v(e)}},shouldDisableDate:e=>{const t=Il(e).format("YYYY-MM-DD");return!(null==g?void 0:g.includes(t))}})})]})]}),c.jsxs(Hu,{open:n,sx:{flexGrow:1,p:3,width:"100%",height:"100%"},children:[c.jsx(u,{sx:{flexGrow:1,overflow:"none",height:"100%",width:"100%",flexDirection:"column",display:"flex",paddingBottom:2,marginLeft:2},children:c.jsxs(u,{sx:{height:"95%",width:"100%"},children:[c.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"left",marginBottom:2},children:[c.jsx(m,{onClick:()=>{x(!0)},children:"Добавить запись на сегодня"}),c.jsxs(u,{sx:{display:"flex",gap:1},children:[c.jsx(m,{variant:"outlined",startIcon:c.jsx(fu,{}),disabled:z||!s,onClick:()=>R((e=>!e)),children:"Фильтр"}),c.jsxs(m,{variant:"outlined",onClick:async()=>{const e=$.map((e=>{var t,n;return null==(n=null==(t=e.blocks[0])?void 0:t.id)?void 0:n.split("-")[1]})).filter(Boolean);if(e.length){I("loading");try{if(!(await async function(e){const t=await Pu("/api/ai_post_generate",{method:"POST",body:e});if(!t.result)throw new Error("Некорректный ответ от AI");return t.result}({records_ids:e,table_name:s,type:"post"})))return I("error"),void setTimeout((()=>{I("wait")}),5e3);I("success"),setTimeout((()=>{I("wait")}),5e3)}catch(Pt){I("error"),setTimeout((()=>{I("wait")}),5e3)}}},disabled:"loading"===L||"success"===L||"error"===L||$.some((e=>"loading"===e.aiResponseStatus))||!$.some((e=>e.checked)),startIcon:"loading"===L?c.jsx(_,{size:20}):"success"===L?c.jsx(rn,{}):"error"===L?c.jsx(Cu,{}):c.jsx(yu,{}),children:[" ","success"===L?"Пост успешно сгенерирован":"error"===L?"Ошибка при генерации поста":"loading"===L?"Генерация поста...":"Сгенерировать пост"]})]})]}),c.jsxs(u,{sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"none",height:"100%"},children:[M&&s&&c.jsx(u,{sx:{flexShrink:0},children:c.jsx(Bu,{filtersConfig:null==(e=o.find((e=>e.src===s)))?void 0:e.filters,filters:D,handleFilterChange:(e,t)=>{P((n=>({...n,[e]:t})))},resetFilters:()=>{P({})},applyFilters:async()=>{if(s){F([]),E([]),A(!0);try{const e=await async function(e,t){try{return await Pu("/get_records",{method:"POST",body:{table_name:e,filters:t}})}catch(fp){return[]}}(s,D);E(e)}finally{A(!1)}}},showFilters:M,setShowFilters:R,loadingFilteredRecords:z,dropdownValues:B})}),c.jsx(u,{sx:{flexGrow:1,overflowY:"none",height:"100%",marginTop:1},children:c.jsxs(u,{sx:{display:"flex",flexGrow:1,flexDirection:"column",gap:2,overflowY:"none",height:"98%",marginTop:1,paddingBottom:2,border:$.some((e=>e.hasUnsavedChanges))?"2px solid #f44336":"2px solid #ccc",borderRadius:2,padding:2,transition:"border-color 0.3s ease"},children:[(null==$?void 0:$.length)>0&&c.jsxs(u,{sx:{marginLeft:0},children:[c.jsx(he,{checked:$.every((e=>e.checked)),onChange:e=>{const t=e.target.checked;F((e=>e.map((e=>({...e,checked:t})))))}}),"Выбрать все"]}),c.jsx(No,{style:{height:"100%",flexGrow:1,border:"2px solid #ccc",borderRadius:0,padding:0,transition:"border-color 0.3s ease"},totalCount:$.length,itemContent:e=>{const t=$[e];return c.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:0,padding:0,alignItems:"stretch",marginBottom:0,background:"transparent"},children:[c.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:1,backgroundColor:"background.paper",padding:0,borderBottom:"2px solid  '#ccc'",boxShadow:"0 2px 8px -5px rgba(0,0,0,0.3)",marginBottom:"-2px",transition:"border-color 0.5s ease"},children:[c.jsx(u,{sx:{display:"flex",alignItems:"center"},children:c.jsx(he,{checked:t.checked,onChange:t=>{const n=t.target.checked;F((t=>{const i=[...t];return i[e]={...i[e],checked:n},i}))}})}),c.jsxs(u,{sx:{display:"flex",gap:1},children:[c.jsx(d,{variant:"contained",disabled:"idle"!==t.saveStatus,onClick:()=>U(e),sx:{"&:hover":{backgroundColor:t.hasUnsavedChanges?"#c8e6c9":void 0},"& .MuiSvgIcon-root":{color:t.hasUnsavedChanges?"#4caf50":void 0,animation:t.hasUnsavedChanges?"pulseIcon 1.2s infinite":void 0},"@keyframes pulseIcon":{"0%":{transform:"scale(1)",filter:"drop-shadow(0 0 0 #4caf50)"},"70%":{transform:"scale(1.15)",filter:"drop-shadow(0 0 8px #4caf50)"},"100%":{transform:"scale(1)",filter:"drop-shadow(0 0 0 #4caf50)"}}},children:"saving"===t.saveStatus?c.jsx(_,{size:24}):"success"===t.saveStatus?c.jsx(rn,{}):c.jsx(Du,{})}),c.jsx(d,{variant:"contained",onClick:()=>G(e),disabled:"loading"===t.aiResponseStatus,children:"loading"===t.aiResponseStatus?c.jsx(_,{size:24}):"success"===t.aiResponseStatus?c.jsx(rn,{}):c.jsx(yu,{})}),c.jsx(d,{variant:"contained",disabled:"loading"===t.imageGenerateStatus,onClick:()=>J(e),children:"loading"===t.imageGenerateStatus?c.jsx(_,{size:24}):c.jsx(uu,{})}),c.jsx(d,{variant:"contained",children:c.jsx(ku,{})}),c.jsx(d,{variant:"contained",onClick:()=>q(e),disabled:"loading"===t.sendToSocialsStatus,children:"loading"===t.sendToSocialsStatus?c.jsx(_,{size:24}):"success"===t.sendToSocialsStatus?c.jsx(rn,{}):"fail"===t.sendToSocialsStatus?c.jsx(Cu,{}):c.jsx(Iu,{})})]})]}),c.jsxs(u,{sx:{display:"flex",gap:2,borderBottom:"2px solid "+(t.hasUnsavedChanges?"#f44336":"#ccc"),background:"white",transition:"border-color 0.5s ease"},children:[c.jsx(u,{sx:{flex:t.aiResponse?1:"100%"},children:c.jsx(ec,{ref:t.ref,initialBlocks:t.blocks,onChange:async()=>{const n=t.ref.current;if(null==n?void 0:n.getBlocks){const t=await n.getBlocks();F((n=>{const i=[...n];return i[e]={...i[e],hasUnsavedChanges:!0,blocks:t},i}))}}})}),t.aiResponse&&c.jsxs(u,{sx:{width:"50%",height:"100%",position:"relative"},children:[c.jsx(d,{onClick:()=>{F((t=>{const n=[...t];return n[e]={...n[e],aiResponse:null},n}))},sx:{position:"absolute",top:8,right:8,zIndex:1},children:c.jsx(bt,{})}),c.jsx(Au,{readOnly:!0,initialMarkdown:t.aiResponse})]})]})]},e)}})]})}),(null==k?void 0:k.length)>0&&0===Object.keys(D).length?c.jsx(ne,{count:k.length,page:T,onChange:async function(e,t){S(t),F([]),P({});const n=k[t-1],i=Il(n).local().startOf("day");if(f(i),!s)return;const r=await zu(s,n);E(r)},variant:"outlined",size:"large",boundaryCount:2,showFirstButton:!0,showLastButton:!0,sx:{marginTop:2}}):null]})]})}),c.jsx(rc,{open:y,handleClose:()=>{x(!1),async function(){x(!1);const e=Il().utc().startOf("day");f(e),await V(s),await W(e.toDate())}()},tableSurvey:b})]})]})}var Nu,Yu={};function Wu(){if(Nu)return Yu;Nu=1;var e=s();Object.defineProperty(Yu,"__esModule",{value:!0}),Yu.default=void 0;var t=e(yt()),n=r();return Yu.default=(0,t.default)((0,n.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),Yu}const Vu=t(Wu());var Uu,qu={};function Gu(){if(Uu)return qu;Uu=1;var e=s();Object.defineProperty(qu,"__esModule",{value:!0}),qu.default=void 0;var t=e(yt()),n=r();return qu.default=(0,t.default)((0,n.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),qu}const Ku=t(Gu());var Ju,Zu={exports:{}};var Xu=(Ju||(Ju=1,Zu.exports=function(){var e={year:0,month:1,day:2,hour:3,minute:4,second:5},t={};return function(n,i,s){var r,o=function(e,n,i){void 0===i&&(i={});var s=new Date(e);return function(e,n){void 0===n&&(n={});var i=n.timeZoneName||"short",s=e+"|"+i,r=t[s];return r||(r=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:i}),t[s]=r),r}(n,i).formatToParts(s)},a=function(t,n){for(var i=o(t,n),r=[],a=0;a<i.length;a+=1){var l=i[a],c=l.type,u=l.value,d=e[c];d>=0&&(r[d]=parseInt(u,10))}var h=r[3],p=24===h?0:h,f=r[0]+"-"+r[1]+"-"+r[2]+" "+p+":"+r[4]+":"+r[5]+":000",m=+t;return(s.utc(f).valueOf()-(m-=m%1e3))/6e4},l=i.prototype;l.tz=function(e,t){void 0===e&&(e=r);var n,i=this.utcOffset(),o=this.toDate(),a=o.toLocaleString("en-US",{timeZone:e}),l=Math.round((o-new Date(a))/1e3/60),c=15*-Math.round(o.getTimezoneOffset()/15)-l;if(Number(c)){if(n=s(a,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(c,!0),t){var u=n.utcOffset();n=n.add(i-u,"minute")}}else n=this.utcOffset(0,t);return n.$x.$timezone=e,n},l.offsetName=function(e){var t=this.$x.$timezone||s.tz.guess(),n=o(this.valueOf(),t,{timeZoneName:e}).find((function(e){return"timezonename"===e.type.toLowerCase()}));return n&&n.value};var c=l.startOf;l.startOf=function(e,t){if(!this.$x||!this.$x.$timezone)return c.call(this,e,t);var n=s(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return c.call(n,e,t).tz(this.$x.$timezone,!0)},s.tz=function(e,t,n){var i=n&&t,o=n||t||r,l=a(+s(),o);if("string"!=typeof e)return s(e).tz(o);var c=function(e,t,n){var i=e-60*t*1e3,s=a(i,n);if(t===s)return[i,t];var r=a(i-=60*(s-t)*1e3,n);return s===r?[i,s]:[e-60*Math.min(s,r)*1e3,Math.max(s,r)]}(s.utc(e,i).valueOf(),l,o),u=c[0],d=c[1],h=s(u).utcOffset(d);return h.$x.$timezone=o,h},s.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},s.tz.setDefault=function(e){r=e}}}()),Zu.exports);const Qu=t(Xu);var ed,td={};function nd(){if(ed)return td;ed=1;var e=s();Object.defineProperty(td,"__esModule",{value:!0}),td.default=void 0;var t=e(yt()),n=r();return td.default=(0,t.default)((0,n.jsx)("path",{d:"M16.5 12.5H15v4l3 2 .75-1.23-2.25-1.52zM16 9 2 3v7l9 2-9 2v7l7.27-3.11C10.09 20.83 12.79 23 16 23c3.86 0 7-3.14 7-7s-3.14-7-7-7m0 12c-2.75 0-4.98-2.22-5-4.97v-.07c.02-2.74 2.25-4.97 5-4.97 2.76 0 5 2.24 5 5S18.76 21 16 21"}),"ScheduleSend"),td}const id=t(nd());function sd({open:e,onClose:t,onApply:n,settingsProp:i={}}){const{workIntervalDuration:s,breakDuration:r,additionalBreakDuration:o,isBackgroundTasks:a}=i,[d,h]=l.useState(Math.floor(s/60)),[g,v]=l.useState(Math.floor(r/60)),[y,x]=l.useState(Math.floor(o/60)),[b,w]=l.useState(a||!0);return c.jsxs(X,{open:e,onClose:t,sx:{maxWidth:"100%"},children:[c.jsx(Q,{children:"Настройки календаря"}),c.jsxs(ee,{sx:{padding:"24px"},children:[c.jsxs(u,{sx:{marginBottom:3},children:[c.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:`Длительность рабочего интервала ${d}`}),c.jsx(f,{value:d,onChange:(e,t)=>{h(t)},"aria-labelledby":"work-duration-slider",valueLabelDisplay:"auto",step:5,min:10,max:120,marks:!0})]}),c.jsxs(u,{sx:{marginBottom:3},children:[c.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:`Длительность обычного перерыва ${g}`}),c.jsx(f,{value:g,onChange:(e,t)=>{v(t)},"aria-labelledby":"break-duration-slider",valueLabelDisplay:"auto",min:3,max:15,step:1,marks:!0})]}),c.jsxs(u,{sx:{marginBottom:3},children:[c.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:`Длительность дополнительного перерыва ${y} (каждый 3-й перерыв для длительной задачи)`}),c.jsx(f,{value:y,onChange:(e,t)=>{x(t)},"aria-labelledby":"additional-duration-slider",valueLabelDisplay:"auto",min:3,max:30,step:1,marks:!0})]}),c.jsx(ge,{fullWidth:!0,children:c.jsxs(ve,{value:"check",size:"small",selected:!!b,onChange:()=>{w(!b)},children:[b?c.jsx(Ic,{}):c.jsx(Dc,{}),c.jsx(p,{sx:{ml:1,textTransform:"none"},children:"Выводить фоновые задачи в список"})]})},"toggleIsBackgroundTasks")]}),c.jsxs(te,{sx:{padding:"16px 24px"},children:[c.jsx(m,{onClick:t,sx:{marginRight:"auto",color:"grey.600"},children:"Отмена"}),c.jsx(m,{variant:"contained",onClick:()=>{n({workIntervalDuration:60*d,breakDuration:60*g,additionalBreakDuration:60*y,isBackgroundTasks:b})},sx:{backgroundColor:"primary.main"},children:"Применить"})]})]})}sd.propTypes={open:a.PropTypes.bool.isRequired,onClose:a.PropTypes.func.isRequired,onApply:a.PropTypes.func.isRequired,settingsProp:a.PropTypes.object},Il.extend(sc),Il.extend(Qu);const rd=L.memo(kc),od=({containerId:e,updateTask:t,tasks:n,selectedList:i,changeTaskStatus:s,onTaskClick:r,handleUpdateTasks:o,additionalButtonClick:a})=>{var h;const[f,g]=l.useState({stateUpdater:0,remainingTime:1500,isOnBreak:!1,currentIntervalIndex:0,currentIntervalEndDate:null,currentIntervalDuration:1500}),[v,y]=l.useState({intervals:[]}),[x,b]=l.useState({workIntervalDuration:1800,breakDuration:300,additionalBreakDuration:900,isBackgroundTasks:!0}),[w,k]=l.useState(n),[j,T]=l.useState(null),[S,C]=l.useState([]),[E,L]=l.useState(!1),I=l.useRef(null),M=f.remainingTime/f.currentIntervalDuration*100;function O(e){g((t=>({...t,...e})))}function R(e,t){null==t&&(t=Il.tz.guess());const n=Il(e).tz(t),i=Il().tz(t),s=3600*n.hour()+60*n.minute()+n.second(),r=3600*i.hour()+60*i.minute()+i.second();return Math.abs(r-s)}function D(e,t=null){null==t&&(t=Il.tz.guess());let n=null,i=null,s=Il().tz(t);return e.some((e=>(i=Il(e.end).tz(t),!!i.isAfter(s)&&(n=e,!0)))),n}l.useEffect((()=>()=>{z()}),[]),l.useEffect((()=>{z();let e=null;e=x.isBackgroundTasks?(null==n?void 0:n.filter((e=>null==i?void 0:i.childes_order.includes(e.id))))||[]:(null==n?void 0:n.filter((e=>i.childes_order.includes(e.id)&&!e.is_background)))||[];const t=A(e,S);k(e),T(t)}),[n,i,x.isBackgroundTasks,S]),l.useEffect((()=>{const e=Il().tz(),{currentIntervalEndDate:t}=f;if(Il(t).isBefore(e)){z(),B();const{intervals:e}=v,t=D(e);let n=null;if(t){const e={currentIntervalIndex:t.id,currentIntervalEndDate:t.end,currentIntervalDuration:t.duration,remainingTime:t.duration,isOnBreak:t.isOnBreak};O(e),P(e.currentIntervalEndDate)}else{const e=A(w,S);e&&(n={...e,status:"started"}),T(n)}}}),[f,v]),l.useEffect((()=>{const{taskParams:e,timerParams:t}=function(e,t){switch(!0){case!e:return{taskParams:{taskName:"Все задачи завершены",taskRange:"",intervals:[],currentTask:null},timerParams:{remainingTime:0,isOnBreak:!0,currentIntervalEndDate:null,currentIntervalIndex:0}};case!function(e,t=null){null==t&&(t=Il.tz.guess());const n=Il(e.start).tz(t),i=Il().tz(t),s=3600*n.hour()+60*n.minute()+n.second();return 3600*i.hour()+60*i.minute()+i.second()>=s}(e):{const t=`${Il(e.start).format("HH:mm")} - ${Il(e.deadline).format("HH:mm")}`,n=R(e.start),i=Il().hour(Il(e.start).hour()).minute(Il(e.start).minute()).second(Il(e.start).second()).toISOString();return{taskParams:{taskName:`Перерыв. Далее ${e.title}`,taskRange:t,intervals:[],currentTask:e},timerParams:{remainingTime:n,isOnBreak:!0,currentIntervalEndDate:i,currentIntervalIndex:0,currentIntervalDuration:n}}}default:{const n=H(e,t),i=`${Il(e.start).format("HH:mm")} - ${Il(e.deadline).format("HH:mm")}`,s=D(n),r=R(null==s?void 0:s.end);return{taskParams:{taskName:e.title,taskRange:i,intervals:n,currentTask:e},timerParams:{remainingTime:r,isOnBreak:null==s?void 0:s.isOnBreak,currentIntervalIndex:null==s?void 0:s.id,currentIntervalDuration:null==s?void 0:s.duration,currentIntervalEndDate:null==s?void 0:s.end}}}}}(j,x);var n;z(),O(t),n=e,y((e=>({...e,...n}))),j?P(t.currentIntervalEndDate):z()}),[j,x]);const P=(e,t=null)=>{null==t&&(t=Il.tz.guess()),I.current=setInterval((()=>{O({remainingTime:R(e)})}),500)};function z(){I.current&&(clearInterval(I.current),I.current=null)}const A=(e,t)=>{const n=null==e?void 0:e.filter((e=>!t.includes(e.id)));return(null==n?void 0:n.find((e=>!$(e))))||null};const B=()=>{let e=Promise.resolve();{const t=new Audio("/sounds/endTimer.mp3");t.volume=.5,e=new Promise((e=>{t.onended=e,t.play()}))}return e},H=(e,t)=>{let n=null==t?void 0:t.workIntervalDuration,i=null==t?void 0:t.breakDuration,s=null==t?void 0:t.additionalBreakDuration;const r=[];let o=(e=>{const t=Il(e.start),n=Il(e.deadline),i=3600*t.hour()+60*t.minute()+t.second();let s=3600*n.hour()+60*n.minute()+n.second()-i;return s<0&&(s+=86400),s})(e),a=Il(e.start),l=Il();l=l.hour(a.hour()).minute(a.minute()).second(a.second());let c=-1,u=0,d="work",h=i,p=0;for(;o>0;){c++;let e=l;switch(d){case"work":o>=n?(p=n,o-=n):(p=o,o=0),l=l.add(p,"second"),r.push({id:c,duration:p,type:"work",isOnBreak:!1,start:e.toISOString(),end:l.toISOString()}),d="break";continue;case"break":if(o<h){if(r&&r.length>0&&"work"==r[r.length-1].type){let e=r.length-1;r[e].duration=r[e].duration+o,r[e].end=l.add(o,"second").toISOString(),o=0}else l=l.add(o,"second"),r.push({id:c,duration:o,type:"work",isOnBreak:!1,start:e.toISOString(),end:l.toISOString()}),o=0;d="work";continue}2==u&&o>s+5&&(h=s,u=0),u++,l=l.add(h,"second"),r.push({id:c,duration:h,type:"break",isOnBreak:!0,start:e.toISOString(),end:l.toISOString()}),o-=h,h=i,d="work";continue}}if(r&&r.length>0&&"break"==r[r.length-1].type){let e=r[r.length-1].duration,t=Il(r[r.length-1].end),n=Il(r[r.length-1].start);if(r.pop(),e==i)r[r.length-1].duration+=i,r[r.length-1].end=t;else{let t=n.add(i,"second");r.push({id:c,duration:i,type:"break",isOnBreak:!0,start:n.toISOString(),end:t.toISOString()});let s=e-i,o=t.add(s,"second");r.push({id:c+1,duration:s,type:"work",isOnBreak:!1,start:t.toISOString(),end:o.toISOString()})}}return r&&r.length>0&&r[r.length-1].duration<1&&r.pop(),r},$=(e,t=null)=>{if(null==t&&(t=Il.tz.guess()),!e||!e.deadline)return!1;const n=Il().tz(t),i=Il(e.deadline).tz(t),s=n.hour(),r=n.minute();return 60*i.hour()+(i.minute()-1)<=60*s+r};return c.jsxs(u,{sx:{flexGrow:1,height:"100%",width:"98.9%",display:"flex",flexDirection:"column",alignContent:"center",overflowX:"none"},children:[c.jsxs(u,{sx:{display:"flex",flexDirection:"row",padding:1},children:[c.jsx(d,{edge:"start",color:"inherit","aria-label":"settings",onClick:()=>L(!0),children:c.jsx(Vu,{})}),c.jsxs(fe,{container:!0,justifyContent:"center",alignItems:"center",direction:"column",children:[c.jsx(p,{variant:"h6",component:"div",children:v.taskName}),(null==n?void 0:n.length)>0&&c.jsx(p,{variant:"subtitle1",component:"div",color:"text.secondary",children:v.taskRange})]}),c.jsx(d,{edge:"end",color:"inherit","aria-label":"refresh",onClick:function(){C([]),"function"==typeof o&&o()},children:c.jsx(Ku,{})})]}),c.jsxs(u,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",padding:1,width:"100%"},children:[c.jsx(u,{sx:{flex:1,display:"flex",flexDirection:"row",justifyContent:"center",padding:1},children:c.jsxs(u,{sx:{position:"relative",display:"flex",margin:0,height:"250px",width:"250px",alignItems:"center",justifyContent:"center"},children:[c.jsx(_,{variant:"determinate",value:M,color:f.isOnBreak?"success":"primary",size:"250px"}),c.jsx(u,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",margin:"auto"},children:c.jsx(p,{variant:"h3",component:"div",color:"text.secondary",children:(e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=e%60;let s="";return t>0&&(s+=`${t<10?`0${t}`:t}:`),s+=`${n<10?`0${n}`:n}:${i<10?`0${i}`:i}`,s})(f.remainingTime)})})]},"focusMode")}),c.jsxs(u,{sx:{width:"100%",overflow:"auto"},children:[c.jsx(je,{activeStep:f.currentIntervalIndex,alternativeLabel:!0,children:v.intervals.map(((e,t)=>c.jsx(Te,{children:c.jsx(Se,{children:`${Math.floor(e.duration/60)} мин`})},`step_${t}`)))}),c.jsx(m,{onClick:()=>{const e=null==v?void 0:v.currentTask;if(!e)return;const t=(null==S?void 0:S.includes(null==e?void 0:e.id))?S:[...S,e.id];C(t)},children:"Пропустить задачу"})]})]}),c.jsx(u,{sx:{px:2,flexGrow:1,overflowY:"auto",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:c.jsx(rd,{containerId:e,tasks:(null==x?void 0:x.isBackgroundTasks)?n:n.filter((e=>!e.is_background)),selectedTaskId:(null==(h=null==v?void 0:v.currentTask)?void 0:h.id)||null,selectedList:i,isNeedContextMenu:!1,setSelectedTaskId:function e(t){e&&r(t)},updateTask:t,additionalButtonClick:function(e){const{intervals:t}=v,n=null==f?void 0:f.currentIntervalIndex;if(t&&t.length>n){let i=t[n];"break"==i.type&&(i=t[n-1]),e.start=i.start,e.end=i.end}else{const t=Il(),n=t.minute(5*Math.floor(t.minute()/5)).second(0);e.start=n,e.end=n.add(60,"minute")}"function"==typeof a&&a(e)},changeTaskStatus:function(e,t){n&&k((n=>n.map((n=>n.id==e?{...n,...t}:n)))),"function"==typeof s&&s(e,t)},skippedTasks:S,additionalButton:id})}),c.jsx(sd,{open:E,onClose:function(){L(!1)},onApply:function(e){L(!1),b((t=>({...t,...e})))},settingsProp:x})]})};function ad({open:e,handleClose:t,handleDelDateClick:n,scroll:i,setSelectedTaskId:s,tasks:r,selectedTaskId:o,taskFields:a,addSubTask:u=null,updateTask:d=null,changeTaskStatus:h=null,deleteTask:p=null}){const f=l.useRef(null);if(l.useEffect((()=>{if(e){const{current:e}=f;null!==e&&e.focus()}}),[e]),!o)return null;function g(){"function"==typeof s&&s(null),t()}return c.jsxs(X,{open:e,onClose:g,scroll:i,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",sx:{maxWidth:"100%"},children:[c.jsx(Q,{id:"scroll-dialog-title",children:"Изменить задачу"}),c.jsx(ee,{dividers:"paper"===i,style:{width:"500px",maxWidth:"100%"},children:c.jsx($c,{tasks:r,selectedTaskId:o,taskFields:a,addSubTask:u,updateTask:d,changeTaskStatus:h,deleteTask:p})}),c.jsxs(te,{children:[c.jsx(m,{onClick:function(){n&&n(o),"function"==typeof s&&s(null)},children:"Удалить дату выполнения"}),c.jsx(m,{onClick:g,children:"Close"})]})]})}od.propTypes={containerId:g.oneOfType([g.string,g.number]),updateTask:g.func,tasks:g.array,selectedList:g.object,changeTaskStatus:g.func,onTaskClick:g.func,handleUpdateTasks:g.func,additionalButtonClick:g.func},ad.propTypes={open:a.PropTypes.bool.isRequired,handleClose:a.PropTypes.func,handleDelDateClick:a.PropTypes.func,scroll:a.PropTypes.string,setSelectedTaskId:a.PropTypes.func,tasks:a.PropTypes.array,selectedTaskId:a.PropTypes.oneOfType([a.PropTypes.string,a.PropTypes.number]),taskFields:a.PropTypes.object,addSubTask:a.PropTypes.func,updateTask:a.PropTypes.func,changeTaskStatus:a.PropTypes.func,deleteTask:a.PropTypes.func};var ld,cd={code:"ru",week:{dow:1,doy:4},buttonText:{prev:"Пред",next:"След",today:"Сегодня",year:"Год",month:"Месяц",week:"Неделя",day:"День",list:"Повестка дня"},weekText:"Нед",allDayText:"Весь день",moreLinkText:e=>"+ ещё "+e,noEventsText:"Нет событий для отображения"},ud={};function dd(){if(ld)return ud;ld=1;var e=s();Object.defineProperty(ud,"__esModule",{value:!0}),ud.default=void 0;var t=e(yt()),n=r();return ud.default=(0,t.default)((0,n.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),ud}const hd=t(dd());var pd,fd={};function md(){if(pd)return fd;pd=1;var e=s();Object.defineProperty(fd,"__esModule",{value:!0}),fd.default=void 0;var t=e(yt()),n=r();return fd.default=(0,t.default)((0,n.jsx)("path",{d:"m12.126 8.125 1.937-1.937 3.747 3.747-1.937 1.938zM20.71 5.63l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75L20.71 7a1 1 0 0 0 0-1.37M2 5l6.63 6.63L3 17.25V21h3.75l5.63-5.62L18 21l2-2L4 3z"}),"EditOff"),fd}const gd=t(md());function vd({open:e,handleClose:t,scroll:n,selectedDate:i,addTask:s}){const[r,o]=l.useState("");function a(){t&&t()}return c.jsxs(X,{open:e,onClose:a,scroll:n,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[c.jsx(Q,{id:"scroll-dialog-title",children:"Создать задачу"}),c.jsx(ee,{dividers:"paper"===n,style:{width:"500px",maxWidth:"100%"},children:c.jsx(V,{children:c.jsx(h,{id:"createTask-input",fullWidth:!0,label:"Введите название задачи",value:r,onChange:e=>o(e.target.value),variant:"outlined"})})}),c.jsxs(te,{children:[c.jsx(m,{onClick:function(){r&&i&&(s({title:r,listId:"tasks",start:i.start,end:i.end?i.end:null,type:"event"}),o(""),a())},children:"Создать задачу"}),c.jsx(m,{onClick:a,children:"Отмена"})]})]})}function yd({open:e,onClose:t,onApply:n,slotDuration:i,timeRange:s,timeOffset:r}){const[o,a]=l.useState(i),[d,h]=l.useState(s),[g,v]=l.useState(r);return c.jsxs(X,{open:e,onClose:t,sx:{maxWidth:"100%"},children:[c.jsx(Q,{children:"Настройки календаря"}),c.jsxs(ee,{sx:{padding:"24px"},children:[c.jsxs(u,{sx:{marginBottom:3},children:[c.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Интервал сетки (минуты)"}),c.jsx(f,{value:o,onChange:(e,t)=>{a(t)},"aria-labelledby":"slot-duration-slider",valueLabelDisplay:"auto",step:5,min:5,max:60,marks:!0})]}),c.jsxs(u,{sx:{marginBottom:3},children:[c.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Временной диапазон (часы)"}),c.jsx(f,{value:d,onChange:(e,t)=>{h(t)},"aria-labelledby":"time-range-slider",valueLabelDisplay:"auto",min:0,max:24,step:1,marks:!0})]}),c.jsxs(u,{sx:{marginBottom:3},children:[c.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Смещение времени (часы)"}),c.jsx(f,{value:g,onChange:(e,t)=>{v(t)},"aria-labelledby":"time-offset-slider",valueLabelDisplay:"auto",min:-12,max:12,step:1,marks:!0})]})]}),c.jsxs(te,{sx:{padding:"16px 24px"},children:[c.jsx(m,{onClick:t,sx:{marginRight:"auto",color:"grey.600"},children:"Отмена"}),c.jsx(m,{variant:"contained",onClick:()=>{n(o,d,g)},sx:{backgroundColor:"primary.main"},children:"Применить"})]})]})}function xd({calendarRef:e,newSettings:t,setNewSettings:n,handleEventClick:i,handleEventChange:s,eventReceive:r,addTask:o,calendarEvents:a,fetchTasks:d,listsList:h,defaultLists:p,projects:f,updateAll:g,updateEvents:v,datesSet:y=null}){const x=l.useRef(null),b=l.useRef(null),[w,k]=l.useState(null),[j,T]=l.useState(!0),[S,C]=l.useState(!1),[_,E]=l.useState(!1),[L,I]=l.useState("paper"),[M,O]=l.useState(null),[R,D]=l.useState(!1),[P,z]=l.useState((null==t?void 0:t.slotDuration)||30),[A,B]=l.useState((null==t?void 0:t.timeRange)||[8,24]),[H,$]=l.useState((null==t?void 0:t.timeOffset)||0),F=Z(),[N,Y]=l.useState((null==t?void 0:t.currentView)||"dayGridMonth"),[W,V]=l.useState([]);function U(e,t){if(0==e){return void document.querySelectorAll(".newTimeElement").forEach((e=>{e.remove()}))}document.querySelectorAll(".fc-timegrid-slot-label").forEach((n=>{const i=n.querySelector(".fc-timegrid-slot-label-cushion");if(i){let s=n.getAttribute("data-original-time");s||(s=i.textContent,n.setAttribute("data-original-time",s));const r=s.split(":");if(r.length>1){const s=parseInt(r[0],10),o=parseInt(r[1],10),a=new Date;a.setHours(s),a.setMinutes(o),0!==e&&a.setHours(a.getHours()+e);const l=String(a.getHours()).padStart(2,"0"),c=String(a.getMinutes()).padStart(2,"0"),u=document.createElement("div");u.className="MuiPaper-root newTimeElemet",u.style.backgroundColor=t.palette.background.paper,u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.width="100%",u.style.height="100%",u.style.display="flex",u.style.alignItems="center",u.style.justifyContent="center";const d=document.createElement("div");d.className="MuiTypography-root",d.textContent=`${l}:${c}`,u.appendChild(d);const h=document.createElement("div");h.style.position="relative",n.innerHTML="",h.appendChild(i),h.appendChild(u),n.appendChild(h)}}}))}l.useEffect((()=>{(async()=>{const e=await d(w);V(e)})()}),[w]),l.useEffect((()=>{var i;const s=null==(i=e.current)?void 0:i.getApi();if(s){Y(s.view.type);let e=t||{};e.currentView=s.view.type,n(e);const i=()=>{const e=s.view.type;Y(e);let i=t||{};i.currentView=s.view.type,n(i)};return s.on("datesSet",i),()=>{s.off("datesSet",i)}}}),[]),l.useEffect((()=>{var t;const n=null==(t=e.current)?void 0:t.getApi();n&&(n.removeAllEvents(),n.addEventSource(a))}),[a,e]),l.useEffect((()=>{U(H,F);const e={...t,timeOffset:H,slotDuration:P,timeRange:A,currentView:N,isToggledBGTasksEdit:S};n(e)}),[F,N,A,P,H,S]);l.useEffect((()=>{x.current&&(b.current&&b.current.destroy(),b.current=new it(x.current,{itemSelector:".draggable-task",eventData:e=>{const t=e.getAttribute("data-id"),n=W.find((e=>String(e.id)===t));return T(!0),{title:n.title,id:n.id,start:n.start,end:n.end_date,allDay:!n.start}}}))}),[W]);const q=()=>D(!1);function K(e,t){const n=new Date(e.start),i=e.end?new Date(e.end):null;0!==t&&(n.setHours(n.getHours()+t),i&&i.setHours(i.getHours()+t));const s=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;return{startTime:s(n),endTime:i?s(i):null}}const J={locale:cd,slotDuration:`00:${String(P).padStart(2,"0")}:00`,slotLabelInterval:`00:${String(P).padStart(2,"0")}:00`,slotMinTime:`${String(A[0]).padStart(2,"0")}:00:00`,slotMaxTime:`${String(A[1]).padStart(2,"0")}:00:00`,initialView:N,height:"100%",plugins:[rt,ot,at,lt,ct],headerToolbar:{left:"prev,next today",center:"title",right:(null==t?void 0:t.views)||"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},droppable:!0,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,initialEvents:a,slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:"short"},select:function(e){const t=(e,t)=>{const n=new Date(e);return n.setHours(n.getHours()+t),n.toISOString()},n=t(e.startStr,H),i=e.endStr?t(e.endStr,H):null;var s;O({start:n,end:i,allDay:e.allDay}),s="paper",E(!0),I(s)},datesSet:()=>{var t;const n=null==(t=null==e?void 0:e.current)?void 0:t.getApi();if(!n)return;const i=n.view.type,s=n.getDate();y&&"function"==typeof y&&y(i,s)},eventClick:i,eventChange:s,eventReceive:function(e){r&&"function"==typeof r&&r(e),e.event.remove()},eventDragStart:()=>T(!0)};return"dayGridMonth"==N?J.eventContent=function(e){const{startTime:t}=K(e.event,H),n=a.find((t=>t.id==e.event.id));return{html:`<div class="fc-daygrid-event-dot" style="border-color: ${2==(null==n?void 0:n.status_id)?"#008000":3==(null==n?void 0:n.priority_id)?"#A52A2A":(null==n?void 0:n.color)?n.color:"#3788D8"};"></div>\n            <div class="fc-event-time">${t}</div>\n            <div class="fc-event-title">${e.event.title}</div>`}}:"listWeek"!==N&&(J.eventContent=function(e){const t=a.find((t=>t.id==e.event.id));if(t&&t.display&&"background"==t.display&&!S)return{html:`<div class="fc-event-main-frame">\n                <div class="fc-event-title-container">\n                  <div class="fc-event-title fc-sticky">${e.event.title}</div>\n                </div>\n            `};const{startTime:n,endTime:i}=K(e.event,H);return{html:`<div class="fc-event-main-frame">\n              <div class="fc-event-time">${n}${i?" - "+i:""}</div>\n              <div class="fc-event-title-container">\n                <div class="fc-event-title fc-sticky">${e.event.title}</div>\n              </div>\n            </div>`}}),0==H&&(J.nowIndicator=!0),c.jsxs(u,{sx:{height:"100%",display:"flex",flexDirection:"column",width:"100%"},children:[c.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",paddingTop:1,paddingX:1},children:[c.jsxs(u,{children:[c.jsx(m,{onClick:()=>D(!0),children:"Настройки"}),c.jsxs(ve,{onClick:()=>{C(!S);let e=t||{};e.isToggledBGTasksEdit=!S,n(e)},selected:S,value:"backgroundsEdit",children:[S?c.jsx(gd,{}):c.jsx(hd,{})," Фоновые задачи"]})]}),c.jsx(m,{onClick:()=>{k(null),T(!j)},children:j?"Показать задачи":"Скрыть задачи"})]}),c.jsxs(fe,{container:!0,sx:{flexGrow:1,overflowY:"auto",height:"100%",position:"relative"},children:[c.jsx(fe,{item:!0,width:"100%",children:c.jsxs(de,{sx:{p:3,flexGrow:1,overflowY:"auto",height:"100%"},children:[c.jsx(st,{ref:e,...J}),c.jsx(vd,{open:_,handleClose:()=>E(!1),scroll:L,selectedDate:M,addTask:o}),c.jsx(yd,{open:R,onClose:function(){q()},onApply:function(e,t,n){z(e),B(t),$(n),q(),U(n,F)},slotDuration:P,timeRange:A,timeOffset:H})]})}),!j&&c.jsxs(fe,{item:!0,sx:{position:"absolute",top:0,bottom:0,right:j?"-100%":"0",width:"500px",maxWidth:"100%",transition:"right 0.3s ease",zIndex:10,backgroundColor:F.palette.background.paper},children:[c.jsx(de,{sx:{p:3,display:w?"none":"block",flexGrow:1,overflowY:"auto",height:"100%"},children:c.jsx(pc,{selectedListId:w,listsList:h,defaultLists:p,projects:f,isNeedContextMenu:!1,setSelectedListId:k,updateAll:g,updateEvents:v},w)}),w&&c.jsxs(de,{sx:{p:3,flexGrow:1,overflowY:"auto",height:"100%"},children:[c.jsx(m,{onClick:()=>k(null),children:"Back"}),c.jsx(ie,{ref:x,children:W&&W.length>0?c.jsxs(c.Fragment,{children:[W.filter((e=>2!==e.status_id)).map((e=>c.jsx(ue,{className:"draggable-task","data-id":e.id,sx:{cursor:"pointer"},children:c.jsx(G,{primary:e.title})},e.id))),W.filter((e=>2===e.status_id)).length>0&&c.jsxs(c.Fragment,{children:[c.jsx(ue,{children:c.jsx(G,{primary:"Выполненные задачи:",sx:{fontWeight:"bold",marginTop:2}})}),W.filter((e=>2===e.status_id)).map((e=>c.jsx(ue,{className:"draggable-task","data-id":e.id,sx:{cursor:"pointer",textDecoration:"line-through",color:"gray"},children:c.jsx(G,{primary:e.title})},e.id)))]})]}):c.jsx(ue,{children:c.jsx(G,{primary:"No tasks available"})})})]})]})]})]})}function bd({containerId:e=null,calendarSettingsProp:t={slotDuration:30,timeRange:[8,24],timeOffset:0,currentView:"dayGridMonth"},handleDatesSet:n=null}){const{updateTask:i,addTask:s,calendarEvents:r,fetchTasks:o}=qc(),{defaultLists:a,projects:u,updateAll:d,updateEvents:h}=qc(),{taskFields:p,addSubTask:f,changeTaskStatus:m,deleteTask:g,listsList:v}=qc(),{setUpdates:y,handleUpdateCalendarSettings:x}=Kd(),b=l.useRef(null),[w,k]=l.useState(!1),[j,T]=l.useState("paper"),[S,C]=l.useState(null),[_,E]=l.useState(t),L=l.useMemo((()=>(e,t)=>null==e?void 0:e.map((e=>{const n={...e},i=e=>{const n=new Date(e);return n.setHours(n.getHours()-t),n};e.start&&(n.start=i(e.start).toISOString()),e.deadline&&(n.end=i(e.deadline).toISOString()),e.rrule&&(n.rrule.dtstart=n.start);const s=2==(null==e?void 0:e.status_id)?"#008000":3==(null==e?void 0:e.priority_id)?"#A52A2A":(null==e?void 0:e.color)?e.color:"#3788D8";return n.color=s,n}))),[]),I=l.useMemo((()=>{let e=L(r,null==_?void 0:_.timeOffset);return _&&_.isToggledBGTasksEdit&&(e=null==e?void 0:e.filter((e=>"background"==e.display)),e.forEach((e=>{e.display="block"}))),e}),[r,null==_?void 0:_.timeOffset,null==_?void 0:_.isToggledBGTasksEdit,L]);async function M(e){const t=(e,t)=>{const n=new Date(e);return n.setHours(n.getHours()+t),n.toISOString()},n={title:e.event.title,allDay:e.event.allDay};if(e.event.start&&(n.start=t(e.event.start,null==_?void 0:_.timeOffset)),e.event.end)n.deadline=t(e.event.end,null==_?void 0:_.timeOffset);else{const i=new Date(e.event.start);i.setHours(i.getHours()+1),n.deadline=t(i,null==_?void 0:_.timeOffset)}const s=r.find((t=>t.id==e.event.id));s&&s.rrule&&(n.rrule={...s.rrule,dtstart:t(e.event.start,null==_?void 0:_.timeOffset)}),await i(e.event.id,n),y&&"function"==typeof y&&y((e=>[...e,"todo"]))}return l.useEffect((()=>{"function"==typeof x&&x(_)}),[_,x,e]),c.jsxs(c.Fragment,{children:[c.jsx(xd,{calendarRef:b,newSettings:_,setNewSettings:E,handleEventClick:async function(e){var t,n;C((null==(t=null==e?void 0:e.event)?void 0:t.id)||null);try{n="paper",k(!0),T(n)}catch(i){}},handleEventChange:M,eventReceive:M,addTask:s,calendarEvents:I,fetchTasks:o,listsList:v,defaultLists:a,projects:u,updateAll:d,updateEvents:h,datesSet:n}),c.jsx(ad,{open:w,handleClose:()=>{k(!1),y((e=>[...e,"todo","calendar"]))},handleDelDateClick:async function(e){await i(e,{start:null,deadline:null}),y((e=>[...e,"todo","calendar"]))},scroll:j,setSelectedTaskId:C,tasks:r,selectedTaskId:S,taskFields:p,addSubTask:f,updateTask:i,changeTaskStatus:m,deleteTask:g})]})}vd.propTypes={open:a.PropTypes.bool.isRequired,handleClose:a.PropTypes.func,scroll:a.PropTypes.string.isRequired,selectedDate:a.PropTypes.object,addTask:a.PropTypes.func.isRequired},yd.propTypes={open:a.PropTypes.bool.isRequired,onClose:a.PropTypes.func.isRequired,onApply:a.PropTypes.func.isRequired,slotDuration:a.PropTypes.number,timeRange:a.PropTypes.array,timeOffset:a.PropTypes.number},xd.propTypes={calendarRef:g.object,newSettings:g.object,setNewSettings:g.func,handleEventClick:g.func,handleEventChange:g.func,eventReceive:g.func,addTask:g.func,calendarEvents:g.array,fetchTasks:g.func,listsList:g.array,defaultLists:g.array,projects:g.array,updateAll:g.func,updateEvents:g.func,datesSet:g.func},bd.propTypes={containerId:a.PropTypes.string,calendarSettingsProp:a.PropTypes.object,handleDatesSet:a.PropTypes.func};var wd,kd={};function jd(){if(wd)return kd;wd=1;var e=s();Object.defineProperty(kd,"__esModule",{value:!0}),kd.default=void 0;var t=e(yt()),n=r();return kd.default=(0,t.default)((0,n.jsx)("path",{d:"M17 1.01 7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99M17 19H7V5h10z"}),"Smartphone"),kd}const Td=t(jd());var Sd,Cd={};function _d(){if(Sd)return Cd;Sd=1;var e=s();Object.defineProperty(Cd,"__esModule",{value:!0}),Cd.default=void 0;var t=e(yt()),n=r();return Cd.default=(0,t.default)((0,n.jsx)("path",{d:"m10 17 5-5-5-5z"}),"ArrowRight"),Cd}const Ed=t(_d());var Ld,Id={};function Md(){if(Ld)return Id;Ld=1;var e=s();Object.defineProperty(Id,"__esModule",{value:!0}),Id.default=void 0;var t=e(yt()),n=r();return Id.default=(0,t.default)((0,n.jsx)("path",{d:"m7 10 5 5 5-5z"}),"ArrowDropDown"),Id}const Od=t(Md()),Rd=Ce(),Dd=({tasks:e})=>{const[t,n]=l.useState(e||null);l.useEffect((()=>{n(e)}),[e]);const i=l.useMemo((()=>{if(!t)return null;const e=t.reduce(((e,t)=>{var n,i;const s=(null==(n=t.type)?void 0:n.group_label)||"Не указано",r=(null==(i=t.type)?void 0:i.type_name)||"Другое";e[s]||(e[s]={totalTime:0,tasks:{}}),e[s].tasks[r]||(e[s].tasks[r]=0);const o=((e,t)=>{const n=new Date(e);return(new Date(t)-n)/6e4})(t.start,t.end);return e[s].totalTime+=o,e[s].tasks[r]+=o,e}),{}),n={};return Object.keys(e).sort(((e,t)=>"Не указано"===e?1:"Не указано"===t?-1:e.localeCompare(t,"ru"))).forEach((t=>{n[t]=e[t]})),n}),[t]);return t?c.jsx(_e,{theme:Rd,children:c.jsx(tt,{"aria-label":"Task Statistics",defaultExpandedItems:["root"],slots:{expandIcon:Ed,collapseIcon:Od},sx:{flexGrow:1,maxWidth:400},children:c.jsx(nt,{itemId:"root",label:"Подсчет времени",children:Object.entries(i).map((([e,t],n)=>c.jsx(nt,{itemId:`period-${n}`,label:c.jsxs(V,{sx:{flex:1,display:"flex",flexDirection:"row",justifyContent:"space-between",padding:1},children:[c.jsx(p,{children:e}),c.jsxs(p,{sx:{marginLeft:"auto",fontWeight:"bold"},children:[Math.round(t.totalTime)," мин."]})]}),children:Object.entries(t.tasks).map((([e,t],i)=>c.jsx(nt,{itemId:`task-${n}-${i}`,label:c.jsxs(V,{sx:{flex:1,display:"flex",flexDirection:"row",justifyContent:"space-between",padding:1},children:[c.jsx(p,{children:e}),c.jsxs(p,{sx:{marginLeft:"auto"},children:[Math.round(t)," мин."]})]})},i)))},n)))})})}):null};function Pd({containerId:e}){const{updateTask:t,getAntiSchedule:n,fetchTasks:i}=qc(),{listsList:s,defaultLists:r,projects:o,updateAll:a,updateEvents:u}=qc(),{taskFields:h,changeTaskStatus:p,deleteTask:f}=qc(),{sendUpdatedTaskToServer:g,deleteAntiTask:v,addAntiTask:y}=qc(),[x,b]=l.useState("focus"),w=l.useRef(null),[k,j]=l.useState([]),[T,S]=l.useState(null),[C,_]=l.useState([]),[E,L]=l.useState(null),[I,M]=l.useState(!1),[O,R]=l.useState("paper"),[D,P]=l.useState(null),[z,A]=l.useState(null),[B,H]=l.useState({}),[$,F]=l.useState(null),[N,Y]=l.useState(!1),[W,U]=l.useState(null),[q,G]=l.useState(Il()),K=Ee("(max-width: 1100px)"),[J,Z]=l.useState(K);l.useEffect((()=>{de(J?"focus":"calendar")}),[]),l.useEffect((()=>{Z(K)}),[K]);const X=l.useRef({start:{type:"datetime",name:"Дата начала"},end:{type:"datetime",name:"Дата завершения"},divider1:{type:"divider"},color:{type:"color",name:"Цвет на календаре"},is_background:{type:"toggle",name:"Фоновая задача"},type_id:{type:"select",name:"Тип задачи",groupBy:"type",options:[{value:1,type:"work",label:"Продуктивная работа",groupLabel:"Работа"},{value:2,type:"work",label:"Повседневные задачи",groupLabel:"Работа"},{value:3,type:"rest",label:"Перерыв",groupLabel:"Отдых"},{value:4,type:"meals",label:"Обед",groupLabel:"Питание"},{value:5,type:"study",label:"Учеба",groupLabel:"Учёба"},{value:6,type:"rest",label:"Прогулка",groupLabel:"Отдых"},{value:7,type:"personal",label:"Личные дела",groupLabel:"Личное"},{value:8,type:"personal",label:"Домашние дела",groupLabel:"Личное"},{value:9,type:"rest",label:"Сон",groupLabel:"Отдых"},{value:10,type:"social",label:"Переписки",groupLabel:"Общение"},{value:11,type:"everyday",label:"Планирование",groupLabel:"Повседневное"},{value:12,type:"work",label:"Составление отчетов",groupLabel:"Работа"},{value:13,type:"meals",label:"Ужин",groupLabel:"Питание"},{value:14,type:"meals",label:"Перекус",groupLabel:"Питание"},{value:15,type:"study",label:"Чтение",groupLabel:"Учёба"},{value:16,type:"personal",label:"Анализ записей",groupLabel:"Личное"},{value:17,type:"study",label:"Изучение языков",groupLabel:"Учёба"},{value:18,type:"personal",label:"Покупки",groupLabel:"Личное"},{value:19,type:"everyday",label:"Умывание",groupLabel:"Повседневное"},{value:20,type:"rest",label:"Отдых",groupLabel:"Отдых"},{value:21,type:"rest",label:"Развлечения",groupLabel:"Отдых"},{value:22,type:"work",label:"Совещание",groupLabel:"Работа"},{value:null,label:"Без типа",groupLabel:"Без группы"}]},divider3:{type:"divider"},files:{type:"string",name:"Добавить файл"},note:{type:"text",name:"Заметка"}}),[Q,ee]=l.useState({slotDuration:30,timeRange:[8,24],timeOffset:0,currentView:"timeGridDay",views:"timeGridWeek,timeGridDay"}),{handleContainerResize:te}=Kd();l.useEffect((()=>{(async()=>{const e=await i("my_day");j(e)})();const e=null==r?void 0:r.find((e=>"my_day"===e.id));S(e),(async()=>{const e=await n();L((null==e?void 0:e.anti_schedule)||[])})()}),[]);const ne=e=>{M(!0),R(e)};async function ie(e){var t;H(X.current),_(E),P((null==(t=null==e?void 0:e.event)?void 0:t.id)||null),F("event");try{ne("paper")}catch(n){}}function se(e,t){const n=2==t.status_id?"green":"#3788D8",i=k.map((i=>i.id==e?{...i,...t,color:n}:i));j(i),_(i),p&&"function"==typeof p&&p(e,t)}function re(e,t){if(!e)return null;return null==e?void 0:e.map((e=>{const n={...e},i=e=>{const n=new Date(e);return n.setHours(n.getHours()-t),n};e.start&&(n.start=i(e.start).toISOString()),e.end&&(n.end=i(e.end).toISOString());const s=2==(null==e?void 0:e.status_id)?"#008000":3==(null==e?void 0:e.priority_id)?"#A52A2A":(null==e?void 0:e.color)?e.color:"#3788D8";n.color=s;const r=e.is_background?"background":"block";return n.display=r,n}))}async function oe(e){e.is_background=0;let t={};y&&"function"==typeof y&&(t=await y(e)),t&&L((e=>[...e,t]))}function ae(e){let t=e.event.start.toISOString(),n=e.event.end;e.event.end||(n=Il(e.event.start).add(60,"minute").toISOString()),Q&&Q.timeOffset&&(t=le(e.event.start,Q.timeOffset),n=le(e.event.end,Q.timeOffset));oe({title:e.event.title,start:t,end:n})}const le=(e,t)=>{const n=new Date(e);return n.setHours(n.getHours()+t),n.toISOString()};async function ce(e){const t={title:e.event.title};if(e.event.start&&(t.start=le(e.event.start,null==Q?void 0:Q.timeOffset)),e.event.end)t.end=le(e.event.end,null==Q?void 0:Q.timeOffset);else{const n=new Date(e.event.start);n.setHours(n.getHours()+1),t.end=le(n,null==Q?void 0:Q.timeOffset)}L((n=>n.map((n=>n.id==e.event.id?{...n,...t}:n)))),await g(e.event.id,{...t},"/tasks/edit_anti_task")}function ue(e,t){G(t);let n=null;"timeGridDay"!==e&&"dayGridDay"!==e||(n=null==z?void 0:z.filter((e=>Il(e.start).isSame(t,"day")))),U(n)}function de(t=null){t||(t=x),"focus"==x?(b("calendar"),J||te(e,{width:1230})):(b("focus"),te(e,{width:540}))}return l.useEffect((()=>{let e=re(E,null==Q?void 0:Q.timeOffset);if(Q&&Q.isToggledBGTasksEdit&&(e=null==e?void 0:e.filter((e=>"background"==e.display)),e.forEach((e=>{e.display="block"}))),A(e),e){const t=e.filter((e=>Il(e.start).isSame(q,"day")));U(t)}}),[Q,E,k,q]),l.useEffect((()=>{if(z){const e=z.filter((e=>Il(e.start).isSame(q,"day")));U(e)}}),[z,q]),c.jsxs(V,{sx:{flexGrow:1,padding:2,height:"100%",width:"100%",display:"flex",flexDirection:"row"},children:[c.jsxs(V,{sx:{minWidth:"500px",display:"flex",flexDirection:"column"},children:[c.jsxs(V,{sx:{minWidth:"500px",display:"flex",flexDirection:"row"},children:[c.jsx(ve,{value:"focus",selected:"focus"===x,onChange:()=>de(),children:"Фокус"}),c.jsx(d,{onClick:()=>Z(!J),color:"inherit",children:c.jsx(Td,{})}),c.jsx(m,{onClick:()=>{Y(!0)},children:"Добавить запись в журнал"})]}),c.jsx(V,{sx:{height:"95%",width:"100%"},children:"focus"!==x&&J?c.jsx(xd,{calendarRef:w,newSettings:Q,setNewSettings:ee,handleEventClick:ie,handleEventChange:ce,eventReceive:ae,handleUpdateTasks:a,addTask:oe,calendarEvents:z,fetchTasks:i,listsList:s,defaultLists:r,projects:o,updateAll:a,updateEvents:u,datesSet:ue}):c.jsx(od,{containerId:e,updateTask:t,tasks:k,selectedList:T,changeTaskStatus:se,handleUpdateTasks:async function(){const e=await i("my_day"),t=await n(),s=null==r?void 0:r.find((e=>"my_day"===e.id));S(s),L((null==t?void 0:t.anti_schedule)||[]),j(e)},onTaskClick:function(e){H(h),_(k),P(e||null),F("task");try{ne("paper")}catch(t){}},additionalButtonClick:function(e){oe(e)}})})]}),"focus"!==x&&!J&&c.jsxs(V,{sx:{width:"100%",height:"98%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[c.jsx(xd,{calendarRef:w,newSettings:Q,setNewSettings:ee,handleEventClick:ie,handleEventChange:ce,eventReceive:ae,handleUpdateTasks:a,addTask:oe,calendarEvents:z,fetchTasks:i,listsList:s,defaultLists:r,projects:o,updateAll:a,updateEvents:u,datesSet:ue}),W&&c.jsx(V,{sx:{width:"100%"},children:c.jsx(Dd,{tasks:W})})]}),c.jsx(ad,{open:I,handleClose:()=>{M(!1)},handleDelDateClick:async function(e){v(e),M(!1);const t=null==E?void 0:E.filter((t=>t.id!=e));L(t)},scroll:O,setSelectedTaskId:P,tasks:C,selectedTaskId:D,taskFields:B,updateTask:async function(e,n){let i=null,s=null;try{switch($){case"event":if(await g(e,{...n},"/tasks/edit_anti_task"),i=null==E?void 0:E.map((t=>t.id==e?{...t,...n}:t)),L(i),_(i),s=re(i,null==Q?void 0:Q.timeOffset),A(s),s){const e=s.filter((e=>Il(e.start).isSame(q,"day")));U(e)}break;case"task":await t(e,n),i=null==k?void 0:k.map((t=>t.id==e?{...t,...n}:t)),j(i),_(i)}}catch(r){}},changeTaskStatus:"task"==$?se:function(e,t){const n=2==t.status_id?"green":"#3788D8",i=E.map((i=>i.id==e?{...i,...t,color:n}:i));L(i),_(i);const s=re(i,null==Q?void 0:Q.timeOffset);A(s),g&&"function"==typeof g&&g(e,t,"tasks/edit_anti_task")},deleteTask:f}),c.jsx(rc,{open:N,handleClose:()=>{Y(!1)}})]})}Dd.propTypes={tasks:a.PropTypes.array},Il.extend(sc),Il.extend(Qu),Pd.propTypes={containerId:g.oneOfType([g.string,g.number])};var zd,Ad={};function Bd(){if(zd)return Ad;zd=1;var e=s();Object.defineProperty(Ad,"__esModule",{value:!0}),Ad.default=void 0;var t=e(yt()),n=r();return Ad.default=(0,t.default)((0,n.jsx)("path",{d:"M3 13h2v-2H3zm0 4h2v-2H3zm0-8h2V7H3zm4 4h14v-2H7zm0 4h14v-2H7zM7 7v2h14V7z"}),"List"),Ad}const Hd=t(Bd());var $d,Fd={};function Nd(){if($d)return Fd;$d=1;var e=s();Object.defineProperty(Fd,"__esModule",{value:!0}),Fd.default=void 0;var t=e(yt()),n=r();return Fd.default=(0,t.default)((0,n.jsx)("path",{d:"M13 8c0-2.21-1.79-4-4-4S5 5.79 5 8s1.79 4 4 4 4-1.79 4-4m-2 0c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2M1 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4m2 0c.2-.71 3.3-2 6-2 2.69 0 5.78 1.28 6 2zm17-3v-3h3v-2h-3V7h-2v3h-3v2h3v3z"}),"PersonAddAlt"),Fd}const Yd=t(Nd()),Wd=L.memo(kc);function Vd({containerId:e}){const{selectedTaskId:t,addTask:n,addList:i}=qc(),{listsList:s,selectedListId:r,setSelectedListId:o,updateList:a,deleteFromChildes:f,defaultLists:g,setSelectedTaskId:v,projects:y,updateAll:x,updateEvents:b,linkListGroup:w}=qc(),{tasks:k,taskFields:j,addSubTask:T,updateTask:S,changeTaskStatus:C,deleteTask:_}=qc(),{linkTaskList:E,selectedList:L}=qc(),[I,M]=l.useState(""),[O,R]=l.useState(""),[D,P]=l.useState(!1);function z(){""!==O.trim()&&L&&(a(L.id,{title:O}),P(!1))}return c.jsx(u,{sx:{flexGrow:1,padding:2,height:"100%",width:"100%",display:"flex",flexDirection:"column"},children:c.jsxs(fe,{container:!0,spacing:.5,sx:{height:"100%"},children:[c.jsxs(fe,{item:!0,xs:12,sm:4,md:3,sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[c.jsx(u,{sx:{flexGrow:1,overflowY:"auto",height:"100%"},children:c.jsx(pc,{selectedListId:r,listsList:s,defaultLists:g,projects:y,updateList:a,isNeedContextMenu:!0,setSelectedListId:o,deleteFromChildes:f,setSelectedTaskId:v,linkListGroup:w,updateAll:x,updateEvents:b})}),c.jsxs(u,{sx:{display:"flex",flexDirection:"row",width:"100%",mt:1},children:[c.jsx(m,{variant:"outlined",sx:{width:"100%"},onClick:()=>{i("list")},children:"Создать список"}),c.jsx(d,{variant:"outlined",sx:{alignSelf:"center"},onClick:()=>{i("group")},children:c.jsx(Wc,{})}),c.jsx(d,{variant:"outlined",sx:{alignSelf:"center"},onClick:()=>{i("project")},children:c.jsx(le,{})})]})]}),c.jsxs(fe,{item:!0,xs:12,sm:8,md:t?5:9,sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[L&&c.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:4,py:2,my:1,borderBottom:"1px solid #ddd"},children:[c.jsxs(u,{sx:{display:"flex",alignItems:"center",flexGrow:1},children:[c.jsx(Hd,{sx:{mr:1}}),D?c.jsx(h,{value:O,onChange:e=>R(e.target.value.trim()),onBlur:z,onKeyDown:e=>{"Enter"===e.key&&O.length>0&&z()},autoFocus:!0,variant:"standard",size:"small",error:0===O.length,helperText:0===O.length?"Title cannot be empty":""}):c.jsx(p,{variant:"h6",onClick:()=>{g.some((e=>e.id===L.id))||(R(L.title),P(!0))},sx:{cursor:g.some((e=>e.id===L.id))?"default":"pointer","&:hover":{opacity:g.some((e=>e.id===L.id))?1:.8}},children:L.title})]}),c.jsx(m,{variant:"outlined",children:c.jsx(Yd,{})})]}),c.jsx(u,{sx:{px:2,flexGrow:1,overflowY:"auto",height:"100%"},children:c.jsx(Wd,{containerId:e,tasks:k,selectedTaskId:t,listsList:s,selectedList:L,isNeedContextMenu:!0,setSelectedTaskId:v,updateList:a,linkTaskList:E,updateTask:S,additionalButtonClick:function(e){const t=3===e.priority_id?1:3;"function"==typeof S&&S(e.id,{priority_id:t})},changeTaskStatus:C,deleteFromChildes:f})}),r&&c.jsxs(de,{component:"form",sx:{display:"flex",flexDirection:"row",flexGrow:1,alignItems:"center",mt:1,mx:1},children:[c.jsx(d,{"aria-label":"menu",onClick:()=>{n(I),M("")},children:c.jsx(Cc,{})}),c.jsx(me,{sx:{flex:1},placeholder:"Добавить задачу",inputProps:{"aria-label":"add task"},value:I,onKeyDown:e=>function(e){if("Enter"===e.key){if(e.preventDefault(),""===I.trim())return;n({title:I}),M("")}}(e),onChange:e=>M(e.target.value)})]})]}),t&&c.jsxs(fe,{item:!0,xs:12,sm:12,md:4,sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[c.jsx(u,{sx:{width:"100%",display:"flex",justifyContent:"flex-end"},children:c.jsx(d,{onClick:()=>v(null),sx:{},children:c.jsx(bt,{})})}),c.jsx(u,{sx:{px:1,flexGrow:1,overflowY:"auto",height:"100%"},children:c.jsx($c,{tasks:k,selectedTaskId:t,taskFields:j,addSubTask:T,updateTask:S,changeTaskStatus:C,deleteTask:_})})]})]})})}Vd.propTypes={containerId:a.PropTypes.oneOfType([a.PropTypes.string,a.PropTypes.number])};const Ud={timer:{type:"timer",name:"Timer",position:{x:0,y:0},size:{width:354,height:244},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:c.jsx(Kt,{})},timersToolbar:{type:"timersToolbar",name:"timersToolbar",position:{x:1540,y:0},size:{width:360,height:900},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:c.jsx(Tl,{})},metronome:{type:"metronome",name:"Metronome",position:{x:500,y:0},size:{width:277,height:320},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:c.jsx(en,{})},chatCollapsed:{type:"chatCollapsed",name:"Chat",position:{x:0,y:600},size:{width:400,height:130},maxSize:{width:600,height:130},minSize:{width:300,height:130},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:c.jsx(el,{})},chat:{type:"chat",name:"Chat",position:{x:0,y:600},size:{width:400,height:500},minSize:{width:300,height:200},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:c.jsx(lc,{})},tasks:{type:"tasks",name:"ToDo",position:{x:600,y:100},size:{width:1400,height:800},minSize:{width:1100,height:700},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:c.jsx(Vd,{})},tasksMobile:{type:"tasksMobile",name:"ToDo",position:{x:600,y:100},size:{width:1400,height:800},minSize:{width:1100,height:700},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:c.jsx(Gc,{})},calendar:{type:"Calendar",name:"Calendar",position:{x:400,y:50},size:{width:800,height:800},minSize:{width:1100,height:700},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:c.jsx(bd,{})},memory:{type:"Memory",name:"Memory",position:{x:400,y:50},size:{width:615,height:865},minSize:{width:615,height:865},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:c.jsx(jl,{})},Scenario:{type:"Scenario",name:"Scenario",position:{x:800,y:0},size:{width:380,height:600},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:c.jsx(El,{})},SecretaryGIF:{type:"SecretaryGIF",name:"SecretaryGIF",position:{x:0,y:0},size:{width:240,height:290},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:c.jsx(Ll,{})},JournalEditor:{type:"JournalEditor",name:"JournalEditor",position:{x:320,y:200},size:{width:1400,height:830},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:c.jsx(ac,{})},JournalEditorDrawer:{type:"JournalEditorDrawer",name:"JournalEditor",position:{x:320,y:200},size:{width:1400,height:830},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:c.jsx(Fu,{})},FocuseMode:{type:"FocuseMode",name:"FocuseMode",position:{x:0,y:0},size:{width:520,height:800},minSize:{width:450,height:500},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:c.jsx(od,{})},AntiSchedule:{type:"AntiSchedule",name:"AntiSchedule",position:{x:0,y:0},size:{width:540,height:800},minSize:{width:500,height:500},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:c.jsx(Pd,{})}},qd=l.createContext(),Gd=({children:e})=>{const[t,n]=l.useState({id:0,name:"dashboard 1"}),[i,s]=l.useState([]),[r,o]=l.useState([]),[a,u]=l.useState(null),[d,h]=l.useState([]),[p,f]=l.useState("light"),[m,g]=l.useState([]),[v,y]=l.useState(!1),[x,b]=l.useState([]),[w,k]=l.useState({slotDuration:30,timeRange:[8,24],timeOffset:0,currentView:"dayGridMonth"});function j(e,t,n){var i,s,r;const o=Ud[e];if(!o)return null;const a=null==(i=o.content)?void 0:i.type,l={...null==(s=o.content)?void 0:s.props,containerId:t,...null==(r=n.content)?void 0:r.props,...n,calendarSettingsProp:w};return{id:t,type:e,name:n.name||o.name,position:n.position||o.position,size:n.size||o.size,maxSize:o.maxSize,minSize:o.minSize,isLockAspectRatio:n.isLockAspectRatio??o.isLockAspectRatio,isResizable:o.isResizable,isDisableDragging:o.isDisableDragging,isLocked:n.isLocked??o.isLocked,isMinimized:n.isMinimized??o.isMinimized,content:a?c.jsx(a,{...l}):o.content}}l.useEffect((()=>{(async()=>{try{const e=await fetch("/dashboard/0");if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();n({id:t.id,name:t.name}),k(t.calendarSettings);const i=t.timers||null;o(i);const r=t.containers.map((e=>j(e.type,e.id,e)));s(r),f(t.themeMode)}catch(e){}})()}),[0]);l.useEffect((()=>{h(i)}),[i]);const[T,S]=l.useReducer(((e,t)=>{switch(t.type){case"SET_QUEUE":return{...e,queue:t.queue};case"PLAY":return{...e,isPlaying:!0};case"PAUSE":return{...e,isPlaying:!1};case"NEXT_TRACK":return{...e,currentTrackIndex:(e.currentTrackIndex+1)%e.queue.length,isPlaying:!0};default:return e}}),{queue:["track1.mp3","track2.mp3","track3.mp3"],currentTrackIndex:0,isPlaying:!1});function C(e){fetch("/post_timers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dashboardId:0,timers:e})}).then((e=>e.json())).then((e=>{})).catch((e=>{}))}return l.useEffect((()=>{if(T.queue.length>0){const e=new Audio(T.queue[T.currentTrackIndex]);T.isPlaying?e.play():e.pause()}}),[T.queue,T.currentTrackIndex,T.isPlaying]),c.jsx(qd.Provider,{value:{windowOrder:x,dashboardData:t,containers:i,activeId:a,minimizedContainers:d,timers:r,setTimers:o,sendTimersToServer:C,themeMode:p,state:T,updates:m,setUpdates:g,dispatch:S,setThemeMode:f,addContainer:function(e,t={}){if(i.length>=20)return;const n=Date.now().toString()+Math.floor(1e3+9e3*Math.random()).toString();if("timersToolbar"===e){0===Object.keys(t).length&&(t={isRunningProp:!1,initialTimeProp:1});const e=[...r,{id:n,...t}];return o(e),void C(e)}const a=j(e,n,{containerId:n,...t});a&&(s((e=>[...e,a])),b((e=>[...e.filter((e=>e!==n)),n])))},handleActive:e=>{u(e),b((t=>[...t.filter((t=>t!==e)),e]))},handleClose:e=>{s(i.filter((t=>t.id!==e))),h(d.filter((t=>t.id!==e))),b((t=>t.filter((t=>t!==e))))},handleMinimizeToggle:e=>{u(e),s((t=>t.map((t=>t.id===e?{...t,isMinimized:!t.isMinimized}:t)))),b((t=>[...t.filter((t=>t!==e)),e]))},sendContainersToServer:async()=>{const e=i.filter((e=>"timersToolbar"!==e.type));try{if(!(await fetch("/dashboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dashboard_data:t,containers:e,themeMode:p,timers:r,calendarSettings:w})})).ok)throw new Error("Network response was not ok")}catch(n){}},handleLock:e=>{s((t=>t.map((t=>t.id===e?{...t,isLocked:!t.isLocked}:t))))},handleContainerResize:(e,t={},n={})=>{s(i.map((i=>i.id===e?{...i,size:{...i.size,...t},position:{...i.position,...n}}:i)))},handleContainerPosition:(e,t)=>{s(i.map((n=>n.id===e?{...n,position:t}:n)))},handleUpdateContent:(e,t)=>{s((n=>n.map((n=>n.id===e?{...n,content:{...n.content,...t}}:n))))},handleUpdateCalendarSettings:e=>{k(e)},isSecretarySpeak:v,setIsSecretarySpeak:y,createComponentFromType:j},children:e})};Gd.propTypes={children:g.node.isRequired};const Kd=()=>{const e=l.useContext(qd);if(!e)throw new Error("useContainer must be used within a ContainerProvider");return e};function Jd({containerData:e}){const{handleActive:t,handleClose:n,handleMinimizeToggle:i,handleLock:s,handleContainerResize:r,handleContainerPosition:o,themeMode:a,windowOrder:l}=Kd(),{id:h,size:f,position:m,isLocked:g,isResizable:v,isDisableDragging:y,isMinimized:x,maxSize:b,minSize:w,name:k,content:j,isLockAspectRatio:T}=e;return c.jsx(Be,{id:h,size:{width:f.width,height:f.height},position:{x:m.x,y:m.y},onDragStop:(e,t)=>o(h,{x:t.x,y:t.y}),onResizeStop:(e,t,n,i,s)=>{r(h,{width:n.offsetWidth,height:n.offsetHeight},s)},enableResizing:!g&&v,disableDragging:g||y,style:{display:x?"none":"block",zIndex:l.indexOf(h)+1,borderRadius:8,border:"1px solid"},bounds:"parent",onMouseDown:()=>t(h),lockAspectRatio:T,dragHandleClassName:"drag-handle",maxWidth:null==b?void 0:b.width,maxHeight:null==b?void 0:b.height,minWidth:(null==w?void 0:w.width)||150,minHeight:(null==w?void 0:w.height)||150,children:c.jsxs(de,{sx:{borderRadius:2,boxShadow:3,overflow:"hidden",display:"flex",flexDirection:"column",height:"100%",width:"100%"},children:[c.jsxs(de,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:1,backgroundColor:"dark"===a?"#292929":"initial"},children:[c.jsx(u,{className:"drag-handle",sx:{display:"flex",alignItems:"center",flexGrow:1,cursor:"move"},children:c.jsx(p,{variant:"body2",children:k})}),c.jsxs(u,{sx:{display:"flex"},children:[c.jsx(d,{size:"small",onClick:()=>i(h),children:c.jsx(Ot,{})}),c.jsx(d,{size:"small",onClick:()=>s(h),children:g?c.jsx(Tt,{}):c.jsx(Et,{})}),c.jsx(d,{size:"small",onClick:()=>n(h),children:c.jsx(bt,{})})]})]}),c.jsx(u,{sx:{flexGrow:1,overflow:"auto",borderBottomLeftRadius:8,borderBottomRightRadius:8},children:j})]})})}Jd.propTypes={containerData:g.shape({id:g.oneOfType([g.string,g.number]).isRequired,size:g.shape({width:g.oneOfType([g.string,g.number]).isRequired,height:g.oneOfType([g.string,g.number]).isRequired}).isRequired,position:g.shape({x:g.oneOfType([g.string,g.number]).isRequired,y:g.oneOfType([g.string,g.number]).isRequired}).isRequired,isLocked:g.bool,isResizable:g.bool,isDisableDragging:g.bool,isMinimized:g.bool,maxSize:g.shape({width:g.oneOfType([g.string,g.number]),height:g.oneOfType([g.string,g.number])}),minSize:g.shape({width:g.oneOfType([g.string,g.number]),height:g.oneOfType([g.string,g.number])}),name:g.string,content:g.node,isLockAspectRatio:g.bool}).isRequired};var Zd,Xd={};function Qd(){if(Zd)return Xd;Zd=1;var e=s();Object.defineProperty(Xd,"__esModule",{value:!0}),Xd.default=void 0;var t=e(yt()),n=r();return Xd.default=(0,t.default)((0,n.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer"),Xd}const eh=t(Qd());var th,nh={};function ih(){if(th)return nh;th=1;var e=s();Object.defineProperty(nh,"__esModule",{value:!0}),nh.default=void 0;var t=e(yt()),n=r();return nh.default=(0,t.default)((0,n.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote"),nh}const sh=t(ih());var rh,oh={};function ah(){if(rh)return oh;rh=1;var e=s();Object.defineProperty(oh,"__esModule",{value:!0}),oh.default=void 0;var t=e(yt()),n=r();return oh.default=(0,t.default)((0,n.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}),"Chat"),oh}const lh=t(ah());var ch,uh={};function dh(){if(ch)return uh;ch=1;var e=s();Object.defineProperty(uh,"__esModule",{value:!0}),uh.default=void 0;var t=e(yt()),n=r();return uh.default=(0,t.default)((0,n.jsx)("path",{d:"M19 7H9c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2m0 2v2H9V9zm-6 6v-2h2v2zm2 2v2h-2v-2zm-4-2H9v-2h2zm6-2h2v2h-2zm-8 4h2v2H9zm8 2v-2h2v2zM6 17H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2v1h-2V5H5v10h1z"}),"TableView"),uh}const hh=t(dh());var ph,fh={};function mh(){if(ph)return fh;ph=1;var e=s();Object.defineProperty(fh,"__esModule",{value:!0}),fh.default=void 0;var t=e(yt()),n=r();return fh.default=(0,t.default)((0,n.jsx)("path",{d:"M22 7h-9v2h9zm0 8h-9v2h9zM5.54 11 2 7.46l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41zm0 8L2 15.46l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41z"}),"Checklist"),fh}const gh=t(mh());var vh,yh={};function xh(){if(vh)return yh;vh=1;var e=s();Object.defineProperty(yh,"__esModule",{value:!0}),yh.default=void 0;var t=e(yt()),n=r();return yh.default=(0,t.default)((0,n.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m-2 14-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"}),"AssignmentTurnedIn"),yh}const bh=t(xh());var wh,kh={};function jh(){if(wh)return kh;wh=1;var e=s();Object.defineProperty(kh,"__esModule",{value:!0}),kh.default=void 0;var t=e(yt()),n=r();return kh.default=(0,t.default)((0,n.jsx)("path",{d:"M18 2h-8L4.02 8 4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-6 6h-2V4h2zm3 0h-2V4h2zm3 0h-2V4h2z"}),"SdStorage"),kh}const Th=t(jh());var Sh,Ch={};function _h(){if(Sh)return Ch;Sh=1;var e=s();Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.default=void 0;var t=e(yt()),n=r();return Ch.default=(0,t.default)((0,n.jsx)("path",{d:"M12 22H5c-1.11 0-2-.9-2-2l.01-14c0-1.1.88-2 1.99-2h1V2h2v2h8V2h2v2h1c1.1 0 2 .9 2 2v6h-2v-2H5v10h7zm10.13-5.01.71-.71c.39-.39.39-1.02 0-1.41l-.71-.71a.9959.9959 0 0 0-1.41 0l-.71.71zm-.71.71-5.3 5.3H14v-2.12l5.3-5.3z"}),"EditCalendar"),Ch}const Eh=t(_h());var Lh,Ih={};function Mh(){if(Lh)return Ih;Lh=1;var e=s();Object.defineProperty(Ih,"__esModule",{value:!0}),Ih.default=void 0;var t=e(yt()),n=r();return Ih.default=(0,t.default)((0,n.jsx)("path",{d:"M3 10h11v2H3zm0-2h11V6H3zm0 8h7v-2H3zm15.01-3.13.71-.71c.39-.39 1.02-.39 1.41 0l.71.71c.39.39.39 1.02 0 1.41l-.71.71zm-.71.71-5.3 5.3V21h2.12l5.3-5.3z"}),"EditNote"),Ih}const Oh=t(Mh());var Rh,Dh={};function Ph(){if(Rh)return Dh;Rh=1;var e=s();Object.defineProperty(Dh,"__esModule",{value:!0}),Dh.default=void 0;var t=e(yt()),n=r();return Dh.default=(0,t.default)([(0,n.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),(0,n.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime"),Dh}const zh=t(Ph()),Ah=[{icon:c.jsx(eh,{}),name:"Timers",type:"timersToolbar"},{icon:c.jsx(sh,{}),name:"Metronome",type:"metronome"},{icon:c.jsx(lh,{}),name:"Chat",type:"chatCollapsed"},{icon:c.jsx(gh,{}),name:"tasks",type:"tasks"},{icon:c.jsx(Eh,{}),name:"calendar",type:"calendar"},{icon:c.jsx(Th,{}),name:"Memory",type:"memory"},{icon:c.jsx(bh,{}),name:"Scenario",type:"Scenario"},{icon:c.jsx(hh,{}),name:"SecretaryGIF",type:"SecretaryGIF"},{icon:c.jsx(Oh,{}),name:"JournalEditor",type:"JournalEditorDrawer"},{icon:c.jsx(zh,{}),name:"AntiSchedule",type:"AntiSchedule"},{icon:c.jsx(gh,{}),name:"ToDo",type:"tasksTree"}];function Bh(){const{addContainer:e}=Kd();return c.jsx(Le,{ariaLabel:"Add Container",sx:{position:"absolute",bottom:80,left:16},icon:c.jsx(Me,{}),children:Ah.map((t=>c.jsx(Ie,{icon:t.icon,tooltipTitle:t.name,onClick:()=>e(t.type)},t.name)))})}function Hh(){const{minimizedContainers:e,handleMinimizeToggle:t}=Kd();return c.jsx(u,{sx:{display:"flex",overflowX:"auto",padding:1},children:e.map(((e,n)=>c.jsx(m,{onClick:()=>t(e.id),sx:{margin:.5},children:e.name},n)))})}function $h(){const{listening:e,resetTranscript:t}=Va.useSpeechRecognition();return c.jsx(Oe,{color:"primary","aria-label":"microphone",onClick:()=>{e?Ua.stopListening():(t(),Ua.startListening({continuous:!0}))},sx:{position:"absolute",bottom:20,left:16},children:c.jsx(w,{children:e?"stop":"mic"})})}var Fh,Nh={};function Yh(){if(Fh)return Nh;Fh=1;var e=s();Object.defineProperty(Nh,"__esModule",{value:!0}),Nh.default=void 0;var t=e(yt()),n=r();return Nh.default=(0,t.default)((0,n.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6"}),"Brightness4"),Nh}const Wh=t(Yh());var Vh,Uh={};function qh(){if(Vh)return Uh;Vh=1;var e=s();Object.defineProperty(Uh,"__esModule",{value:!0}),Uh.default=void 0;var t=e(yt()),n=r();return Uh.default=(0,t.default)((0,n.jsx)("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6m0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4"}),"Brightness7"),Uh}const Gh=t(qh());function Kh(e){const{timers:t,addContainer:n}=Kd(),[i,s]=l.useState(!1),[r,o]=l.useState(t);l.useEffect((()=>{const e=setInterval((()=>{o([...t])}),1e3);return()=>clearInterval(e)}),[t]);const a=e=>{const t=e/1e3%60|0,n=e/1e3/60%60|0,i=e/36e5%24|0;return Math.abs(i)>0?`${i} h`:Math.abs(n)>0?`${n} m`:`${t} s`};return r&&0!==r.length?c.jsxs(u,{sx:{overflowX:"auto",maxWidth:"50vw"},children:[c.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:1},children:[r.map((t=>{const{progress:n,remainingTime:r,isPaused:o}=(e=>{let t,n;if(!e.isRunningProp&&e.initialTimeProp)t=1e3*e.initialTimeProp,n=!0;else{const i=(new Date).getTime();t=(new Date(e.initialEndTimeProp).getTime()||null)-i+2e3,n=!1}const i=36e5;let s=t<=i?t/i*100:100;return t<0&&(s=100),{progress:Math.max(s,0),remainingTime:t,isPaused:n}})(t);return c.jsxs(u,{sx:{position:"relative",display:"inline-flex",margin:1},onClick:()=>s(!i),children:[c.jsx(_,{variant:"determinate",...e,value:n,color:o?"warning":r<0?"error":"primary"}),c.jsx(u,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:o?c.jsx(w,{color:"action",children:"pause"}):c.jsx(p,{variant:"caption",component:"div",color:"text.secondary",children:a(r)})})]},t.id)})),c.jsx(d,{onClick:()=>s(!i),color:"inherit",children:i?c.jsx(w,{children:"expand_less"}):c.jsx(w,{children:"expand_more"})})]}),c.jsx(C,{in:i,sx:{position:"absolute",zIndex:999,minWidth:"360px",right:"30px"},children:c.jsx(de,{sx:{padding:1,border:"1px solid #ccc"},children:c.jsx(Tl,{})})})]}):c.jsx(m,{onClick:()=>n("timersToolbar"),children:"Запустить таймер"})}const Jh=l.createContext({toggleColorMode:()=>{}});function Zh(){const{containers:e,sendContainersToServer:t,themeMode:n,setThemeMode:i}=Kd(),s=De(),[r,o]=l.useState(n),a=l.useMemo((()=>({toggleColorMode:()=>{const e="light"===r?"dark":"light";o(e),i(e)}})),[r,i]);l.useEffect((()=>{o(n)}),[n]);const h=l.useMemo((()=>Ce({palette:{mode:r}})),[r]);return c.jsx(Jh.Provider,{value:a,children:c.jsxs(_e,{theme:h,children:[c.jsx(we,{}),c.jsxs(de,{sx:{width:"100%",height:"60px",position:"relative",margin:"0px",px:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[c.jsx(u,{sx:{maxWidth:"40vw"},children:c.jsx(Hh,{})}),c.jsxs(u,{sx:{marginLeft:"auto",display:"flex",alignItems:"center"},children:[c.jsx(Kh,{}),c.jsx(d,{onClick:a.toggleColorMode,color:"inherit",children:"dark"===h.palette.mode?c.jsx(Gh,{}):c.jsx(Wh,{})}),c.jsx(d,{onClick:function(){s("/mobile")},color:"inherit",children:c.jsx(Td,{})}),c.jsx(m,{onClick:t,children:"Save"})]})]}),c.jsxs(u,{sx:{width:"99vw",height:"92vh",position:"relative",margin:"0px"},children:[e.map((e=>!e.isMinimized&&c.jsx(Jd,{containerData:e},e.id))),c.jsx(Bh,{}),c.jsx($h,{})]}),c.jsx(el,{})]})})}function Xh(){return c.jsx("div",{children:c.jsx(Zh,{})})}const Qh=Ce({palette:{primary:{main:Re[500]}}}),ep=()=>{const{containers:e}=Kd();return c.jsxs(_e,{theme:Qh,children:[c.jsxs(V,{sx:{width:"100%",height:"100vh",backgroundColor:"primary.main",p:0},children:[c.jsx(p,{variant:"h1",color:"primary",children:"Second Page"}),e.map((e=>!e.isMinimized&&c.jsx(Jd,{containerData:e},e.id)))]}),c.jsx($h,{})]})};function tp(){const{updateTask:e,addTask:t,calendarEvents:n,fetchTasks:i}=qc(),{listsList:s,updateList:r,deleteFromChildes:o,defaultLists:a,projects:d,updateAll:h,updateEvents:p,linkListGroup:f}=qc(),{taskFields:g,addSubTask:v,changeTaskStatus:y,deleteTask:x}=qc(),{setUpdates:b}=Kd(),w=l.useRef(null),k=l.useRef(null),j=l.useRef(null),[T,S]=l.useState(null),[C,_]=l.useState(!0),[E,L]=l.useState(!1),[I,M]=l.useState(!1),[O,R]=l.useState(!1),[D,P]=l.useState("paper"),[z,A]=l.useState(null),[B,H]=l.useState(!1),[$,F]=l.useState(30),[N,Y]=l.useState([8,24]),W=l.useRef(0),V=Z(),[U,q]=l.useState("dayGridMonth"),[K,J]=l.useState([]),[X,Q]=l.useState(null);function ee(e,t){if(0==e){return void document.querySelectorAll(".newTimeElement").forEach((e=>{e.remove()}))}document.querySelectorAll(".fc-timegrid-slot-label").forEach((n=>{const i=n.querySelector(".fc-timegrid-slot-label-cushion");if(i){let s=n.getAttribute("data-original-time");s||(s=i.textContent,n.setAttribute("data-original-time",s));const r=s.split(":");if(r.length>1){const s=parseInt(r[0],10),o=parseInt(r[1],10),a=new Date;a.setHours(s),a.setMinutes(o),0!==e&&a.setHours(a.getHours()+e);const l=String(a.getHours()).padStart(2,"0"),c=String(a.getMinutes()).padStart(2,"0"),u=document.createElement("div");u.className="MuiPaper-root newTimeElemet",u.style.backgroundColor=t.palette.background.paper,u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.width="100%",u.style.height="100%",u.style.display="flex",u.style.alignItems="center",u.style.justifyContent="center";const d=document.createElement("div");d.className="MuiTypography-root",d.textContent=`${l}:${c}`,u.appendChild(d);const h=document.createElement("div");h.style.position="relative",n.innerHTML="",h.appendChild(i),h.appendChild(u),n.appendChild(h)}}}))}l.useEffect((()=>{(async()=>{const e=await i(T);J(e)})()}),[T]),l.useEffect((()=>{var e;let t=null==n?void 0:n.map((e=>{const t={...e},n=e=>{const t=new Date(e);return t.setHours(t.getHours()-W.current),t};e.start&&(t.start=n(e.start).toISOString()),e.deadline&&(t.end=n(e.deadline).toISOString()),e.rrule&&(t.rrule.dtstart=t.start);const i=2==(null==e?void 0:e.status_id)?"#008000":3==(null==e?void 0:e.priority_id)?"#A52A2A":(null==e?void 0:e.color)?e.color:"#3788D8";return t.color=i,t}));const i=null==(e=w.current)?void 0:e.getApi();i&&i.removeAllEvents(),I?(t=null==t?void 0:t.filter((e=>"background"==e.display)),t.forEach((e=>{e.display="block"})),i.addEventSource(t)):i.addEventSource(t)}),[W.current,I,U,n]),l.useEffect((()=>{var e;const t=null==(e=w.current)?void 0:e.getApi();if(t){q(t.view.type);const e=()=>{const e=t.view.type;q(e)};return t.on("datesSet",e),()=>{t.off("datesSet",e)}}}),[]),l.useEffect((()=>{ee(W.current,V)}),[V,U,N,$]);const te=()=>{L(!1),R(!1),b((e=>[...e,"todo","calendar"]))};async function ne(t){const i=(e,t)=>{const n=new Date(e);return n.setHours(n.getHours()+t),n.toISOString()},s={title:t.event.title,allDay:t.event.allDay};if(t.event.start&&(s.start=i(t.event.start,W.current)),t.event.end)s.deadline=i(t.event.end,W.current);else{const e=new Date(t.event.start);e.setHours(e.getHours()+1),s.deadline=i(e,W.current)}const r=n.find((e=>e.id==t.event.id));r&&r.rrule&&(s.rrule={...r.rrule,dtstart:i(t.event.start,W.current)}),await e(t.event.id,s),b((e=>[...e,"todo"]))}l.useEffect((()=>{k.current&&(j.current&&j.current.destroy(),j.current=new it(k.current,{itemSelector:".draggable-task",eventData:e=>{const t=e.getAttribute("data-id"),n=K.find((e=>String(e.id)===t));return _(!0),{title:n.title,id:n.id,start:n.start,end:n.end_date,allDay:!n.start}}}))}),[K]);const se=()=>H(!1);function re(e,t){const n=new Date(e.start),i=e.end?new Date(e.end):null;0!==t&&(n.setHours(n.getHours()+t),i&&i.setHours(i.getHours()+t));const s=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;return{startTime:s(n),endTime:i?s(i):null}}const oe=String($).padStart(2,"0"),ae={locale:cd,slotDuration:`00:${oe}:00`,slotLabelInterval:`00:${oe}:00`,slotMinTime:`${String(N[0]).padStart(2,"0")}:00:00`,slotMaxTime:`${String(N[1]).padStart(2,"0")}:00:00`,height:"100%",plugins:[rt,ot,at,lt,ct],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},droppable:!0,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,initialEvents:n,datesSet:e=>q(e.view.type),slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:"short"},select:function(e){const t=(e,t)=>{const n=new Date(e);return n.setHours(n.getHours()+t),n.toISOString()},n=t(e.startStr,W.current),i=e.endStr?t(e.endStr,W.current):null;var s;A({start:n,end:i,allDay:e.allDay}),s="paper",R(!0),P(s)},eventClick:async function(e){var t,n;Q((null==(t=null==e?void 0:e.event)?void 0:t.id)||null);try{n="paper",L(!0),P(n)}catch(i){}},eventChange:ne,eventReceive:function(e){ne(e)},eventDragStart:()=>_(!0)};return"dayGridMonth"==U?ae.eventContent=function(e){const{startTime:t}=re(e.event,W.current),i=n.find((t=>t.id==e.event.id));return{html:`<div class="fc-daygrid-event-dot" style="border-color: ${2==(null==i?void 0:i.status_id)?"#008000":3==(null==i?void 0:i.priority_id)?"#A52A2A":(null==i?void 0:i.color)?i.color:"#3788D8"};"></div>\n            <div class="fc-event-time">${t}</div>\n            <div class="fc-event-title">${e.event.title}</div>`}}:"listWeek"!==U&&(ae.eventContent=function(e){const t=n.find((t=>t.id==e.event.id));if(t&&t.display&&"background"==t.display&&!I)return{html:`<div class="fc-event-main-frame">\n                <div class="fc-event-title-container">\n                  <div class="fc-event-title fc-sticky">${e.event.title}</div>\n                </div>\n            `};const{startTime:i,endTime:s}=re(e.event,W.current);return{html:`<div class="fc-event-main-frame">\n              <div class="fc-event-time">${i}${s?" - "+s:""}</div>\n              <div class="fc-event-title-container">\n                <div class="fc-event-title fc-sticky">${e.event.title}</div>\n              </div>\n            </div>`}}),0==W.current&&(ae.nowIndicator=!0),c.jsxs(u,{sx:{height:"100%",display:"flex",flexDirection:"column",width:"100%"},children:[c.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",paddingTop:1,paddingX:1},children:[c.jsxs(u,{children:[c.jsx(m,{onClick:()=>H(!0),children:"Настройки"}),c.jsxs(ve,{onClick:()=>{M(!I)},selected:I,value:"backgroundsEdit",children:[I?c.jsx(gd,{}):c.jsx(hd,{})," Фоновые задачи"]})]}),c.jsx(m,{onClick:()=>{S(null),_(!C)},children:C?"Показать задачи":"Скрыть задачи"})]}),c.jsxs(fe,{container:!0,sx:{flexGrow:1,overflowY:"auto",height:"100%",position:"relative"},children:[c.jsx(fe,{item:!0,width:"100%",children:c.jsxs(de,{sx:{p:3,flexGrow:1,overflowY:"auto",height:"100%"},children:[c.jsx(st,{ref:w,...ae}),c.jsx(ad,{open:E,handleClose:te,handleDelDateClick:async function(t){await e(t,{start:null,deadline:null}),b((e=>[...e,"todo","calendar"]))},scroll:D,setSelectedTaskId:Q,tasks:n,selectedTaskId:X,taskFields:g,addSubTask:v,updateTask:e,changeTaskStatus:y,deleteTask:x}),c.jsx(vd,{open:O,handleClose:te,scroll:D,selectedDate:z,addTask:t}),c.jsx(yd,{open:B,onClose:function(){se()},onApply:function(e,t,n){F(e),Y(t),W.current=n,se(),ee(n,V)},slotDuration:$,timeRange:N,timeOffset:W.current})]})}),!C&&c.jsxs(fe,{item:!0,sx:{position:"absolute",top:0,bottom:0,right:C?"-100%":"0",width:"500px",maxWidth:"100%",transition:"right 0.3s ease",zIndex:10,backgroundColor:V.palette.background.paper},children:[c.jsx(de,{sx:{p:3,display:T?"none":"block",flexGrow:1,overflowY:"auto",height:"100%"},children:c.jsx(pc,{selectedListId:T,listsList:s,defaultLists:a,projects:d,updateList:r,isNeedContextMenu:!0,setSelectedListId:S,deleteFromChildes:o,setSelectedTaskId:Q,linkListGroup:f,updateAll:h,updateEvents:p},T)}),T&&c.jsxs(de,{sx:{p:3,flexGrow:1,overflowY:"auto",height:"100%"},children:[c.jsx(m,{onClick:()=>S(null),children:"Back"}),c.jsx(ie,{ref:k,children:K&&K.length>0?c.jsxs(c.Fragment,{children:[K.filter((e=>2!==e.status_id)).map((e=>c.jsx(ue,{className:"draggable-task","data-id":e.id,sx:{cursor:"pointer"},children:c.jsx(G,{primary:e.title})},e.id))),K.filter((e=>2===e.status_id)).length>0&&c.jsxs(c.Fragment,{children:[c.jsx(ue,{children:c.jsx(G,{primary:"Выполненные задачи:",sx:{fontWeight:"bold",marginTop:2}})}),K.filter((e=>2===e.status_id)).map((e=>c.jsx(ue,{className:"draggable-task","data-id":e.id,sx:{cursor:"pointer",textDecoration:"line-through",color:"gray"},children:c.jsx(G,{primary:e.title})},e.id)))]})]}):c.jsx(ue,{children:c.jsx(G,{primary:"No tasks available"})})})]})]})]})]})}function np(){return c.jsx("div",{children:c.jsx(Be,{size:{width:"1400px",height:"900px"},enableResizing:!0,disableDragging:!0,style:{display:"block",zIndex:60,borderRadius:8,border:"1px solid"},bounds:"parent",onMouseDown:()=>{},lockAspectRatio:!1,dragHandleClassName:"drag-handle",maxWidth:1400,maxHeight:900,minWidth:150,minHeight:150,children:c.jsxs(de,{sx:{borderRadius:2,boxShadow:3,overflow:"hidden",display:"flex",flexDirection:"column",height:"100%",width:"100%"},children:[c.jsxs(de,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:1,backgroundColor:"initial"},children:[c.jsx(V,{className:"drag-handle",sx:{display:"flex",alignItems:"center",flexGrow:1,cursor:"move"},children:c.jsx(p,{variant:"body2",children:name})}),c.jsxs(V,{sx:{display:"flex"},children:[c.jsx(d,{size:"small",children:"1"}),c.jsx(d,{size:"small",children:"2"}),c.jsx(d,{size:"small",children:"3"})]})]}),c.jsx(V,{sx:{flexGrow:1,overflow:"auto",borderBottomLeftRadius:8,borderBottomRightRadius:8},children:c.jsx(tp,{})})]})})})}var ip,sp={};function rp(){if(ip)return sp;ip=1;var e=s();Object.defineProperty(sp,"__esModule",{value:!0}),sp.default=void 0;var t=e(yt()),n=r();return sp.default=(0,t.default)((0,n.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),sp}const op=t(rp());var ap,lp={};function cp(){if(ap)return lp;ap=1;var e=s();Object.defineProperty(lp,"__esModule",{value:!0}),lp.default=void 0;var t=e(yt()),n=r();return lp.default=(0,t.default)((0,n.jsx)("path",{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2zM4 6h16v10H4z"}),"Computer"),lp}const up=t(cp()),dp=[{icon:c.jsx(sh,{}),name:"Метроном",type:"metronome"},{icon:c.jsx(gh,{}),name:"Список задач",type:"tasks"},{icon:c.jsx(Eh,{}),name:"Календарь",type:"calendar"},{icon:c.jsx(Th,{}),name:"Память",type:"memory"},{icon:c.jsx(bh,{}),name:"Сценарий",type:"Scenario"},{icon:c.jsx(Oh,{}),name:"Журналы",type:"JournalEditorDrawer"},{icon:c.jsx(lh,{}),name:"Chat",type:"chat"},{icon:c.jsx(zh,{}),name:"Режим фокусировки",type:"AntiSchedule"}];function hp(){const[e,t]=l.useState("light"),[n,i]=l.useState(!1),[s,r]=l.useState(null),[o,a]=l.useState("chat"),h=Ee("(max-width: 1100px)"),[p,f]=l.useState(h),m=l.useMemo((()=>({toggleColorMode:()=>{t((e=>"light"===e?"dark":"light"))}})),[]),g=l.useMemo((()=>Ce({palette:{mode:e}})),[e]);l.useEffect((()=>{f(h)}),[h]),l.useEffect((()=>{y(o)}),[p]);const v=()=>{i(!n)},y=e=>{const t=function(e){var t;"tasks"===e&&p&&(e="tasksMobile");const n=Ud[e];if(!n)return null;const i=null==(t=n.content)?void 0:t.type;return c.jsx(i,{})}(e);r(t),i(!1),a(e)};return c.jsxs(_e,{theme:g,children:[c.jsx(we,{}),c.jsxs(de,{sx:{width:"100%",height:"60px",position:"relative",margin:"0px",px:1,display:"flex",justifyContent:"end",alignItems:"center"},children:[c.jsx(d,{onClick:v,color:"inherit",sx:{position:"absolute",left:"10px"},children:c.jsx(op,{})}),c.jsx(Kh,{})]}),c.jsxs(ke,{anchor:"left",open:n,onClose:v,sx:{width:"400px"},PaperProps:{sx:{width:"inherit"}},children:[c.jsx(ie,{children:dp.map(((e,t)=>c.jsxs(U,{onClick:()=>y(e.type),selected:o===e.type,sx:{height:"70px",borderBottom:"1px solid #ccc"},children:[c.jsx(q,{children:e.icon}),c.jsx(G,{primary:e.name})]},`component${t}`)))}),c.jsxs(u,{sx:{position:"absolute",bottom:"10px",right:"10px",width:"100%",justifyContent:"space-between",display:"flex",padding:"10px"},children:[c.jsx(d,{onClick:m.toggleColorMode,color:"inherit",children:"dark"===g.palette.mode?c.jsx(Gh,{}):c.jsx(Wh,{})}),c.jsx(d,{onClick:function(){f(!p)},color:"inherit",children:p?c.jsx(up,{}):c.jsx(Td,{})}),"v.1.3"]})]}),c.jsxs(u,{sx:{width:"98vw",height:"91vh",position:"relative",margin:"0px",justifyContent:"center",alignItems:"center",display:"flex"},children:[s?c.jsx(u,{sx:{height:"100%",position:"relative",p:2,overflowY:"auto",width:"100%",display:"flex",justifyContent:"center"},children:s}):c.jsx(u,{sx:{textAlign:"center",mt:4},children:"Добро пожаловать!"}),"chat"!==o&&c.jsx($h,{})]})]})}function pp(){return c.jsx("div",{className:"App",children:c.jsx(Gd,{children:c.jsx(Uc,{children:c.jsx(Pe,{future:{v7_fetcherPersist:!0,v7_normalizeFormMethod:!0,v7_partialHydration:!0,v7_relativeSplatPath:!0,v7_skipActionErrorRevalidation:!0,v7_startTransition:!0},children:c.jsxs(ze,{children:[c.jsx(Ae,{path:"/",element:c.jsx(Xh,{})}),c.jsx(Ae,{path:"/second",element:c.jsx(ep,{})}),c.jsx(Ae,{path:"/test",element:c.jsx(np,{})}),c.jsx(Ae,{path:"/mobile",element:c.jsx(hp,{})})]})})})})})}ht.createRoot(document.getElementById("root")).render(c.jsx(L.StrictMode,{children:c.jsx(pp,{})}));
