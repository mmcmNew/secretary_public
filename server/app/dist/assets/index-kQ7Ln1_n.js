const e=function(e,n,r,i,a){const u=t(n);return!!o(e)&&u.call(a,e,r,i)},t=function(e){if(null==e)return r;if("string"==typeof e)return function(e){return n(t);function t(t){return t.tagName===e}}(e);if("object"==typeof e)return function(e){const r=[];let o=-1;for(;++o<e.length;)r[o]=t(e[o]);return n(i);function i(...e){let t=-1;for(;++t<r.length;)if(r[t].apply(this,e))return!0;return!1}}(e);if("function"==typeof e)return n(e);throw new Error("Expected function, string, or array as `test`")};function n(e){return function(t,n,r){return Boolean(o(t)&&e.call(this,t,"number"==typeof n?n:void 0,r||void 0))}}function r(e){return Boolean(e&&"object"==typeof e&&"type"in e&&"element"===e.type&&"tagName"in e&&"string"==typeof e.tagName)}function o(e){return null!==e&&"object"==typeof e&&"type"in e&&"tagName"in e}const i=t((function(e){return"audio"===e.tagName||"canvas"===e.tagName||"embed"===e.tagName||"iframe"===e.tagName||"img"===e.tagName||"math"===e.tagName||"object"===e.tagName||"picture"===e.tagName||"svg"===e.tagName||"video"===e.tagName})),a=/[ \t\n\f\r]/g;function u(e){return"object"==typeof e?"text"===e.type&&c(e.value):c(e)}function c(e){return""===e.replace(a,"")}const l=function(e){if(null==e)return p;if("function"==typeof e)return f(e);if("object"==typeof e)return Array.isArray(e)?function(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=l(e[n]);return f(r);function r(...e){let n=-1;for(;++n<t.length;)if(t[n].apply(this,e))return!0;return!1}}(e):function(e){const t=e;return f(n);function n(n){const r=n;let o;for(o in e)if(r[o]!==t[o])return!1;return!0}}(e);if("string"==typeof e)return function(e){return f(t);function t(t){return t&&t.type===e}}(e);throw new Error("Expected function, string, or object as test")};function f(e){return function(t,n,r){return Boolean(function(e){return null!==e&&"object"==typeof e&&"type"in e}(t)&&e.call(this,t,"number"==typeof n?n:void 0,r||void 0))}}function p(){return!0}const s=["address","article","aside","blockquote","body","br","caption","center","col","colgroup","dd","dialog","dir","div","dl","dt","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","legend","li","li","listing","main","menu","nav","ol","optgroup","option","p","plaintext","pre","section","summary","table","tbody","td","td","tfoot","th","th","thead","tr","ul","wbr","xmp"],d=["button","input","select","textarea"],m=["area","base","basefont","dialog","datalist","head","link","meta","noembed","noframes","param","rp","script","source","style","template","track","title"],h={},g=l(["comment","doctype"]);function y(e,t){if("children"in e){const n={...t};return("root"===e.type||w(e))&&(n.before=!0,n.after=!0),n.whitespace=function(e,t){if("tagName"in e&&e.properties)switch(e.tagName){case"listing":case"plaintext":case"script":case"style":case"xmp":return"pre";case"nobr":return"nowrap";case"pre":return e.properties.wrap?"pre-wrap":"pre";case"td":case"th":return e.properties.noWrap?"nowrap":t.whitespace;case"textarea":return"pre-wrap"}return t.whitespace}(e,t),function(e,t){let n=t.before;const r=t.after,o=e.children;let i=o.length,a=-1;for(;++a<i;){const e=y(o[a],{...t,after:b(o,a,r),before:n});e.remove?(o.splice(a,1),a--,i--):e.ignore||(n=e.stripAtStart),N(o[a])&&(n=!1)}return{ignore:!1,stripAtStart:Boolean(n||r),remove:!1}}(e,n)}if("text"===e.type){if("normal"===t.whitespace)return function(e,t){const n=t.collapse(e.value),r={ignore:!1,stripAtStart:!1,remove:!1};let o=0,i=n.length;t.before&&k(n.charAt(0))&&o++;o!==i&&k(n.charAt(i-1))&&(t.after?i--:r.stripAtStart=!0);o===i?r.remove=!0:e.value=n.slice(o,i);return r}(e,t);"nowrap"===t.whitespace&&(e.value=t.collapse(e.value))}return{ignore:g(e),stripAtStart:!1,remove:!1}}function b(e,t,n){for(;++t<e.length;){const n=e[t];let r=v(n);if(void 0===r&&"children"in n&&!x(n)&&(r=b(n.children,-1)),"boolean"==typeof r)return r}return n}function v(e){if("element"===e.type){if(N(e))return!1;if(w(e))return!0}else if("text"===e.type){if(!u(e))return!1}else if(!g(e))return!1}function N(t){return i(t)||e(t,d)}function w(t){return e(t,s)}function x(t){return Boolean("element"===t.type&&t.properties.hidden)||g(t)||e(t,m)}function k(e){return" "===e||"\n"===e}function A(e){const t=/\r?\n|\r/.exec(e);return t?t[0]:" "}function j(){return" "}function S(e){return function(t){return String(t).replace(/[\t\n\v\f\r ]+/g,e)}}const B={}.hasOwnProperty;const E=new Set(["pingback","prefetch","stylesheet"]);const P=t(["a","abbr","area","b","bdi","bdo","br","button","cite","code","data","datalist","del","dfn","em","i","input","ins","kbd","keygen","label","map","mark","meter","noscript","output","progress","q","ruby","s","samp","script","select","small","span","strong","sub","sup","template","textarea","time","u","var","wbr"]),I=t("meta");function q(e){return Boolean("text"===e.type||P(e)||i(e)||function(e){if("element"!==e.type||"link"!==e.tagName)return!1;if(e.properties.itemProp)return!0;const t=e.properties.rel;let n=-1;if(!Array.isArray(t)||0===t.length)return!1;for(;++n<t.length;)if(!E.has(String(t[n])))return!1;return!0}(e)||I(e)&&function(e,t){const n="element"===e.type&&B.call(e.properties,t)&&e.properties[t];return null!=n&&!1!==n}(e,"itemProp"))}const O=["pre","script","style","textarea"];const M=[],W=!0,$=!1,z="skip";function C(e,t,n,r){let o;"function"==typeof t&&"function"!=typeof n?(r=n,n=t):o=t;const i=l(o),a=r?-1:1;!function e(o,u,c){const l=o&&"object"==typeof o?o:{};if("string"==typeof l.type){const e="string"==typeof l.tagName?l.tagName:"string"==typeof l.name?l.name:void 0;Object.defineProperty(f,"name",{value:"node ("+o.type+(e?"<"+e+">":"")+")"})}return f;function f(){let l,f,p,s=M;if((!t||i(o,u,c[c.length-1]||void 0))&&(s=function(e){if(Array.isArray(e))return e;if("number"==typeof e)return[W,e];return null==e?M:[e]}(n(o,c)),s[0]===$))return s;if("children"in o&&o.children){const t=o;if(t.children&&s[0]!==z)for(f=(r?t.children.length:-1)+a,p=c.concat(t);f>-1&&f<t.children.length;){const n=t.children[f];if(l=e(n,f,p)(),l[0]===$)return l;f="number"==typeof l[1]?l[1]:f+a}}return s}}(e,void 0,[])()}const D={};function F(e,t){const n=t||D,r={blanks:n.blanks||[],head:!1,indentInitial:!1!==n.indentInitial,indent:"number"==typeof n.indent?" ".repeat(n.indent):"string"==typeof n.indent?n.indent:"  "};function o(e,t,n){const o=e[e.length-1],i=o&&u(o)?e[e.length-2]:o,a=(G(r,i)&&G(r,n)?"\n\n":"\n")+r.indent.repeat(Math.max(t,0));o&&"text"===o.type?o.value=u(o)?a:o.value+a:e.push({type:"text",value:a})}!function(e,t){y(e,{collapse:S((t||h).newlines?A:j),whitespace:"normal"})}(e,{newlines:!0}),C(e,(function(e,t){if(!("children"in e))return;"element"===e.type&&"head"===e.tagName&&(r.head=!0);r.head&&"element"===e.type&&"body"===e.tagName&&(r.head=!1);if("element"===e.type&&O.includes(e.tagName))return z;if(0===e.children.length||!H(r,e))return;let n=t.length;r.indentInitial||n--;let i=!1;for(const o of e.children)"comment"!==o.type&&"text"!==o.type||(o.value.includes("\n")&&(i=!0),o.value=o.value.replace(/ *\n/g,"$&"+r.indent.repeat(n)));const a=[];let c;for(const u of e.children)(H(r,u)||i&&!c)&&(o(a,n,u),i=!0),c=u,a.push(u);c&&(i||H(r,c))&&(u(c)&&(a.pop(),c=a[a.length-1]),o(a,n-1));e.children=a}))}function G(e,t){return Boolean(t&&"element"===t.type&&e.blanks.length>0&&e.blanks.includes(t.tagName))}function H(e,t){return"root"===t.type||"element"===t.type&&(e.head||"script"===t.tagName||i(t)||!q(t))}function J(e){return function(t){F(t,e)}}export{J as default};
