import{a5 as e,ai as t,r as n,j as s,aj as i,I as r,ak as o,A as a,al as l,am as c,an as d,T as u,ao as h,R as p,ap as f,a3 as m,a8 as g,aq as x,s as y,ar as v,as as b,at as k,au as w,av as T,aw as j,ax as S,ay as C,a9 as E,az as _,aA as I,aa as L,af as D,aB as R,a2 as O,aC as M,ad as A,aD as P,aE as z,aF as B,aG as $,aH as F,aI as H,aJ as N,aK as W,aL as q,aM as U,aN as Y,aO as G,aP as V,aQ as K,aR as J,aS as X,a as Z,X as Q,aT as ee,Z as te,S as ne,z as se,y as ie,aU as re,M as oe,a7 as ae,aV as le,aW as ce,aX as de,aY as ue,aZ as he,E as pe,a_ as fe,a$ as me,b0 as ge,b1 as xe,b2 as ye,b3 as ve,b4 as be,W as ke,b5 as we,b6 as Te,U as je,P as Se,b7 as Ce,b8 as Ee,b9 as _e,ba as Ie,bb as Le,bc as De,bd as Re,be as Oe,bf as Me,bg as Ae,bh as Pe,bi as ze,bj as Be,bk as $e,bl as Fe,bm as He,bn as Ne,V as We,bo as qe,bp as Ue,bq as Ye,br as Ge,bs as Ve,bt as Ke,bu as Je,bv as Xe,bw as Ze,bx as Qe,by as et,bz as tt,bA as nt,bB as st,bC as it,K as rt,bD as ot,bE as at,bF as lt,bG as ct,bH as dt,bI as ut,bJ as ht,bK as pt,bL as ft,bM as mt,bN as gt,bO as xt,bP as yt,bQ as vt,bR as bt,bS as kt,bT as wt,bU as Tt,bV as jt,bW as St,bX as Ct,bY as Et,bZ as _t,b_ as It,b$ as Lt,c0 as Dt,c1 as Rt,a0 as Ot,$ as Mt,c2 as At,c3 as Pt,c4 as zt,c5 as Bt,c6 as $t,c7 as Ft}from"./mui-fHG9gkAl.js";import{d as Ht,M as Nt,R as Wt}from"./blocknote-BwDZ4YHO.js";import{R as qt}from"./dnd-DqQ3X1Wj.js";import{d as Ut,S as Yt,e as Gt,c as Vt,m as Kt,a as Jt,b as Xt,f as Zt,g as Qt}from"./swiper-GGsF7Ke6.js";import{a as en,r as tn}from"./utils-CwVkOTPZ.js";import{u as nn,N as sn,O as rn,R as on,a as an,B as ln}from"./react-vendor-JeHzVyxY.js";import{L as cn,D as dn,a as un,r as hn,S as pn,T as fn}from"./mui-x-DAQFfo7p.js";import{E as mn,F as gn,i as xn,a as yn,b as vn,c as bn,d as kn}from"./fullcalendar-DDBiRdUH.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var wn,Tn={exports:{}};var jn,Sn=wn?Tn.exports:(wn=1,"undefined"!=typeof self&&self,Tn.exports=(jn=e(),(()=>{var e={155:e=>{e.exports=jn}},t={};function n(s){var i=t[s];if(void 0!==i)return i.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};n.r(s),n.d(s,{useStopwatch:()=>d,useTime:()=>u,useTimer:()=>c});var i=n(155);class r{static getTimeFromMilliseconds(e,t=!0){const n=t?Math.ceil(e/1e3):Math.floor(e/1e3),s=Math.floor(n/86400),i=Math.floor(n%86400/3600),r=Math.floor(n%3600/60),o=Math.floor(n%60);return{totalMilliseconds:e,totalSeconds:n,milliseconds:Math.floor(e%1e3),seconds:o,minutes:r,hours:i,days:s}}static getMillisecondsFromExpiry(e){const t=(new Date).getTime(),n=(null==e?void 0:e.getTime())-t;return n>0?n:0}static getMillisecondsFromPrevTime(e){const t=(new Date).getTime()-e;return t>0?t:0}static getMillisecondsFromTimeNow(){const e=new Date;return e.getTime()-60*e.getTimezoneOffset()*1e3}static getFormattedTimeFromMilliseconds(e,t){const{milliseconds:n,seconds:s,minutes:i,hours:o}=r.getTimeFromMilliseconds(e);let a="",l=o;return"12-hour"===t&&(a=o>=12?"pm":"am",l=o%12),{milliseconds:n,seconds:s,minutes:i,hours:l,ampm:a}}}class o{static expiryTimestamp(e){const t=new Date(e).getTime()>0;return t}static onExpire(e){const t=e&&"function"==typeof e;return t}}function a(e,t){const n=(0,i.useRef)(e);(0,i.useEffect)((()=>{n.current=e})),(0,i.useEffect)((()=>{if(!t)return()=>{};const e=setInterval((()=>{var e;null===(e=null==n?void 0:n.current)||void 0===e||e.call(n)}),t);return()=>clearInterval(e)}),[t])}const l=1e3;function c({expiryTimestamp:e,onExpire:t=()=>{},autoStart:n=!0,interval:s=l}){const[c,d]=(0,i.useState)(e),[u,h]=(0,i.useState)(r.getMillisecondsFromExpiry(c)),[p,f]=(0,i.useState)(n),[m,g]=(0,i.useState)(n),[x,y]=(0,i.useState)(s),v=(0,i.useCallback)((()=>{o.onExpire(t)&&t(),f(!1),y(null)}),[t]),b=(0,i.useCallback)((()=>{f(!1)}),[]),k=(0,i.useCallback)(((e,t=!0)=>{y(s),g(t),f(t),d(e),h(r.getMillisecondsFromExpiry(e))}),[s]),w=(0,i.useCallback)((()=>{const e=new Date;e.setMilliseconds(e.getMilliseconds()+u),k(e)}),[u,k]),T=(0,i.useCallback)((()=>{m?(h(r.getMillisecondsFromExpiry(c)),f(!0)):w()}),[c,m,w]);return a((()=>{const e=r.getMillisecondsFromExpiry(c);h(e),e<=0?v():x&&e<x&&y(e)}),p?x:null),(0,i.useEffect)((()=>{o.expiryTimestamp(c)}),[c]),Object.assign(Object.assign({},r.getTimeFromMilliseconds(u)),{start:T,pause:b,resume:w,restart:k,isRunning:p})}function d({autoStart:e=!0,offsetTimestamp:t,interval:n=l}={}){const s=t?r.getMillisecondsFromExpiry(t):0,[o,c]=(0,i.useState)((new Date).getTime()-new Date(s).getTime()),[d,u]=(0,i.useState)(r.getMillisecondsFromPrevTime(o||0)),[h,p]=(0,i.useState)(e),f=l-d%l,[m,g]=(0,i.useState)(n<f?n:f);a((()=>{m!==n&&g(n),u(r.getMillisecondsFromPrevTime(o))}),h?m:null);const x=(0,i.useCallback)((()=>{c((new Date).getTime()-new Date(d).getTime()),p(!0)}),[d]),y=(0,i.useCallback)((()=>{h&&(u(r.getMillisecondsFromPrevTime(o)),p(!1))}),[o,h]),v=(0,i.useCallback)(((e,t=!0)=>{const s=e?r.getMillisecondsFromExpiry(e):0,i=(new Date).getTime()-new Date(s).getTime(),o=r.getMillisecondsFromPrevTime(i),a=l-o%l;c(i),u(o),g(n<a?n:a),p(t)}),[n]);return Object.assign(Object.assign({},r.getTimeFromMilliseconds(d,!1)),{start:x,pause:y,reset:v,isRunning:h})}function u({format:e,interval:t=l}={}){const[n,s]=(0,i.useState)(r.getMillisecondsFromTimeNow());return a((()=>{s(r.getMillisecondsFromTimeNow())}),t),Object.assign({},r.getFormattedTimeFromMilliseconds(n,e))}return s})()));function Cn({id:e,initialTimeProp:t,initialEndTimeProp:u,resultText:h,isRunningProp:p=!1,onExpireFunc:f=null,handleCloseTimer:m=null,handleUpdateTimers:g=null,playSoundProp:x=!0,soundUrl:y="/sounds/endTimer.mp3",currentActionId:v=null}){const[b,k]=n.useState(!0),[w,T]=n.useState(h||"Таймер завершился"),j=p?u?new Date(u):new Date:t?new Date((new Date).getTime()+1e3*t):new Date,S=j.getTime()-(new Date).getTime(),[C,E]=n.useState({days:Math.trunc(S/864e5),hours:Math.trunc(S%864e5/36e5),minutes:Math.trunc(S%36e5/6e4),seconds:Math.trunc(S%6e4/1e3)});n.useEffect((()=>{if(v===e){if(!(_+60*I+3600*L+86400*D)&&f)return void f(e);P()}}),[v]);const{seconds:_,minutes:I,hours:L,days:D,isRunning:R,pause:O,restart:M}=Sn.useTimer({expiryTimestamp:j,onExpire:function(){let t=Promise.resolve();if(x&&y){const e=new Audio(y);t=new Promise((t=>{e.onended=t,e.play()}))}t.then((()=>{fetch("/get_tts_audio",{method:"POST",body:new URLSearchParams({text:w}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{if(!e.ok)throw new Error("Network response was not ok "+e.statusText);return e.blob()})).then((e=>new Promise((t=>{const n=URL.createObjectURL(e),s=new Audio(n);s.onended=t,s.play()})))).catch((e=>{}))})).then((()=>{z(),f&&f(e)}))},autoStart:!1});function A(e){const{name:t,value:n}=e.target;E((e=>({...e,[t]:parseInt(n,10)||0})))}function P(){const e=new Date;e.setSeconds(e.getSeconds()+C.seconds+60*C.minutes+3600*C.hours+86400*C.days),e>new Date&&M(e)}function z(){E({days:0,hours:0,minutes:0,seconds:0})}return n.useEffect((()=>{R&&E({days:D,hours:L,minutes:I,seconds:_})}),[R,D,L,I,_]),n.useEffect((()=>{if(b)k(!1);else{if(!R){g&&g(e,{initialTimeProp:_+60*I+3600*L+86400*D,resultText:w,isRunningProp:!1})}if(R){const t=new Date;t.setSeconds(t.getSeconds()+_+60*I+3600*L+86400*D),g&&g(e,{initialEndTimeProp:t.toISOString(),isRunningProp:!0})}}}),[R]),n.useEffect((()=>{p&&P()}),[p]),s.jsxs(i,{textAlign:"center",border:1,padding:"3px",sx:{maxWidth:"450px"},children:[s.jsx(i,{textAlign:"right",children:s.jsx(r,{size:"small",onClick:()=>{m&&m(e)},children:s.jsx(o,{fontSize:"inherit"})})}),s.jsx(a,{size:"small",value:w,onChange:e=>T(e.target.value),onBlur:()=>{g&&g(e,{resultText:w})},style:{width:"calc(100% - 20px)",margin:"0px 0px"}}),s.jsxs(i,{display:"flex",justifyContent:"center",alignItems:"center",fontSize:"30px",marginTop:1,children:[s.jsxs(i,{children:[s.jsx(r,{onClick:R?O:P,children:R?s.jsx(l,{}):s.jsx(c,{})}),s.jsx(r,{onClick:function(){O(),z()},children:s.jsx(d,{})})]}),s.jsx(a,{size:"small",type:"number",name:"hours",value:C.hours+24*C.days,onChange:A,disabled:R,inputProps:{min:0},style:{width:"70px"}}),":",s.jsx(a,{size:"small",type:"number",name:"minutes",value:C.minutes,onChange:A,disabled:R,inputProps:{min:0,max:59},style:{width:"70px"}}),":",s.jsx(a,{size:"small",type:"number",name:"seconds",value:C.seconds,onChange:A,disabled:R,inputProps:{min:0,max:59},style:{width:"70px"}})]})]})}function En({id:e,initialName:t="Metronome",initialBpm:r=120,initialCount:o=0,isRunningProp:l=!1,onExpireFunc:d=null,currentActionId:m=null}){const[g,x]=n.useState(t),[y,v]=n.useState(parseInt(r)),[b,k]=n.useState(parseInt(o)),[w,T]=n.useState(l),j=n.useRef(null),S=n.useRef(0),C=new Audio("/sounds/click1.mp3");function E(){if(j.current)return;const e=60/y*1e3;S.current=0,j.current=setInterval((()=>{C.play(),S.current+=1,S.current>=b&&b>1&&(_(),T(!1),S.current=0,d&&d(m))}),e)}n.useEffect((()=>(w?E():_(),()=>_())),[w,y,b]),n.useEffect((()=>{m===e&&E()}),[m]);const _=()=>{j.current&&(clearInterval(j.current),j.current=null)};return s.jsxs(i,{sx:{p:2,textAlign:"center",border:1,height:"320px"},children:[s.jsx(a,{fullWidth:!0,size:"small",value:g,onChange:e=>x(e.target.value),variant:"outlined",label:"Name"}),s.jsxs(u,{variant:"h6",sx:{mt:2},children:[y," BPM"]}),s.jsx(h,{value:y,onChange:(e,t)=>{v(t)},min:1,max:240,step:1,valueLabelDisplay:"auto",sx:{mt:2}}),s.jsxs(i,{sx:{display:"flex",justifyContent:"center",alignItems:"center",mt:2},children:[s.jsx(p,{onClick:()=>T(!0),variant:"outlined",startIcon:s.jsx(c,{}),children:"Start"}),s.jsx(p,{onClick:()=>T(!1),variant:"outlined",startIcon:s.jsx(f,{}),sx:{ml:2},children:"Stop"})]}),s.jsx(a,{fullWidth:!0,size:"small",type:"number",value:b,onChange:e=>{k(e.target.value)},variant:"outlined",label:"Ticks Count",sx:{mt:2}})]})}function _n({initialMarkdown:e}){const t=Ht();return n.useEffect((()=>{(async()=>{const n=await t.tryParseMarkdownToBlocks(e);t.replaceBlocks(t.document,n)})()}),[t,e]),s.jsx(Nt,{editor:t})}function In({url:e}){const t=e.split(".").pop().toLowerCase(),[i,r]=n.useState(null);if(n.useEffect((()=>{if(["md","txt"].includes(t)){let t=!0;return fetch(e).then((e=>e.text())).then((e=>{t&&r(e)})).catch((()=>{t&&r("")})),()=>{t=!1}}}),[e,t]),["md","txt"].includes(t))return null===i?s.jsx(g,{size:20}):s.jsx(_n,{readOnly:!0,initialMarkdown:i});if(/(png|jpe?g|gif|webp)$/i.test(t)){const t=`![file](${e})`;return s.jsx(_n,{readOnly:!0,initialMarkdown:t})}return s.jsx(p,{href:e,target:"_blank",startIcon:s.jsx(x,{}),children:"Открыть файл"})}Cn.propTypes={id:t.PropTypes.string,initialTimeProp:t.PropTypes.number,initialEndTimeProp:t.PropTypes.string,resultText:t.PropTypes.string,isRunningProp:t.PropTypes.bool,playSoundProp:t.PropTypes.bool,soundUrl:t.PropTypes.string,onExpireFunc:t.PropTypes.func,handleCloseTimer:t.PropTypes.func,handleUpdateTimers:t.PropTypes.func,currentActionId:t.PropTypes.string},En.propTypes={id:t.PropTypes.string,initialName:t.PropTypes.string,initialBpm:t.PropTypes.oneOfType([t.PropTypes.number,t.PropTypes.string]),initialCount:t.PropTypes.oneOfType([t.PropTypes.number,t.PropTypes.string]),isRunningProp:t.PropTypes.bool,onExpireFunc:t.PropTypes.func,currentActionId:t.PropTypes.string},_n.propTypes={initialMarkdown:t.PropTypes.string},In.propTypes={url:m.string.isRequired};const Ln=Object.create(null);Ln.open="0",Ln.close="1",Ln.ping="2",Ln.pong="3",Ln.message="4",Ln.upgrade="5",Ln.noop="6";const Dn=Object.create(null);Object.keys(Ln).forEach((e=>{Dn[Ln[e]]=e}));const Rn={type:"error",data:"parser error"},On="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),Mn="function"==typeof ArrayBuffer,An=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,Pn=({type:e,data:t},n,s)=>On&&t instanceof Blob?n?s(t):zn(t,s):Mn&&(t instanceof ArrayBuffer||An(t))?n?s(t):zn(new Blob([t]),s):s(Ln[e]+(t||"")),zn=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+(e||""))},n.readAsDataURL(e)};function Bn(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let $n;const Fn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hn="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let pu=0;pu<64;pu++)Hn[Fn.charCodeAt(pu)]=pu;const Nn="function"==typeof ArrayBuffer,Wn=(e,t)=>{if("string"!=typeof e)return{type:"message",data:Un(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:qn(e.substring(1),t)};return Dn[n]?e.length>1?{type:Dn[n],data:e.substring(1)}:{type:Dn[n]}:Rn},qn=(e,t)=>{if(Nn){const n=(e=>{let t,n,s,i,r,o=.75*e.length,a=e.length,l=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const c=new ArrayBuffer(o),d=new Uint8Array(c);for(t=0;t<a;t+=4)n=Hn[e.charCodeAt(t)],s=Hn[e.charCodeAt(t+1)],i=Hn[e.charCodeAt(t+2)],r=Hn[e.charCodeAt(t+3)],d[l++]=n<<2|s>>4,d[l++]=(15&s)<<4|i>>2,d[l++]=(3&i)<<6|63&r;return c})(e);return Un(n,t)}return{base64:!0,data:e}},Un=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,Yn=String.fromCharCode(30);function Gn(){return new TransformStream({transform(e,t){!function(e,t){On&&e.data instanceof Blob?e.data.arrayBuffer().then(Bn).then(t):Mn&&(e.data instanceof ArrayBuffer||An(e.data))?t(Bn(e.data)):Pn(e,!1,(e=>{$n||($n=new TextEncoder),t($n.encode(e))}))}(e,(n=>{const s=n.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const e=new DataView(i.buffer);e.setUint8(0,126),e.setUint16(1,s)}else{i=new Uint8Array(9);const e=new DataView(i.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(s))}e.data&&"string"!=typeof e.data&&(i[0]|=128),t.enqueue(i),t.enqueue(n)}))}})}let Vn;function Kn(e){return e.reduce(((e,t)=>e+t.length),0)}function Jn(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let s=0;for(let i=0;i<t;i++)n[i]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),n}function Xn(e){if(e)return function(e){for(var t in Xn.prototype)e[t]=Xn.prototype[t];return e}(e)}Xn.prototype.on=Xn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},Xn.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},Xn.prototype.off=Xn.prototype.removeListener=Xn.prototype.removeAllListeners=Xn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,s=this._callbacks["$"+e];if(!s)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<s.length;i++)if((n=s[i])===t||n.fn===t){s.splice(i,1);break}return 0===s.length&&delete this._callbacks["$"+e],this},Xn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){s=0;for(var i=(n=n.slice(0)).length;s<i;++s)n[s].apply(this,t)}return this},Xn.prototype.emitReserved=Xn.prototype.emit,Xn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},Xn.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Zn="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Qn="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function es(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const ts=Qn.setTimeout,ns=Qn.clearTimeout;function ss(e,t){t.useNativeTimers?(e.setTimeoutFn=ts.bind(Qn),e.clearTimeoutFn=ns.bind(Qn)):(e.setTimeoutFn=Qn.setTimeout.bind(Qn),e.clearTimeoutFn=Qn.clearTimeout.bind(Qn))}function is(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class rs extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class os extends Xn{constructor(e){super(),this.writable=!1,ss(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new rs(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Wn(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}(e);return t.length?"?"+t:""}}class as extends os{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const n=e.split(Yn),s=[];for(let i=0;i<n.length;i++){const e=Wn(n[i],t);if(s.push(e),"error"===e.type)break}return s})(e,this.socket.binaryType).forEach((e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)})),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const n=e.length,s=new Array(n);let i=0;e.forEach(((e,r)=>{Pn(e,!1,(e=>{s[r]=e,++i===n&&t(s.join(Yn))}))}))})(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=is()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let ls=!1;try{ls="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(hu){}const cs=ls;function ds(){}class us extends as{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}class hs extends Xn{constructor(e,t,n){super(),this.createRequest=e,ss(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=void 0!==n.data?n.data:null,this._create()}_create(){var e;const t=es(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&n.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(jn){}if("POST"===this._method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(jn){}try{n.setRequestHeader("Accept","*/*")}catch(jn){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var e;3===n.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(n.getResponseHeader("set-cookie"))),4===n.readyState&&(200===n.status||1223===n.status?this._onLoad():this.setTimeoutFn((()=>{this._onError("number"==typeof n.status?n.status:0)}),0))},n.send(this._data)}catch(jn){return void this.setTimeoutFn((()=>{this._onError(jn)}),0)}"undefined"!=typeof document&&(this._index=hs.requestsCount++,hs.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=ds,e)try{this._xhr.abort()}catch(jn){}"undefined"!=typeof document&&delete hs.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(hs.requestsCount=0,hs.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",ps);else if("function"==typeof addEventListener){addEventListener("onpagehide"in Qn?"pagehide":"unload",ps,!1)}function ps(){for(let e in hs.requests)hs.requests.hasOwnProperty(e)&&hs.requests[e].abort()}const fs=function(){const e=ms({xdomain:!1});return e&&null!==e.responseType}();function ms(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||cs))return new XMLHttpRequest}catch(jn){}if(!t)try{return new(Qn[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(jn){}}const gs="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class xs extends os{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=gs?{}:es(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(hu){return this.emitReserved("error",hu)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;Pn(n,this.supportsBinary,(e=>{try{this.doWrite(n,e)}catch(jn){}s&&Zn((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=is()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const ys=Qn.WebSocket||Qn.MozWebSocket;const vs={websocket:class extends xs{createSocket(e,t,n){return gs?new ys(e,t,n):t?new ys(e,t):new ys(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends os{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(hu){return this.emitReserved("error",hu)}this._transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)})),this._transport.ready.then((()=>{this._transport.createBidirectionalStream().then((e=>{const t=function(e,t){Vn||(Vn=new TextDecoder);const n=[];let s=0,i=-1,r=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(0===s){if(Kn(n)<1)break;const e=Jn(n,1);r=!(128&~e[0]),i=127&e[0],s=i<126?3:126===i?1:2}else if(1===s){if(Kn(n)<2)break;const e=Jn(n,2);i=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),s=3}else if(2===s){if(Kn(n)<8)break;const e=Jn(n,8),t=new DataView(e.buffer,e.byteOffset,e.length),r=t.getUint32(0);if(r>Math.pow(2,21)-1){a.enqueue(Rn);break}i=r*Math.pow(2,32)+t.getUint32(4),s=3}else{if(Kn(n)<i)break;const e=Jn(n,i);a.enqueue(Wn(r?e:Vn.decode(e),t)),s=0}if(0===i||i>e){a.enqueue(Rn);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),s=Gn();s.readable.pipeTo(e.writable),this._writer=s.writable.getWriter();const i=()=>{n.read().then((({done:e,value:t})=>{e||(this.onPacket(t),i())})).catch((e=>{}))};i();const r={type:"open"};this.query.sid&&(r.data=`{"sid":"${this.query.sid}"}`),this._writer.write(r).then((()=>this.onOpen()))}))}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;this._writer.write(n).then((()=>{s&&Zn((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends us{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=fs&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new hs(ms,this.uri(),e)}}},bs=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ks=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ws(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),s=e.indexOf("]");-1!=n&&-1!=s&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let i=bs.exec(e||""),r={},o=14;for(;o--;)r[ks[o]]=i[o]||"";return-1!=n&&-1!=s&&(r.source=t,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=function(e,t){const n=/\/{2,9}/g,s=t.replace(n,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||s.splice(0,1);"/"==t.slice(-1)&&s.splice(s.length-1,1);return s}(0,r.path),r.queryKey=function(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,s){t&&(n[t]=s)})),n}(0,r.query),r}const Ts="function"==typeof addEventListener&&"function"==typeof removeEventListener,js=[];Ts&&addEventListener("offline",(()=>{js.forEach((e=>e()))}),!1);class Ss extends Xn{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const n=ws(e);t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=ws(t.host).host);ss(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach((e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e})),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},n=e.split("&");for(let s=0,i=n.length;s<i;s++){let e=n[s].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),Ts&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},js.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);const e=this.opts.rememberUpgrade&&Ss.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(e=>this._onClose("transport close",e)))}onOpen(){this.readyState="open",Ss.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn((()=>{this._onClose("ping timeout")}),e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(e+="string"==typeof(t=s)?function(e){let t=0,n=0;for(let s=0,i=e.length;s<i;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}(t):Math.ceil(1.33*(t.byteLength||t.size))),n>0&&e>this._maxPayload)return this.writeBuffer.slice(0,n);e+=2}var t;return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Zn((()=>{this._onClose("ping timeout")}),this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,s){if("function"==typeof t&&(s=t,t=void 0),"function"==typeof n&&(s=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;(n=n||{}).compress=!1!==n.compress;const i={type:e,data:t,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}_onError(e){if(Ss.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Ts&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=js.indexOf(this._offlineEventListener);-1!==e&&js.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Ss.protocol=4;class Cs extends Ss{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;Ss.priorWebsocketSuccess=!1;const s=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Ss.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(c(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function i(){n||(n=!0,c(),t.close(),t=null)}const r=e=>{const n=new Error("probe error: "+e);n.transport=t.name,i(),this.emitReserved("upgradeError",n)};function o(){r("transport closed")}function a(){r("socket closed")}function l(e){t&&e.name!==t.name&&i()}const c=()=>{t.removeListener("open",s),t.removeListener("error",r),t.removeListener("close",o),this.off("close",a),this.off("upgrading",l)};t.once("open",s),t.once("error",r),t.once("close",o),this.once("close",a),this.once("upgrading",l),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{n||t.open()}),200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}let Es=class extends Cs{constructor(e,t={}){const n="object"==typeof e?e:t;(!n.transports||n.transports&&"string"==typeof n.transports[0])&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map((e=>vs[e])).filter((e=>!!e))),super(e,n)}};const _s="function"==typeof ArrayBuffer,Is=Object.prototype.toString,Ls="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Is.call(Blob),Ds="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===Is.call(File);function Rs(e){return _s&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||Ls&&e instanceof Blob||Ds&&e instanceof File}function Os(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(Os(e[t]))return!0;return!1}if(Rs(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Os(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Os(e[n]))return!0;return!1}function Ms(e){const t=[],n=e.data,s=e;return s.data=As(n,t),s.attachments=t.length,{packet:s,buffers:t}}function As(e,t){if(!e)return e;if(Rs(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=As(e[s],t);return n}if("object"==typeof e&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=As(e[s],t));return n}return e}function Ps(e,t){return e.data=zs(e.data,t),delete e.attachments,e}function zs(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=zs(e[n],t);else if("object"==typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=zs(e[n],t));return e}const Bs=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var $s,Fs;(Fs=$s||($s={}))[Fs.CONNECT=0]="CONNECT",Fs[Fs.DISCONNECT=1]="DISCONNECT",Fs[Fs.EVENT=2]="EVENT",Fs[Fs.ACK=3]="ACK",Fs[Fs.CONNECT_ERROR=4]="CONNECT_ERROR",Fs[Fs.BINARY_EVENT=5]="BINARY_EVENT",Fs[Fs.BINARY_ACK=6]="BINARY_ACK";function Hs(e){return"[object Object]"===Object.prototype.toString.call(e)}class Ns extends Xn{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===$s.BINARY_EVENT;n||t.type===$s.BINARY_ACK?(t.type=n?$s.EVENT:$s.ACK,this.reconstructor=new Ws(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!Rs(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===$s[n.type])throw new Error("unknown packet type "+n.type);if(n.type===$s.BINARY_EVENT||n.type===$s.BINARY_ACK){const s=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const i=e.substring(s,t);if(i!=Number(i)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===e.charAt(t+1)){const s=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}n.nsp=e.substring(s,t)}else n.nsp="/";const s=e.charAt(t+1);if(""!==s&&Number(s)==s){const s=t+1;for(;++t;){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(!Ns.isPayloadValid(n.type,s))throw new Error("invalid payload");n.data=s}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(jn){return!1}}static isPayloadValid(e,t){switch(e){case $s.CONNECT:return Hs(t);case $s.DISCONNECT:return void 0===t;case $s.CONNECT_ERROR:return"string"==typeof t||Hs(t);case $s.EVENT:case $s.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===Bs.indexOf(t[0]));case $s.ACK:case $s.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ws{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Ps(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const qs=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Ns,Encoder:class{constructor(e){this.replacer=e}encode(e){return e.type!==$s.EVENT&&e.type!==$s.ACK||!Os(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===$s.EVENT?$s.BINARY_EVENT:$s.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==$s.BINARY_EVENT&&e.type!==$s.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Ms(e),n=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(n),s}},get PacketType(){return $s},protocol:5},Symbol.toStringTag,{value:"Module"}));function Us(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Ys=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Gs extends Xn{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Us(e,"open",this.onopen.bind(this)),Us(e,"packet",this.onpacket.bind(this)),Us(e,"error",this.onerror.bind(this)),Us(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var n,s,i;if(Ys.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const r={type:$s.EVENT,data:t,options:{}};if(r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,n=t.pop();this._registerAckCallback(e,n),r.id=e}const o=null===(s=null===(n=this.io.engine)||void 0===n?void 0:n.transport)||void 0===s?void 0:s.writable,a=this.connected&&!(null===(i=this.io.engine)||void 0===i?void 0:i._hasPingExpired());return this.flags.volatile&&!o||(a?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var n;const s=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===s)return void(this.acks[e]=t);const i=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),s),r=(...e)=>{this.io.clearTimeoutFn(i),t.apply(this,e)};r.withError=!0,this.acks[e]=r}emitWithAck(e,...t){return new Promise(((n,s)=>{const i=(e,t)=>e?s(e):n(t);i.withError=!0,t.push(i),this.emit(e,...t)}))}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push(((e,...s)=>{if(n!==this._queue[0])return;return null!==e?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...s)),n.pending=!1,this._drainQueue()})),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this._sendConnectPacket(e)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:$s.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((e=>{if(!this.sendBuffer.some((t=>String(t.id)===e))){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}}))}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case $s.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case $s.EVENT:case $s.BINARY_EVENT:this.onevent(e);break;case $s.ACK:case $s.BINARY_ACK:this.onack(e);break;case $s.DISCONNECT:this.ondisconnect();break;case $s.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...s){n||(n=!0,t.packet({type:$s.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:$s.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Vs(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Vs.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+n:e-n}return 0|Math.min(e,this.max)},Vs.prototype.reset=function(){this.attempts=0},Vs.prototype.setMin=function(e){this.ms=e},Vs.prototype.setMax=function(e){this.max=e},Vs.prototype.setJitter=function(e){this.jitter=e};class Ks extends Xn{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,ss(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new Vs({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||qs;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Es(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=Us(t,"open",(function(){n.onopen(),e&&e()})),i=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},r=Us(t,"error",i);if(!1!==this._timeout){const e=this._timeout,n=this.setTimeoutFn((()=>{s(),i(new Error("timeout")),t.close()}),e);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}return this.subs.push(s),this.subs.push(r),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Us(e,"ping",this.onping.bind(this)),Us(e,"data",this.ondata.bind(this)),Us(e,"error",this.onerror.bind(this)),Us(e,"close",this.onclose.bind(this)),Us(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(jn){this.onclose("parse error",jn)}}ondecoded(e){Zn((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Gs(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t){if(this.nsps[n].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),null===(n=this.engine)||void 0===n||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((()=>{this.clearTimeoutFn(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Js={};function Xs(e,t){"object"==typeof e&&(t=e,e=void 0);const n=function(e,t="",n){let s=e;n=n||"undefined"!=typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==n?n.protocol+"//"+e:"https://"+e),s=ws(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const i=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+i+":"+s.port+t,s.href=s.protocol+"://"+i+(n&&n.port===s.port?"":":"+s.port),s}(e,(t=t||{}).path||"/socket.io"),s=n.source,i=n.id,r=n.path,o=Js[i]&&r in Js[i].nsps;let a;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?a=new Ks(s,t):(Js[i]||(Js[i]=new Ks(s,t)),a=Js[i]),n.query&&!t.query&&(t.query=n.queryKey),a.socket(n.path,t)}Object.assign(Xs,{Manager:Ks,Socket:Gs,io:Xs,connect:Xs});const Zs=n.createContext(null),Qs=({children:e})=>{const[t,i]=n.useState(null),[r,o]=n.useState([]),[a,l]=n.useState(!1),[c,d]=n.useState([]),{setUpdates:u,addContainer:h}=Ad();n.useEffect((()=>{var e;const t=r[r.length-1];t&&t.context&&t.context.UPDATES&&u((e=>[...e,...t.context.UPDATES])),t&&t.context&&(null==(e=t.context)?void 0:e.component)&&h(t.context.component,t.context.params)}),[a]),n.useEffect((()=>{const e=Xs("/chat",{transports:["websocket"]});return e.on("connect",(()=>{e.emit("request_messages")})),e.on("all_messages",(e=>{o(e)})),e.on("message",(e=>{o((t=>[...t,e])),l(!0)})),e.on("disconnect",(()=>{})),i(e),()=>{e.disconnect()}}),[]);return s.jsx(Zs.Provider,{value:{messages:r,isNewMessage:a,setIsNewMessage:l,sendMessage:async function(e){return new Promise(((n,s)=>{t?(t.emit("new_message",e),t.on("message",(async e=>{if(e.error)s(new Error(e.error));else try{n(e)}catch(t){s(t)}}))):s(new Error("Socket is not connected"))}))},sendMessageAPI:async function(e,t,n){const s=(new Date).getTimezoneOffset();n||(n=c);const i=new FormData;i.append("user_id",e),i.append("text",t),i.append("timeZone",s),n.forEach(((e,t)=>{i.append(`files[${t}]`,e)}));const r=await fetch("/chat/new_message",{method:"POST",body:i}),a=await r.json();if(201!=a.status_code)throw new Error("Message sending failed");d([]),o((e=>[...e,...a.messages])),l(!0)},sendTranscript:function(e){const n=(new Date).getTimezoneOffset();if(t)try{const s={...e,timeZone:n};t.emit("new_transcript",s)}catch(s){}},sendEditedRecord:e=>{const n=(new Date).getTimezoneOffset();return new Promise(((s,i)=>{if(!t)return void i(new Error("Socket is not connected"));const r=setTimeout((()=>{i(new Error("Server timeout"))}),5e3);t.emit("post_edited_record",e,n),t.on("post_edited_record_response",(e=>{clearTimeout(r),"OK"===e.status?s(e):i(new Error(e.message||"An unexpected error occurred"))}))}))},files:c,setFiles:d},children:e})};Qs.propTypes={children:m.node.isRequired};const ei=()=>n.useContext(Zs),ti=y((e=>{const{...t}=e;return s.jsx(r,{...t})}))((({theme:e,expand:t})=>({transform:t?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})})));function ni({message:e,message_time:t}){const[o,l]=n.useState(!1),{user:c,text:d,files:h,params:f}=e,{user_name:m,avatar_src:x}=c,y=`/avatars/${x}`,[L,D]=n.useState(f),[R,O]=n.useState(!1),[M,A]=n.useState(!1),{sendEditedRecord:P}=ei(),[z,B]=n.useState(!1);return s.jsxs(v,{sx:{width:"90%",mb:.5,border:R?`2px solid ${b[500]}`:"none",boxShadow:2},children:[s.jsx(k,{avatar:s.jsx(T,{sx:{bgcolor:b[500]},"aria-label":"avatar",children:x?s.jsx("img",{src:y,alt:"avatar",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%"}}):m.charAt(0).toUpperCase()}),action:s.jsx(r,{"aria-label":"settings",children:s.jsx(w,{children:"more_vert"})}),title:m,subheader:t}),h&&s.jsx(i,{sx:{mb:1},children:s.jsx(In,{url:h})}),s.jsx(j,{children:s.jsx(u,{variant:"body2",color:"text.secondary",children:d})}),s.jsx(S,{disableSpacing:!0,children:f&&s.jsx(ti,{expand:o?"true":void 0,onClick:function(){l(!o)},"aria-expanded":o,"aria-label":"show more",children:s.jsx(C,{})})}),f&&s.jsx(E,{in:o,timeout:"auto",unmountOnExit:!0,children:s.jsxs(j,{children:[Object.keys(f).map((e=>"id"!==e&&"date"!==e&&"files"!==e&&"time"!==e&&"table_name"!==e&&s.jsx("div",{style:{marginBottom:"1rem"},children:s.jsx(a,{id:e+"_message_id",label:e,multiline:!0,maxRows:15,fullWidth:!0,value:L[e]||"",onChange:t=>function(e,t){D((n=>({...n,[e]:t})))}(e,t.target.value)})},e))),M?s.jsx(g,{size:24}):s.jsx(p,{onClick:async function(){O(!1),A(!0);try{await P(L),B(!0)}catch(e){O(e.message||"An unexpected error occurred")}finally{A(!1)}},disabled:M,children:"Отправить"}),R&&s.jsx("p",{style:{color:"red"},children:R}),z&&s.jsx(_,{icon:s.jsx(I,{fontSize:"inherit"}),severity:"success",children:"Запись обновлена"})]})})]})}ni.propTypes={message_time:m.string.isRequired,message:m.shape({message_id:m.string,user:m.shape({user_name:m.string.isRequired,avatar_src:m.string}).isRequired,files:m.string,text:m.string.isRequired,params:m.object}).isRequired,error:m.shape({text:m.string,code:m.string})};function si(e){return()=>e}function ii(e){e()}function ri(e,t){return n=>e(t(n))}function oi(e,t){return()=>e(t)}function ai(e){return void 0!==e}function li(){}function ci(e,t){return t(e),e}function di(e,t){return t(e)}function ui(...e){return e}function hi(e,t){return e(1,t)}function pi(e,t){e(0,t)}function fi(e){e(2)}function mi(e){return e(4)}function gi(e,t){return hi(e,function(e,t){return n=>e(t,n)}(t,0))}function xi(e,t){const n=e(1,(e=>{n(),t(e)}));return n}function yi(e){let t,n;return s=>i=>{t=i,n&&clearTimeout(n),n=setTimeout((()=>{s(t)}),e)}}function vi(e,t){return e===t}function bi(e=vi){let t;return n=>s=>{e(t,s)||(t=s,n(s))}}function ki(e){return t=>n=>{e(n)&&t(n)}}function wi(e){return t=>ri(t,e)}function Ti(e){return t=>()=>{t(e)}}function ji(e,...t){const n=function(...e){return t=>e.reduceRight(di,t)}(...t);return(t,s)=>{switch(t){case 2:return void fi(e);case 1:return hi(e,n(s))}}}function Si(e,t){return n=>s=>{n(t=e(t,s))}}function Ci(e){return t=>n=>{e>0?e--:t(n)}}function Ei(e){let t,n=null;return s=>i=>{n=i,!t&&(t=setTimeout((()=>{t=void 0,s(n)}),e))}}function _i(...e){const t=new Array(e.length);let n=0,s=null;const i=Math.pow(2,e.length)-1;return e.forEach(((e,r)=>{const o=Math.pow(2,r);hi(e,(e=>{const a=n;n|=o,t[r]=e,a!==i&&n===i&&s&&(s(),s=null)}))})),e=>r=>{const o=()=>{e([r].concat(t))};n===i?o():s=o}}function Ii(e){let t=e;const n=Di();return(e,s)=>{switch(e){case 0:t=s;break;case 1:s(t);break;case 4:return t}return n(e,s)}}function Li(e,t){return ci(Ii(t),(t=>gi(e,t)))}function Di(){const e=[];return(t,n)=>{switch(t){case 0:return void e.slice().forEach((e=>{e(n)}));case 2:return void e.splice(0,e.length);case 1:return e.push(n),()=>{const t=e.indexOf(n);t>-1&&e.splice(t,1)}}}}function Ri(e){return ci(Di(),(t=>gi(e,t)))}function Oi(e,t=[],{singleton:n}={singleton:!0}){return{constructor:e,dependencies:t,id:Mi(),singleton:n}}const Mi=()=>Symbol();function Ai(...e){const t=Di(),n=new Array(e.length);let s=0;const i=Math.pow(2,e.length)-1;return e.forEach(((e,r)=>{const o=Math.pow(2,r);hi(e,(e=>{n[r]=e,s|=o,s===i&&pi(t,n)}))})),function(e,r){switch(e){case 2:return void fi(t);case 1:return s===i&&r(n),hi(t,r)}}}function Pi(e,t=vi){return ji(e,bi(t))}function zi(...e){return function(t,n){switch(t){case 2:return;case 1:return function(...e){return()=>{e.map(ii)}}(...e.map((e=>hi(e,n))))}}}var Bi=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(Bi||{});const $i=Oi((()=>{const e=Ii(3);return{log:Ii(((t,n,s=1)=>{var i;null!=(i=(typeof globalThis>"u"?window:globalThis).VIRTUOSO_LOG_LEVEL)||mi(e)})),logLevel:e}}),[],{singleton:!0});function Fi(e,t,n){return Hi(e,t,n).callbackRef}function Hi(e,t,n){const s=L.useRef(null);let i=e=>{};const r=L.useMemo((()=>typeof ResizeObserver<"u"?new ResizeObserver((t=>{const s=()=>{const n=t[0].target;null!==n.offsetParent&&e(n)};n?s():requestAnimationFrame(s)})):null),[e,n]);return i=e=>{e&&t?(null==r||r.observe(e),s.current=e):(s.current&&(null==r||r.unobserve(s.current)),s.current=null)},{callbackRef:i,ref:s}}function Ni(e,t,n,s,i,r,o,a,l){const c=L.useCallback((n=>{const l=function(e,t,n,s){const i=e.length;if(0===i)return null;const r=[];for(let o=0;o<i;o++){const i=e.item(o);if(void 0===i.dataset.index)continue;const a=parseInt(i.dataset.index),l=parseFloat(i.dataset.knownSize),c=t(i,n);if(0===c&&s("Zero-sized element, this should not happen",{child:i},Bi.ERROR),c===l)continue;const d=r[r.length-1];0===r.length||d.size!==c||d.endIndex!==a-1?r.push({endIndex:a,size:c,startIndex:a}):r[r.length-1].endIndex++}return r}(n.children,t,a?"offsetWidth":"offsetHeight",i);let c=n.parentElement;for(;!c.dataset.virtuosoScroller;)c=c.parentElement;const d="window"===c.lastElementChild.dataset.viewportType;let u;d&&(u=c.ownerDocument.defaultView);const h=o?a?o.scrollLeft:o.scrollTop:d?a?u.scrollX||u.document.documentElement.scrollLeft:u.scrollY||u.document.documentElement.scrollTop:a?c.scrollLeft:c.scrollTop,p=o?a?o.scrollWidth:o.scrollHeight:d?a?u.document.documentElement.scrollWidth:u.document.documentElement.scrollHeight:a?c.scrollWidth:c.scrollHeight,f=o?a?o.offsetWidth:o.offsetHeight:d?a?u.innerWidth:u.innerHeight:a?c.offsetWidth:c.offsetHeight;s({scrollHeight:p,scrollTop:Math.max(h,0),viewportHeight:f}),null==r||r(a?Wi("column-gap",getComputedStyle(n).columnGap,i):Wi("row-gap",getComputedStyle(n).rowGap,i)),null!==l&&e(l)}),[e,t,i,r,o,s,a]);return Hi(c,n,l)}function Wi(e,t,n){return"normal"!==t&&!(null!=t&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Bi.WARN),"normal"===t?0:parseInt(null!=t?t:"0",10)}function qi(e,t,n){const s=L.useRef(null),i=L.useCallback((n=>{if(null==n||!n.offsetParent)return;const i=n.getBoundingClientRect(),r=i.width;let a,l;if(t){const e=t.getBoundingClientRect(),n=i.top-e.top;l=e.height-Math.max(0,n),a=n+t.scrollTop}else{const e=o.current.ownerDocument.defaultView;l=e.innerHeight-Math.max(0,i.top),a=i.top+e.scrollY}s.current={offsetTop:a,visibleHeight:l,visibleWidth:r},e(s.current)}),[e,t]),{callbackRef:r,ref:o}=Hi(i,!0,n),a=L.useCallback((()=>{i(o.current)}),[i,o]);return L.useEffect((()=>{var e;if(t){t.addEventListener("scroll",a);const e=new ResizeObserver((()=>{requestAnimationFrame(a)}));return e.observe(t),()=>{t.removeEventListener("scroll",a),e.unobserve(t)}}{const t=null==(e=o.current)?void 0:e.ownerDocument.defaultView;return null==t||t.addEventListener("scroll",a),null==t||t.addEventListener("resize",a),()=>{null==t||t.removeEventListener("scroll",a),null==t||t.removeEventListener("resize",a)}}}),[a,t,o]),r}const Ui=Oi((()=>{const e=Di(),t=Di(),n=Ii(0),s=Di(),i=Ii(0),r=Di(),o=Di(),a=Ii(0),l=Ii(0),c=Ii(0),d=Ii(0),u=Di(),h=Di(),p=Ii(!1),f=Ii(!1),m=Ii(!1);return gi(ji(e,wi((({scrollTop:e})=>e))),t),gi(ji(e,wi((({scrollHeight:e})=>e))),o),gi(t,i),{deviation:n,fixedFooterHeight:c,fixedHeaderHeight:l,footerHeight:d,headerHeight:a,horizontalDirection:f,scrollBy:h,scrollContainerState:e,scrollHeight:o,scrollingInProgress:p,scrollTo:u,scrollTop:t,skipAnimationFrameInResizeObserver:m,smoothScrollTargetReached:s,statefulScrollTop:i,viewportHeight:r}}),[],{singleton:!0}),Yi={lvl:0};function Gi(e,t){const n=e.length;if(0===n)return[];let{index:s,value:i}=t(e[0]);const r=[];for(let o=1;o<n;o++){const{index:n,value:a}=t(e[o]);r.push({end:n-1,start:s,value:i}),s=n,i=a}return r.push({end:1/0,start:s,value:i}),r}function Vi(e){return e===Yi}function Ki(e,t){if(!Vi(e))return t===e.k?e.v:t<e.k?Ki(e.l,t):Ki(e.r,t)}function Ji(e,t,n="k"){if(Vi(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const s=Ji(e.r,t,n);return s[0]===-1/0?[e.k,e.v]:s}return Ji(e.l,t,n)}function Xi(e,t,n){return Vi(e)?lr(t,n,1):t===e.k?ir(e,{k:t,v:n}):t<e.k?cr(ir(e,{l:Xi(e.l,t,n)})):cr(ir(e,{r:Xi(e.r,t,n)}))}function Zi(){return Yi}function Qi(e,t,n){if(Vi(e))return[];return function(e){return Gi(e,(({k:e,v:t})=>({index:e,value:t})))}(nr(e,Ji(e,t)[0],n))}function er(e,t){if(Vi(e))return Yi;const{k:n,l:s,r:i}=e;if(t===n){if(Vi(s))return i;if(Vi(i))return s;{const[t,n]=ar(s);return sr(ir(e,{k:t,l:rr(s),v:n}))}}return sr(ir(e,t<n?{l:er(s,t)}:{r:er(i,t)}))}function tr(e){return Vi(e)?[]:[...tr(e.l),{k:e.k,v:e.v},...tr(e.r)]}function nr(e,t,n){if(Vi(e))return[];const{k:s,l:i,r:r,v:o}=e;let a=[];return s>t&&(a=a.concat(nr(i,t,n))),s>=t&&s<=n&&a.push({k:s,v:o}),s<=n&&(a=a.concat(nr(r,t,n))),a}function sr(e){const{l:t,lvl:n,r:s}=e;if(s.lvl>=n-1&&t.lvl>=n-1)return e;if(n>s.lvl+1){if(or(t))return dr(ir(e,{lvl:n-1}));if(!Vi(t)&&!Vi(t.r))return ir(t.r,{l:ir(t,{r:t.r.l}),lvl:n,r:ir(e,{l:t.r.r,lvl:n-1})});throw new Error("Unexpected empty nodes")}if(or(e))return ur(ir(e,{lvl:n-1}));if(Vi(s)||Vi(s.l))throw new Error("Unexpected empty nodes");{const t=s.l,i=or(t)?s.lvl-1:s.lvl;return ir(t,{l:ir(e,{lvl:n-1,r:t.l}),lvl:t.lvl+1,r:ur(ir(s,{l:t.r,lvl:i}))})}}function ir(e,t){return lr(void 0!==t.k?t.k:e.k,void 0!==t.v?t.v:e.v,void 0!==t.lvl?t.lvl:e.lvl,void 0!==t.l?t.l:e.l,void 0!==t.r?t.r:e.r)}function rr(e){return Vi(e.r)?e.l:sr(ir(e,{r:rr(e.r)}))}function or(e){return Vi(e)||e.lvl>e.r.lvl}function ar(e){return Vi(e.r)?[e.k,e.v]:ar(e.r)}function lr(e,t,n,s=Yi,i=Yi){return{k:e,l:s,lvl:n,r:i,v:t}}function cr(e){return ur(dr(e))}function dr(e){const{l:t}=e;return Vi(t)||t.lvl!==e.lvl?e:ir(t,{r:ir(e,{l:t.r})})}function ur(e){const{lvl:t,r:n}=e;return Vi(n)||Vi(n.r)||n.lvl!==t||n.r.lvl!==t?e:ir(n,{l:ir(e,{r:n.l}),lvl:t+1})}function hr(e,t){return!(!e||e.startIndex!==t.startIndex||e.endIndex!==t.endIndex)}function pr(e,t){return!(!e||e[0]!==t[0]||e[1]!==t[1])}const fr=Oi((()=>({recalcInProgress:Ii(!1)})),[],{singleton:!0});function mr(e,t,n){return e[gr(e,t,n)]}function gr(e,t,n,s=0){let i=e.length-1;for(;s<=i;){const r=Math.floor((s+i)/2),o=n(e[r],t);if(0===o)return r;if(-1===o){if(i-s<2)return r-1;i=r-1}else{if(i===s)return r;s=r+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function xr(e,t){return Math.round(e.getBoundingClientRect()[t])}function yr(e){return!Vi(e.groupOffsetTree)}function vr({index:e},t){return t===e?0:t<e?-1:1}function br({offset:e},t){return t===e?0:t<e?-1:1}function kr(e,t,n){if(0===t.length)return 0;const{index:s,offset:i,size:r}=mr(t,e,vr),o=e-s,a=r*o+(o-1)*n+i;return a>0?a+n:a}function wr(e,t){if(!yr(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function Tr(e,t,n){if(function(e){return typeof e.groupIndex<"u"}(e))return t.groupIndices[e.groupIndex]+1;{let s=wr("LAST"===e.index?n:e.index,t);return s=Math.max(0,s,Math.min(n,s)),s}}function jr(e,t,n,s=0){return s>0&&(t=Math.max(t,mr(e,s,vr).offset)),Gi(function(e,t,n,s){const i=gr(e,t,s),r=gr(e,n,s,i);return e.slice(i,r+1)}(e,t,n,br),_r)}function Sr(e,[t,n,s,i]){t.length>0&&s("received item sizes",t,Bi.DEBUG);const r=e.sizeTree;let o=r,a=0;if(n.length>0&&Vi(r)&&2===t.length){const e=t[0].size,s=t[1].size;o=n.reduce(((t,n)=>Xi(Xi(t,n,e),n+1,s)),o)}else[o,a]=function(e,t){let n=Vi(e)?0:1/0;for(const s of t){const{endIndex:t,size:i,startIndex:r}=s;if(n=Math.min(n,r),Vi(e)){e=Xi(e,0,i);continue}const o=Qi(e,r-1,t+1);if(o.some(Ir(s)))continue;let a=!1,l=!1;for(const{end:n,start:s,value:c}of o)a?(t>=s||i===c)&&(e=er(e,s)):(l=c!==i,a=!0),n>t&&t>=s&&c!==i&&(e=Xi(e,t+1,c));l&&(e=Xi(e,r,i))}return[e,n]}(o,t);if(o===r)return e;const{lastIndex:l,lastOffset:c,lastSize:d,offsetTree:u}=Er(e.offsetTree,a,o,i);return{groupIndices:n,groupOffsetTree:n.reduce(((e,t)=>Xi(e,t,kr(t,u,i))),Zi()),lastIndex:l,lastOffset:c,lastSize:d,offsetTree:u,sizeTree:o}}function Cr(e,t){let n=0,s=0;for(;n<e;)n+=t[s+1]-t[s]-1,s++;return s-(n===e?0:1)}function Er(e,t,n,s){let i=e,r=0,o=0,a=0,l=0;if(0!==t){l=gr(i,t-1,vr),a=i[l].offset;const e=Ji(n,t-1);r=e[0],o=e[1],i.length&&i[l].size===Ji(n,t)[1]&&(l-=1),i=i.slice(0,l+1)}else i=[];for(const{start:c,value:d}of Qi(n,t,1/0)){const e=c-r,t=e*o+a+e*s;i.push({index:c,offset:t,size:d}),r=c,a=t,o=d}return{lastIndex:r,lastOffset:a,lastSize:o,offsetTree:i}}function _r(e){return{index:e.index,value:e}}function Ir(e){const{endIndex:t,size:n,startIndex:s}=e;return e=>e.start===s&&(e.end===t||e.end===1/0)&&e.value===n}const Lr={offsetHeight:"height",offsetWidth:"width"},Dr=Oi((([{log:e},{recalcInProgress:t}])=>{const n=Di(),s=Di(),i=Li(s,0),r=Di(),o=Di(),a=Ii(0),l=Ii([]),c=Ii(void 0),d=Ii(void 0),u=Ii(((e,t)=>xr(e,Lr[t]))),h=Ii(void 0),p=Ii(0),f={groupIndices:[],groupOffsetTree:Zi(),lastIndex:0,lastOffset:0,lastSize:0,offsetTree:[],sizeTree:Zi()},m=Li(ji(n,_i(l,e,p),Si(Sr,f),bi()),f),g=Li(ji(l,bi(),Si(((e,t)=>({current:t,prev:e.current})),{current:[],prev:[]}),wi((({prev:e})=>e))),[]);gi(ji(l,ki((e=>e.length>0)),_i(m,p),wi((([e,t,n])=>{const s=e.reduce(((e,s,i)=>Xi(e,s,kr(s,t.offsetTree,n)||i)),Zi());return{...t,groupIndices:e,groupOffsetTree:s}}))),m),gi(ji(s,_i(m),ki((([e,{lastIndex:t}])=>e<t)),wi((([e,{lastIndex:t,lastSize:n}])=>[{endIndex:t,size:n,startIndex:e}]))),n),gi(c,d);const x=Li(ji(c,wi((e=>void 0===e))),!0);gi(ji(d,ki((e=>void 0!==e&&Vi(mi(m).sizeTree))),wi((e=>[{endIndex:0,size:e,startIndex:0}]))),n);const y=Ri(ji(n,_i(m),Si((({sizes:e},[t,n])=>({changed:n!==e,sizes:n})),{changed:!1,sizes:f}),wi((e=>e.changed))));hi(ji(a,Si(((e,t)=>({diff:e.prev-t,prev:t})),{diff:0,prev:0}),wi((e=>e.diff))),(e=>{const{groupIndices:n}=mi(m);if(e>0)pi(t,!0),pi(r,e+Cr(e,n));else if(e<0){const t=mi(g);t.length>0&&(e-=Cr(-e,t)),pi(o,e)}})),hi(ji(a,_i(e)),(([e,t])=>{e<0&&t("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:a},Bi.ERROR)}));const v=Ri(r);gi(ji(r,_i(m),wi((([e,t])=>{const n=t.groupIndices.length>0,s=[],i=t.lastSize;if(n){const n=Ki(t.sizeTree,0);let r=0,o=0;for(;r<e;){const e=t.groupIndices[o],a=t.groupIndices.length===o+1?1/0:t.groupIndices[o+1]-e-1;s.push({endIndex:e,size:n,startIndex:e}),s.push({endIndex:e+1+a-1,size:i,startIndex:e+1}),o++,r+=a+1}const a=tr(t.sizeTree);return r!==e&&a.shift(),a.reduce(((t,{k:n,v:s})=>{let i=t.ranges;return 0!==t.prevSize&&(i=[...t.ranges,{endIndex:n+e-1,size:t.prevSize,startIndex:t.prevIndex}]),{prevIndex:n+e,prevSize:s,ranges:i}}),{prevIndex:e,prevSize:0,ranges:s}).ranges}return tr(t.sizeTree).reduce(((t,{k:n,v:s})=>({prevIndex:n+e,prevSize:s,ranges:[...t.ranges,{endIndex:n+e-1,size:t.prevSize,startIndex:t.prevIndex}]})),{prevIndex:0,prevSize:i,ranges:[]}).ranges}))),n);const b=Ri(ji(o,_i(m,p),wi((([e,{offsetTree:t},n])=>kr(-e,t,n)))));return gi(ji(o,_i(m,p),wi((([e,t,n])=>{if(t.groupIndices.length>0){if(Vi(t.sizeTree))return t;let s=Zi();const i=mi(g);let r=0,o=0,a=0;for(;r<-e;){a=i[o];const e=i[o+1]-a-1;o++,r+=e+1}if(s=tr(t.sizeTree).reduce(((t,{k:n,v:s})=>Xi(t,Math.max(0,n+e),s)),s),r!==-e){s=Xi(s,0,Ki(t.sizeTree,a));s=Xi(s,1,Ji(t.sizeTree,1-e)[1])}return{...t,sizeTree:s,...Er(t.offsetTree,0,s,n)}}{const s=tr(t.sizeTree).reduce(((t,{k:n,v:s})=>Xi(t,Math.max(0,n+e),s)),Zi());return{...t,sizeTree:s,...Er(t.offsetTree,0,s,n)}}}))),m),{beforeUnshiftWith:v,data:h,defaultItemSize:d,firstItemIndex:a,fixedItemSize:c,gap:p,groupIndices:l,itemSize:u,listRefresh:y,shiftWith:o,shiftWithOffset:b,sizeRanges:n,sizes:m,statefulTotalCount:i,totalCount:s,trackItemSizes:x,unshiftWith:r}}),ui($i,fr),{singleton:!0});function Rr(e){return e.reduce(((e,t)=>(e.groupIndices.push(e.totalCount),e.totalCount+=t+1,e)),{groupIndices:[],totalCount:0})}const Or=Oi((([{groupIndices:e,sizes:t,totalCount:n},{headerHeight:s,scrollTop:i}])=>{const r=Di(),o=Di(),a=Ri(ji(r,wi(Rr)));return gi(ji(a,wi((e=>e.totalCount))),n),gi(ji(a,wi((e=>e.groupIndices))),e),gi(ji(Ai(i,t,s),ki((([e,t])=>yr(t))),wi((([e,t,n])=>Ji(t.groupOffsetTree,Math.max(e-n,0),"v")[0])),bi(),wi((e=>[e]))),o),{groupCounts:r,topItemsIndexes:o}}),ui(Dr,Ui)),Mr=Oi((([{log:e}])=>{const t=Ii(!1),n=Ri(ji(t,ki((e=>e)),bi()));return hi(t,(t=>{t&&mi(e)("props updated",{},Bi.DEBUG)})),{didMount:n,propsReady:t}}),ui($i),{singleton:!0}),Ar=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function Pr(e){const t="number"==typeof e?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!Ar)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const zr=Oi((([{gap:e,listRefresh:t,sizes:n,totalCount:s},{fixedFooterHeight:i,fixedHeaderHeight:r,footerHeight:o,headerHeight:a,scrollingInProgress:l,scrollTo:c,smoothScrollTargetReached:d,viewportHeight:u},{log:h}])=>{const p=Di(),f=Di(),m=Ii(0);let g=null,x=null,y=null;function v(){g&&(g(),g=null),y&&(y(),y=null),x&&(clearTimeout(x),x=null),pi(l,!1)}return gi(ji(p,_i(n,u,s,m,a,o,h),_i(e,r,i),wi((([[e,n,s,i,r,o,a,c],u,h,m])=>{const b=Pr(e),{align:k,behavior:w,offset:T}=b,j=i-1,S=Tr(b,n,j);let C=kr(S,n.offsetTree,u)+o;"end"===k?(C+=h+Ji(n.sizeTree,S)[1]-s+m,S===j&&(C+=a)):"center"===k?C+=(h+Ji(n.sizeTree,S)[1]-s+m)/2:C-=r,T&&(C+=T);const E=t=>{v(),t?(c("retrying to scroll to",{location:e},Bi.DEBUG),pi(p,e)):(pi(f,!0),c("list did not change, scroll successful",{},Bi.DEBUG))};if(v(),"smooth"===w){let e=!1;y=hi(t,(t=>{e=e||t})),g=xi(d,(()=>{E(e)}))}else g=xi(ji(t,function(e){return t=>{const n=setTimeout((()=>{t(!1)}),e);return e=>{e&&(t(!0),clearTimeout(n))}}}(150)),E);return x=setTimeout((()=>{v()}),1200),pi(l,!0),c("scrolling from index to",{behavior:w,index:S,top:C},Bi.DEBUG),{behavior:w,top:C}}))),c),{scrollTargetReached:f,scrollToIndex:p,topListHeight:m}}),ui(Dr,Ui,$i),{singleton:!0});function Br(e,t){0==e?t():requestAnimationFrame((()=>{Br(e-1,t)}))}function $r(e,t){const n=t-1;return"number"==typeof e?e:"LAST"===e.index?n:e.index}const Fr=Oi((([{defaultItemSize:e,listRefresh:t,sizes:n},{scrollTop:s},{scrollTargetReached:i,scrollToIndex:r},{didMount:o}])=>{const a=Ii(!0),l=Ii(0),c=Ii(!0);return gi(ji(o,_i(l),ki((([e,t])=>!!t)),Ti(!1)),a),gi(ji(o,_i(l),ki((([e,t])=>!!t)),Ti(!1)),c),hi(ji(Ai(t,o),_i(a,n,e,c),ki((([[,e],t,{sizeTree:n},s,i])=>e&&(!Vi(n)||ai(s))&&!t&&!i)),_i(l)),(([,e])=>{xi(i,(()=>{pi(c,!0)})),Br(4,(()=>{xi(s,(()=>{pi(a,!0)})),pi(r,e)}))})),{initialItemFinalLocationReached:c,initialTopMostItemIndex:l,scrolledToInitialItem:a}}),ui(Dr,Ui,zr,Mr),{singleton:!0});function Hr(e,t){return Math.abs(e-t)<1.01}const Nr="up",Wr="down",qr={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollHeight:0,scrollTop:0,viewportHeight:0}},Ur=Oi((([{footerHeight:e,headerHeight:t,scrollBy:n,scrollContainerState:s,scrollTop:i,viewportHeight:r}])=>{const o=Ii(!1),a=Ii(!0),l=Di(),c=Di(),d=Ii(4),u=Ii(0),h=Li(ji(zi(ji(Pi(i),Ci(1),Ti(!0)),ji(Pi(i),Ci(1),Ti(!1),yi(100))),bi()),!1),p=Li(ji(zi(ji(n,Ti(!0)),ji(n,Ti(!1),yi(200))),bi()),!1);gi(ji(Ai(Pi(i),Pi(u)),wi((([e,t])=>e<=t)),bi()),a),gi(ji(a,Ei(50)),c);const f=Ri(ji(Ai(s,Pi(r),Pi(t),Pi(e),Pi(d)),Si(((e,[{scrollHeight:t,scrollTop:n},s,i,r,o])=>{const a={scrollHeight:t,scrollTop:n,viewportHeight:s};if(n+s-t>-o){let t,s;return n>e.state.scrollTop?(t="SCROLLED_DOWN",s=e.state.scrollTop-n):(t="SIZE_DECREASED",s=e.state.scrollTop-n||e.scrollTopDelta),{atBottom:!0,atBottomBecause:t,scrollTopDelta:s,state:a}}let l;return l=a.scrollHeight>e.state.scrollHeight?"SIZE_INCREASED":s<e.state.viewportHeight?"VIEWPORT_HEIGHT_DECREASING":n<e.state.scrollTop?"SCROLLING_UPWARDS":"NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:l,state:a}}),qr),bi(((e,t)=>e&&e.atBottom===t.atBottom)))),m=Li(ji(s,Si(((e,{scrollHeight:t,scrollTop:n,viewportHeight:s})=>{if(Hr(e.scrollHeight,t))return{changed:!1,jump:0,scrollHeight:t,scrollTop:n};{const i=t-(n+s)<1;return e.scrollTop!==n&&i?{changed:!0,jump:e.scrollTop-n,scrollHeight:t,scrollTop:n}:{changed:!0,jump:0,scrollHeight:t,scrollTop:n}}}),{changed:!1,jump:0,scrollHeight:0,scrollTop:0}),ki((e=>e.changed)),wi((e=>e.jump))),0);gi(ji(f,wi((e=>e.atBottom))),o),gi(ji(o,Ei(50)),l);const g=Ii(Wr);gi(ji(s,wi((({scrollTop:e})=>e)),bi(),Si(((e,t)=>mi(p)?{direction:e.direction,prevScrollTop:t}:{direction:t<e.prevScrollTop?Nr:Wr,prevScrollTop:t}),{direction:Wr,prevScrollTop:0}),wi((e=>e.direction))),g),gi(ji(s,Ei(50),Ti("none")),g);const x=Ii(0);return gi(ji(h,ki((e=>!e)),Ti(0)),x),gi(ji(i,Ei(100),_i(h),ki((([e,t])=>!!t)),Si((([e,t],[n])=>[t,n]),[0,0]),wi((([e,t])=>t-e))),x),{atBottomState:f,atBottomStateChange:l,atBottomThreshold:d,atTopStateChange:c,atTopThreshold:u,isAtBottom:o,isAtTop:a,isScrolling:h,lastJumpDueToItemResize:m,scrollDirection:g,scrollVelocity:x}}),ui(Ui)),Yr="top",Gr="bottom",Vr="none";function Kr(e,t,n){return"number"==typeof e?n===Nr&&t===Yr||n===Wr&&t===Gr?e:0:n===Nr?t===Yr?e.main:e.reverse:t===Gr?e.main:e.reverse}function Jr(e,t){var n;return"number"==typeof e?e:null!=(n=e[t])?n:0}const Xr=Oi((([{deviation:e,fixedHeaderHeight:t,headerHeight:n,scrollTop:s,viewportHeight:i}])=>{const r=Di(),o=Ii(0),a=Ii(0),l=Ii(0);return{increaseViewportBy:a,listBoundary:r,overscan:l,topListHeight:o,visibleRange:Li(ji(Ai(Pi(s),Pi(i),Pi(n),Pi(r,pr),Pi(l),Pi(o),Pi(t),Pi(e),Pi(a)),wi((([e,t,n,[s,i],r,o,a,l,c])=>{const d=e-l,u=o+a,h=Math.max(n-d,0);let p=Vr;const f=Jr(c,Yr),m=Jr(c,Gr);return s-=l,i+=n+a,(s+=n+a)>e+u-f&&(p=Nr),(i-=l)<e-h+t+m&&(p=Wr),p!==Vr?[Math.max(d-n-Kr(r,Yr,p)-f,0),d-h-a+t+Kr(r,Gr,p)+m]:null})),ki((e=>null!=e)),bi(pr)),[0,0])}}),ui(Ui),{singleton:!0});const Zr={bottom:0,firstItemIndex:0,items:[],offsetBottom:0,offsetTop:0,top:0,topItems:[],topListHeight:0,totalCount:0};function Qr(e,t,n,s,i,r){const{lastIndex:o,lastOffset:a,lastSize:l}=i;let c=0,d=0;if(e.length>0){c=e[0].offset;const t=e[e.length-1];d=t.offset+t.size}const u=n-o,h=c,p=a+u*l+(u-1)*s-d;return{bottom:d,firstItemIndex:r,items:to(e,i,r),offsetBottom:p,offsetTop:c,top:h,topItems:to(t,i,r),topListHeight:t.reduce(((e,t)=>t.size+e),0),totalCount:n}}function eo(e,t,n,s,i,r){let o=0;if(n.groupIndices.length>0)for(const c of n.groupIndices){if(c-o>=e)break;o++}const a=e+o,l=$r(t,a);return Qr(Array.from({length:a}).map(((e,t)=>({data:r[t+l],index:t+l,offset:0,size:0}))),[],a,i,n,s)}function to(e,t,n){if(0===e.length)return[];if(!yr(t))return e.map((e=>({...e,index:e.index+n,originalIndex:e.index})));const s=e[0].index,i=e[e.length-1].index,r=[],o=Qi(t.groupOffsetTree,s,i);let a,l=0;for(const c of e){let e;(!a||a.end<c.index)&&(a=o.shift(),l=t.groupIndices.indexOf(a.start)),e=c.index===a.start?{index:l,type:"group"}:{groupIndex:l,index:c.index-(l+1)+n},r.push({...e,data:c.data,offset:c.offset,originalIndex:c.index,size:c.size})}return r}const no=Oi((([{data:e,firstItemIndex:t,gap:n,sizes:s,totalCount:i},r,{listBoundary:o,topListHeight:a,visibleRange:l},{initialTopMostItemIndex:c,scrolledToInitialItem:d},{topListHeight:u},h,{didMount:p},{recalcInProgress:f}])=>{const m=Ii([]),g=Ii(0),x=Di();gi(r.topItemsIndexes,m);const y=Li(ji(Ai(p,f,Pi(l,pr),Pi(i),Pi(s),Pi(c),d,Pi(m),Pi(t),Pi(n),e),ki((([e,t,,n,,,,,,,s])=>{const i=s&&s.length!==n;return e&&!t&&!i})),wi((([,,[e,t],n,s,i,r,o,a,l,c])=>{const d=s,{offsetTree:u,sizeTree:h}=d,p=mi(g);if(0===n)return{...Zr,totalCount:n};if(0===e&&0===t)return 0===p?{...Zr,totalCount:n}:eo(p,i,s,a,l,c||[]);if(Vi(h))return p>0?null:Qr(function(e,t,n){if(yr(t)){const s=wr(e,t);return[{index:Ji(t.groupOffsetTree,s)[0],offset:0,size:0},{data:null==n?void 0:n[0],index:s,offset:0,size:0}]}return[{data:null==n?void 0:n[0],index:e,offset:0,size:0}]}($r(i,n),d,c),[],n,l,d,a);const f=[];if(o.length>0){const e=o[0],t=o[o.length-1];let n=0;for(const s of Qi(h,e,t)){const i=s.value,r=Math.max(s.start,e),o=Math.min(s.end,t);for(let e=r;e<=o;e++)f.push({data:null==c?void 0:c[e],index:e,offset:n,size:i}),n+=i}}if(!r)return Qr([],f,n,l,d,a);const m=o.length>0?o[o.length-1]+1:0,x=jr(u,e,t,m);if(0===x.length)return null;const y=n-1;return Qr(ci([],(n=>{for(const s of x){const i=s.value;let r=i.offset,o=s.start;const a=i.size;if(i.offset<e){o+=Math.floor((e-i.offset+l)/(a+l));const t=o-s.start;r+=t*a+t*l}o<m&&(r+=(m-o)*a,o=m);const d=Math.min(s.end,y);for(let e=o;e<=d&&!(r>=t);e++)n.push({data:null==c?void 0:c[e],index:e,offset:r,size:a}),r+=a+l}})),f,n,l,d,a)})),ki((e=>null!==e)),bi()),Zr);gi(ji(e,ki(ai),wi((e=>null==e?void 0:e.length))),i),gi(ji(y,wi((e=>e.topListHeight))),u),gi(u,a),gi(ji(y,wi((e=>[e.top,e.bottom]))),o),gi(ji(y,wi((e=>e.items))),x);const v=Ri(ji(y,ki((({items:e})=>e.length>0)),_i(i,e),ki((([{items:e},t])=>e[e.length-1].originalIndex===t-1)),wi((([,e,t])=>[e-1,t])),bi(pr),wi((([e])=>e)))),b=Ri(ji(y,Ei(200),ki((({items:e,topItems:t})=>e.length>0&&e[0].originalIndex===t.length)),wi((({items:e})=>e[0].index)),bi())),k=Ri(ji(y,ki((({items:e})=>e.length>0)),wi((({items:e})=>{let t=0,n=e.length-1;for(;"group"===e[t].type&&t<n;)t++;for(;"group"===e[n].type&&n>t;)n--;return{endIndex:e[n].index,startIndex:e[t].index}})),bi(hr)));return{endReached:v,initialItemCount:g,itemsRendered:x,listState:y,rangeChanged:k,startReached:b,topItemsIndexes:m,...h}}),ui(Dr,Or,Xr,Fr,zr,Ur,Mr,fr),{singleton:!0}),so=Oi((([{fixedFooterHeight:e,fixedHeaderHeight:t,footerHeight:n,headerHeight:s},{listState:i}])=>{const r=Di(),o=Li(ji(Ai(n,e,s,t,i),wi((([e,t,n,s,i])=>e+t+n+s+i.offsetBottom+i.bottom))),0);return gi(Pi(o),r),{totalListHeight:o,totalListHeightChanged:r}}),ui(Ui,no),{singleton:!0}),io=Oi((([{viewportHeight:e},{totalListHeight:t}])=>{const n=Ii(!1);return{alignToBottom:n,paddingTopAddition:Li(ji(Ai(n,e,t),ki((([e])=>e)),wi((([,e,t])=>Math.max(0,e-t))),Ei(0),bi()),0)}}),ui(Ui,so),{singleton:!0});function ro(e){return!!e&&("smooth"===e?"smooth":"auto")}const oo=Oi((([{listRefresh:e,totalCount:t},{atBottomState:n,isAtBottom:s},{scrollToIndex:i},{scrolledToInitialItem:r},{didMount:o,propsReady:a},{log:l},{scrollingInProgress:c}])=>{const d=Ii(!1),u=Di();let h=null;function p(e){pi(i,{align:"end",behavior:e,index:"LAST"})}function f(e){const t=xi(n,(t=>{e&&!t.atBottom&&"SIZE_INCREASED"===t.notAtBottomBecause&&!h&&(mi(l)("scrolling to bottom due to increased size",{},Bi.DEBUG),p("auto"))}));setTimeout(t,100)}return hi(ji(Ai(ji(Pi(t),Ci(1)),o),_i(Pi(d),s,r,c),wi((([[e,t],n,s,i,r])=>{let o=t&&i,a="auto";return o&&(a=((e,t)=>"function"==typeof e?ro(e(t)):t&&ro(e))(n,s||r),o=o&&!!a),{followOutputBehavior:a,shouldFollow:o,totalCount:e}})),ki((({shouldFollow:e})=>e))),(({followOutputBehavior:t,totalCount:n})=>{h&&(h(),h=null),h=xi(e,(()=>{mi(l)("following output to ",{totalCount:n},Bi.DEBUG),p(t),h=null}))})),hi(ji(Ai(Pi(d),t,a),ki((([e,,t])=>e&&t)),Si((({value:e},[,t])=>({refreshed:e===t,value:t})),{refreshed:!1,value:0}),ki((({refreshed:e})=>e)),_i(d,t)),(([,e])=>{mi(r)&&f(!1!==e)})),hi(u,(()=>{f(!1!==mi(d))})),hi(Ai(Pi(d),n),(([e,t])=>{e&&!t.atBottom&&"VIEWPORT_HEIGHT_DECREASING"===t.notAtBottomBecause&&p("auto")})),{autoscrollToBottom:u,followOutput:d}}),ui(Dr,Ur,zr,Fr,Mr,$i,Ui)),ao=Oi((([{data:e,firstItemIndex:t,gap:n,sizes:s},{initialTopMostItemIndex:i},{initialItemCount:r,listState:o},{didMount:a}])=>(gi(ji(a,_i(r),ki((([,e])=>0!==e)),_i(i,s,t,n,e),wi((([[,e],t,n,s,i,r=[]])=>eo(e,t,n,s,i,r)))),o),{})),ui(Dr,Fr,no,Mr),{singleton:!0}),lo=Oi((([{didMount:e},{scrollTo:t},{listState:n}])=>{const s=Ii(0);return hi(ji(e,_i(s),ki((([,e])=>0!==e)),wi((([,e])=>({top:e})))),(e=>{xi(ji(n,Ci(1),ki((e=>e.items.length>1))),(()=>{requestAnimationFrame((()=>{pi(t,e)}))}))})),{initialScrollTop:s}}),ui(Mr,Ui,no),{singleton:!0}),co=({itemBottom:e,itemTop:t,locationParams:{align:n,behavior:s,...i},viewportBottom:r,viewportTop:o})=>t<o?{...i,align:null!=n?n:"start",behavior:s}:e>r?{...i,align:null!=n?n:"end",behavior:s}:null,uo=Oi((([{gap:e,sizes:t,totalCount:n},{fixedFooterHeight:s,fixedHeaderHeight:i,headerHeight:r,scrollingInProgress:o,scrollTop:a,viewportHeight:l},{scrollToIndex:c}])=>{const d=Di();return gi(ji(d,_i(t,l,n,r,i,s,a),_i(e),wi((([[e,t,n,s,i,r,a,l],c])=>{const{align:d,behavior:u,calculateViewLocation:h=co,done:p,...f}=e,m=Tr(e,t,s-1),g=kr(m,t.offsetTree,c)+i+r,x=h({itemBottom:g+Ji(t.sizeTree,m)[1],itemTop:g,locationParams:{align:d,behavior:u,...f},viewportBottom:l+n-a,viewportTop:l+r});return x?p&&xi(ji(o,ki((e=>!e)),Ci(mi(o)?1:2)),p):p&&p(),x})),ki((e=>null!==e))),c),{scrollIntoView:d}}),ui(Dr,Ui,zr,no,$i),{singleton:!0}),ho=Oi((([{scrollVelocity:e}])=>{const t=Ii(!1),n=Di(),s=Ii(!1);return gi(ji(e,_i(s,t,n),ki((([e,t])=>!!t)),wi((([e,t,n,s])=>{const{enter:i,exit:r}=t;if(n){if(r(e,s))return!1}else if(i(e,s))return!0;return n})),bi()),t),hi(ji(Ai(t,e,n),_i(s)),(([[e,t,n],s])=>{e&&s&&s.change&&s.change(t,n)})),{isSeeking:t,scrollSeekConfiguration:s,scrollSeekRangeChanged:n,scrollVelocity:e}}),ui(Ur),{singleton:!0}),po=Oi((([{scrollContainerState:e,scrollTo:t}])=>{const n=Di(),s=Di(),i=Di(),r=Ii(!1),o=Ii(void 0);return gi(ji(Ai(n,s),wi((([{scrollHeight:e,scrollTop:t,viewportHeight:n},{offsetTop:s}])=>({scrollHeight:e,scrollTop:Math.max(0,t-s),viewportHeight:n})))),e),gi(ji(t,_i(s),wi((([e,{offsetTop:t}])=>({...e,top:e.top+t})))),i),{customScrollParent:o,useWindowScroll:r,windowScrollContainerState:n,windowScrollTo:i,windowViewportRect:s}}),ui(Ui)),fo=Oi((([{sizeRanges:e,sizes:t},{headerHeight:n,scrollTop:s},{initialTopMostItemIndex:i},{didMount:r},{useWindowScroll:o,windowScrollContainerState:a,windowViewportRect:l}])=>{const c=Di(),d=Ii(void 0),u=Ii(null),h=Ii(null);return gi(a,u),gi(l,h),hi(ji(c,_i(t,s,o,u,h,n)),(([e,t,n,s,i,r,o])=>{const a=function(e){return tr(e).map((({k:e,v:t},n,s)=>{const i=s[n+1];return{endIndex:i?i.k-1:1/0,size:t,startIndex:e}}))}(t.sizeTree);s&&null!==i&&null!==r&&(n=i.scrollTop-r.offsetTop),e({ranges:a,scrollTop:n-=o})})),gi(ji(d,ki(ai),wi(mo)),i),gi(ji(r,_i(d),ki((([,e])=>void 0!==e)),bi(),wi((([,e])=>e.ranges))),e),{getState:c,restoreStateFrom:d}}),ui(Dr,Ui,Fr,Mr,po));function mo(e){return{align:"start",index:0,offset:e.scrollTop}}const go=Oi((([{topItemsIndexes:e}])=>{const t=Ii(0);return gi(ji(t,ki((e=>e>=0)),wi((e=>Array.from({length:e}).map(((e,t)=>t))))),e),{topItemCount:t}}),ui(no));function xo(e){let t,n=!1;return()=>(n||(n=!0,t=e()),t)}const yo=xo((()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent))),vo=Oi((([{deviation:e,scrollBy:t,scrollingInProgress:n,scrollTop:s},{isAtBottom:i,isScrolling:r,lastJumpDueToItemResize:o,scrollDirection:a},{listState:l},{beforeUnshiftWith:c,gap:d,shiftWithOffset:u,sizes:h},{log:p},{recalcInProgress:f}])=>{const m=Ri(ji(l,_i(o),Si((([,e,t,n],[{bottom:s,items:i,offsetBottom:r,totalCount:o},a])=>{const l=s+r;let c=0;return t===o&&e.length>0&&i.length>0&&(0===i[0].originalIndex&&0===e[0].originalIndex||(c=l-n,0!==c&&(c+=a))),[c,i,o,l]}),[0,[],0,0]),ki((([e])=>0!==e)),_i(s,a,n,i,p,f),ki((([,e,t,n,,,s])=>!s&&!n&&0!==e&&t===Nr)),wi((([[e],,,,,t])=>(t("Upward scrolling compensation",{amount:e},Bi.DEBUG),e)))));function g(n){n>0?(pi(t,{behavior:"auto",top:-n}),pi(e,0)):(pi(e,0),pi(t,{behavior:"auto",top:-n}))}return hi(ji(m,_i(e,r)),(([t,n,s])=>{s&&yo()?pi(e,n-t):g(-t)})),hi(ji(Ai(Li(r,!1),e,f),ki((([e,t,n])=>!e&&!n&&0!==t)),wi((([e,t])=>t)),Ei(1)),g),gi(ji(u,wi((e=>({top:-e})))),t),hi(ji(c,_i(h,d),wi((([e,{groupIndices:t,lastSize:n,sizeTree:s},i])=>{function r(e){return e*(n+i)}if(0===t.length)return r(e);{let n=0;const i=Ki(s,0);let o=0,a=0;for(;o<e;){o++,n+=i;let s=t.length===a+1?1/0:t[a+1]-t[a]-1;o+s>e&&(n-=i,s=e-o+1),o+=s,n+=r(s),a++}return n}}))),(n=>{pi(e,n),requestAnimationFrame((()=>{pi(t,{top:n}),requestAnimationFrame((()=>{pi(e,0),pi(f,!1)}))}))})),{deviation:e}}),ui(Ui,Ur,no,Dr,$i,fr)),bo=Oi((([e,t,n,s,i,r,o,a,l,c])=>({...e,...t,...n,...s,...i,...r,...o,...a,...l,...c})),ui(Xr,ao,Mr,ho,so,lo,io,po,uo,$i)),ko=Oi((([{data:e,defaultItemSize:t,firstItemIndex:n,fixedItemSize:s,gap:i,groupIndices:r,itemSize:o,sizeRanges:a,sizes:l,statefulTotalCount:c,totalCount:d,trackItemSizes:u},{initialItemFinalLocationReached:h,initialTopMostItemIndex:p,scrolledToInitialItem:f},m,g,x,{listState:y,topItemsIndexes:v,...b},{scrollToIndex:k},w,{topItemCount:T},{groupCounts:j},S])=>(gi(b.rangeChanged,S.scrollSeekRangeChanged),gi(ji(S.windowViewportRect,wi((e=>e.visibleHeight))),m.viewportHeight),{data:e,defaultItemHeight:t,firstItemIndex:n,fixedItemHeight:s,gap:i,groupCounts:j,initialItemFinalLocationReached:h,initialTopMostItemIndex:p,scrolledToInitialItem:f,sizeRanges:a,topItemCount:T,topItemsIndexes:v,totalCount:d,...x,groupIndices:r,itemSize:o,listState:y,scrollToIndex:k,statefulTotalCount:c,trackItemSizes:u,...b,...S,...m,sizes:l,...g})),ui(Dr,Fr,Ui,fo,oo,no,zr,vo,go,Or,bo));function wo(e,t){const n={},s={};let i=0;const r=e.length;for(;i<r;)s[e[i]]=1,i+=1;for(const o in t)Object.hasOwn(s,o)||(n[o]=t[o]);return n}const To=typeof document<"u"?L.useLayoutEffect:L.useEffect;function jo(e,t,n){const i=Object.keys(t.required||{}),r=Object.keys(t.optional||{}),o=Object.keys(t.methods||{}),a=Object.keys(t.events||{}),l=L.createContext({});function c(e,n){e.propsReady&&pi(e.propsReady,!1);for(const s of i){pi(e[t.required[s]],n[s])}for(const s of r)if(s in n){pi(e[t.optional[s]],n[s])}e.propsReady&&pi(e.propsReady,!0)}function d(e){return a.reduce(((n,s)=>(n[s]=function(e){let t,n;const s=()=>null==t?void 0:t();return function(i,r){switch(i){case 1:return r?n===r?void 0:(s(),n=r,t=hi(e,r),t):(s(),li);case 2:return s(),void(n=null)}}}(e[t.events[s]]),n)),{})}const u=L.forwardRef(((u,h)=>{const{children:p,...f}=u,[m]=L.useState((()=>ci(function(e){const t=new Map,n=({constructor:e,dependencies:s,id:i,singleton:r})=>{if(r&&t.has(i))return t.get(i);const o=e(s.map((e=>n(e))));return r&&t.set(i,o),o};return n(e)}(e),(e=>{c(e,f)})))),[g]=L.useState(oi(d,m));To((()=>{for(const e of a)e in f&&hi(g[e],f[e]);return()=>{Object.values(g).map(fi)}}),[f,g,m]),To((()=>{c(m,f)})),L.useImperativeHandle(h,si(function(e){return o.reduce(((n,s)=>(n[s]=n=>{pi(e[t.methods[s]],n)},n)),{})}(m)));const x=n;return s.jsx(l.Provider,{value:m,children:n?s.jsx(x,{...wo([...i,...r,...a],f),children:p}):p})}));return{Component:u,useEmitter:(e,t)=>{const n=L.useContext(l)[e];To((()=>hi(n,t)),[t,n])},useEmitterValue:L.version.startsWith("18")?e=>{const t=L.useContext(l)[e],n=L.useCallback((e=>hi(t,e)),[t]);return L.useSyncExternalStore(n,(()=>mi(t)),(()=>mi(t)))}:e=>{const t=L.useContext(l)[e],[n,s]=L.useState(oi(mi,t));return To((()=>hi(t,(e=>{e!==n&&s(si(e))}))),[t,n]),n},usePublisher:e=>{const t=L.useContext(l);return L.useCallback((n=>{pi(t[e],n)}),[t,e])}}}const So=L.createContext(void 0),Co=L.createContext(void 0),Eo=typeof document<"u"?L.useLayoutEffect:L.useEffect;function _o(e){return"self"in e}function Io(e,t,n,s=li,i,r){const o=L.useRef(null),a=L.useRef(null),l=L.useRef(null),c=L.useCallback((n=>{let s,i,o;const c=n.target;if(function(e){return"body"in e}(c)||_o(c)){const e=_o(c)?c:c.defaultView;o=r?e.scrollX:e.scrollY,s=r?e.document.documentElement.scrollWidth:e.document.documentElement.scrollHeight,i=r?e.innerWidth:e.innerHeight}else o=r?c.scrollLeft:c.scrollTop,s=r?c.scrollWidth:c.scrollHeight,i=r?c.offsetWidth:c.offsetHeight;const d=()=>{e({scrollHeight:s,scrollTop:Math.max(o,0),viewportHeight:i})};n.suppressFlushSync?d():D.flushSync(d),null!==a.current&&(o===a.current||o<=0||o===s-i)&&(a.current=null,t(!0),l.current&&(clearTimeout(l.current),l.current=null))}),[e,t,r]);return L.useEffect((()=>{const e=i||o.current;return s(i||o.current),c({suppressFlushSync:!0,target:e}),e.addEventListener("scroll",c,{passive:!0}),()=>{s(null),e.removeEventListener("scroll",c)}}),[o,c,n,s,i]),{scrollByCallback:function(e){r&&(e={behavior:e.behavior,left:e.top}),o.current.scrollBy(e)},scrollerRef:o,scrollToCallback:function(n){const s=o.current;if(!s||(r?"offsetWidth"in s&&0===s.offsetWidth:"offsetHeight"in s&&0===s.offsetHeight))return;const i="smooth"===n.behavior;let c,d,u;_o(s)?(d=Math.max(xr(s.document.documentElement,r?"width":"height"),r?s.document.documentElement.scrollWidth:s.document.documentElement.scrollHeight),c=r?s.innerWidth:s.innerHeight,u=r?window.scrollX:window.scrollY):(d=s[r?"scrollWidth":"scrollHeight"],c=xr(s,r?"width":"height"),u=s[r?"scrollLeft":"scrollTop"]);const h=d-c;if(n.top=Math.ceil(Math.max(Math.min(h,n.top),0)),Hr(c,d)||n.top===u)return e({scrollHeight:d,scrollTop:u,viewportHeight:c}),void(i&&t(!0));i?(a.current=n.top,l.current&&clearTimeout(l.current),l.current=setTimeout((()=>{l.current=null,a.current=null,t(!0)}),1e3)):a.current=null,r&&(n={behavior:n.behavior,left:n.top}),s.scrollTo(n)}}}const Lo="-webkit-sticky",Do="sticky",Ro=xo((()=>{if(typeof document>"u")return Do;const e=document.createElement("div");return e.style.position=Lo,e.style.position===Lo?Lo:Do}));function Oo(e){return e}const Mo=Oi((()=>{const e=Ii((e=>`Item ${e}`)),t=Ii(null),n=Ii((e=>`Group ${e}`)),s=Ii({}),i=Ii(Oo),r=Ii("div"),o=Ii(li),a=(e,t=null)=>Li(ji(s,wi((t=>t[e])),bi()),t);return{components:s,computeItemKey:i,context:t,EmptyPlaceholder:a("EmptyPlaceholder"),FooterComponent:a("Footer"),GroupComponent:a("Group","div"),groupContent:n,HeaderComponent:a("Header"),HeaderFooterTag:r,ItemComponent:a("Item","div"),itemContent:e,ListComponent:a("List","div"),ScrollerComponent:a("Scroller","div"),scrollerRef:o,ScrollSeekPlaceholder:a("ScrollSeekPlaceholder"),TopItemListComponent:a("TopItemList")}})),Ao=Oi((([e,t])=>({...e,...t})),ui(ko,Mo)),Po=({height:e})=>s.jsx("div",{style:{height:e}}),zo={overflowAnchor:"none",position:Ro(),zIndex:1},Bo={overflowAnchor:"none"},$o={...Bo,display:"inline-block",height:"100%"},Fo=L.memo((function({showTopList:e=!1}){const t=sa("listState"),i=ia("sizeRanges"),r=sa("useWindowScroll"),o=sa("customScrollParent"),a=ia("windowScrollContainerState"),l=ia("scrollContainerState"),c=o||r?a:l,d=sa("itemContent"),u=sa("context"),h=sa("groupContent"),p=sa("trackItemSizes"),f=sa("itemSize"),m=sa("log"),g=ia("gap"),x=sa("horizontalDirection"),{callbackRef:y}=Ni(i,f,p,e?li:c,m,g,o,x,sa("skipAnimationFrameInResizeObserver")),[v,b]=L.useState(0);na("deviation",(e=>{v!==e&&b(e)}));const k=sa("EmptyPlaceholder"),w=sa("ScrollSeekPlaceholder")||Po,T=sa("ListComponent"),j=sa("ItemComponent"),S=sa("GroupComponent"),C=sa("computeItemKey"),E=sa("isSeeking"),_=sa("groupIndices").length>0,I=sa("alignToBottom"),D=sa("initialItemFinalLocationReached"),R=e?{}:{boxSizing:"border-box",...x?{display:"inline-block",height:"100%",marginLeft:0!==v?v:I?"auto":0,paddingLeft:t.offsetTop,paddingRight:t.offsetBottom,whiteSpace:"nowrap"}:{marginTop:0!==v?v:I?"auto":0,paddingBottom:t.offsetBottom,paddingTop:t.offsetTop},...D?{}:{visibility:"hidden"}};return!e&&0===t.totalCount&&k?s.jsx(k,{...Uo(k,u)}):s.jsx(T,{...Uo(T,u),"data-testid":e?"virtuoso-top-item-list":"virtuoso-item-list",ref:y,style:R,children:(e?t.topItems:t.items).map((e=>{const s=e.originalIndex,i=C(s+t.firstItemIndex,e.data,u);return E?n.createElement(w,{...Uo(w,u),height:e.size,index:e.index,key:i,type:e.type||"item",..."group"===e.type?{}:{groupIndex:e.groupIndex}}):"group"===e.type?n.createElement(S,{...Uo(S,u),"data-index":s,"data-item-index":e.index,"data-known-size":e.size,key:i,style:zo},h(e.index,u)):n.createElement(j,{...Uo(j,u),...Yo(j,e.data),"data-index":s,"data-item-group-index":e.groupIndex,"data-item-index":e.index,"data-known-size":e.size,key:i,style:x?$o:Bo},_?d(e.index,e.groupIndex,e.data,u):d(e.index,e.data,u))}))})})),Ho={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},No={outline:"none",overflowX:"auto",position:"relative"},Wo=e=>({height:"100%",position:"absolute",top:0,width:"100%",...e?{display:"flex",flexDirection:"column"}:{}}),qo={position:Ro(),top:0,width:"100%",zIndex:1};function Uo(e,t){if("string"!=typeof e)return{context:t}}function Yo(e,t){return{item:"string"==typeof e?void 0:t}}const Go=L.memo((function(){const e=sa("HeaderComponent"),t=ia("headerHeight"),n=sa("HeaderFooterTag"),i=Fi(L.useMemo((()=>e=>{t(xr(e,"height"))}),[t]),!0,sa("skipAnimationFrameInResizeObserver")),r=sa("context");return e?s.jsx(n,{ref:i,children:s.jsx(e,{...Uo(e,r)})}):null})),Vo=L.memo((function(){const e=sa("FooterComponent"),t=ia("footerHeight"),n=sa("HeaderFooterTag"),i=Fi(L.useMemo((()=>e=>{t(xr(e,"height"))}),[t]),!0,sa("skipAnimationFrameInResizeObserver")),r=sa("context");return e?s.jsx(n,{ref:i,children:s.jsx(e,{...Uo(e,r)})}):null}));function Ko({useEmitter:e,useEmitterValue:t,usePublisher:n}){return L.memo((function({children:i,style:r,...o}){const a=n("scrollContainerState"),l=t("ScrollerComponent"),c=n("smoothScrollTargetReached"),d=t("scrollerRef"),u=t("context"),h=t("horizontalDirection")||!1,{scrollByCallback:p,scrollerRef:f,scrollToCallback:m}=Io(a,c,l,d,void 0,h);return e("scrollTo",m),e("scrollBy",p),s.jsx(l,{"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,ref:f,style:{...h?No:Ho,...r},tabIndex:0,...o,...Uo(l,u),children:i})}))}function Jo({useEmitter:e,useEmitterValue:t,usePublisher:n}){return L.memo((function({children:i,style:r,...o}){const a=n("windowScrollContainerState"),l=t("ScrollerComponent"),c=n("smoothScrollTargetReached"),d=t("totalListHeight"),u=t("deviation"),h=t("customScrollParent"),p=t("context"),f=L.useRef(null),m=t("scrollerRef"),{scrollByCallback:g,scrollerRef:x,scrollToCallback:y}=Io(a,c,l,m,h);return Eo((()=>{var e;return x.current=h||(null==(e=f.current)?void 0:e.ownerDocument.defaultView),()=>{x.current=null}}),[x,h]),e("windowScrollTo",y),e("scrollBy",g),s.jsx(l,{ref:f,"data-virtuoso-scroller":!0,style:{position:"relative",...r,...0!==d?{height:d+u}:{}},...o,...Uo(l,p),children:i})}))}const Xo=({children:e})=>{const t=L.useContext(So),n=ia("viewportHeight"),i=ia("fixedItemHeight"),r=sa("alignToBottom"),o=sa("horizontalDirection"),a=Fi(L.useMemo((()=>ri(n,(e=>xr(e,o?"width":"height")))),[n,o]),!0,sa("skipAnimationFrameInResizeObserver"));return L.useEffect((()=>{t&&(n(t.viewportHeight),i(t.itemHeight))}),[t,n,i]),s.jsx("div",{"data-viewport-type":"element",ref:a,style:Wo(r),children:e})},Zo=({children:e})=>{const t=L.useContext(So),n=ia("windowViewportRect"),i=ia("fixedItemHeight"),r=sa("customScrollParent"),o=qi(n,r,sa("skipAnimationFrameInResizeObserver")),a=sa("alignToBottom");return L.useEffect((()=>{t&&(i(t.itemHeight),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))}),[t,n,i]),s.jsx("div",{"data-viewport-type":"window",ref:o,style:Wo(a),children:e})},Qo=({children:e})=>{const t=sa("TopItemListComponent")||"div",n=sa("headerHeight"),i={...qo,marginTop:`${n}px`},r=sa("context");return s.jsx(t,{style:i,...Uo(t,r),children:e})},ea=L.memo((function(e){const t=sa("useWindowScroll"),n=sa("topItemsIndexes").length>0,i=sa("customScrollParent"),r=sa("context"),o=i||t?oa:ra,a=i||t?Zo:Xo;return s.jsxs(o,{...e,...Uo(o,r),children:[n&&s.jsx(Qo,{children:s.jsx(Fo,{showTopList:!0})}),s.jsxs(a,{children:[s.jsx(Go,{}),s.jsx(Fo,{}),s.jsx(Vo,{})]})]})})),{Component:ta,useEmitter:na,useEmitterValue:sa,usePublisher:ia}=jo(Ao,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedItemHeight:"fixedItemHeight",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},ea),ra=Ko({useEmitter:na,useEmitterValue:sa,usePublisher:ia}),oa=Jo({useEmitter:na,useEmitterValue:sa,usePublisher:ia}),aa=ta,la=Oi((()=>{const e=Ii((e=>s.jsxs("td",{children:["Item $",e]}))),t=Ii(null),n=Ii(null),i=Ii(null),r=Ii({}),o=Ii(Oo),a=Ii(li),l=(e,t=null)=>Li(ji(r,wi((t=>t[e])),bi()),t);return{components:r,computeItemKey:o,context:t,EmptyPlaceholder:l("EmptyPlaceholder"),FillerRow:l("FillerRow"),fixedFooterContent:i,fixedHeaderContent:n,itemContent:e,ScrollerComponent:l("Scroller","div"),scrollerRef:a,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder"),TableBodyComponent:l("TableBody","tbody"),TableComponent:l("Table","table"),TableFooterComponent:l("TableFoot","tfoot"),TableHeadComponent:l("TableHead","thead"),TableRowComponent:l("TableRow","tr")}}));ui(ko,la);const ca={bottom:0,itemHeight:0,items:[],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},da={bottom:0,itemHeight:0,items:[{index:0}],itemWidth:0,offsetBottom:0,offsetTop:0,top:0},{ceil:ua,floor:ha,max:pa,min:fa,round:ma}=Math;function ga(e,t,n){return Array.from({length:t-e+1}).map(((t,s)=>({data:null===n?null:n[s+e],index:s+e})))}function xa(e,t){return e&&e.width===t.width&&e.height===t.height}function ya(e,t){return e&&e.column===t.column&&e.row===t.row}const va=Oi((([{increaseViewportBy:e,listBoundary:t,overscan:n,visibleRange:s},{footerHeight:i,headerHeight:r,scrollBy:o,scrollContainerState:a,scrollTo:l,scrollTop:c,smoothScrollTargetReached:d,viewportHeight:u},h,p,{didMount:f,propsReady:m},{customScrollParent:g,useWindowScroll:x,windowScrollContainerState:y,windowScrollTo:v,windowViewportRect:b},k])=>{const w=Ii(0),T=Ii(0),j=Ii(ca),S=Ii({height:0,width:0}),C=Ii({height:0,width:0}),E=Di(),_=Di(),I=Ii(0),L=Ii(null),D=Ii({column:0,row:0}),R=Di(),O=Di(),M=Ii(!1),A=Ii(0),P=Ii(!0),z=Ii(!1),B=Ii(!1);hi(ji(f,_i(A),ki((([e,t])=>!!t))),(()=>{pi(P,!1)})),hi(ji(Ai(f,P,C,S,A,z),ki((([e,t,n,s,,i])=>e&&!t&&0!==n.height&&0!==s.height&&!i))),(([,,,,e])=>{pi(z,!0),Br(1,(()=>{pi(E,e)})),xi(ji(c),(()=>{pi(t,[0,0]),pi(P,!0)}))})),gi(ji(O,ki((e=>null!=e&&e.scrollTop>0)),Ti(0)),T),hi(ji(f,_i(O),ki((([,e])=>null!=e))),(([,e])=>{e&&(pi(S,e.viewport),pi(C,e.item),pi(D,e.gap),e.scrollTop>0&&(pi(M,!0),xi(ji(c,Ci(1)),(e=>{pi(M,!1)})),pi(l,{top:e.scrollTop})))})),gi(ji(S,wi((({height:e})=>e))),u),gi(ji(Ai(Pi(S,xa),Pi(C,xa),Pi(D,((e,t)=>e&&e.column===t.column&&e.row===t.row)),Pi(c)),wi((([e,t,n,s])=>({gap:n,item:t,scrollTop:s,viewport:e})))),R),gi(ji(Ai(Pi(w),s,Pi(D,ya),Pi(C,xa),Pi(S,xa),Pi(L),Pi(T),Pi(M),Pi(P),Pi(A)),ki((([,,,,,,,e])=>!e)),wi((([e,[t,n],s,i,r,o,a,,l,c])=>{const{column:d,row:u}=s,{height:h,width:p}=i,{width:f}=r;if(0===a&&(0===e||0===f))return ca;if(0===p){const t=$r(c,e);return function(e){return{...da,items:e}}(ga(t,t+Math.max(a-1,0),o))}const m=ba(f,p,d);let g,x;l?0===t&&0===n&&a>0?(g=0,x=a-1):(g=m*ha((t+u)/(h+u)),x=m*ua((n+u)/(h+u))-1,x=fa(e-1,pa(x,m-1)),g=fa(x,pa(0,g))):(g=0,x=-1);const y=ga(g,x,o),{bottom:v,top:b}=ka(r,s,i,y),k=ua(e/m);return{bottom:v,itemHeight:h,items:y,itemWidth:p,offsetBottom:k*h+(k-1)*u-v,offsetTop:b,top:b}}))),j),gi(ji(L,ki((e=>null!==e)),wi((e=>e.length))),w),gi(ji(Ai(S,C,j,D),ki((([e,t,{items:n}])=>n.length>0&&0!==t.height&&0!==e.height)),wi((([e,t,{items:n},s])=>{const{bottom:i,top:r}=ka(e,s,t,n);return[r,i]})),bi(pr)),t);const $=Ii(!1);gi(ji(c,_i($),wi((([e,t])=>t||0!==e))),$);const F=Ri(ji(Ai(j,w),ki((([{items:e}])=>e.length>0)),_i($),ki((([[e,t],n])=>{const s=e.items[e.items.length-1].index===t-1;return(n||e.bottom>0&&e.itemHeight>0&&0===e.offsetBottom&&e.items.length===t)&&s})),wi((([[,e]])=>e-1)),bi())),H=Ri(ji(Pi(j),ki((({items:e})=>e.length>0&&0===e[0].index)),Ti(0),bi())),N=Ri(ji(Pi(j),_i(M),ki((([{items:e},t])=>e.length>0&&!t)),wi((([{items:e}])=>({endIndex:e[e.length-1].index,startIndex:e[0].index}))),bi(hr),Ei(0)));gi(N,p.scrollSeekRangeChanged),gi(ji(E,_i(S,C,w,D),wi((([e,t,n,s,i])=>{const r=Pr(e),{align:o,behavior:a,offset:l}=r;let c=r.index;"LAST"===c&&(c=s-1),c=pa(0,c,fa(s-1,c));let d=wa(t,i,n,c);return"end"===o?d=ma(d-t.height+n.height):"center"===o&&(d=ma(d-t.height/2+n.height/2)),l&&(d+=l),{behavior:a,top:d}}))),l);const W=Li(ji(j,wi((e=>e.offsetBottom+e.bottom))),0);return gi(ji(b,wi((e=>({height:e.visibleHeight,width:e.visibleWidth})))),S),{customScrollParent:g,data:L,deviation:I,footerHeight:i,gap:D,headerHeight:r,increaseViewportBy:e,initialItemCount:T,itemDimensions:C,overscan:n,restoreStateFrom:O,scrollBy:o,scrollContainerState:a,scrollHeight:_,scrollTo:l,scrollToIndex:E,scrollTop:c,smoothScrollTargetReached:d,totalCount:w,useWindowScroll:x,viewportDimensions:S,windowScrollContainerState:y,windowScrollTo:v,windowViewportRect:b,...p,gridState:j,horizontalDirection:B,initialTopMostItemIndex:A,totalListHeight:W,...h,endReached:F,propsReady:m,rangeChanged:N,startReached:H,stateChanged:R,stateRestoreInProgress:M,...k}}),ui(Xr,Ui,Ur,ho,Mr,po,$i));function ba(e,t,n){return pa(1,ha((e+n)/(ha(t)+n)))}function ka(e,t,n,s){const{height:i}=n;if(void 0===i||0===s.length)return{bottom:0,top:0};const r=wa(e,t,n,s[0].index);return{bottom:wa(e,t,n,s[s.length-1].index)+i,top:r}}function wa(e,t,n,s){const i=ba(e.width,n.width,t.column),r=ha(s/i),o=r*n.height+pa(0,r-1)*t.row;return o>0?o+t.row:o}const Ta=Oi((()=>{const e=Ii((e=>`Item ${e}`)),t=Ii({}),n=Ii(null),s=Ii("virtuoso-grid-item"),i=Ii("virtuoso-grid-list"),r=Ii(Oo),o=Ii("div"),a=Ii(li),l=(e,n=null)=>Li(ji(t,wi((t=>t[e])),bi()),n),c=Ii(!1),d=Ii(!1);return gi(Pi(d),c),{components:t,computeItemKey:r,context:n,FooterComponent:l("Footer"),HeaderComponent:l("Header"),headerFooterTag:o,itemClassName:s,ItemComponent:l("Item","div"),itemContent:e,listClassName:i,ListComponent:l("List","div"),readyStateChanged:c,reportReadyState:d,ScrollerComponent:l("Scroller","div"),scrollerRef:a,ScrollSeekPlaceholder:l("ScrollSeekPlaceholder","div")}})),ja=Oi((([e,t])=>({...e,...t})),ui(va,Ta)),Sa=L.memo((function(){const e=Ra("gridState"),t=Ra("listClassName"),i=Ra("itemClassName"),r=Ra("itemContent"),o=Ra("computeItemKey"),a=Ra("isSeeking"),l=Oa("scrollHeight"),c=Ra("ItemComponent"),d=Ra("ListComponent"),u=Ra("ScrollSeekPlaceholder"),h=Ra("context"),p=Oa("itemDimensions"),f=Oa("gap"),m=Ra("log"),g=Ra("stateRestoreInProgress"),x=Oa("reportReadyState"),y=Fi(L.useMemo((()=>e=>{const t=e.parentElement.parentElement.scrollHeight;l(t);const n=e.firstChild;if(n){const{height:e,width:t}=n.getBoundingClientRect();p({height:e,width:t})}f({column:Pa("column-gap",getComputedStyle(e).columnGap,m),row:Pa("row-gap",getComputedStyle(e).rowGap,m)})}),[l,p,f,m]),!0,!1);return Eo((()=>{e.itemHeight>0&&e.itemWidth>0&&x(!0)}),[e]),g?null:s.jsx(d,{className:t,ref:y,...Uo(d,h),"data-testid":"virtuoso-item-list",style:{paddingBottom:e.offsetBottom,paddingTop:e.offsetTop},children:e.items.map((t=>{const l=o(t.index,t.data,h);return a?s.jsx(u,{...Uo(u,h),height:e.itemHeight,index:t.index,width:e.itemWidth},l):n.createElement(c,{...Uo(c,h),className:i,"data-index":t.index,key:l},r(t.index,t.data,h))}))})})),Ca=L.memo((function(){const e=Ra("HeaderComponent"),t=Oa("headerHeight"),n=Ra("headerFooterTag"),i=Fi(L.useMemo((()=>e=>{t(xr(e,"height"))}),[t]),!0,!1),r=Ra("context");return e?s.jsx(n,{ref:i,children:s.jsx(e,{...Uo(e,r)})}):null})),Ea=L.memo((function(){const e=Ra("FooterComponent"),t=Oa("footerHeight"),n=Ra("headerFooterTag"),i=Fi(L.useMemo((()=>e=>{t(xr(e,"height"))}),[t]),!0,!1),r=Ra("context");return e?s.jsx(n,{ref:i,children:s.jsx(e,{...Uo(e,r)})}):null})),_a=({children:e})=>{const t=L.useContext(Co),n=Oa("itemDimensions"),i=Oa("viewportDimensions"),r=Fi(L.useMemo((()=>e=>{i(e.getBoundingClientRect())}),[i]),!0,!1);return L.useEffect((()=>{t&&(i({height:t.viewportHeight,width:t.viewportWidth}),n({height:t.itemHeight,width:t.itemWidth}))}),[t,i,n]),s.jsx("div",{ref:r,style:Wo(!1),children:e})},Ia=({children:e})=>{const t=L.useContext(Co),n=Oa("windowViewportRect"),i=Oa("itemDimensions"),r=Ra("customScrollParent"),o=qi(n,r,!1);return L.useEffect((()=>{t&&(i({height:t.itemHeight,width:t.itemWidth}),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))}),[t,n,i]),s.jsx("div",{ref:o,style:Wo(!1),children:e})},La=L.memo((function({...e}){const t=Ra("useWindowScroll"),n=Ra("customScrollParent"),i=n||t?Aa:Ma,r=n||t?Ia:_a,o=Ra("context");return s.jsx(i,{...e,...Uo(i,o),children:s.jsxs(r,{children:[s.jsx(Ca,{}),s.jsx(Sa,{}),s.jsx(Ea,{})]})})})),{useEmitter:Da,useEmitterValue:Ra,usePublisher:Oa}=jo(ja,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex",increaseViewportBy:"increaseViewportBy"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},La),Ma=Ko({useEmitter:Da,useEmitterValue:Ra,usePublisher:Oa}),Aa=Jo({useEmitter:Da,useEmitterValue:Ra,usePublisher:Oa});function Pa(e,t,n){return"normal"!==t&&!(null!=t&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Bi.WARN),"normal"===t?0:parseInt(null!=t?t:"0",10)}function za(){const e=n.useRef(null),t=n.useRef(null),{messages:o,isNewMessage:a,setIsNewMessage:l}=ei(),{setIsSecretarySpeak:c}=Ad(),[d,u]=n.useState(!1),[h,p]=n.useState(!1),[f,m]=n.useState(0);function g(){if(d||h)return;const t=o[o.length-1];if(1===t.user.id)return;const n=`/temp/edge_audio_${t.message_id}.mp3`;e.current.src=n,e.current&&(d?(e.current.pause(),c(!1)):(e.current.play(),c(!0)),u(!d))}n.useEffect((()=>{a&&(l(!1),g())}),[o]),n.useEffect((()=>{function t(){if(e.current){const t=e.current.currentTime,n=e.current.duration;n>0&&m(t/n*100)}}const n=e.current;return n&&(n.addEventListener("timeupdate",t),n.addEventListener("ended",(()=>{u(!1),c(!1)}))),()=>{n&&(n.removeEventListener("timeupdate",t),n.removeEventListener("ended",(()=>{u(!1),c(!1)})))}}),[]),n.useEffect((()=>{t.current&&t.current.scrollToIndex({index:o.length-1,behavior:"smooth"})}),[o]);let x="";return s.jsxs(i,{sx:{height:"90%",display:"flex",flexDirection:"column"},children:[s.jsxs(i,{sx:{display:"flex",alignItems:"center",p:1},children:[s.jsx(r,{onClick:g,"aria-label":"play",children:h?s.jsx(w,{children:"hourglass_empty"}):d?s.jsx(w,{children:"pause"}):s.jsx(w,{children:"play_arrow"})}),s.jsx("audio",{ref:e,onCanPlay:()=>p(!1),onPlay:()=>u(!0),onPause:()=>u(!1),onEnded:()=>u(!1),onLoadStart:()=>p(!0)}),s.jsx(R,{variant:"determinate",value:f,style:{width:"100%"}})]}),s.jsx(i,{sx:{overflowY:"auto",p:1,flexGrow:1},children:s.jsx(aa,{ref:t,data:o,initialTopMostItemIndex:o.length-1,itemContent:(e,t)=>{const n=function(e){const t=new Date(e);return new Intl.DateTimeFormat("default",{year:"numeric",month:"long",day:"numeric"}).format(t)}(t.datetime),i=function(e){const t=new Date(e);return new Intl.DateTimeFormat("default",{hour:"2-digit",minute:"2-digit"}).format(t)}(t.datetime),r=n!==x;return x=n,s.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[r&&s.jsx(O,{children:n}),s.jsx(ni,{message:t,message_time:i})]},e)}})})]})}var Ba,$a,Fa,Ha={exports:{}};function Na(e,t,n,s,i,r,o){try{var a=e[r](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(s,i)}function Wa(e){return function(){var t=this,n=arguments;return new Promise((function(s,i){var r=e.apply(t,n);function o(e){Na(r,s,i,o,a,"next",e)}function a(e){Na(r,s,i,o,a,"throw",e)}o(void 0)}))}}Ba||(Ba=1,function(){var e=function(e){var t,n=Object.prototype,s=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(hu){c=function(e,t,n){return e[t]=n}}function d(e,t,n,s){var r=t&&t.prototype instanceof x?t:x,o=Object.create(r.prototype),a=new L(s||[]);return i(o,"_invoke",{value:C(e,n,a)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(hu){return{type:"throw",arg:hu}}}e.wrap=d;var h="suspendedStart",p="suspendedYield",f="executing",m="completed",g={};function x(){}function y(){}function v(){}var b={};c(b,o,(function(){return this}));var k=Object.getPrototypeOf,w=k&&k(k(D([])));w&&w!==n&&s.call(w,o)&&(b=w);var T=v.prototype=x.prototype=Object.create(b);function j(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(i,r,o,a){var l=u(e[i],e,r);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&s.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,a)}))}a(l.arg)}var r;i(this,"_invoke",{value:function(e,s){function i(){return new t((function(t,i){n(e,s,t,i)}))}return r=r?r.then(i,i):i()}})}function C(e,n,s){var i=h;return function(r,o){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===r)throw o;return{value:t,done:!0}}for(s.method=r,s.arg=o;;){var a=s.delegate;if(a){var l=E(a,s);if(l){if(l===g)continue;return l}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(i===h)throw i=m,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);i=f;var c=u(e,n,s);if("normal"===c.type){if(i=s.done?m:p,c.arg===g)continue;return{value:c.arg,done:s.done}}"throw"===c.type&&(i=m,s.method="throw",s.arg=c.arg)}}}function E(e,n){var s=n.method,i=e.iterator[s];if(i===t)return n.delegate=null,"throw"===s&&e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method)||"return"!==s&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+s+"' method")),g;var r=u(i,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function D(e){if(null!=e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function n(){for(;++i<e.length;)if(s.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(typeof e+" is not iterable")}return y.prototype=v,i(T,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:y,configurable:!0}),y.displayName=c(v,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,l,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},j(S.prototype),c(S.prototype,a,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,s,i,r){void 0===r&&(r=Promise);var o=new S(d(t,n,s,i),r);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},j(T),c(T,l,"Generator"),c(T,o,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var s in t)n.push(s);return n.reverse(),function e(){for(;n.length;){var s=n.pop();if(s in t)return e.value=s,e.done=!1,e}return e.done=!0,e}},e.values=D,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&s.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(s,i){return a.type="throw",a.arg=e,n.next=s,i&&(n.method="next",n.arg=t),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=s.call(o,"catchLoc"),c=s.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&s.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var s=n.completion;if("throw"===s.type){var i=s.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,s){return this.delegate={iterator:D(e),resultName:n,nextLoc:s},"next"===this.method&&(this.arg=t),g}},e}(Ha.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}());const qa=A(function(){if(Fa)return $a;Fa=1;var e=/^\s+|\s+$/g,t=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,s=/^0o[0-7]+$/i,i=parseInt,r="object"==typeof M&&M&&M.Object===Object&&M,o="object"==typeof self&&self&&self.Object===Object&&self,a=r||o||Function("return this")(),l=Object.prototype.toString,c=Math.max,d=Math.min,u=function(){return a.Date.now()};function h(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(r){if("number"==typeof r)return r;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==l.call(e)}(r))return NaN;if(h(r)){var o="function"==typeof r.valueOf?r.valueOf():r;r=h(o)?o+"":o}if("string"!=typeof r)return 0===r?r:+r;r=r.replace(e,"");var a=n.test(r);return a||s.test(r)?i(r.slice(2),a?2:8):t.test(r)?NaN:+r}return $a=function(e,t,n){var s,i,r,o,a,l,f=0,m=!1,g=!1,x=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var n=s,r=i;return s=i=void 0,f=t,o=e.apply(r,n)}function v(e){var n=e-l;return void 0===l||n>=t||n<0||g&&e-f>=r}function b(){var e=u();if(v(e))return k(e);a=setTimeout(b,function(e){var n=t-(e-l);return g?d(n,r-(e-f)):n}(e))}function k(e){return a=void 0,x&&s?y(e):(s=i=void 0,o)}function w(){var e=u(),n=v(e);if(s=arguments,i=this,l=e,n){if(void 0===a)return function(e){return f=e,a=setTimeout(b,t),m?y(e):o}(l);if(g)return a=setTimeout(b,t),y(l)}return void 0===a&&(a=setTimeout(b,t)),o}return t=p(t)||0,h(n)&&(m=!!n.leading,r=(g="maxWait"in n)?c(p(n.maxWait)||0,t):r,x="trailing"in n?!!n.trailing:x),w.cancel=function(){void 0!==a&&clearTimeout(a),f=0,s=l=i=a=void 0},w.flush=function(){return void 0===a?o:k(u())},w}}()),Ua="undefined"!=typeof window&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition);var Ya=()=>/(android)/i.test("undefined"!=typeof navigator?navigator.userAgent:"");const Ga=(...e)=>e.map((e=>e.trim())).join(" ").trim(),Va=/\s*\((.*?)\)\s*/g,Ka=/(\(\?:[^)]+\))\?/g,Ja=/(\(\?)?:\w+/g,Xa=/\*/g,Za=/[-{}[\]+?.,\\^$|#]/g,Qa=()=>"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.mediaDevices&&void 0!==window.navigator.mediaDevices.getUserMedia&&(void 0!==window.AudioContext||void 0!==window.webkitAudioContext);class el{setSpeechRecognition(e){const t=!!e&&((e=>e===Ua)(e)||Qa());t&&(this.disableRecognition(),this.recognition=new e,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.onresult=this.updateTranscript.bind(this),this.recognition.onend=this.onRecognitionDisconnect.bind(this),this.recognition.onerror=this.onError.bind(this)),this.emitBrowserSupportsSpeechRecognitionChange(t)}subscribe(e,t){this.subscribers[e]=t}unsubscribe(e){delete this.subscribers[e]}emitListeningChange(e){this.listening=e,Object.keys(this.subscribers).forEach((t=>{const{onListeningChange:n}=this.subscribers[t];n(e)}))}emitMicrophoneAvailabilityChange(e){this.isMicrophoneAvailable=e,Object.keys(this.subscribers).forEach((t=>{const{onMicrophoneAvailabilityChange:n}=this.subscribers[t];n(e)}))}emitTranscriptChange(e,t){Object.keys(this.subscribers).forEach((n=>{const{onTranscriptChange:s}=this.subscribers[n];s(e,t)}))}emitClearTranscript(){Object.keys(this.subscribers).forEach((e=>{const{onClearTranscript:t}=this.subscribers[e];t()}))}emitBrowserSupportsSpeechRecognitionChange(e){Object.keys(this.subscribers).forEach((t=>{const{onBrowserSupportsSpeechRecognitionChange:n,onBrowserSupportsContinuousListeningChange:s}=this.subscribers[t];n(e),s(e)}))}disconnect(e){if(this.recognition&&this.listening)switch(e){case"ABORT":this.pauseAfterDisconnect=!0,this.abort();break;case"RESET":this.pauseAfterDisconnect=!1,this.abort();break;default:this.pauseAfterDisconnect=!0,this.stop()}}disableRecognition(){this.recognition&&(this.recognition.onresult=()=>{},this.recognition.onend=()=>{},this.recognition.onerror=()=>{},this.listening&&this.stopListening())}onError(e){e&&e.error&&"not-allowed"===e.error&&(this.emitMicrophoneAvailabilityChange(!1),this.disableRecognition())}onRecognitionDisconnect(){this.onStopListening(),this.listening=!1,this.pauseAfterDisconnect?this.emitListeningChange(!1):this.recognition&&(this.recognition.continuous?this.startListening({continuous:this.recognition.continuous}):this.emitListeningChange(!1)),this.pauseAfterDisconnect=!1}updateTranscript({results:e,resultIndex:t}){const n=void 0===t?e.length-1:t;this.interimTranscript="",this.finalTranscript="";for(let i=n;i<e.length;++i)e[i].isFinal&&(!Ya()||e[i][0].confidence>0)?this.updateFinalTranscript(e[i][0].transcript):this.interimTranscript=Ga(this.interimTranscript,e[i][0].transcript);let s=!1;""===this.interimTranscript&&""!==this.finalTranscript?(this.previousResultWasFinalOnly&&(s=!0),this.previousResultWasFinalOnly=!0):this.previousResultWasFinalOnly=!1,s||this.emitTranscriptChange(this.interimTranscript,this.finalTranscript)}updateFinalTranscript(e){this.finalTranscript=Ga(this.finalTranscript,e)}resetTranscript(){this.disconnect("RESET")}startListening(){return Wa((function*({continuous:e=!1,language:t}={}){if(!this.recognition)return;const n=e!==this.recognition.continuous,s=t&&t!==this.recognition.lang;if((n||s)&&(this.listening&&(yield this.stopListening()),this.recognition.continuous=n?e:this.recognition.continuous,this.recognition.lang=s?t:this.recognition.lang),!this.listening){this.recognition.continuous||(this.resetTranscript(),this.emitClearTranscript());try{yield this.start(),this.emitListeningChange(!0)}catch(jn){jn instanceof DOMException||this.emitMicrophoneAvailabilityChange(!1)}}})).apply(this,arguments)}abortListening(){return Wa((function*(){this.disconnect("ABORT"),this.emitListeningChange(!1),yield new Promise((e=>{this.onStopListening=e}))})).call(this)}stopListening(){return Wa((function*(){this.disconnect("STOP"),this.emitListeningChange(!1),yield new Promise((e=>{this.onStopListening=e}))})).call(this)}getRecognition(){return this.recognition}start(){return Wa((function*(){this.recognition&&!this.listening&&(yield this.recognition.start(),this.listening=!0)})).call(this)}stop(){this.recognition&&this.listening&&(this.recognition.stop(),this.listening=!1)}abort(){this.recognition&&this.listening&&(this.recognition.abort(),this.listening=!1)}constructor(e){this.recognition=null,this.pauseAfterDisconnect=!1,this.interimTranscript="",this.finalTranscript="",this.listening=!1,this.isMicrophoneAvailable=!0,this.subscribers={},this.onStopListening=()=>{},this.previousResultWasFinalOnly=!1,this.resetTranscript=this.resetTranscript.bind(this),this.startListening=this.startListening.bind(this),this.stopListening=this.stopListening.bind(this),this.abortListening=this.abortListening.bind(this),this.setSpeechRecognition=this.setSpeechRecognition.bind(this),this.disableRecognition=this.disableRecognition.bind(this),this.setSpeechRecognition(e),Ya()&&(this.updateFinalTranscript=qa(this.updateFinalTranscript,250,{leading:!0}))}}const tl="CLEAR_TRANSCRIPT",nl="APPEND_TRANSCRIPT",sl=(e,t)=>{switch(t.type){case tl:return{interimTranscript:"",finalTranscript:""};case nl:return{interimTranscript:t.payload.interimTranscript,finalTranscript:Ga(e.finalTranscript,t.payload.finalTranscript)};default:throw new Error}};let il,rl=!!Ua,ol=rl&&!Ya();const al=({transcribing:e=!0,clearTranscriptOnListen:t=!0,commands:s=[]}={})=>{const[i]=n.useState(ll.getRecognitionManager()),[r,o]=n.useState(rl),[a,l]=n.useState(ol),[{interimTranscript:c,finalTranscript:d},u]=n.useReducer(sl,{interimTranscript:i.interimTranscript,finalTranscript:""}),[h,p]=n.useState(i.listening),[f,m]=n.useState(i.isMicrophoneAvailable),g=n.useRef(s);g.current=s;const x=()=>{u({type:tl})},y=n.useCallback((()=>{i.resetTranscript(),x()}),[i]),v=(e,t,n)=>{const s=("object"==typeof e?e.toString():e).replace(/[&/\\#,+()!$~%.'":*?<>{}]/g,"").replace(/  +/g," ").trim(),i=((e,t)=>{if(e=e.replace(/\s+/g,"").toLowerCase(),t=t.replace(/\s+/g,"").toLowerCase(),!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e===t)return 1;if(1===e.length&&1===t.length)return 0;if(e.length<2||t.length<2)return 0;const n=new Map;for(let i=0;i<e.length-1;i++){const t=e.substring(i,i+2),s=n.has(t)?n.get(t)+1:1;n.set(t,s)}let s=0;for(let i=0;i<t.length-1;i++){const e=t.substring(i,i+2),r=n.has(e)?n.get(e):0;r>0&&(n.set(e,r-1),s++)}return 2*s/(e.length+t.length-2)})(s,t);return i>=n?{command:e,commandWithoutSpecials:s,howSimilar:i,isFuzzyMatch:!0}:null},b=(e,t)=>{const n=(e=>e instanceof RegExp?new RegExp(e.source,"i"):(e=e.replace(Za,"\\$&").replace(Va,"(?:$1)?").replace(Ja,((e,t)=>t?e:"([^\\s]+)")).replace(Xa,"(.*?)").replace(Ka,"\\s*$1?\\s*"),new RegExp("^"+e+"$","i")))(e),s=n.exec(t);return s?{command:e,parameters:s.slice(1)}:null},k=n.useCallback(((e,t)=>{g.current.forEach((({command:n,callback:s,matchInterim:i=!1,isFuzzyMatch:r=!1,fuzzyMatchingThreshold:o=.8,bestMatchOnly:a=!1})=>{const l=!t&&i?e.trim():t.trim(),c=(Array.isArray(n)?n:[n]).map((e=>r?v(e,l,o):b(e,l))).filter((e=>e));if(r&&a&&c.length>=2){c.sort(((e,t)=>t.howSimilar-e.howSimilar));const{command:e,commandWithoutSpecials:t,howSimilar:n}=c[0];s(t,l,n,{command:e,resetTranscript:y})}else c.forEach((e=>{if(e.isFuzzyMatch){const{command:t,commandWithoutSpecials:n,howSimilar:i}=e;s(n,l,i,{command:t,resetTranscript:y})}else{const{command:t,parameters:n}=e;s(...n,{command:t,resetTranscript:y})}}))}))}),[y]),w=n.useCallback(((t,n)=>{e&&u(((e,t)=>({type:nl,payload:{interimTranscript:e,finalTranscript:t}}))(t,n)),k(t,n)}),[k,e]),T=n.useCallback((()=>{t&&x()}),[t]);n.useEffect((()=>{const e=ll.counter;ll.counter+=1;const t={onListeningChange:p,onMicrophoneAvailabilityChange:m,onTranscriptChange:w,onClearTranscript:T,onBrowserSupportsSpeechRecognitionChange:o,onBrowserSupportsContinuousListeningChange:l};return i.subscribe(e,t),()=>{i.unsubscribe(e)}}),[e,t,i,w,T]);return{transcript:Ga(d,c),interimTranscript:c,finalTranscript:d,listening:h,isMicrophoneAvailable:f,resetTranscript:y,browserSupportsSpeechRecognition:r,browserSupportsContinuousListening:a}},ll={counter:0,applyPolyfill:e=>{il?il.setSpeechRecognition(e):il=new el(e);const t=!!e&&Qa();rl=t,ol=t},removePolyfill:()=>{il?il.setSpeechRecognition(Ua):il=new el(Ua),rl=!!Ua,ol=rl&&!Ya()},getRecognitionManager:()=>(il||(il=new el(Ua)),il),getRecognition:()=>ll.getRecognitionManager().getRecognition(),startListening:({continuous:e,language:t}={})=>Wa((function*(){const n=ll.getRecognitionManager();yield n.startListening({continuous:e,language:t})}))(),stopListening:()=>Wa((function*(){const e=ll.getRecognitionManager();yield e.stopListening()}))(),abortListening:()=>Wa((function*(){const e=ll.getRecognitionManager();yield e.abortListening()}))(),browserSupportsSpeechRecognition:()=>rl,browserSupportsContinuousListening:()=>ol};function cl({files:e,setFiles:t}){return s.jsx(i,{sx:{display:"flex",alignItems:"flex-end",gap:1,position:"relative",bottom:0,left:0,right:0,zIndex:1,backgroundColor:"background.paper",p:1,mb:0,overflow:"auto"},children:s.jsx(i,{sx:{display:"flex",gap:2},children:e.map((n=>s.jsxs(i,{sx:{position:"relative",textAlign:"center"},children:[s.jsx(P,{fontSize:"large"}),s.jsx(u,{variant:"caption",children:n.name}),s.jsx(r,{size:"small",sx:{position:"absolute",top:0,right:0},onClick:()=>{return s=n.lastModified,void t(e.filter((e=>e.lastModified!==s)));var s},children:s.jsx(o,{fontSize:"small"})})]},n.lastModified)))})})}cl.propTypes={files:t.PropTypes.array.isRequired,setFiles:t.PropTypes.func.isRequired};const dl="1";function ul(){const[e,t]=n.useState(""),[o,l]=n.useState(!1),[c,d]=n.useState(!1),[u,h]=n.useState(!1),p=n.useRef(null),f=n.useRef(null),{transcript:m,resetTranscript:x}=al(),{sendMessageAPI:y,sendTranscript:v,files:b,setFiles:k}=ei();return n.useEffect((()=>(clearTimeout(f.current),f.current=setTimeout((()=>{if(m){if("останови прослушивание"===m.toLowerCase()||m.toLowerCase().includes("стоп стоп стоп"))return void x();u?(t(m),h(!1)):v({user_id:dl,text:m}),x()}}),1100),()=>clearTimeout(f.current))),[m,x,v]),s.jsxs(s.Fragment,{children:[s.jsx(cl,{files:b,setFiles:k}),s.jsxs(i,{sx:{display:"flex",alignItems:"flex-end",gap:1,position:"relative",bottom:0,left:0,right:0,zIndex:1,backgroundColor:"background.paper",mt:0,p:1},children:[s.jsx("input",{type:"file",multiple:!0,ref:p,style:{display:"none"},onChange:function(e){const t=Array.from(e.target.files);k((e=>{const n=t.filter((t=>!e.some((e=>e.name===t.name&&e.lastModified===t.lastModified))));return[...e,...n]})),p.current.value=""}}),s.jsx(r,{"aria-label":"add",onClick:()=>p.current.click(),children:s.jsx(w,{children:"add_circle_outline"})}),s.jsx(a,{id:"message_field",label:"Сообщение",multiline:!0,maxRows:15,fullWidth:!0,error:!!o,value:e,onChange:e=>t(e.target.value),helperText:o||""}),s.jsx(r,{onClick:function(){u?h(!1):(ll.startListening({continuous:!1}),h(!0))},children:s.jsx(w,{children:u?"stop":"mic"})}),s.jsx(r,{onClick:async function(){if(e.trim()){l(!1),d(!0);try{await y(dl,e),t("")}catch(n){l(n.message||"An unexpected error occurred"),d(!1)}finally{d(!1)}}else l("Введите сообщение")},disabled:c,children:c?s.jsx(g,{size:24}):s.jsx(w,{children:"send"})})]})]})}function hl(){return s.jsxs(z,{sx:{position:"fixed",bottom:0,right:0,width:"600px",maxWidth:"100%",zIndex:999},children:[s.jsx(B,{expandIcon:s.jsx(w,{children:"expand_less"}),sx:{border:"1px solid"},children:s.jsx(u,{children:"Chat"})}),s.jsx($,{sx:{position:"relative",display:"flex",flexDirection:"column",height:"70vh"},children:s.jsxs(Qs,{children:[s.jsx(za,{}),s.jsx(ul,{})]})})]})}const pl=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function fl(e){return"object"==typeof e&&null!==e&&e.constructor&&"Object"===Object.prototype.toString.call(e).slice(8,-1)&&!e.__swiper__}function ml(e,t){const n=["__proto__","constructor","prototype"];Object.keys(t).filter((e=>n.indexOf(e)<0)).forEach((n=>{void 0===e[n]?e[n]=t[n]:fl(t[n])&&fl(e[n])&&Object.keys(t[n]).length>0?t[n].__swiper__?e[n]=t[n]:ml(e[n],t[n]):e[n]=t[n]}))}function gl(e){return void 0===e&&(e={}),e.navigation&&void 0===e.navigation.nextEl&&void 0===e.navigation.prevEl}function xl(e){return void 0===e&&(e={}),e.pagination&&void 0===e.pagination.el}function yl(e){return void 0===e&&(e={}),e.scrollbar&&void 0===e.scrollbar.el}function vl(e){void 0===e&&(e="");const t=e.split(" ").map((e=>e.trim())).filter((e=>!!e)),n=[];return t.forEach((e=>{n.indexOf(e)<0&&n.push(e)})),n.join(" ")}function bl(e){return void 0===e&&(e=""),e?e.includes("swiper-wrapper")?e:`swiper-wrapper ${e}`:"swiper-wrapper"}function kl(){return kl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},kl.apply(this,arguments)}function wl(e){return e.type&&e.type.displayName&&e.type.displayName.includes("SwiperSlide")}function Tl(e){const t=[];return L.Children.toArray(e).forEach((e=>{wl(e)?t.push(e):e.props&&e.props.children&&Tl(e.props.children).forEach((e=>t.push(e)))})),t}function jl(e){const t=[],n={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]};return L.Children.toArray(e).forEach((e=>{if(wl(e))t.push(e);else if(e.props&&e.props.slot&&n[e.props.slot])n[e.props.slot].push(e);else if(e.props&&e.props.children){const s=Tl(e.props.children);s.length>0?s.forEach((e=>t.push(e))):n["container-end"].push(e)}else n["container-end"].push(e)})),{slides:t,slots:n}}function Sl(e,t){return"undefined"==typeof window?n.useEffect(e,t):n.useLayoutEffect(e,t)}const Cl=n.createContext(null),El=n.createContext(null),_l=n.forwardRef((function(e,t){let{className:s,tag:i="div",wrapperTag:r="div",children:o,onSwiper:a,...l}=void 0===e?{}:e,c=!1;const[d,u]=n.useState("swiper"),[h,p]=n.useState(null),[f,m]=n.useState(!1),g=n.useRef(!1),x=n.useRef(null),y=n.useRef(null),v=n.useRef(null),b=n.useRef(null),k=n.useRef(null),w=n.useRef(null),T=n.useRef(null),j=n.useRef(null),{params:S,passedParams:C,rest:E,events:_}=function(e,t){void 0===e&&(e={}),void 0===t&&(t=!0);const n={on:{}},s={},i={};ml(n,Ut),n._emitClasses=!0,n.init=!1;const r={},o=pl.map((e=>e.replace(/_/,""))),a=Object.assign({},e);return Object.keys(a).forEach((a=>{void 0!==e[a]&&(o.indexOf(a)>=0?fl(e[a])?(n[a]={},i[a]={},ml(n[a],e[a]),ml(i[a],e[a])):(n[a]=e[a],i[a]=e[a]):0===a.search(/on[A-Z]/)&&"function"==typeof e[a]?t?s[`${a[2].toLowerCase()}${a.substr(3)}`]=e[a]:n.on[`${a[2].toLowerCase()}${a.substr(3)}`]=e[a]:r[a]=e[a])})),["navigation","pagination","scrollbar"].forEach((e=>{!0===n[e]&&(n[e]={}),!1===n[e]&&delete n[e]})),{params:n,passedParams:i,rest:r,events:s}}(l),{slides:I,slots:D}=jl(o),R=()=>{m(!f)};Object.assign(S.on,{_containerClasses(e,t){u(t)}});const O=()=>{Object.assign(S.on,_),c=!0;const e={...S};if(delete e.wrapperClass,y.current=new Yt(e),y.current.virtual&&y.current.params.virtual.enabled){y.current.virtual.slides=I;const e={cache:!1,slides:I,renderExternal:p,renderExternalUpdate:!1};ml(y.current.params.virtual,e),ml(y.current.originalParams.virtual,e)}};x.current||O(),y.current&&y.current.on("_beforeBreakpoint",R);return n.useEffect((()=>()=>{y.current&&y.current.off("_beforeBreakpoint",R)})),n.useEffect((()=>{!g.current&&y.current&&(y.current.emitSlidesClasses(),g.current=!0)})),Sl((()=>{if(t&&(t.current=x.current),x.current)return y.current.destroyed&&O(),function(e,t){let{el:n,nextEl:s,prevEl:i,paginationEl:r,scrollbarEl:o,swiper:a}=e;gl(t)&&s&&i&&(a.params.navigation.nextEl=s,a.originalParams.navigation.nextEl=s,a.params.navigation.prevEl=i,a.originalParams.navigation.prevEl=i),xl(t)&&r&&(a.params.pagination.el=r,a.originalParams.pagination.el=r),yl(t)&&o&&(a.params.scrollbar.el=o,a.originalParams.scrollbar.el=o),a.init(n)}({el:x.current,nextEl:k.current,prevEl:w.current,paginationEl:T.current,scrollbarEl:j.current,swiper:y.current},S),a&&!y.current.destroyed&&a(y.current),()=>{y.current&&!y.current.destroyed&&y.current.destroy(!0,!1)}}),[]),Sl((()=>{!c&&_&&y.current&&Object.keys(_).forEach((e=>{y.current.on(e,_[e])}));const e=function(e,t,n,s,i){const r=[];if(!t)return r;const o=e=>{r.indexOf(e)<0&&r.push(e)};if(n&&s){const e=s.map(i),t=n.map(i);e.join("")!==t.join("")&&o("children"),s.length!==n.length&&o("children")}return pl.filter((e=>"_"===e[0])).map((e=>e.replace(/_/,""))).forEach((n=>{if(n in e&&n in t)if(fl(e[n])&&fl(t[n])){const s=Object.keys(e[n]),i=Object.keys(t[n]);s.length!==i.length?o(n):(s.forEach((s=>{e[n][s]!==t[n][s]&&o(n)})),i.forEach((s=>{e[n][s]!==t[n][s]&&o(n)})))}else e[n]!==t[n]&&o(n)})),r}(C,v.current,I,b.current,(e=>e.key));return v.current=C,b.current=I,e.length&&y.current&&!y.current.destroyed&&function(e){let{swiper:t,slides:n,passedParams:s,changedParams:i,nextEl:r,prevEl:o,scrollbarEl:a,paginationEl:l}=e;const c=i.filter((e=>"children"!==e&&"direction"!==e&&"wrapperClass"!==e)),{params:d,pagination:u,navigation:h,scrollbar:p,virtual:f,thumbs:m}=t;let g,x,y,v,b,k,w,T;i.includes("thumbs")&&s.thumbs&&s.thumbs.swiper&&!s.thumbs.swiper.destroyed&&d.thumbs&&(!d.thumbs.swiper||d.thumbs.swiper.destroyed)&&(g=!0),i.includes("controller")&&s.controller&&s.controller.control&&d.controller&&!d.controller.control&&(x=!0),i.includes("pagination")&&s.pagination&&(s.pagination.el||l)&&(d.pagination||!1===d.pagination)&&u&&!u.el&&(y=!0),i.includes("scrollbar")&&s.scrollbar&&(s.scrollbar.el||a)&&(d.scrollbar||!1===d.scrollbar)&&p&&!p.el&&(v=!0),i.includes("navigation")&&s.navigation&&(s.navigation.prevEl||o)&&(s.navigation.nextEl||r)&&(d.navigation||!1===d.navigation)&&h&&!h.prevEl&&!h.nextEl&&(b=!0);const j=e=>{t[e]&&(t[e].destroy(),"navigation"===e?(t.isElement&&(t[e].prevEl.remove(),t[e].nextEl.remove()),d[e].prevEl=void 0,d[e].nextEl=void 0,t[e].prevEl=void 0,t[e].nextEl=void 0):(t.isElement&&t[e].el.remove(),d[e].el=void 0,t[e].el=void 0))};i.includes("loop")&&t.isElement&&(d.loop&&!s.loop?k=!0:!d.loop&&s.loop?w=!0:T=!0),c.forEach((e=>{if(fl(d[e])&&fl(s[e]))Object.assign(d[e],s[e]),"navigation"!==e&&"pagination"!==e&&"scrollbar"!==e||!("enabled"in s[e])||s[e].enabled||j(e);else{const t=s[e];!0!==t&&!1!==t||"navigation"!==e&&"pagination"!==e&&"scrollbar"!==e?d[e]=s[e]:!1===t&&j(e)}})),c.includes("controller")&&!x&&t.controller&&t.controller.control&&d.controller&&d.controller.control&&(t.controller.control=d.controller.control),i.includes("children")&&n&&f&&d.virtual.enabled?(f.slides=n,f.update(!0)):i.includes("virtual")&&f&&d.virtual.enabled&&(n&&(f.slides=n),f.update(!0)),i.includes("children")&&n&&d.loop&&(T=!0),g&&m.init()&&m.update(!0);x&&(t.controller.control=d.controller.control),y&&(!t.isElement||l&&"string"!=typeof l||(l=document.createElement("div"),l.classList.add("swiper-pagination"),l.part.add("pagination"),t.el.appendChild(l)),l&&(d.pagination.el=l),u.init(),u.render(),u.update()),v&&(!t.isElement||a&&"string"!=typeof a||(a=document.createElement("div"),a.classList.add("swiper-scrollbar"),a.part.add("scrollbar"),t.el.appendChild(a)),a&&(d.scrollbar.el=a),p.init(),p.updateSize(),p.setTranslate()),b&&(t.isElement&&(r&&"string"!=typeof r||(r=document.createElement("div"),r.classList.add("swiper-button-next"),r.innerHTML=t.hostEl.constructor.nextButtonSvg,r.part.add("button-next"),t.el.appendChild(r)),o&&"string"!=typeof o||(o=document.createElement("div"),o.classList.add("swiper-button-prev"),o.innerHTML=t.hostEl.constructor.prevButtonSvg,o.part.add("button-prev"),t.el.appendChild(o))),r&&(d.navigation.nextEl=r),o&&(d.navigation.prevEl=o),h.init(),h.update()),i.includes("allowSlideNext")&&(t.allowSlideNext=s.allowSlideNext),i.includes("allowSlidePrev")&&(t.allowSlidePrev=s.allowSlidePrev),i.includes("direction")&&t.changeDirection(s.direction,!1),(k||T)&&t.loopDestroy(),(w||T)&&t.loopCreate(),t.update()}({swiper:y.current,slides:I,passedParams:C,changedParams:e,nextEl:k.current,prevEl:w.current,scrollbarEl:j.current,paginationEl:T.current}),()=>{_&&y.current&&Object.keys(_).forEach((e=>{y.current.off(e,_[e])}))}})),Sl((()=>{var e;!(e=y.current)||e.destroyed||!e.params.virtual||e.params.virtual&&!e.params.virtual.enabled||(e.updateSlides(),e.updateProgress(),e.updateSlidesClasses(),e.parallax&&e.params.parallax&&e.params.parallax.enabled&&e.parallax.setTranslate())}),[h]),L.createElement(i,kl({ref:x,className:vl(`${d}${s?` ${s}`:""}`)},E),L.createElement(El.Provider,{value:y.current},D["container-start"],L.createElement(r,{className:bl(S.wrapperClass)},D["wrapper-start"],S.virtual?function(e,t,n){if(!n)return null;const s=e=>{let n=e;return e<0?n=t.length+e:n>=t.length&&(n-=t.length),n},i=e.isHorizontal()?{[e.rtlTranslate?"right":"left"]:`${n.offset}px`}:{top:`${n.offset}px`},{from:r,to:o}=n,a=e.params.loop?-t.length:0,l=e.params.loop?2*t.length:t.length,c=[];for(let d=a;d<l;d+=1)d>=r&&d<=o&&c.push(t[s(d)]);return c.map(((t,n)=>L.cloneElement(t,{swiper:e,style:i,key:t.props.virtualIndex||t.key||`slide-${n}`})))}(y.current,I,h):I.map(((e,t)=>L.cloneElement(e,{swiper:y.current,swiperSlideIndex:t}))),D["wrapper-end"]),gl(S)&&L.createElement(L.Fragment,null,L.createElement("div",{ref:w,className:"swiper-button-prev"}),L.createElement("div",{ref:k,className:"swiper-button-next"})),yl(S)&&L.createElement("div",{ref:j,className:"swiper-scrollbar"}),xl(S)&&L.createElement("div",{ref:T,className:"swiper-pagination"}),D["container-end"]))}));_l.displayName="Swiper";const Il=n.forwardRef((function(e,t){let{tag:s="div",children:i,className:r="",swiper:o,zoom:a,lazy:l,virtualIndex:c,swiperSlideIndex:d,...u}=void 0===e?{}:e;const h=n.useRef(null),[p,f]=n.useState("swiper-slide"),[m,g]=n.useState(!1);function x(e,t,n){t===h.current&&f(n)}Sl((()=>{if(void 0!==d&&(h.current.swiperSlideIndex=d),t&&(t.current=h.current),h.current&&o){if(!o.destroyed)return o.on("_slideClass",x),()=>{o&&o.off("_slideClass",x)};"swiper-slide"!==p&&f("swiper-slide")}})),Sl((()=>{o&&h.current&&!o.destroyed&&f(o.getSlideClasses(h.current))}),[o]);const y={isActive:p.indexOf("swiper-slide-active")>=0,isVisible:p.indexOf("swiper-slide-visible")>=0,isPrev:p.indexOf("swiper-slide-prev")>=0,isNext:p.indexOf("swiper-slide-next")>=0},v=()=>"function"==typeof i?i(y):i;return L.createElement(s,kl({ref:h,className:vl(`${p}${r?` ${r}`:""}`),"data-swiper-slide-index":c,onLoad:()=>{g(!0)}},u),a&&L.createElement(Cl.Provider,{value:y},L.createElement("div",{className:"swiper-zoom-container","data-swiper-zoom":"number"==typeof a?a:void 0},v(),l&&!m&&L.createElement("div",{className:"swiper-lazy-preloader"}))),!a&&L.createElement(Cl.Provider,{value:y},v(),l&&!m&&L.createElement("div",{className:"swiper-lazy-preloader"})))}));function Ll(e,t,n,s){return e.params.createElements&&Object.keys(s).forEach((i=>{if(!n[i]&&!0===n.auto){let r=Gt(e.el,`.${s[i]}`)[0];r||(r=Vt("div",s[i]),r.className=s[i],e.el.append(r)),n[i]=r,t[i]=r}})),n}function Dl(e){let{swiper:t,extendParams:n,on:s,emit:i}=e;function r(e){let n;return e&&"string"==typeof e&&t.isElement&&(n=t.el.querySelector(e)||t.hostEl.querySelector(e),n)?n:(e&&("string"==typeof e&&(n=[...document.querySelectorAll(e)]),t.params.uniqueNavElements&&"string"==typeof e&&n&&n.length>1&&1===t.el.querySelectorAll(e).length?n=t.el.querySelector(e):n&&1===n.length&&(n=n[0])),e&&!n?e:n)}function o(e,n){const s=t.params.navigation;(e=Kt(e)).forEach((e=>{e&&(e.classList[n?"add":"remove"](...s.disabledClass.split(" ")),"BUTTON"===e.tagName&&(e.disabled=n),t.params.watchOverflow&&t.enabled&&e.classList[t.isLocked?"add":"remove"](s.lockClass))}))}function a(){const{nextEl:e,prevEl:n}=t.navigation;if(t.params.loop)return o(n,!1),void o(e,!1);o(n,t.isBeginning&&!t.params.rewind),o(e,t.isEnd&&!t.params.rewind)}function l(e){e.preventDefault(),(!t.isBeginning||t.params.loop||t.params.rewind)&&(t.slidePrev(),i("navigationPrev"))}function c(e){e.preventDefault(),(!t.isEnd||t.params.loop||t.params.rewind)&&(t.slideNext(),i("navigationNext"))}function d(){const e=t.params.navigation;if(t.params.navigation=Ll(t,t.originalParams.navigation,t.params.navigation,{nextEl:"swiper-button-next",prevEl:"swiper-button-prev"}),!e.nextEl&&!e.prevEl)return;let n=r(e.nextEl),s=r(e.prevEl);Object.assign(t.navigation,{nextEl:n,prevEl:s}),n=Kt(n),s=Kt(s);const i=(n,s)=>{n&&n.addEventListener("click","next"===s?c:l),!t.enabled&&n&&n.classList.add(...e.lockClass.split(" "))};n.forEach((e=>i(e,"next"))),s.forEach((e=>i(e,"prev")))}function u(){let{nextEl:e,prevEl:n}=t.navigation;e=Kt(e),n=Kt(n);const s=(e,n)=>{e.removeEventListener("click","next"===n?c:l),e.classList.remove(...t.params.navigation.disabledClass.split(" "))};e.forEach((e=>s(e,"next"))),n.forEach((e=>s(e,"prev")))}n({navigation:{nextEl:null,prevEl:null,hideOnClick:!1,disabledClass:"swiper-button-disabled",hiddenClass:"swiper-button-hidden",lockClass:"swiper-button-lock",navigationDisabledClass:"swiper-navigation-disabled"}}),t.navigation={nextEl:null,prevEl:null},s("init",(()=>{!1===t.params.navigation.enabled?h():(d(),a())})),s("toEdge fromEdge lock unlock",(()=>{a()})),s("destroy",(()=>{u()})),s("enable disable",(()=>{let{nextEl:e,prevEl:n}=t.navigation;e=Kt(e),n=Kt(n),t.enabled?a():[...e,...n].filter((e=>!!e)).forEach((e=>e.classList.add(t.params.navigation.lockClass)))})),s("click",((e,n)=>{let{nextEl:s,prevEl:r}=t.navigation;s=Kt(s),r=Kt(r);const o=n.target;let a=r.includes(o)||s.includes(o);if(t.isElement&&!a){const e=n.path||n.composedPath&&n.composedPath();e&&(a=e.find((e=>s.includes(e)||r.includes(e))))}if(t.params.navigation.hideOnClick&&!a){if(t.pagination&&t.params.pagination&&t.params.pagination.clickable&&(t.pagination.el===o||t.pagination.el.contains(o)))return;let e;s.length?e=s[0].classList.contains(t.params.navigation.hiddenClass):r.length&&(e=r[0].classList.contains(t.params.navigation.hiddenClass)),i(!0===e?"navigationShow":"navigationHide"),[...s,...r].filter((e=>!!e)).forEach((e=>e.classList.toggle(t.params.navigation.hiddenClass)))}}));const h=()=>{t.el.classList.add(...t.params.navigation.navigationDisabledClass.split(" ")),u()};Object.assign(t.navigation,{enable:()=>{t.el.classList.remove(...t.params.navigation.navigationDisabledClass.split(" ")),d(),a()},disable:h,update:a,init:d,destroy:u})}function Rl(e){return void 0===e&&(e=""),`.${e.trim().replace(/([\.:!+\/])/g,"\\$1").replace(/ /g,".")}`}function Ol(e){let{swiper:t,extendParams:n,on:s,emit:i}=e;const r="swiper-pagination";let o;n({pagination:{el:null,bulletElement:"span",clickable:!1,hideOnClick:!1,renderBullet:null,renderProgressbar:null,renderFraction:null,renderCustom:null,progressbarOpposite:!1,type:"bullets",dynamicBullets:!1,dynamicMainBullets:1,formatFractionCurrent:e=>e,formatFractionTotal:e=>e,bulletClass:`${r}-bullet`,bulletActiveClass:`${r}-bullet-active`,modifierClass:`${r}-`,currentClass:`${r}-current`,totalClass:`${r}-total`,hiddenClass:`${r}-hidden`,progressbarFillClass:`${r}-progressbar-fill`,progressbarOppositeClass:`${r}-progressbar-opposite`,clickableClass:`${r}-clickable`,lockClass:`${r}-lock`,horizontalClass:`${r}-horizontal`,verticalClass:`${r}-vertical`,paginationDisabledClass:`${r}-disabled`}}),t.pagination={el:null,bullets:[]};let a=0;function l(){return!t.params.pagination.el||!t.pagination.el||Array.isArray(t.pagination.el)&&0===t.pagination.el.length}function c(e,n){const{bulletActiveClass:s}=t.params.pagination;e&&(e=e[("prev"===n?"previous":"next")+"ElementSibling"])&&(e.classList.add(`${s}-${n}`),(e=e[("prev"===n?"previous":"next")+"ElementSibling"])&&e.classList.add(`${s}-${n}-${n}`))}function d(e){const n=e.target.closest(Rl(t.params.pagination.bulletClass));if(!n)return;e.preventDefault();const s=Zt(n)*t.params.slidesPerGroup;if(t.params.loop){if(t.realIndex===s)return;const e=(i=t.realIndex,r=s,o=t.slides.length,(r%=o)==1+(i%=o)?"next":r===i-1?"previous":void 0);"next"===e?t.slideNext():"previous"===e?t.slidePrev():t.slideToLoop(s)}else t.slideTo(s);var i,r,o}function u(){const e=t.rtl,n=t.params.pagination;if(l())return;let s,r,d=t.pagination.el;d=Kt(d);const u=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.slides.length,h=t.params.loop?Math.ceil(u/t.params.slidesPerGroup):t.snapGrid.length;if(t.params.loop?(r=t.previousRealIndex||0,s=t.params.slidesPerGroup>1?Math.floor(t.realIndex/t.params.slidesPerGroup):t.realIndex):void 0!==t.snapIndex?(s=t.snapIndex,r=t.previousSnapIndex):(r=t.previousIndex||0,s=t.activeIndex||0),"bullets"===n.type&&t.pagination.bullets&&t.pagination.bullets.length>0){const i=t.pagination.bullets;let l,u,h;if(n.dynamicBullets&&(o=Xt(i[0],t.isHorizontal()?"width":"height"),d.forEach((e=>{e.style[t.isHorizontal()?"width":"height"]=o*(n.dynamicMainBullets+4)+"px"})),n.dynamicMainBullets>1&&void 0!==r&&(a+=s-(r||0),a>n.dynamicMainBullets-1?a=n.dynamicMainBullets-1:a<0&&(a=0)),l=Math.max(s-a,0),u=l+(Math.min(i.length,n.dynamicMainBullets)-1),h=(u+l)/2),i.forEach((e=>{const t=[...["","-next","-next-next","-prev","-prev-prev","-main"].map((e=>`${n.bulletActiveClass}${e}`))].map((e=>"string"==typeof e&&e.includes(" ")?e.split(" "):e)).flat();e.classList.remove(...t)})),d.length>1)i.forEach((e=>{const i=Zt(e);i===s?e.classList.add(...n.bulletActiveClass.split(" ")):t.isElement&&e.setAttribute("part","bullet"),n.dynamicBullets&&(i>=l&&i<=u&&e.classList.add(...`${n.bulletActiveClass}-main`.split(" ")),i===l&&c(e,"prev"),i===u&&c(e,"next"))}));else{const e=i[s];if(e&&e.classList.add(...n.bulletActiveClass.split(" ")),t.isElement&&i.forEach(((e,t)=>{e.setAttribute("part",t===s?"bullet-active":"bullet")})),n.dynamicBullets){const e=i[l],t=i[u];for(let s=l;s<=u;s+=1)i[s]&&i[s].classList.add(...`${n.bulletActiveClass}-main`.split(" "));c(e,"prev"),c(t,"next")}}if(n.dynamicBullets){const s=Math.min(i.length,n.dynamicMainBullets+4),r=(o*s-o)/2-h*o,a=e?"right":"left";i.forEach((e=>{e.style[t.isHorizontal()?a:"top"]=`${r}px`}))}}d.forEach(((e,r)=>{if("fraction"===n.type&&(e.querySelectorAll(Rl(n.currentClass)).forEach((e=>{e.textContent=n.formatFractionCurrent(s+1)})),e.querySelectorAll(Rl(n.totalClass)).forEach((e=>{e.textContent=n.formatFractionTotal(h)}))),"progressbar"===n.type){let i;i=n.progressbarOpposite?t.isHorizontal()?"vertical":"horizontal":t.isHorizontal()?"horizontal":"vertical";const r=(s+1)/h;let o=1,a=1;"horizontal"===i?o=r:a=r,e.querySelectorAll(Rl(n.progressbarFillClass)).forEach((e=>{e.style.transform=`translate3d(0,0,0) scaleX(${o}) scaleY(${a})`,e.style.transitionDuration=`${t.params.speed}ms`}))}"custom"===n.type&&n.renderCustom?(e.innerHTML=n.renderCustom(t,s+1,h),0===r&&i("paginationRender",e)):(0===r&&i("paginationRender",e),i("paginationUpdate",e)),t.params.watchOverflow&&t.enabled&&e.classList[t.isLocked?"add":"remove"](n.lockClass)}))}function h(){const e=t.params.pagination;if(l())return;const n=t.virtual&&t.params.virtual.enabled?t.virtual.slides.length:t.grid&&t.params.grid.rows>1?t.slides.length/Math.ceil(t.params.grid.rows):t.slides.length;let s=t.pagination.el;s=Kt(s);let r="";if("bullets"===e.type){let s=t.params.loop?Math.ceil(n/t.params.slidesPerGroup):t.snapGrid.length;t.params.freeMode&&t.params.freeMode.enabled&&s>n&&(s=n);for(let n=0;n<s;n+=1)e.renderBullet?r+=e.renderBullet.call(t,n,e.bulletClass):r+=`<${e.bulletElement} ${t.isElement?'part="bullet"':""} class="${e.bulletClass}"></${e.bulletElement}>`}"fraction"===e.type&&(r=e.renderFraction?e.renderFraction.call(t,e.currentClass,e.totalClass):`<span class="${e.currentClass}"></span> / <span class="${e.totalClass}"></span>`),"progressbar"===e.type&&(r=e.renderProgressbar?e.renderProgressbar.call(t,e.progressbarFillClass):`<span class="${e.progressbarFillClass}"></span>`),t.pagination.bullets=[],s.forEach((n=>{"custom"!==e.type&&(n.innerHTML=r||""),"bullets"===e.type&&t.pagination.bullets.push(...n.querySelectorAll(Rl(e.bulletClass)))})),"custom"!==e.type&&i("paginationRender",s[0])}function p(){t.params.pagination=Ll(t,t.originalParams.pagination,t.params.pagination,{el:"swiper-pagination"});const e=t.params.pagination;if(!e.el)return;let n;"string"==typeof e.el&&t.isElement&&(n=t.el.querySelector(e.el)),n||"string"!=typeof e.el||(n=[...document.querySelectorAll(e.el)]),n||(n=e.el),n&&0!==n.length&&(t.params.uniqueNavElements&&"string"==typeof e.el&&Array.isArray(n)&&n.length>1&&(n=[...t.el.querySelectorAll(e.el)],n.length>1&&(n=n.find((e=>Jt(e,".swiper")[0]===t.el)))),Array.isArray(n)&&1===n.length&&(n=n[0]),Object.assign(t.pagination,{el:n}),n=Kt(n),n.forEach((n=>{"bullets"===e.type&&e.clickable&&n.classList.add(...(e.clickableClass||"").split(" ")),n.classList.add(e.modifierClass+e.type),n.classList.add(t.isHorizontal()?e.horizontalClass:e.verticalClass),"bullets"===e.type&&e.dynamicBullets&&(n.classList.add(`${e.modifierClass}${e.type}-dynamic`),a=0,e.dynamicMainBullets<1&&(e.dynamicMainBullets=1)),"progressbar"===e.type&&e.progressbarOpposite&&n.classList.add(e.progressbarOppositeClass),e.clickable&&n.addEventListener("click",d),t.enabled||n.classList.add(e.lockClass)})))}function f(){const e=t.params.pagination;if(l())return;let n=t.pagination.el;n&&(n=Kt(n),n.forEach((n=>{n.classList.remove(e.hiddenClass),n.classList.remove(e.modifierClass+e.type),n.classList.remove(t.isHorizontal()?e.horizontalClass:e.verticalClass),e.clickable&&(n.classList.remove(...(e.clickableClass||"").split(" ")),n.removeEventListener("click",d))}))),t.pagination.bullets&&t.pagination.bullets.forEach((t=>t.classList.remove(...e.bulletActiveClass.split(" "))))}s("changeDirection",(()=>{if(!t.pagination||!t.pagination.el)return;const e=t.params.pagination;let{el:n}=t.pagination;n=Kt(n),n.forEach((n=>{n.classList.remove(e.horizontalClass,e.verticalClass),n.classList.add(t.isHorizontal()?e.horizontalClass:e.verticalClass)}))})),s("init",(()=>{!1===t.params.pagination.enabled?m():(p(),h(),u())})),s("activeIndexChange",(()=>{void 0===t.snapIndex&&u()})),s("snapIndexChange",(()=>{u()})),s("snapGridLengthChange",(()=>{h(),u()})),s("destroy",(()=>{f()})),s("enable disable",(()=>{let{el:e}=t.pagination;e&&(e=Kt(e),e.forEach((e=>e.classList[t.enabled?"remove":"add"](t.params.pagination.lockClass))))})),s("lock unlock",(()=>{u()})),s("click",((e,n)=>{const s=n.target,r=Kt(t.pagination.el);if(t.params.pagination.el&&t.params.pagination.hideOnClick&&r&&r.length>0&&!s.classList.contains(t.params.pagination.bulletClass)){if(t.navigation&&(t.navigation.nextEl&&s===t.navigation.nextEl||t.navigation.prevEl&&s===t.navigation.prevEl))return;const e=r[0].classList.contains(t.params.pagination.hiddenClass);i(!0===e?"paginationShow":"paginationHide"),r.forEach((e=>e.classList.toggle(t.params.pagination.hiddenClass)))}}));const m=()=>{t.el.classList.add(t.params.pagination.paginationDisabledClass);let{el:e}=t.pagination;e&&(e=Kt(e),e.forEach((e=>e.classList.add(t.params.pagination.paginationDisabledClass)))),f()};Object.assign(t.pagination,{enable:()=>{t.el.classList.remove(t.params.pagination.paginationDisabledClass);let{el:e}=t.pagination;e&&(e=Kt(e),e.forEach((e=>e.classList.remove(t.params.pagination.paginationDisabledClass)))),p(),h(),u()},disable:m,render:h,update:u,init:p,destroy:f})}function Ml(e){let t,n,{swiper:s,extendParams:i,on:r,emit:o,params:a}=e;s.autoplay={running:!1,paused:!1,timeLeft:0},i({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!1,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});let l,c,d,u,h,p,f,m,g=a&&a.autoplay?a.autoplay.delay:3e3,x=a&&a.autoplay?a.autoplay.delay:3e3,y=(new Date).getTime();function v(e){s&&!s.destroyed&&s.wrapperEl&&e.target===s.wrapperEl&&(s.wrapperEl.removeEventListener("transitionend",v),m||e.detail&&e.detail.bySwiperTouchMove||S())}const b=()=>{if(s.destroyed||!s.autoplay.running)return;s.autoplay.paused?c=!0:c&&(x=l,c=!1);const e=s.autoplay.paused?l:y+x-(new Date).getTime();s.autoplay.timeLeft=e,o("autoplayTimeLeft",e,e/g),n=requestAnimationFrame((()=>{b()}))},k=e=>{if(s.destroyed||!s.autoplay.running)return;cancelAnimationFrame(n),b();let i=void 0===e?s.params.autoplay.delay:e;g=s.params.autoplay.delay,x=s.params.autoplay.delay;const r=(()=>{let e;if(e=s.virtual&&s.params.virtual.enabled?s.slides.find((e=>e.classList.contains("swiper-slide-active"))):s.slides[s.activeIndex],!e)return;return parseInt(e.getAttribute("data-swiper-autoplay"),10)})();!Number.isNaN(r)&&r>0&&void 0===e&&(i=r,g=r,x=r),l=i;const a=s.params.speed,c=()=>{s&&!s.destroyed&&(s.params.autoplay.reverseDirection?!s.isBeginning||s.params.loop||s.params.rewind?(s.slidePrev(a,!0,!0),o("autoplay")):s.params.autoplay.stopOnLastSlide||(s.slideTo(s.slides.length-1,a,!0,!0),o("autoplay")):!s.isEnd||s.params.loop||s.params.rewind?(s.slideNext(a,!0,!0),o("autoplay")):s.params.autoplay.stopOnLastSlide||(s.slideTo(0,a,!0,!0),o("autoplay")),s.params.cssMode&&(y=(new Date).getTime(),requestAnimationFrame((()=>{k()}))))};return i>0?(clearTimeout(t),t=setTimeout((()=>{c()}),i)):requestAnimationFrame((()=>{c()})),i},w=()=>{y=(new Date).getTime(),s.autoplay.running=!0,k(),o("autoplayStart")},T=()=>{s.autoplay.running=!1,clearTimeout(t),cancelAnimationFrame(n),o("autoplayStop")},j=(e,n)=>{if(s.destroyed||!s.autoplay.running)return;clearTimeout(t),e||(f=!0);const i=()=>{o("autoplayPause"),s.params.autoplay.waitForTransition?s.wrapperEl.addEventListener("transitionend",v):S()};if(s.autoplay.paused=!0,n)return p&&(l=s.params.autoplay.delay),p=!1,void i();const r=l||s.params.autoplay.delay;l=r-((new Date).getTime()-y),s.isEnd&&l<0&&!s.params.loop||(l<0&&(l=0),i())},S=()=>{s.isEnd&&l<0&&!s.params.loop||s.destroyed||!s.autoplay.running||(y=(new Date).getTime(),f?(f=!1,k(l)):k(),s.autoplay.paused=!1,o("autoplayResume"))},C=()=>{if(s.destroyed||!s.autoplay.running)return;const e=Qt();"hidden"===e.visibilityState&&(f=!0,j(!0)),"visible"===e.visibilityState&&S()},E=e=>{"mouse"===e.pointerType&&(f=!0,m=!0,s.animating||s.autoplay.paused||j(!0))},_=e=>{"mouse"===e.pointerType&&(m=!1,s.autoplay.paused&&S())};r("init",(()=>{s.params.autoplay.enabled&&(s.params.autoplay.pauseOnMouseEnter&&(s.el.addEventListener("pointerenter",E),s.el.addEventListener("pointerleave",_)),Qt().addEventListener("visibilitychange",C),w())})),r("destroy",(()=>{s.el&&"string"!=typeof s.el&&(s.el.removeEventListener("pointerenter",E),s.el.removeEventListener("pointerleave",_)),Qt().removeEventListener("visibilitychange",C),s.autoplay.running&&T()})),r("_freeModeStaticRelease",(()=>{(u||f)&&S()})),r("_freeModeNoMomentumRelease",(()=>{s.params.autoplay.disableOnInteraction?T():j(!0,!0)})),r("beforeTransitionStart",((e,t,n)=>{!s.destroyed&&s.autoplay.running&&(n||!s.params.autoplay.disableOnInteraction?j(!0,!0):T())})),r("sliderFirstMove",(()=>{!s.destroyed&&s.autoplay.running&&(s.params.autoplay.disableOnInteraction?T():(d=!0,u=!1,f=!1,h=setTimeout((()=>{f=!0,u=!0,j(!0)}),200)))})),r("touchEnd",(()=>{if(!s.destroyed&&s.autoplay.running&&d){if(clearTimeout(h),clearTimeout(t),s.params.autoplay.disableOnInteraction)return u=!1,void(d=!1);u&&s.params.cssMode&&S(),u=!1,d=!1}})),r("slideChange",(()=>{!s.destroyed&&s.autoplay.running&&(p=!0)})),Object.assign(s.autoplay,{start:w,stop:T,pause:j,resume:S})}Il.displayName="SwiperSlide";const Al=({initInterval:e=6e3,initItems:t=[]})=>{const[o,d]=n.useState(!0),[f,m]=n.useState(!1),[x,y]=n.useState(e),[v,b]=n.useState(!0),[k,w]=n.useState(!1),[T,j]=n.useState(50),[S,E]=n.useState(""),[L,D]=n.useState(""),[R,O]=n.useState(""),[M,A]=n.useState([]),[P,Y]=n.useState(t),[G,V]=n.useState(!1),[K,J]=n.useState(!1),[X,Z]=n.useState(!1),Q=n.useRef(null),ee=n.useRef(null),te=n.useRef(null);function ne(e){let t=[],n=0;d(!0),Q.current.swiper.autoplay.stop(),Q.current.swiper.slideTo(0),A([]),D(""),"numbers"===e||"images"===e?(t=Array.from({length:T},(()=>(n=Math.floor(100*Math.random())+1,{text:n.toString(),url:`${n}.png`}))),w("images"!==e),E(t.map((e=>e.text)).join(" "))):"base"===e&&(t=Array.from({length:T},(()=>({text:`${Math.ceil(5*Math.random())}.${Math.ceil(5*Math.random())}.${Math.ceil(5*Math.random())}`,url:""}))),w(!0));const s=t.concat([{text:"",url:""}]);Y(s)}return s.jsxs(i,{sx:{margin:2,display:"flex",flexDirection:"column",maxHeight:"95vh",maxWidth:"700px",minWidth:"300px"},children:[s.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",marginBottom:2},children:[s.jsx(a,{label:"Количество слов",type:"number",variant:"outlined",size:"small",min:1,max:1e3,value:T,onChange:e=>j(e.target.value)}),s.jsxs(i,{display:"flex",gap:1,children:[s.jsx(p,{variant:"outlined",size:"small",onClick:()=>ne("images"),children:"Опорные образы"}),s.jsx(p,{variant:"outlined",size:"small",onClick:()=>ne("numbers"),children:"Числа"}),s.jsx(p,{variant:"outlined",size:"small",onClick:()=>ne("base"),children:"База"})]})]}),s.jsxs(z,{expanded:f,onChange:()=>m(!f),children:[s.jsx(B,{expandIcon:s.jsx(C,{}),children:s.jsx(u,{children:"Набор слов для запоминания"})}),s.jsxs($,{children:[s.jsx(a,{label:"Введите текст",multiline:!0,maxRows:10,variant:"outlined",fullWidth:!0,value:S,onChange:e=>E(e.target.value)}),s.jsx(a,{label:"Введите разделитель",variant:"outlined",fullWidth:!0,value:R,onChange:e=>O(e.target.value),sx:{marginTop:2}}),s.jsx(p,{variant:"outlined",size:"small",onClick:function(){if(D(""),""===S.trim())return;A([]),Q.current.swiper.slideTo(0),Q.current.swiper.autoplay.start(),d(!1),w(!0),m(!1);const e=R||" ",t=S.split(e).filter((e=>""!==e.trim())).map((e=>({text:e,url:""})));Y(t)},sx:{marginTop:2},children:"Начать запоминание"})]})]}),s.jsx(i,{sx:{flexGrow:1,marginTop:2,height:"100%",width:"100%"},children:s.jsxs(_l,{ref:Q,spaceBetween:30,centeredSlides:!0,autoplay:{enabled:!o,delay:x,disableOnInteraction:!1},lazy:"true",pagination:{type:"fraction"},height:"100%",navigation:!0,modules:[Ml,Ol,Dl],onAutoplayTimeLeft:(e,t,n)=>{ee.current.style.setProperty("--progress",1-n),te.current.textContent=`${Math.ceil(t/1e3)}s`},onSlideChange:()=>(Q.current.swiper.activeIndex===P.length-1&&(d(!0),Q.current.swiper.autoplay.stop()),void(v&&new Audio("sounds/click1.mp3").play())),children:[P.map(((e,t)=>s.jsx(Il,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"400px"},children:k?s.jsx(u,{variant:"h3",children:e.text}):s.jsx("img",{src:e.url?`memory/${e.url}`:"memory/placeholder.jpg",alt:e.text,style:{width:"100%",height:"100%"}})},t))),s.jsxs("div",{className:"autoplay-progress",slot:"container-end",children:[s.jsx("svg",{viewBox:"0 0 48 48",ref:ee,children:s.jsx("circle",{cx:"24",cy:"24",r:"20"})}),s.jsx("span",{ref:te})]})]})}),s.jsxs(i,{sx:{display:"flex",alignItems:"center",marginTop:2,width:"100%"},children:[s.jsxs(F,{size:"small",children:[s.jsx(r,{onClick:function(){P.length<1||(o?Q.current.swiper.autoplay.start():Q.current.swiper.autoplay.stop(),d(!o))},children:o?s.jsx(c,{}):s.jsx(l,{})}),s.jsx(r,{onClick:function(){P.length<1||(Q.current.swiper.slideTo(0),Q.current.swiper.autoplay.start(),d(!1))},children:s.jsx(H,{})})]}),s.jsx(h,{min:500,max:15e3,step:500,value:x,onChange:function(e,t){y(t),Q.current.swiper.params.autoplay.delay=t},valueLabelDisplay:"auto",valueLabelFormat:e=>e/1e3+"s","aria-labelledby":"interval-slider",sx:{width:"150px",marginLeft:2,marginRight:2}}),s.jsx(N,{checked:v,onChange:function(){b(!v)},icon:s.jsx(q,{}),checkedIcon:s.jsx(W,{})}),s.jsx(N,{checked:k,onChange:function(){w(!k)},icon:s.jsx(U,{}),checkedIcon:s.jsx(U,{})})]}),s.jsx(a,{label:"Введите текст для проверки",multiline:!0,maxRows:10,variant:"outlined",fullWidth:!0,value:L,onChange:e=>D(e.target.value),sx:{marginTop:2}}),s.jsx(p,{variant:"outlined",size:"large",onClick:async function(){const e=R||" ",t=S.split(e).filter((e=>""!==e.trim())),n=L.split(e).filter((e=>""!==e.trim()));let s=[],i=0;for(let d=0;d<t.length;d++)t[d]===n[d]?(s.push({word:t[d],correct:!0}),i++):s.push({word:t[d],correct:!1});const r=s.map((e=>e.correct?e.word:`<span style="color: red;">${e.word}</span>`)).join(" "),o=(i/t.length*100).toFixed(2),a=`Результат: ${i} из ${t.length} (${o}%)`;A({summary:a,words:s,resultString:r});let l=null;try{if(J(!0),l=await async function(e,t){const n=(new Date).getTimezoneOffset();let s=null;const i=new FormData;i.append("table_name",e),i.append("time_zone",n),i.append("record_info",JSON.stringify(t));try{const e=await fetch("/post_new_record",{method:"POST",body:i});if(!e.ok)throw new Error("Ошибка при отправке новой записи на сервер");s=await e.json()}catch(r){}return s}("diary",{reason:"Memory",comment:`Результат: ${i} из ${t.length} (${o}%)`}),J(!1),!l)throw new Error("Ошибка при отправке");Z(!0)}catch(c){V(c.message||"An unexpected error occurred")}finally{J(!1)}setTimeout((()=>{Z(!1),V(!1)}),5e3)},sx:{marginTop:2},children:"Проверить"}),s.jsxs(i,{sx:{height:"100px"},children:[s.jsx(u,{children:M.summary}),s.jsx(u,{sx:{color:"green"},dangerouslySetInnerHTML:{__html:M.resultString}}),K&&s.jsx(g,{size:24}),G&&s.jsx("p",{style:{color:"red"},children:G}),X&&s.jsx(_,{icon:s.jsx(I,{fontSize:"inherit"}),severity:"success",children:"Результат записан в личный дневник"})]})]})};function Pl(){const{timers:e,setTimers:t,sendTimersToServer:n,addContainer:i}=Ad();if(!e)return null;function r(s,i){const r=e.map((e=>e.id===s?{...e,...i}:e));t(r),n(r)}function o(s){const i=e.filter((e=>e.id!==s));t(i),n(i)}return e?s.jsxs(Y,{sx:{overflowY:"auto",maxHeight:"80vh"},children:[s.jsx(p,{onClick:()=>i("timersToolbar"),children:"Add Timer"}),e.map((e=>s.jsx(Cn,{id:e.id,...e,handleUpdateTimers:r,handleCloseTimer:o},e.id)))]}):null}function zl({element:e,elementId:t,isStartPlay:i=null,onExpireFunc:o=null,currentActionId:a=null}){const[d,u]=n.useState(!1),[h,p]=n.useState(null),[f,m]=n.useState(!1);async function x(){if(h&&d)h.pause(),u(!1);else if(h)h.play(),u(!0);else{m(!0);const n=await fetch("/get_tts_audio",{method:"POST",body:new URLSearchParams({text:e.text})});if(!n.ok)return void m(!1);const s=await n.blob(),i=URL.createObjectURL(s),r=new Audio(i);p(r),r.onended=()=>{u(!1),o&&o(t)},m(!1),r.play(),u(!0)}}return n.useEffect((()=>{i?(u(!0),x()):(u(!1),h&&h.pause())}),[i]),n.useEffect((()=>{a===t&&(u(!0),x())}),[a]),s.jsxs(G,{sx:{margin:0,padding:0},children:[s.jsx(V,{onClick:f?null:x,children:s.jsx(r,{"aria-label":d?"pause":"play",color:"primary",disabled:f,children:f?s.jsx(g,{size:24}):d?s.jsx(l,{}):s.jsx(c,{})})}),s.jsx(K,{id:t,primary:e.text})]})}function Bl({element:e,elementId:t,isStartPlay:i=null,onExpireFunc:r=null,currentActionId:o=null}){return n.useEffect((()=>{i&&document.getElementById(t).play()}),[i]),n.useEffect((()=>{o===t&&document.getElementById(t).play()}),[o]),e?s.jsx("audio",{id:t,controls:!0,src:`audio/${e.url}`,onEnded:()=>{r(t)}}):null}function $l({id:e,survey:t,activeElementId:i=null,onExpireFunc:r=null,autosend:o=!0,taskId:l=null}){const c=null==t?void 0:t.fields,d=["id","date","files","time","table_name","task_id"],u=c.filter((e=>!d.includes(e.field_id))),h=u.reduce(((e,t)=>(e[t.field_id]=t.value||"",e)),{}),[f,m]=n.useState(h),[x,y]=n.useState(!1),[v,b]=n.useState(!1),[k,w]=n.useState(!1),[T,j]=n.useState(""),[S,C]=n.useState(!1),[E,L]=n.useState(0),[D,R]=n.useState(null),O=n.useRef(null),[M,A]=n.useState([]),[P,z]=n.useState({}),{finalTranscript:B,resetTranscript:$,listening:F}=al();if(n.useEffect((()=>{(null==t?void 0:t.table_name)&&(async()=>{try{const e=await fetch(`/get_tables_filters/${t.table_name}`);if(e.ok){const t=await e.json();z(t)}}catch(e){}})()}),[null==t?void 0:t.table_name]),n.useEffect((()=>{i===e&&R(e+t.table_name)}),[i,e,t.table_name]),n.useEffect((()=>{S&&!F&&C(!1)}),[S,F]),n.useEffect((()=>{if(S){const e=u[E-1].field_id;let t=f;"дальше"!==B.toLocaleLowerCase()&&(N(e,B),t={...f,[e]:B}),$(),C(!1),q(E,t)}}),[B]),!u)return null;function H(e){A((t=>{const n=e.filter((e=>!t.some((t=>t.name===e.name&&t.lastModified===e.lastModified))));return[...t,...n]}))}function N(e,t){m((n=>({...n,[e]:t})))}async function W(n,s=null){y(!1),b(!0),s||(s=f),null!==l&&(s.task_id=l);const i=!s.id;let o=null;try{if(o=i?await async function(e,t){const n=`/api/journals/${e}`;try{const e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Ошибка при отправке новой записи на сервер");return await e.json()}catch(s){return null}}(t.table_name,s):await async function(e,t){const n=`/api/journals/${e}/${t.id}`;try{const e=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error("Ошибка при отправке обновленной записи на сервер");return await e.json()}catch(s){return null}}(t.table_name,s),!o)throw new Error("Ошибка при отправке");A([]);const e={};o.data?(Object.keys(o.data).forEach((t=>{u.some((e=>e.field_id===t))&&(e[t]=o.data[t])})),e.id=o.id):(Object.keys(o).forEach((t=>{u.some((e=>e.field_id===t))&&(e[t]=o[t])})),e.id=o.id),m(e),j(i?"Запись создана":"Запись обновлена"),w(!0)}catch(a){y(a.message||"An unexpected error occurred")}finally{b(!1),r&&r(e)}}async function q(n,s=null){s||(s=f);let i=E;n==e+t.table_name&&(i=0,L(0));let r=u[i];for(;r&&"false"===r.check;)i++,r=u[i];if(L(i+1),i>=u.length)return void(o&&W(0,s));const a=await(l=r.field_name,fetch("/get_tts_audio_filename",{method:"POST",body:new URLSearchParams({text:l}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>{if(!e.ok)throw new Error("Network response was not ok "+e.statusText);return e.json()})).then((e=>e.filename)).catch((e=>{})));var l;const c=new Audio(`temp/${a}`);c.onended=()=>{C(!0),ll.startListening()},c.play()}return s.jsxs(Y,{onPaste:function(e){var t;const n=null==(t=e.clipboardData)?void 0:t.items;if(!n)return;const s=[];for(const i of n)if("file"===i.kind){const e=i.getAsFile();e&&s.push(e)}s.length&&(e.preventDefault(),H(s))},onDrop:function(e){e.preventDefault();const t=Array.from(e.dataTransfer.files);t.length&&H(t)},onDragOver:function(e){e.preventDefault()},children:[s.jsxs("p",{children:["Имя таблицы: ",t.table_name]}),s.jsx(zl,{element:{text:t.text},elementId:e+t.table_name,onExpireFunc:q,currentActionId:D},e+t.table_name),u.map((t=>{const n=t.type||"text",i=P[t.field_id]||[];return"select"===n&&i.length>0?s.jsx("div",{style:{marginBottom:"1rem"},children:s.jsx(J,{freeSolo:!0,options:i,value:f[t.field_id]||"",onChange:(e,n)=>{N(t.field_id,n||"")},onInputChange:(e,n)=>{N(t.field_id,n)},renderInput:e=>s.jsx(a,{...e,label:t.field_name,fullWidth:!0})})},e+t.field_id):s.jsx("div",{style:{marginBottom:"1rem"},children:s.jsx(a,{id:e+t.field_id,label:t.field_name,multiline:"textarea"===n,maxRows:15,fullWidth:!0,type:"number"===n?"number":"date"===n?"date":"text",value:f[t.field_id]||"",onChange:e=>N(t.field_id,e.target.value)})},e+t.field_id)})),v?s.jsx(g,{size:24}):s.jsxs(Y,{children:[M&&M.length>0&&s.jsx(cl,{files:M,setFiles:A}),s.jsx("input",{type:"file",multiple:!0,ref:O,style:{display:"none"},onChange:function(e){H(Array.from(e.target.files)),O.current.value=""}}),s.jsx(p,{onClick:W,disabled:v,children:"Записать"}),s.jsx(p,{onClick:()=>O.current.click(),disabled:v,children:"Прикрепить файл"})]}),x&&s.jsx("p",{style:{color:"red"},children:x}),k&&s.jsx(_,{icon:s.jsx(I,{fontSize:"inherit"}),severity:"success",children:T})]})}function Fl({isRunningProp:e=!1,updateProgress:t}){var o;const[d,h]=n.useState(e),[p,f]=n.useState(null),[m,g]=n.useState(!1),[x,y]=n.useState(null),[v,b]=n.useState("my_day"),k=n.useMemo((()=>[{label:"Демонстрация",src:"demo"},{label:"Продуктивность",src:"productivity"},{label:"Расслабление",src:"relax"},{label:"Мой день",src:"my_day"}]),[]);async function w(e,t){b(t),y(null),h(!1),f(null),g(!1);const n=await async function(e){try{const t=await fetch(`/get_scenario/${e}`);if(!t.ok)throw new Error("Network response was not ok");return(await t.json()).scenario}catch(t){return null}}(t);y(n)}function T(e){if(!d)return;const t=e.split("_"),n=t[1];let s=parseInt(t[2]);if(s>=x.steps[n].actions.length-1)return s=0,n>=x.steps.length-1?void h(!1):(f(`el_${parseInt(n)+1}_0`),void g(`panel_${parseInt(n)+1}`));f(`el_${n}_${s+1}`)}function j(e,t,n){const i=`el_${n}_${t}`;let r=0,o=null,a=!1;switch(e.type){case"timer":if(e.endtime)o=e.endtime,a=!0;else for(let t=0;t<e.time.length;t++)r+=parseInt(e.time[t])*Math.pow(60,e.time.length-1-t);return s.jsx(Cn,{id:i,resultText:e.name,initialEndTimeProp:o,initialTimeProp:o?void 0:r,onExpireFunc:T,currentActionId:p,isRunningProp:a},i);case"metronome":return s.jsx(En,{intialName:e.name,initialCount:e.count,initialBpm:e.bpm,id:i,onExpireFunc:T,currentActionId:p},i);case"text":return s.jsx(zl,{element:e,elementId:i,isScenarioRunning:d,onExpireFunc:T,currentActionId:p},i);case"audio":return s.jsx(Bl,{element:e,elementId:i,isStartPlay:!1,onExpireFunc:T,currentActionId:p},i);case"survey":return s.jsx($l,{id:i,survey:e,onExpireFunc:T,activeElementId:p},i);default:return null}}function S(e,t){const n=m===`panel_${t}`;return s.jsxs(z,{expanded:n,onChange:()=>g(!n&&`panel_${t}`),children:[s.jsx(B,{expandIcon:s.jsx(C,{}),sx:{padding:0},children:s.jsxs(G,{sx:{margin:0,padding:0},children:[s.jsx(V,{onClick:e=>{e.stopPropagation(),function(e){d?h(!1):(f(`el_${e}_0`),h(!0),g(`panel_${e}`))}(t)},children:s.jsx(r,{"aria-label":"play",color:"primary",children:d?s.jsx(l,{}):s.jsx(c,{})})}),s.jsx(K,{id:t,primary:"Этап "+parseInt(t+1)+". "+e.name})]})}),s.jsx($,{sx:{border:1,borderColor:"divider"},children:e.actions.map(((e,n)=>s.jsx(i,{my:2,width:"100%",sx:{alignItems:"center",display:"flex",justifyContent:"center"},children:j(e,n,t)},n)))})]},t)}return n.useEffect((()=>{p||f("el_0_0"),h(e)}),[e]),n.useEffect((()=>{var e;const n=(null==p?void 0:p.split("_")[1])||0,s=null==x?void 0:x.steps[n].name,i=6e5,r=(null==(e=k.find((e=>e.src===v)))?void 0:e.label)||"Выберите сценарий";t&&t(r,60,i,s)}),[d,t,p,x,v,k]),s.jsxs(i,{sx:{maxWidth:"700px",minWidth:"300px",margin:"auto"},children:[s.jsx(J,{disablePortal:!0,id:"combo-box-demo",options:k,sx:{width:"100%",padding:1},renderInput:e=>s.jsx(a,{...e,label:"Сценарии"}),onChange:(e,t)=>{w(0,(null==t?void 0:t.src)||null)}}),x&&s.jsxs(s.Fragment,{children:[s.jsx(u,{variant:"h4",sx:{textAlign:"center",m:1},children:x.name}),null==(o=x.steps)?void 0:o.map(((e,t)=>S(e,t)))]})]})}Al.propTypes={initInterval:m.number,initItems:m.arrayOf(m.shape({text:m.string,url:m.string}))},zl.propTypes={element:t.PropTypes.object.isRequired,elementId:t.PropTypes.string.isRequired,isStartPlay:t.PropTypes.bool,onExpireFunc:t.PropTypes.func,currentActionId:t.PropTypes.string},Bl.propTypes={element:t.PropTypes.object,elementId:t.PropTypes.string,isStartPlay:t.PropTypes.bool,onExpireFunc:t.PropTypes.func,currentActionId:t.PropTypes.string},$l.propTypes={id:t.PropTypes.string.isRequired,survey:t.PropTypes.object.isRequired,activeElementId:t.PropTypes.string,onExpireFunc:t.PropTypes.func,autosend:t.PropTypes.bool,taskId:t.PropTypes.oneOfType([t.PropTypes.string,t.PropTypes.number])},Fl.propTypes={scenario:t.PropTypes.object,isRunningProp:t.PropTypes.bool,updateProgress:t.PropTypes.func};const Hl=()=>{const{listening:e}=al(),{isSecretarySpeak:t}=Ad(),n=t?"avatars/speak-anime.gif":e?"avatars/noted.webp":"avatars/sleep.webp";return s.jsx(v,{sx:{maxWidth:240},children:s.jsx(X,{component:"img",height:"250",image:n,alt:"status image"})})},Nl=n.createContext(),Wl=()=>{const e=n.useContext(Nl);if(!e)throw new Error("useAccessControl must be used within AccessControlProvider");return e},ql=({children:e})=>{const[t,i]=n.useState(null),[r,o]=n.useState(!0);n.useEffect((()=>{a()}),[]);const a=async()=>{try{const e=await en.get("/api/user/permissions");i(e.data)}catch(e){i({features:["tasks"],max_containers:2})}finally{o(!1)}};return s.jsx(Nl.Provider,{value:{userPermissions:t,hasAccess:e=>!!t&&(t.features.includes("*")||t.features.includes(e)),canAddContainer:e=>!!t&&(-1===t.max_containers||e<t.max_containers),loading:r,refreshPermissions:a},children:e})};function Ul(){const{hasAccess:e}=Wl();return e("chat")?s.jsx(i,{sx:{position:"relative",display:"flex",flexDirection:"column",gap:1,height:"100%",width:"100%"},children:s.jsxs(Qs,{children:[s.jsx(za,{}),s.jsx(ul,{})]})}):s.jsxs(i,{sx:{p:3,textAlign:"center"},children:[s.jsx(u,{variant:"h6",gutterBottom:!0,children:"Чат доступен только в платных тарифах"}),s.jsx(u,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Обновите тариф для доступа к функции чата"}),s.jsx(p,{variant:"contained",sx:{mt:2},children:"Выбрать тариф"})]})}const Yl=A(tn());var Gl,Vl={exports:{}};var Kl=(Gl||(Gl=1,Vl.exports=function(){var e="week",t="year";return function(n,s,i){var r=s.prototype;r.week=function(n){if(void 0===n&&(n=null),null!==n)return this.add(7*(n-this.week()),"day");var s=this.$locale().yearStart||1;if(11===this.month()&&this.date()>25){var r=i(this).startOf(t).add(1,t).date(s),o=i(this).endOf(e);if(r.isBefore(o))return 1}var a=i(this).startOf(t).date(s).startOf(e).subtract(1,"millisecond"),l=this.diff(a,e,!0);return l<0?i(this).startOf("week").week():Math.ceil(l)},r.weeks=function(e){return void 0===e&&(e=null),this.week(e)}}}()),Vl.exports);const Jl=A(Kl);var Xl,Zl={exports:{}};var Ql=(Xl||(Xl=1,Zl.exports=function(){var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},t=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,n=/\d/,s=/\d\d/,i=/\d\d?/,r=/\d*[^-_:/,()\s\d]+/,o={},a=function(e){return(e=+e)+(e>68?1900:2e3)},l=function(e){return function(t){this[e]=+t}},c=[/[+-]\d\d:?(\d\d)?|Z/,function(e){(this.zone||(this.zone={})).offset=function(e){if(!e)return 0;if("Z"===e)return 0;var t=e.match(/([+-]|\d\d)/g),n=60*t[1]+(+t[2]||0);return 0===n?0:"+"===t[0]?-n:n}(e)}],d=function(e){var t=o[e];return t&&(t.indexOf?t:t.s.concat(t.f))},u=function(e,t){var n,s=o.meridiem;if(s){for(var i=1;i<=24;i+=1)if(e.indexOf(s(i,0,t))>-1){n=i>12;break}}else n=e===(t?"pm":"PM");return n},h={A:[r,function(e){this.afternoon=u(e,!1)}],a:[r,function(e){this.afternoon=u(e,!0)}],Q:[n,function(e){this.month=3*(e-1)+1}],S:[n,function(e){this.milliseconds=100*+e}],SS:[s,function(e){this.milliseconds=10*+e}],SSS:[/\d{3}/,function(e){this.milliseconds=+e}],s:[i,l("seconds")],ss:[i,l("seconds")],m:[i,l("minutes")],mm:[i,l("minutes")],H:[i,l("hours")],h:[i,l("hours")],HH:[i,l("hours")],hh:[i,l("hours")],D:[i,l("day")],DD:[s,l("day")],Do:[r,function(e){var t=o.ordinal,n=e.match(/\d+/);if(this.day=n[0],t)for(var s=1;s<=31;s+=1)t(s).replace(/\[|\]/g,"")===e&&(this.day=s)}],w:[i,l("week")],ww:[s,l("week")],M:[i,l("month")],MM:[s,l("month")],MMM:[r,function(e){var t=d("months"),n=(d("monthsShort")||t.map((function(e){return e.slice(0,3)}))).indexOf(e)+1;if(n<1)throw new Error;this.month=n%12||n}],MMMM:[r,function(e){var t=d("months").indexOf(e)+1;if(t<1)throw new Error;this.month=t%12||t}],Y:[/[+-]?\d+/,l("year")],YY:[s,function(e){this.year=a(e)}],YYYY:[/\d{4}/,l("year")],Z:c,ZZ:c};function p(n){var s,i;s=n,i=o&&o.formats;for(var r=(n=s.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(t,n,s){var r=s&&s.toUpperCase();return n||i[s]||e[s]||i[r].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(e,t,n){return t||n.slice(1)}))}))).match(t),a=r.length,l=0;l<a;l+=1){var c=r[l],d=h[c],u=d&&d[0],p=d&&d[1];r[l]=p?{regex:u,parser:p}:c.replace(/^\[|\]$/g,"")}return function(e){for(var t={},n=0,s=0;n<a;n+=1){var i=r[n];if("string"==typeof i)s+=i.length;else{var o=i.regex,l=i.parser,c=e.slice(s),d=o.exec(c)[0];l.call(t,d),e=e.replace(d,"")}}return function(e){var t=e.afternoon;if(void 0!==t){var n=e.hours;t?n<12&&(e.hours+=12):12===n&&(e.hours=0),delete e.afternoon}}(t),t}}return function(e,t,n){n.p.customParseFormat=!0,e&&e.parseTwoDigitYear&&(a=e.parseTwoDigitYear);var s=t.prototype,i=s.parse;s.parse=function(e){var t=e.date,s=e.utc,r=e.args;this.$u=s;var a=r[1];if("string"==typeof a){var l=!0===r[2],c=!0===r[3],d=l||c,u=r[2];c&&(u=r[2]),o=this.$locale(),!l&&u&&(o=n.Ls[u]),this.$d=function(e,t,n,s){try{if(["x","X"].indexOf(t)>-1)return new Date(("X"===t?1e3:1)*e);var i=p(t)(e),r=i.year,o=i.month,a=i.day,l=i.hours,c=i.minutes,d=i.seconds,u=i.milliseconds,h=i.zone,f=i.week,m=new Date,g=a||(r||o?1:m.getDate()),x=r||m.getFullYear(),y=0;r&&!o||(y=o>0?o-1:m.getMonth());var v,b=l||0,k=c||0,w=d||0,T=u||0;return h?new Date(Date.UTC(x,y,g,b,k,w,T+60*h.offset*1e3)):n?new Date(Date.UTC(x,y,g,b,k,w,T)):(v=new Date(x,y,g,b,k,w,T),f&&(v=s(v).week(f).toDate()),v)}catch(j){return new Date("")}}(t,a,s,n),this.init(),u&&!0!==u&&(this.$L=this.locale(u).$L),d&&t!=this.format(a)&&(this.$d=new Date("")),o={}}else if(a instanceof Array)for(var h=a.length,f=1;f<=h;f+=1){r[1]=a[f-1];var m=n.apply(this,r);if(m.isValid()){this.$d=m.$d,this.$L=m.$L,this.init();break}f===h&&(this.$d=new Date(""))}else i.call(this,e)}}}()),Zl.exports);const ec=A(Ql);var tc,nc={exports:{}};var sc=(tc||(tc=1,nc.exports=function(){var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(t,n,s){var i=n.prototype,r=i.format;s.en.formats=e,i.format=function(t){void 0===t&&(t="YYYY-MM-DDTHH:mm:ssZ");var n,s=this.$locale().formats,i=(n=void 0===s?{}:s,t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(t,s,i){var r=i&&i.toUpperCase();return s||n[i]||e[i]||n[r].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(e,t,n){return t||n.slice(1)}))})));return r.call(this,i)}}}()),nc.exports);const ic=A(sc);var rc,oc={exports:{}};const ac=A(rc?oc.exports:(rc=1,oc.exports=function(e,t,n){t.prototype.isBetween=function(e,t,s,i){var r=n(e),o=n(t),a="("===(i=i||"()")[0],l=")"===i[1];return(a?this.isAfter(r,s):!this.isBefore(r,s))&&(l?this.isBefore(o,s):!this.isAfter(o,s))||(a?this.isBefore(r,s):!this.isAfter(r,s))&&(l?this.isAfter(o,s):!this.isBefore(o,s))}}));var lc,cc={exports:{}};const dc=A(lc?cc.exports:(lc=1,cc.exports=function(e,t){var n=t.prototype,s=n.format;n.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return s.bind(this)(e);var i=this.$utils(),r=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return n.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return n.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return s.bind(this)(r)}}));Yl.extend(ic),Yl.extend(Jl),Yl.extend(ac),Yl.extend(dc);const uc={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},hc={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",dayOfMonthFull:"Do",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},pc=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join("\n"),fc=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join("\n");class mc{constructor({locale:e,formats:t}={}){var n,s;this.isMUIAdapter=!0,this.isTimezoneCompatible=!0,this.lib="dayjs",this.dayjs=void 0,this.locale=void 0,this.formats=void 0,this.escapedCharacters={start:"[",end:"]"},this.formatTokenMap=uc,this.setLocaleToValue=e=>{const t=this.getCurrentLocaleCode();return t===e.locale()?e:e.locale(t)},this.hasUTCPlugin=()=>void 0!==Yl.utc,this.hasTimezonePlugin=()=>void 0!==Yl.tz,this.isSame=(e,t,n)=>{const s=this.setTimezone(t,this.getTimezone(e));return e.format(n)===s.format(n)},this.cleanTimezone=e=>{switch(e){case"default":return;case"system":return Yl.tz.guess();default:return e}},this.createSystemDate=e=>{if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const t=Yl.tz.guess();return"UTC"!==t?Yl.tz(e,t):Yl(e)}return Yl(e)},this.createUTCDate=e=>{if(!this.hasUTCPlugin())throw new Error(pc);return Yl.utc(e)},this.createTZDate=(e,t)=>{if(!this.hasUTCPlugin())throw new Error(pc);if(!this.hasTimezonePlugin())throw new Error(fc);const n=void 0!==e&&!e.endsWith("Z");return Yl(e).tz(this.cleanTimezone(t),n)},this.getLocaleFormats=()=>{const e=Yl.Ls;let t=e[this.locale||"en"];return void 0===t&&(t=e.en),t.formats},this.adjustOffset=e=>{if(!this.hasTimezonePlugin())return e;const t=this.getTimezone(e);if("UTC"!==t){const n=e.tz(this.cleanTimezone(t),!0);if(n.$offset===(e.$offset??0))return e;e.$offset=n.$offset}return e},this.date=(e,t="default")=>{if(null===e)return null;let n;return n="UTC"===t?this.createUTCDate(e):"system"===t||"default"===t&&!this.hasTimezonePlugin()?this.createSystemDate(e):this.createTZDate(e,t),void 0===this.locale?n:n.locale(this.locale)},this.getInvalidDate=()=>Yl(new Date("Invalid date")),this.getTimezone=e=>{var t;if(this.hasTimezonePlugin()){const n=null==(t=e.$x)?void 0:t.$timezone;if(n)return n}return this.hasUTCPlugin()&&e.isUTC()?"UTC":"system"},this.setTimezone=(e,t)=>{if(this.getTimezone(e)===t)return e;if("UTC"===t){if(!this.hasUTCPlugin())throw new Error(pc);return e.utc()}if("system"===t)return e.local();if(!this.hasTimezonePlugin()){if("default"===t)return e;throw new Error(fc)}return Yl.tz(e,this.cleanTimezone(t))},this.toJsDate=e=>e.toDate(),this.parse=(e,t)=>""===e?null:this.dayjs(e,t,this.locale,!0),this.getCurrentLocaleCode=()=>this.locale||"en",this.is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||""),this.expandFormat=e=>{const t=this.getLocaleFormats();return e.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,((e,n,s)=>{const i=s&&s.toUpperCase();return n||t[s]||t[i].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,((e,t,n)=>t||n.slice(1)))}))},this.isValid=e=>null!=e&&e.isValid(),this.format=(e,t)=>this.formatByString(e,this.formats[t]),this.formatByString=(e,t)=>this.dayjs(e).format(t),this.formatNumber=e=>e,this.isEqual=(e,t)=>null===e&&null===t||null!==e&&null!==t&&e.toDate().getTime()===t.toDate().getTime(),this.isSameYear=(e,t)=>this.isSame(e,t,"YYYY"),this.isSameMonth=(e,t)=>this.isSame(e,t,"YYYY-MM"),this.isSameDay=(e,t)=>this.isSame(e,t,"YYYY-MM-DD"),this.isSameHour=(e,t)=>e.isSame(t,"hour"),this.isAfter=(e,t)=>e>t,this.isAfterYear=(e,t)=>this.hasUTCPlugin()?!this.isSameYear(e,t)&&e.utc()>t.utc():e.isAfter(t,"year"),this.isAfterDay=(e,t)=>this.hasUTCPlugin()?!this.isSameDay(e,t)&&e.utc()>t.utc():e.isAfter(t,"day"),this.isBefore=(e,t)=>e<t,this.isBeforeYear=(e,t)=>this.hasUTCPlugin()?!this.isSameYear(e,t)&&e.utc()<t.utc():e.isBefore(t,"year"),this.isBeforeDay=(e,t)=>this.hasUTCPlugin()?!this.isSameDay(e,t)&&e.utc()<t.utc():e.isBefore(t,"day"),this.isWithinRange=(e,[t,n])=>e>=t&&e<=n,this.startOfYear=e=>this.adjustOffset(e.startOf("year")),this.startOfMonth=e=>this.adjustOffset(e.startOf("month")),this.startOfWeek=e=>this.adjustOffset(this.setLocaleToValue(e).startOf("week")),this.startOfDay=e=>this.adjustOffset(e.startOf("day")),this.endOfYear=e=>this.adjustOffset(e.endOf("year")),this.endOfMonth=e=>this.adjustOffset(e.endOf("month")),this.endOfWeek=e=>this.adjustOffset(this.setLocaleToValue(e).endOf("week")),this.endOfDay=e=>this.adjustOffset(e.endOf("day")),this.addYears=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"year"):e.add(t,"year")),this.addMonths=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"month"):e.add(t,"month")),this.addWeeks=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"week"):e.add(t,"week")),this.addDays=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"day"):e.add(t,"day")),this.addHours=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"hour"):e.add(t,"hour")),this.addMinutes=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"minute"):e.add(t,"minute")),this.addSeconds=(e,t)=>this.adjustOffset(t<0?e.subtract(Math.abs(t),"second"):e.add(t,"second")),this.getYear=e=>e.year(),this.getMonth=e=>e.month(),this.getDate=e=>e.date(),this.getHours=e=>e.hour(),this.getMinutes=e=>e.minute(),this.getSeconds=e=>e.second(),this.getMilliseconds=e=>e.millisecond(),this.setYear=(e,t)=>this.adjustOffset(e.set("year",t)),this.setMonth=(e,t)=>this.adjustOffset(e.set("month",t)),this.setDate=(e,t)=>this.adjustOffset(e.set("date",t)),this.setHours=(e,t)=>this.adjustOffset(e.set("hour",t)),this.setMinutes=(e,t)=>this.adjustOffset(e.set("minute",t)),this.setSeconds=(e,t)=>this.adjustOffset(e.set("second",t)),this.setMilliseconds=(e,t)=>this.adjustOffset(e.set("millisecond",t)),this.getDaysInMonth=e=>e.daysInMonth(),this.getWeekArray=e=>{const t=this.startOfWeek(this.startOfMonth(e)),n=this.endOfWeek(this.endOfMonth(e));let s=0,i=t;const r=[];for(;i<n;){const e=Math.floor(s/7);r[e]=r[e]||[],r[e].push(i),i=this.addDays(i,1),s+=1}return r},this.getWeekNumber=e=>e.week(),this.getYearRange=([e,t])=>{const n=this.startOfYear(e),s=this.endOfYear(t),i=[];let r=n;for(;this.isBefore(r,s);)i.push(r),r=this.addYears(r,1);return i},this.dayjs=(n=Yl,(s=e)?(...e)=>n(...e).locale(s):n),this.locale=e,this.formats=Z({},hc,t),Yl.extend(ec)}getDayOfWeek(e){return e.day()+1}}var gc,xc={exports:{}};var yc=(gc||(gc=1,xc.exports=function(){var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,n=/([+-]|\d\d)/g;return function(s,i,r){var o=i.prototype;r.utc=function(e){return new i({date:e,utc:!0,args:arguments})},o.utc=function(t){var n=r(this.toDate(),{locale:this.$L,utc:!0});return t?n.add(this.utcOffset(),e):n},o.local=function(){return r(this.toDate(),{locale:this.$L,utc:!1})};var a=o.parse;o.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),a.call(this,e)};var l=o.init;o.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else l.call(this)};var c=o.utcOffset;o.utcOffset=function(s,i){var r=this.$utils().u;if(r(s))return this.$u?0:r(this.$offset)?c.call(this):this.$offset;if("string"==typeof s&&null===(s=function(e){void 0===e&&(e="");var s=e.match(t);if(!s)return null;var i=(""+s[0]).match(n)||["-",0,0],r=i[0],o=60*+i[1]+ +i[2];return 0===o?0:"+"===r?o:-o}(s)))return this;var o=Math.abs(s)<=16?60*s:s,a=this;if(i)return a.$offset=o,a.$u=0===s,a;if(0!==s){var l=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(a=this.local().add(o+l,e)).$offset=o,a.$x.$localOffset=l}else a=this.utc();return a};var d=o.format;o.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return d.call(this,t)},o.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var u=o.toDate;o.toDate=function(e){return"s"===e&&this.$offset?r(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():u.call(this)};var h=o.diff;o.diff=function(e,t,n){if(e&&this.$u===e.$u)return h.call(this,e,t,n);var s=this.local(),i=r(e).local();return h.call(s,i,t,n)}}}()),xc.exports);const vc=A(yc);function bc({open:e,handleClose:t,taskId:i=null,tableSurvey:r=null,tablesList:o=null,onTableChange:l}){const[c,d]=n.useState(o||[]),[u,h]=n.useState(r||null);function f(){t&&t()}async function m(e,t=null){if(l)l(e);else{if(!e)return;const n=Yl().utc().startOf("day"),s=n.month()+1,i=n.year();t||(t=(new Date).getTimezoneOffset());const r=await async function(e,t,n,s){const i=t<10?`0${t}`:`${t}`;try{const t=await fetch(`/get_days?table_name=${e}&month=${i}&year=${n}&timezone=${s}`);if(!t.ok)throw new Error(`Network response was not ok: ${t.statusText}`);return await t.json()||[]}catch(r){}}(e,s,i,t),o=r.survey;h(o)}}return n.useEffect((()=>{o||(async()=>{const e=await async function(){try{const e=await fetch("/get_tables");if(!e.ok)throw new Error("Network response was not ok");return(await e.json()).tables}catch(e){}}();d(e)})()}),[]),n.useEffect((()=>{o&&d(o)}),[o]),n.useEffect((()=>{r&&h(r)}),[r]),s.jsxs(Q,{open:e,onClose:f,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[s.jsx(ee,{id:"scroll-dialog-title",children:"Добавить новую запись"}),s.jsxs(te,{dividers:"paper"===scroll,style:{width:"500px",minHeight:"500px"},children:[c&&c.length>0&&s.jsx(J,{disablePortal:!0,id:"combo-box-demo",options:c||[],sx:{width:"100%",padding:1},renderInput:e=>s.jsx(a,{...e,label:"Таблица"}),onChange:(e,t)=>m((null==t?void 0:t.src)||null)}),u&&s.jsx(Y,{children:s.jsx($l,{id:"addRecordSurvey",survey:u,activeElementId:null,onExpireFunc:null,autosend:!1,taskId:i},"addRecordSurvey")})]}),s.jsx(ne,{children:s.jsx(p,{onClick:f,children:"Закрыть"})})]})}async function kc(e,{method:t="GET",body:n,headers:s={}}={}){const i={method:t,headers:{"Content-Type":"application/json",...s}};n&&(i.body=JSON.stringify(n));const r=await fetch(e,i);if(!r.ok){let e="";try{const t=await r.json();e=t.message||JSON.stringify(t)}catch{e=r.statusText}throw new Error(e||"Ошибка запроса")}return r.json()}Yl.extend(vc),bc.propTypes={open:t.PropTypes.bool.isRequired,handleClose:t.PropTypes.func,tableSurvey:t.PropTypes.object,tablesList:t.PropTypes.array,onTableChange:t.PropTypes.func,taskId:t.PropTypes.oneOfType([t.PropTypes.string,t.PropTypes.number])};async function wc(e,t){try{const n=6e4*(new Date).getTimezoneOffset();return await kc(`/get_table_data?table_name=${e}&date=${t}&timezone_offset=${n}`)}catch(n){return{records:[],columns:[]}}}const Tc=({showFilters:e,filtersConfig:t,filters:n,dropdownValues:r,handleFilterChange:o,resetFilters:l,applyFilters:c,loadingFilteredRecords:d})=>{var h,f,m,g;return e&&t?s.jsxs(i,{sx:{marginBottom:2,padding:2,border:"1px solid #ccc",borderRadius:2},children:[s.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Фильтры"}),null==(h=t.date)?void 0:h.map((e=>s.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,marginBottom:2},children:[s.jsx(a,{label:`${e} от`,type:"date",InputLabelProps:{shrink:!0},value:n[`${e}_from`]||"",onChange:t=>o(`${e}_from`,t.target.value),disabled:d}),s.jsx(a,{label:`${e} до`,type:"date",InputLabelProps:{shrink:!0},value:n[`${e}_to`]||"",onChange:t=>o(`${e}_to`,t.target.value),disabled:d})]},e))),null==(f=t.dropdown)?void 0:f.map((e=>{var t;return s.jsxs(se,{sx:{minWidth:150,marginRight:2,marginBottom:2},disabled:d,children:[s.jsx(ie,{children:e}),s.jsx(re,{multiple:!0,value:n[e]||[],onChange:t=>o(e,t.target.value),renderValue:e=>e.join(", "),label:e,children:null==(t=r[e])?void 0:t.map((t=>s.jsxs(oe,{value:t,children:[s.jsx(ae,{checked:(n[e]||[]).includes(t)}),s.jsx(K,{primary:t})]},t)))})]},e)})),null==(m=t.text)?void 0:m.map((e=>s.jsx(a,{label:e,variant:"outlined",value:n[e]||"",onChange:t=>o(e,t.target.value),sx:{marginRight:2,marginBottom:2},disabled:d},e))),null==(g=t.range)?void 0:g.map((e=>s.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,marginBottom:2},children:[s.jsx(a,{label:`${e} от`,type:"number",value:n[`${e}_min`]||"",onChange:t=>o(`${e}_min`,t.target.value),disabled:d}),s.jsx(a,{label:`${e} до`,type:"number",value:n[`${e}_max`]||"",onChange:t=>o(`${e}_max`,t.target.value),disabled:d})]},e))),s.jsxs(i,{sx:{display:"flex",gap:2,marginTop:2},children:[s.jsx(p,{variant:"outlined",onClick:l,disabled:d,children:"Сбросить фильтры"}),s.jsx(p,{variant:"contained",onClick:c,disabled:d,children:"Загрузить"})]})]}):null};Tc.propTypes={showFilters:m.bool,filtersConfig:m.object,filters:m.object,handleFilterChange:m.func,resetFilters:m.func,applyFilters:m.func,loadingFilteredRecords:m.bool,dropdownValues:m.object};const jc=n.forwardRef((({initialMarkdown:e="",onChange:t},i)=>{const r=Ht({trailingBlock:!1}),o=n.useRef(!0);return n.useEffect((()=>{if(!r)return;(async()=>{const t="string"==typeof e?e.trim():"",n=await r.tryParseMarkdownToBlocks(t);r.replaceBlocks(r.document,n),o.current=!1})()}),[e,r]),r.onEditorContentChange((()=>{o.current||t&&t()})),n.useImperativeHandle(i,(()=>({getMarkdown:async()=>(await r.blocksToMarkdownLossy(r.document)).trim(),setMarkdown:async e=>{const t=await r.tryParseMarkdownToBlocks(e);r.replaceBlocks(r.document,t)}}))),s.jsx(Nt,{editor:r,style:{padding:2}})}));function Sc({editor:e,index:t,tableSurvey:n,onCheck:a,onSave:l,onAIEnhance:c,onGenerateImage:d,onPostToSocials:h,dispatchEditors:f}){var m;const y=e.record||{},v=e.ref,b=(null==(m=null==n?void 0:n.fields)?void 0:m.map((e=>e.field_id)))||[],k=b.length?b:Object.keys(y),w=e=>{var t;const s=null==(t=null==n?void 0:n.fields)?void 0:t.find((t=>t.field_id===e));return s?s.field_name:e},T=e=>{if(!e)return null;const t=e.split(";").filter(Boolean);return s.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:t.map(((e,t)=>{const n=function(e){const t=e.replace(/\\/g,"/").split("/"),[n,s,i]=t;return`/journals/file?${new URLSearchParams({category:n,date_folder:s,filename:i}).toString()}`}(e.trim());return/\.(png|jpe?g|gif|webp|md|txt)$/i.test(n)?s.jsx(In,{url:n},t):s.jsxs(p,{href:n,target:"_blank",startIcon:s.jsx(x,{}),children:["Файл ",t+1]},t)}))})};return s.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:0,padding:0,alignItems:"stretch",marginBottom:0,background:"transparent"},children:[s.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:1,backgroundColor:"background.paper",padding:0,borderBottom:"2px solid  '#ccc'",boxShadow:"0 2px 8px -5px rgba(0,0,0,0.3)",marginBottom:"-2px",transition:"border-color 0.5s ease"},children:[s.jsx(i,{sx:{display:"flex",alignItems:"center"},children:s.jsx(ae,{checked:e.checked,onChange:e=>a(t,e.target.checked)})}),s.jsxs(i,{sx:{display:"flex",gap:1},children:[s.jsx(r,{variant:"contained",disabled:"idle"!==e.saveStatus,onClick:()=>l(t),sx:{"&:hover":{backgroundColor:e.hasUnsavedChanges?"#c8e6c9":void 0},"& .MuiSvgIcon-root":{color:e.hasUnsavedChanges?"#4caf50":void 0,animation:e.hasUnsavedChanges?"pulseIcon 1.2s infinite":void 0},"@keyframes pulseIcon":{"0%":{transform:"scale(1)",filter:"drop-shadow(0 0 0 #4caf50)"},"70%":{transform:"scale(1.15)",filter:"drop-shadow(0 0 8px #4caf50)"},"100%":{transform:"scale(1)",filter:"drop-shadow(0 0 0 #4caf50)"}}},children:"saving"===e.saveStatus?s.jsx(g,{size:24}):"success"===e.saveStatus?s.jsx(I,{}):s.jsx(le,{})}),s.jsx(r,{variant:"contained",onClick:()=>c(t),disabled:"loading"===e.aiResponseStatus,children:"loading"===e.aiResponseStatus?s.jsx(g,{size:24}):"success"===e.aiResponseStatus?s.jsx(I,{}):s.jsx(ce,{})}),s.jsx(r,{variant:"contained",disabled:"loading"===e.imageGenerateStatus,onClick:()=>d(t),children:"loading"===e.imageGenerateStatus?s.jsx(g,{size:24}):s.jsx(de,{})}),s.jsx(r,{variant:"contained",children:s.jsx(x,{})}),s.jsx(r,{variant:"contained",onClick:()=>h(t),disabled:"loading"===e.sendToSocialsStatus,children:"loading"===e.sendToSocialsStatus?s.jsx(g,{size:24}):"success"===e.sendToSocialsStatus?s.jsx(I,{}):"fail"===e.sendToSocialsStatus?s.jsx(ue,{}):s.jsx(he,{})})]})]}),s.jsxs(i,{sx:{display:"flex",gap:2,borderBottom:"2px solid "+(e.hasUnsavedChanges?"#f44336":"#ccc"),background:"white",transition:"border-color 0.5s ease"},children:[s.jsx(i,{sx:{flex:e.aiResponse?1:"100%",p:1},children:k.map((e=>"files"===e&&y[e]?s.jsxs(i,{sx:{mb:1},children:[s.jsx(u,{variant:"h6",children:"Вложения"}),T(y[e])]},e):"id"===e?s.jsx(i,{sx:{mb:1},children:s.jsxs(u,{variant:"h6",children:["id Записи: ",y[e]]})},e):s.jsxs(i,{sx:{mb:1},children:[s.jsx(u,{variant:"h6",children:w(e)}),s.jsx(jc,{ref:v[e],initialMarkdown:y[e]||"",onChange:()=>f({type:"SET_HAS_UNSAVED",index:t})})]},e)))}),e.aiResponse&&s.jsxs(i,{sx:{width:"50%",height:"100%",position:"relative"},children:[s.jsx(r,{onClick:()=>f({type:"SET_AI_RESPONSE",index:t,value:null}),sx:{position:"absolute",top:8,right:8,zIndex:1},children:s.jsx(o,{})}),s.jsx(_n,{readOnly:!0,initialMarkdown:e.aiResponse})]})]})]})}jc.displayName="MarkdownEditor",jc.propTypes={initialMarkdown:m.string,onChange:m.func},Sc.propTypes={editor:m.object.isRequired,index:m.number.isRequired,tableSurvey:m.object,onCheck:m.func.isRequired,onSave:m.func.isRequired,onAIEnhance:m.func.isRequired,onGenerateImage:m.func.isRequired,onPostToSocials:m.func.isRequired,dispatchEditors:m.func.isRequired},Yl.extend(vc);const Cc=y("main",{shouldForwardProp:e=>"open"!==e})((({theme:e})=>({flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:"-300px",variants:[{props:({open:e})=>e,style:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginLeft:0}}]}))),Ec=y("div")((({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing(0,1),...e.mixins.toolbar,justifyContent:"flex-end"})));function _c(){var e;const t=pe(),o=nn(),[l,c]=n.useState(!0),[d,h]=n.useState(),[f,m]=n.useState([]),[x,y]=n.useState(Yl().utc().startOf("day")),[v,b]=n.useState([]),[k,w]=n.useState(!1),[T,j]=n.useState(null),[S,C]=n.useState([]),[E,_]=n.useState(-1),[L,D]=n.useState([]),[R,M]=n.useState("wait"),[A,P]=n.useState(!1),[z,B]=n.useState({}),[$,F]=n.useState(!1),[H,N]=n.useState({}),[W,q]=n.useReducer(((e,t)=>{switch(t.type){case"SET_EDITORS":return t.payload;case"SET_STATUS":return e.map(((e,n)=>n===t.index?{...e,[t.key]:t.value}:e));case"SET_CHECKED":return e.map(((e,n)=>n===t.index?{...e,checked:t.checked}:e));case"SET_ALL_CHECKED":return e.map((e=>({...e,checked:t.checked})));case"SET_AI_RESPONSE":return e.map(((e,n)=>n===t.index?{...e,aiResponse:t.value}:e));case"SET_HAS_UNSAVED":return e.map(((e,n)=>n===t.index?{...e,hasUnsavedChanges:!0}:e));case"CLEAR_UNSAVED":return e.map(((e,n)=>n===t.index?{...e,hasUnsavedChanges:!1}:e));default:return e}}),[]),U=n.useRef([]);n.useEffect((()=>{let e=!1;return(async()=>{const t=await async function(){try{return(await kc("/get_tables")).tables}catch(e){}}();e||m(t)})(),()=>{e=!0}}),[]),n.useEffect((()=>{var e;const t=(null==(e=null==T?void 0:T.fields)?void 0:e.map((e=>e.field_id)))||[];U.current=L.map(((e,s)=>{const i=U.current[s]||{};return(t.length?t:Object.keys(e)).forEach((e=>{["id","date","time"].includes(e)||i[e]||(i[e]=n.createRef())})),i}));const s=L.map(((e,t)=>({ref:U.current[t],record:e,saveStatus:"idle",aiResponseStatus:"idle",sendToSocialsStatus:"idle",aiResponse:null,checked:!1,hasUnsavedChanges:!1})));q({type:"SET_EDITORS",payload:s})}),[L,T]);async function Y(e,t,n,s){s||(s=(new Date).getTimezoneOffset());const i=await async function(e,t,n,s){const i=t<10?`0${t}`:`${t}`;try{return await kc(`/get_days?table_name=${e}&month=${i}&year=${n}&timezone=${s}`)||[]}catch(r){}}(e,t,n,s),r=i.days||[],o=i.survey;j(o);const a=i.unique_dates||[];C(a);return r.map((e=>Yl(e).format("YYYY-MM-DD")))}async function G(e){q({type:"SET_EDITORS",payload:[]});const t=Yl(e).utc().startOf("day");if(y(t),B({}),!d)return;const n=await wc(d,t.toISOString());D(n.records||[]);const s=t.format("YYYY-MM-DD"),i=S.findIndex((e=>Yl(e).format("YYYY-MM-DD")===s));-1!==i&&_(i+1)}const V=n.useCallback((async e=>{if(h(e),D([]),B({}),N({}),!e)return;const t=x.month()+1,n=x.year(),s=await Y(e,t,n);b(s);const i=await(async e=>{try{return await kc(`/get_tables_filters/${e}`)}catch(hu){return{}}})(e);N(i)}),[x]),K=n.useCallback((async e=>{const t=e.month()+1,n=e.year();if(d){const e=await Y(d,t,n);b(e)}}),[d]),X=n.useCallback((async e=>{var t,n;q({type:"SET_STATUS",index:e,key:"saveStatus",value:"saving"});const s=W[e].ref,i={id:W[e].record.id},r=(null==(t=null==T?void 0:T.fields)?void 0:t.map((e=>e.field_id)))||Object.keys(s);for(const o of r){const e=null==(n=s[o])?void 0:n.current;e&&e.getMarkdown&&(i[o]=await e.getMarkdown())}await async function(e,t){try{return await kc("/update_record_from_blocks",{method:"POST",body:{table_name:e,records:t}})}catch(n){}}(d,[i]),q({type:"SET_STATUS",index:e,key:"saveStatus",value:"success"}),q({type:"CLEAR_UNSAVED",index:e}),setTimeout((()=>{q({type:"SET_STATUS",index:e,key:"saveStatus",value:"idle"})}),3e3)}),[T,d,W]),Z=n.useCallback((e=>{const t=Yl(e).format("YYYY-MM-DD");return!(null==v?void 0:v.includes(t))}),[v]),Q=n.useCallback((()=>{c(!0)}),[]),ee=n.useCallback((()=>{c(!1)}),[]),te=n.useCallback((()=>{w(!0)}),[]),ne=n.useCallback((async()=>{w(!1);const e=Yl().utc().startOf("day");y(e),await V(d),await G(e.toDate())}),[d]),se=n.useCallback((()=>{w(!1),ne()}),[ne]),ie=async(e,t="post")=>{var n,s,i;const r=null==(n=W[e])?void 0:n.ref,o=null==(i=null==(s=W[e])?void 0:s.record)?void 0:i.id;if(r&&o&&"posts_journal"===d&&o)try{q({type:"SET_STATUS",index:e,key:"sendToSocialsStatus",value:"loading"});await async function(e){const t=await kc("/api/messengers/post_record_to_socials",{method:"POST",body:e});if(!t.result)throw new Error("Некорректный ответ от AI");return t.result}({records_ids:[o],table_name:d,type:t});q({type:"SET_STATUS",index:e,key:"sendToSocialsStatus",value:"success"}),setTimeout((()=>{q({type:"SET_STATUS",index:e,key:"sendToSocialsStatus",value:"idle"})}),8e3)}catch(jn){q({type:"SET_STATUS",index:e,key:"sendToSocialsStatus",value:"fail"}),setTimeout((()=>{q({type:"SET_STATUS",index:e,key:"sendToSocialsStatus",value:"idle"})}),8e3)}},re=async(e,t="fix")=>{var n,s,i;const r=null==(n=W[e])?void 0:n.ref,o=null==(i=null==(s=W[e])?void 0:s.record)?void 0:i.id;if(!r||!o)return;let a="";for(const l in r){const e=r[l].current;e&&e.getMarkdown&&(a+=await e.getMarkdown()+"\n")}if(a=a.trim(),a&&d)try{q({type:"SET_STATUS",index:e,key:"aiResponseStatus",value:"loading"});const n=await async function(e){const t=await kc("/api/ai_record_fix",{method:"POST",body:e});if(!t.result)throw new Error("Некорректный ответ от AI");return t.result}({record:a,table_name:d,type:t});q({type:"SET_AI_RESPONSE",index:e,value:n||"Нет ответа"}),q({type:"SET_STATUS",index:e,key:"aiResponseStatus",value:"idle"})}catch(jn){q({type:"SET_AI_RESPONSE",index:e,value:"Возникла ошибка при получении ответа от ИИ. Повтрорите запрос"}),q({type:"SET_STATUS",index:e,key:"aiResponseStatus",value:"idle"})}};async function oe(e){var t,n;q({type:"SET_STATUS",index:e,key:"imageGenerateStatus",value:"loading"});const s=U.current[e]||{},i=null==(n=null==(t=W[e])?void 0:t.record)?void 0:n.id;if(!i)return;let r="";for(const o in s){const e=s[o].current;e&&e.getMarkdown&&(r+=await e.getMarkdown()+"\n")}r=r.trim();try{await async function({table_name:e,record_id:t,text:n}){try{await kc("/api/generate-image",{method:"POST",body:{table_name:e,record_id:t,text:n}})}catch(jn){throw jn}}({table_name:d,record_id:i,text:r}),q({type:"SET_STATUS",index:e,key:"imageGenerateStatus",value:"idle"})}catch(jn){alert("Ошибка генерации изображения: "+((null==jn?void 0:jn.message)||jn)),q({type:"SET_STATUS",index:e,key:"imageGenerateStatus",value:"idle"})}}return s.jsxs(i,{sx:{display:"flex",width:"100%",height:"100%"},children:[s.jsx(fe,{}),s.jsx(r,{color:"inherit","aria-label":"open drawer",onClick:Q,edge:"start",sx:[{ml:2},l&&{display:"none"}],children:s.jsx(me,{})}),s.jsxs(ge,{sx:{width:300,flexShrink:0,"& .MuiDrawer-paper":{width:330,boxSizing:"border-box",borderRadius:"10px"}},variant:"persistent",anchor:"left",open:l,children:[s.jsx(Ec,{children:s.jsx(r,{onClick:ee,children:"ltr"===t.direction?s.jsx(xe,{}):s.jsx(ye,{})})}),s.jsx(O,{}),s.jsxs(i,{children:[s.jsx(J,{options:(f||[]).map((({label:e,src:t})=>({label:e,src:t}))),getOptionLabel:e=>e.label||"",isOptionEqualToValue:(e,t)=>(null==e?void 0:e.src)===(null==t?void 0:t.src),onChange:(e,t)=>V((null==t?void 0:t.src)||null),renderInput:e=>s.jsx(a,{...e,label:"Журнал"})}),s.jsx(cn,{dateAdapter:mc,children:s.jsx(dn,{value:x,onChange:e=>G(e),onMonthChange:K,shouldDisableDate:Z})})]})]}),s.jsxs(Cc,{open:l,sx:{flexGrow:1,p:3,width:"100%",height:"100%"},children:[s.jsx(i,{sx:{flexGrow:1,overflow:"none",height:"100%",width:"100%",flexDirection:"column",display:"flex",paddingBottom:2,marginLeft:2},children:s.jsxs(i,{sx:{height:"95%",width:"100%"},children:[f||0==f.length?null:s.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"left",marginBottom:2},children:[s.jsx(p,{onClick:te,children:"Добавить запись на сегодня"}),s.jsxs(i,{sx:{display:"flex",gap:1},children:[s.jsx(p,{variant:"outlined",startIcon:s.jsx(ve,{}),disabled:$||!d,onClick:()=>P((e=>!e)),children:"Фильтр"}),s.jsxs(p,{variant:"outlined",onClick:async()=>{const e=W.map((e=>{var t;return null==(t=e.record)?void 0:t.id})).filter(Boolean);if(e.length){M("loading");try{if(!(await async function(e){const t=await kc("/api/ai_post_generate",{method:"POST",body:e});if(!t.result)throw new Error("Некорректный ответ от AI");return t.result}({records_ids:e,table_name:d,type:"post"})))return M("error"),void setTimeout((()=>{M("wait")}),5e3);M("success"),setTimeout((()=>{M("wait")}),5e3)}catch(jn){M("error"),setTimeout((()=>{M("wait")}),5e3)}}},disabled:"loading"===R||"success"===R||"error"===R||W.some((e=>"loading"===e.aiResponseStatus))||!W.some((e=>e.checked)),startIcon:"loading"===R?s.jsx(g,{size:20}):"success"===R?s.jsx(I,{}):"error"===R?s.jsx(ue,{}):s.jsx(ce,{}),children:[" ","success"===R?"Пост успешно сгенерирован":"error"===R?"Ошибка при генерации поста":"loading"===R?"Генерация поста...":"Сгенерировать пост"]})]})]}),s.jsxs(i,{sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"none",height:"100%"},children:[A&&d&&s.jsx(i,{sx:{flexShrink:0},children:s.jsx(Tc,{filtersConfig:null==(e=f.find((e=>e.src===d)))?void 0:e.filters,filters:z,handleFilterChange:(e,t)=>{B((n=>({...n,[e]:t})))},resetFilters:()=>{B({})},applyFilters:async()=>{if(d){q({type:"SET_EDITORS",payload:[]}),D([]),F(!0);try{const e=await async function(e,t){try{return await kc("/get_records",{method:"POST",body:{table_name:e,filters:t}})}catch(hu){return{records:[],columns:[]}}}(d,z);D(e.records||[])}finally{F(!1)}}},showFilters:A,setShowFilters:P,loadingFilteredRecords:$,dropdownValues:H})}),s.jsx(i,{sx:{flexGrow:1,overflowY:"none",height:"100%",marginTop:1},children:f&&0===f.length?s.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:2},children:[s.jsx(u,{variant:"h5",color:"text.secondary",children:"У вас нет журналов"}),s.jsx(u,{variant:"body1",color:"text.secondary",textAlign:"center",children:"Создайте свой первый журнал через профиль пользователя"}),s.jsx(p,{variant:"contained",onClick:()=>o("/account"),size:"large",children:"Перейти в профиль"})]}):s.jsxs(i,{sx:{display:"flex",flexGrow:1,flexDirection:"column",gap:2,overflowY:"none",height:"98%",marginTop:1,paddingBottom:2,border:W.some((e=>e.hasUnsavedChanges))?"2px solid #f44336":"2px solid #ccc",borderRadius:2,padding:2,transition:"border-color 0.3s ease"},children:[(null==W?void 0:W.length)>0&&s.jsxs(i,{sx:{marginLeft:0},children:[s.jsx(ae,{checked:W.every((e=>e.checked)),onChange:e=>{const t=e.target.checked;q({type:"SET_ALL_CHECKED",checked:t})}}),"Выбрать все"]}),s.jsx(aa,{style:{height:"100%",flexGrow:1,border:"2px solid #ccc",borderRadius:0,padding:0,transition:"border-color 0.3s ease"},data:W,itemKey:(e,t)=>{var n;return(null==(n=t.record)?void 0:n.id)||e},itemContent:(e,t)=>{var n;return s.jsx(Sc,{editor:t,index:e,tableSurvey:T,onCheck:(e,t)=>q({type:"SET_CHECKED",index:e,checked:t}),onSave:X,onAIEnhance:re,onGenerateImage:oe,onPostToSocials:ie,dispatchEditors:q},(null==(n=t.record)?void 0:n.id)||e)}})]})}),(null==S?void 0:S.length)>0&&0===Object.keys(z).length?s.jsx(be,{count:S.length,page:E,onChange:async function(e,t){_(t),q({type:"SET_EDITORS",payload:[]}),B({});const n=S[t-1],s=Yl(n).local().startOf("day");if(y(s),!d)return;const i=await wc(d,n);D(i.records||[])},variant:"outlined",size:"large",boundaryCount:2,showFirstButton:!0,showLastButton:!0,sx:{marginTop:2}}):null]})]})}),s.jsx(bc,{open:k,handleClose:se,tableSurvey:T})]})]})}function Ic({containerId:e,listsList:t,projects:i=[],selectedList:o,isNeedContextMenu:a=!1,setSelectedTaskId:l=null,linkTaskList:c=null,additionalButtonClick:d=null,deleteFromChildes:u=null,additionalButton:h=null,tasks:p=[],selectedTaskId:f=null,updateTask:m=null,changeTaskStatus:g=null,onSuccess:x=null,onError:y=null}){var v,b;const[k,w]=n.useState({}),[T,j]=n.useState(!0),[S,_]=n.useState(null),[I,D]=n.useState(null),[R,M]=n.useState(null),[A,P]=n.useState(null);if(n.useEffect((()=>{const t=document.getElementById(`tasksList${e}`);if(!t)return;const n=new mn(t,{itemSelector:".draggable-task",eventData:e=>{const t=e.getAttribute("data-id"),n=p.find((e=>String(e.id)===t));return{title:n.title,id:n.id,start:n.start||null,end:n.end||null,allDay:!n.start}}});return()=>n.destroy()}),[p,e]),!p||!o)return null;function z(){D(null),_(null),M(null)}async function B(e,t){if(!o)return;const n=o.childes_order.indexOf(e);if(-1!==n&&("up"===t&&n>0?[o.childes_order[n-1],o.childes_order[n]]=[o.childes_order[n],o.childes_order[n-1]]:"down"===t&&n<o.childes_order.length-1&&([o.childes_order[n+1],o.childes_order[n]]=[o.childes_order[n],o.childes_order[n+1]]),_(null),"function"==typeof updateList))try{await updateList({listId:o.id,childes_order:o.childes_order}),x&&x("Порядок задач изменен")}catch(hu){y&&y(hu)}}async function $(e,t=null){if(t||(t=R),"function"==typeof c){const n={task_id:A,list_id:e,action:t};"move"===t&&(null==o?void 0:o.id)&&(n.source_list_id=o.id);try{await c(n),x&&x("Задача перемещена")}catch(hu){y&&y(hu)}}z()}function F(e,t){M(t),D(e.currentTarget)}function H(e){const t=`checkbox-list-label-${e.id}`,n=e.childes_order&&e.childes_order.length>0;return s.jsxs("div",{children:[s.jsx(je,{disablePadding:!0,children:s.jsx(Se,{sx:{mb:1,width:"100%"},children:s.jsxs(G,{className:"draggable-task","data-id":e.id,draggable:"true",selected:f===e.id,onClick:()=>{"function"==typeof l&&l(e.id)},onDragStart:t=>function(e,t){e.dataTransfer.setData("task",JSON.stringify(t))}(t,e),onContextMenu:a?t=>function(e,t){e.preventDefault(),_(e.currentTarget),P(t.id)}(t,e):void 0,children:[s.jsx(V,{onClick:e=>e.stopPropagation(),children:s.jsx(ae,{edge:"start",checked:2===e.status_id,tabIndex:-1,disableRipple:!0,inputProps:{"aria-labelledby":t},onChange:t=>{t.stopPropagation(),function(e,t){const n=t?2:1;2==n&&new Audio("/sounds/isComplited.wav").play();const s={status_id:n};2==n&&(s.end_date=Yl().toISOString()),"function"==typeof g&&g({taskId:e,...s,listId:o.id})}(e.id,t.target.checked)}})}),s.jsx(K,{id:t,primary:e.title}),n&&s.jsx(r,{edge:"end",onClick:t=>{var n;t.stopPropagation(),n=e.id,w((e=>({...e,[n]:!e[n]})))},children:k[e.id]?s.jsx(we,{}):s.jsx(C,{})}),s.jsx(r,{onClick:t=>{t.stopPropagation(),function(e){"function"==typeof d&&d(e)}(e)},children:h?L.createElement(h):3===e.priority_id?s.jsx(Ce,{}):s.jsx(Ee,{})})]})})}),n&&s.jsx(E,{in:k[e.id],timeout:"auto",unmountOnExit:!0,children:s.jsx(ke,{disablePadding:!0,sx:{pl:3},children:e.childes_order.map((e=>{const t=p.find((t=>t.id===e));return t?H(t):null}))})})]},e.id)}const N=o.childes_order.map((e=>null==p?void 0:p.find((t=>t.id===e&&2!=t.status_id)))).filter(Boolean),W=o.childes_order.map((e=>null==p?void 0:p.find((t=>t.id===e&&2==t.status_id)))).filter(Boolean);return s.jsxs(s.Fragment,{children:[s.jsxs(ke,{sx:{width:"100%",pt:0},component:"nav",id:`tasksList${e}`,children:[N.map((e=>H(e))),W.length>0&&s.jsxs("div",{children:[s.jsxs(G,{onClick:()=>j(!T),children:[s.jsx(K,{primary:"Completed Tasks"}),T?s.jsx(we,{}):s.jsx(C,{})]}),s.jsx(E,{in:T,timeout:"auto",unmountOnExit:!0,children:s.jsx(ke,{disablePadding:!0,children:W.map((e=>H(e)))})})]})]}),a&&s.jsxs(Te,{anchorEl:S,open:Boolean(S),onClose:z,children:[s.jsx(oe,{onClick:async function(){const e=p.find((e=>e.id===A));if(!e)return;const t=Yl().hour(12).minute(0).second(0).millisecond(0),n=t.clone().add(1,"hour");if("function"==typeof m)try{await m({taskId:e.id,start:t.toISOString(),end:n.toISOString(),deadline:n.toISOString()}),x&&x('Добавлено в "Мой день"')}catch(hu){y&&y(hu)}z()},children:"Добавить в Мой день"},"addToMyDay"),(null==t?void 0:t.filter((e=>"list"==e.type)))&&[s.jsx(oe,{onClick:e=>F(e,"move"),children:"Переместить в список"},"moveToList"),s.jsx(oe,{onClick:e=>F(e,"link"),children:"Связать со списком"},"linkToList")],!(null==(v=null==o?void 0:o.childes_order)?void 0:v.includes(A))&&[s.jsx(oe,{onClick:()=>(o.id,void $(o.id,"link")),children:"Поднять до задачи"},"upToTask")],(null==(b=null==o?void 0:o.childes_order)?void 0:b.includes(A))&&[s.jsx(O,{},"divider2"),s.jsx(oe,{onClick:()=>B(A,"up"),children:"Переместить выше"},"moveUp"),s.jsx(oe,{onClick:()=>B(A,"down"),children:"Переместить ниже"},"moveDown"),s.jsx(oe,{onClick:()=>async function(e){if("function"==typeof u)try{await u(`task_${e}`,o.id),x&&x("Задача удалена из списка")}catch(hu){y&&y(hu)}_(null)}(A),children:"Удалить из этого списка"},"toggleInList")]]}),a&&s.jsx(Te,{anchorEl:I,open:Boolean(I),onClose:function(){D(null)},children:(()=>{const e=t.concat(i),n=new Map(e.map((e=>[e.id,e]))),r=i.filter((e=>!e.deleted)),o=[];let a=0;const l=new Set,c=(e,t=0)=>{if(!(l.has(e.id)||t>10))if(l.add(e.id),"project"===e.type||"group"===e.type)o.push(s.jsx(oe,{disabled:!0,sx:{pl:2*t},"data-id":e.id,children:e.title},a++)),(e.childes_order||[]).forEach((e=>{const s=n.get(e);s&&!l.has(e)&&c(s,t+1)}));else if("list"===e.type){const n=a++;o.push(s.jsx(oe,{"data-id":e.id,onClick:()=>$(e.id),sx:{pl:2*t},children:e.title},n))}};r.forEach((e=>c(e)));return t.filter((e=>e.inGeneralList&&!e.deleted&&!e.parent_id)).forEach((e=>c(e))),o})()})]})}_c.propTypes={},Ic.propTypes={containerId:m.oneOfType([m.string,m.number]),tasks:m.array,selectedTaskId:m.number,listsList:m.array,projects:m.array,isNeedContextMenu:m.bool,selectedList:m.object,setSelectedTaskId:m.func,updateList:m.func,updateTask:m.func,linkTaskList:m.func,additionalButtonClick:m.func,changeTaskStatus:m.func,deleteFromChildes:m.func,additionalButton:m.object,onSuccess:m.func,onError:m.func};var Lc,Dc={exports:{}};var Rc=(Lc||(Lc=1,Dc.exports=function(){var e={year:0,month:1,day:2,hour:3,minute:4,second:5},t={};return function(n,s,i){var r,o=function(e,n,s){void 0===s&&(s={});var i=new Date(e);return function(e,n){void 0===n&&(n={});var s=n.timeZoneName||"short",i=e+"|"+s,r=t[i];return r||(r=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:s}),t[i]=r),r}(n,s).formatToParts(i)},a=function(t,n){for(var s=o(t,n),r=[],a=0;a<s.length;a+=1){var l=s[a],c=l.type,d=l.value,u=e[c];u>=0&&(r[u]=parseInt(d,10))}var h=r[3],p=24===h?0:h,f=r[0]+"-"+r[1]+"-"+r[2]+" "+p+":"+r[4]+":"+r[5]+":000",m=+t;return(i.utc(f).valueOf()-(m-=m%1e3))/6e4},l=s.prototype;l.tz=function(e,t){void 0===e&&(e=r);var n,s=this.utcOffset(),o=this.toDate(),a=o.toLocaleString("en-US",{timeZone:e}),l=Math.round((o-new Date(a))/1e3/60),c=15*-Math.round(o.getTimezoneOffset()/15)-l;if(Number(c)){if(n=i(a,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(c,!0),t){var d=n.utcOffset();n=n.add(s-d,"minute")}}else n=this.utcOffset(0,t);return n.$x.$timezone=e,n},l.offsetName=function(e){var t=this.$x.$timezone||i.tz.guess(),n=o(this.valueOf(),t,{timeZoneName:e}).find((function(e){return"timezonename"===e.type.toLowerCase()}));return n&&n.value};var c=l.startOf;l.startOf=function(e,t){if(!this.$x||!this.$x.$timezone)return c.call(this,e,t);var n=i(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return c.call(n,e,t).tz(this.$x.$timezone,!0)},i.tz=function(e,t,n){var s=n&&t,o=n||t||r,l=a(+i(),o);if("string"!=typeof e)return i(e).tz(o);var c=function(e,t,n){var s=e-60*t*1e3,i=a(s,n);if(t===i)return[s,t];var r=a(s-=60*(i-t)*1e3,n);return i===r?[s,i]:[e-60*Math.min(i,r)*1e3,Math.max(i,r)]}(i.utc(e,s).valueOf(),l,o),d=c[0],u=c[1],h=i(d).utcOffset(u);return h.$x.$timezone=o,h},i.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},i.tz.setDefault=function(e){r=e}}}()),Dc.exports);const Oc=A(Rc);function Mc({open:e,onClose:t,onApply:r,settingsProp:o={}}){const{workIntervalDuration:a,breakDuration:l,additionalBreakDuration:c,isBackgroundTasks:d}=o,[f,m]=n.useState(Math.floor(a/60)),[g,x]=n.useState(Math.floor(l/60)),[y,v]=n.useState(Math.floor(c/60)),[b,k]=n.useState(d||!0);return s.jsxs(Q,{open:e,onClose:t,sx:{maxWidth:"100%"},children:[s.jsx(ee,{children:"Настройки календаря"}),s.jsxs(te,{sx:{padding:"24px"},children:[s.jsxs(i,{sx:{marginBottom:3},children:[s.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:`Длительность рабочего интервала ${f}`}),s.jsx(h,{value:f,onChange:(e,t)=>{m(t)},"aria-labelledby":"work-duration-slider",valueLabelDisplay:"auto",step:5,min:10,max:120,marks:!0})]}),s.jsxs(i,{sx:{marginBottom:3},children:[s.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:`Длительность обычного перерыва ${g}`}),s.jsx(h,{value:g,onChange:(e,t)=>{x(t)},"aria-labelledby":"break-duration-slider",valueLabelDisplay:"auto",min:3,max:15,step:1,marks:!0})]}),s.jsxs(i,{sx:{marginBottom:3},children:[s.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:`Длительность дополнительного перерыва ${y} (каждый 3-й перерыв для длительной задачи)`}),s.jsx(h,{value:y,onChange:(e,t)=>{v(t)},"aria-labelledby":"additional-duration-slider",valueLabelDisplay:"auto",min:3,max:30,step:1,marks:!0})]}),s.jsx(se,{fullWidth:!0,children:s.jsxs(_e,{value:"check",size:"small",selected:!!b,onChange:()=>{k(!b)},children:[b?s.jsx(Ie,{}):s.jsx(Le,{}),s.jsx(u,{sx:{ml:1,textTransform:"none"},children:"Выводить фоновые задачи в список"})]})},"toggleIsBackgroundTasks")]}),s.jsxs(ne,{sx:{padding:"16px 24px"},children:[s.jsx(p,{onClick:t,sx:{marginRight:"auto",color:"grey.600"},children:"Отмена"}),s.jsx(p,{variant:"contained",onClick:()=>{r({workIntervalDuration:60*f,breakDuration:60*g,additionalBreakDuration:60*y,isBackgroundTasks:b})},sx:{backgroundColor:"primary.main"},children:"Применить"})]})]})}Yl.extend(vc),Yl.extend(Oc),Mc.propTypes={open:t.PropTypes.bool.isRequired,onClose:t.PropTypes.func.isRequired,onApply:t.PropTypes.func.isRequired,settingsProp:t.PropTypes.object},Yl.extend(vc),Yl.extend(Oc);const Ac=L.memo(Ic),Pc=({containerId:e,tasks:t=[],selectedList:o,updateTask:a,changeTaskStatus:l,fetchTasks:c,onTaskClick:d,additionalButtonClick:h,saveSettings:p})=>{var f;const[m,x]=n.useState({intervals:[]}),[y,v]=n.useState({workIntervalDuration:1800,breakDuration:300,additionalBreakDuration:900,isBackgroundTasks:!0}),[b,k]=n.useState(!1),[w,T]=n.useState([]),[j,S]=n.useState(null),[C,E]=n.useState({remainingTime:0,isOnBreak:!0,currentIntervalEndDate:null,currentIntervalIndex:0,currentIntervalDuration:0}),[_,I]=n.useState(0),{updateTimerState:L,startTimer:D,stopTimer:R,formatRemainingTime:O}=function(e={}){const[t,s]=n.useState({remainingTime:e.remainingTime||1500,isOnBreak:e.isOnBreak||!1,currentIntervalIndex:e.currentIntervalIndex||0,currentIntervalEndDate:e.currentIntervalEndDate||null,currentIntervalDuration:e.currentIntervalDuration||1500}),i=n.useRef(null),r=e=>{s((t=>({...t,...e})))},o=(e,t)=>{if(!e)return 0;t||(t=Yl.tz.guess());const n=Yl(e).tz(t),s=Yl().tz(t),i=3600*n.hour()+60*n.minute()+n.second(),r=3600*s.hour()+60*s.minute()+s.second();return Math.abs(r-i)},a=()=>{i.current&&(clearInterval(i.current),i.current=null)};n.useEffect((()=>()=>a()),[]);const l=t.remainingTime/t.currentIntervalDuration*100;return{timerState:t,updateTimerState:r,startTimer:(e,t)=>{e&&(t||(t=Yl.tz.guess()),i.current=setInterval((()=>{r({remainingTime:o(e,t)})}),500))},stopTimer:a,formatRemainingTime:e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60),s=e%60;let i="";return t>0&&(i+=`${t<10?`0${t}`:t}:`),i+=`${n<10?`0${n}`:n}:${s<10?`0${s}`:s}`,i},progress:l}}();function M(e,t){null==t&&(t=Yl.tz.guess());const n=Yl(e).tz(t),s=Yl().tz(t),i=3600*n.hour()+60*n.minute()+n.second(),r=3600*s.hour()+60*s.minute()+s.second();return Math.abs(r-i)}function A(e,t=null){null==t&&(t=Yl.tz.guess());let n=null,s=null,i=Yl().tz(t);return e.some((e=>(s=Yl(e.end).tz(t),!!s.isAfter(i)&&(n=e,!0)))),n}n.useEffect((()=>()=>{R()}),[]),n.useEffect((()=>{const e=Yl().tz(),{currentIntervalEndDate:n}=C;if(Yl(n).isBefore(e)){R(),z();const{intervals:e}=m,n=A(e);let s=null;if(n){const e={currentIntervalIndex:n.id,currentIntervalEndDate:n.end,currentIntervalDuration:n.duration,remainingTime:n.duration,isOnBreak:n.isOnBreak};L(e),D(e.currentIntervalEndDate)}else{const e=P(t,w);e&&(s={...e,status:"started"}),S(s)}}}),[C,m,t,w]),n.useEffect((()=>{const{taskParams:e,timerParams:t}=function(e,t){switch(!0){case!e:return{taskParams:{taskName:"Все задачи завершены",taskRange:"",intervals:[],currentTask:null},timerParams:{remainingTime:0,isOnBreak:!0,currentIntervalEndDate:null,currentIntervalIndex:0}};case!function(e,t=null){null==t&&(t=Yl.tz.guess());const n=Yl(e.start).tz(t),s=Yl().tz(t),i=3600*n.hour()+60*n.minute()+n.second();return 3600*s.hour()+60*s.minute()+s.second()>=i}(e):{const t=`${Yl(e.start).format("HH:mm")} - ${Yl(e.deadline).format("HH:mm")}`,n=M(e.start),s=Yl().hour(Yl(e.start).hour()).minute(Yl(e.start).minute()).second(Yl(e.start).second()).toISOString();return{taskParams:{taskName:`Перерыв. Далее ${e.title}`,taskRange:t,intervals:[],currentTask:e},timerParams:{remainingTime:n,isOnBreak:!0,currentIntervalEndDate:s,currentIntervalIndex:0,currentIntervalDuration:n}}}default:{const n=B(e,t),s=`${Yl(e.start).format("HH:mm")} - ${Yl(e.deadline).format("HH:mm")}`,i=A(n),r=M(null==i?void 0:i.end);return{taskParams:{taskName:e.title,taskRange:s,intervals:n,currentTask:e},timerParams:{remainingTime:r,isOnBreak:null==i?void 0:i.isOnBreak,currentIntervalIndex:null==i?void 0:i.id,currentIntervalDuration:null==i?void 0:i.duration,currentIntervalEndDate:null==i?void 0:i.end}}}}}(j,y);var n;R(),L(t),n=e,x((e=>({...e,...n}))),j?D(t.currentIntervalEndDate):R()}),[j,y]);const P=(e,t)=>{const n=null==e?void 0:e.filter((e=>!t.includes(e.id)));return(null==n?void 0:n.find((e=>!$(e))))||null};const z=()=>{let e=Promise.resolve();{const t=new Audio("/sounds/endTimer.mp3");t.volume=.5,e=new Promise((e=>{t.onended=e,t.play()}))}return e},B=(e,t)=>{let n=null==t?void 0:t.workIntervalDuration,s=null==t?void 0:t.breakDuration,i=null==t?void 0:t.additionalBreakDuration;const r=[];let o=(e=>{const t=Yl(e.start),n=Yl(e.deadline),s=3600*t.hour()+60*t.minute()+t.second();let i=3600*n.hour()+60*n.minute()+n.second()-s;return i<0&&(i+=86400),i})(e),a=Yl(e.start),l=Yl();l=l.hour(a.hour()).minute(a.minute()).second(a.second());let c=-1,d=0,u="work",h=s,p=0;for(;o>0;){c++;let e=l;switch(u){case"work":o>=n?(p=n,o-=n):(p=o,o=0),l=l.add(p,"second"),r.push({id:c,duration:p,type:"work",isOnBreak:!1,start:e.toISOString(),end:l.toISOString()}),u="break";continue;case"break":if(o<h){if(r&&r.length>0&&"work"==r[r.length-1].type){let e=r.length-1;r[e].duration=r[e].duration+o,r[e].end=l.add(o,"second").toISOString(),o=0}else l=l.add(o,"second"),r.push({id:c,duration:o,type:"work",isOnBreak:!1,start:e.toISOString(),end:l.toISOString()}),o=0;u="work";continue}2==d&&o>i+5&&(h=i,d=0),d++,l=l.add(h,"second"),r.push({id:c,duration:h,type:"break",isOnBreak:!0,start:e.toISOString(),end:l.toISOString()}),o-=h,h=s,u="work";continue}}if(r&&r.length>0&&"break"==r[r.length-1].type){let e=r[r.length-1].duration,t=Yl(r[r.length-1].end),n=Yl(r[r.length-1].start);if(r.pop(),e==s)r[r.length-1].duration+=s,r[r.length-1].end=t;else{let t=n.add(s,"second");r.push({id:c,duration:s,type:"break",isOnBreak:!0,start:n.toISOString(),end:t.toISOString()});let i=e-s,o=t.add(i,"second");r.push({id:c+1,duration:i,type:"work",isOnBreak:!1,start:t.toISOString(),end:o.toISOString()})}}return r&&r.length>0&&r[r.length-1].duration<1&&r.pop(),r},$=(e,t=null)=>{if(null==t&&(t=Yl.tz.guess()),!e||!e.deadline)return!1;const n=Yl().tz(t),s=Yl(e.deadline).tz(t),i=n.hour(),r=n.minute();return 60*s.hour()+(s.minute()-1)<=60*i+r};const F=(null==y?void 0:y.isBackgroundTasks)?t:t.filter((e=>!e.is_background));return s.jsxs(i,{sx:{flexGrow:1,height:"100%",width:"98.9%",display:"flex",flexDirection:"column",alignContent:"center",overflowX:"none"},children:[s.jsxs(i,{sx:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",padding:1},children:[s.jsx(r,{edge:"start",color:"inherit","aria-label":"settings",onClick:()=>k(!0),children:s.jsx(De,{})}),s.jsx(i,{sx:{flex:1,display:"flex",justifyContent:"center"},children:s.jsxs(Re,{container:!0,justifyContent:"center",alignItems:"center",direction:"column",children:[s.jsx(u,{variant:"h6",component:"div",children:m.taskName}),(null==t?void 0:t.length)>0&&s.jsx(u,{variant:"subtitle1",component:"div",color:"text.secondary",children:m.taskRange})]})}),s.jsx(r,{edge:"end",color:"inherit","aria-label":"refresh",onClick:function(){T([]),(null==o?void 0:o.id)&&"function"==typeof c&&c(o.id)},children:s.jsx(Oe,{})})]}),s.jsxs(i,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",padding:1,width:"100%"},children:[s.jsx(i,{sx:{flex:1,display:"flex",flexDirection:"row",justifyContent:"center",padding:1},children:s.jsxs(i,{sx:{position:"relative",display:"flex",margin:0,height:"250px",width:"250px",alignItems:"center",justifyContent:"center"},children:[s.jsx(g,{variant:"determinate",value:_,color:C.isOnBreak?"success":"primary",size:"250px"}),s.jsx(i,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",margin:"auto"},children:s.jsx(u,{variant:"h3",component:"div",color:"text.secondary",children:O(C.remainingTime)})})]},"focusMode")}),s.jsx(i,{sx:{width:"100%",overflow:"auto"},children:s.jsx(Me,{activeStep:C.currentIntervalIndex,alternativeLabel:!0,children:m.intervals.map(((e,t)=>s.jsx(Ae,{children:s.jsx(Pe,{children:`${Math.floor(e.duration/60)} мин`})},`step_${t}`)))})})]}),s.jsx(i,{sx:{px:2,flexGrow:1,overflowY:"auto",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:s.jsx(Ac,{containerId:e,tasks:F,selectedTaskId:(null==(f=null==m?void 0:m.currentTask)?void 0:f.id)||null,selectedList:o,isNeedContextMenu:!1,setSelectedTaskId:function(e){d&&"function"==typeof d&&d(e)},updateTask:a,additionalButtonClick:function(e){const{intervals:t}=m,n=null==C?void 0:C.currentIntervalIndex;if(t&&t.length>n){let s=t[n];"break"==s.type&&(s=t[n-1]),e.start=s.start,e.end=s.end}else{const t=Yl(),n=t.minute(5*Math.floor(t.minute()/5)).second(0);e.start=n,e.end=n.add(60,"minute")}"function"==typeof h&&h(e)},changeTaskStatus:function(e,t){"function"==typeof l&&l(e,t)},skippedTasks:w,additionalButton:ze})}),s.jsx(Mc,{open:b,onClose:function(){k(!1)},onApply:function(e){k(!1);const t={...y,...e};v(t),"function"==typeof p&&p(t)},settingsProp:y})]})};Pc.propTypes={containerId:m.oneOfType([m.string,m.number]),tasks:m.array,selectedList:m.object,updateTask:m.func,changeTaskStatus:m.func,fetchTasks:m.func,onTaskClick:m.func,additionalButtonClick:m.func,saveSettings:m.func};const zc=n.createContext({setError:()=>{},setSuccess:()=>{}});function Bc({children:e}){const[t,i]=n.useState({message:null,severity:"info"}),[r,o]=n.useState(!1),a=n.useCallback(((e,t="info")=>{i({message:e,severity:t}),o(!0)}),[]),l=n.useCallback((e=>{const t=e&&e.message?e.message:String(e);a(t,"error")}),[a]),c=n.useCallback((e=>{a(e,"success")}),[a]),d=(e,t)=>{"clickaway"!==t&&o(!1)};return s.jsxs(zc.Provider,{value:{setError:l,setSuccess:c},children:[e,s.jsx(Be,{open:r,autoHideDuration:6e3,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(_,{onClose:d,severity:t.severity,sx:{width:"100%"},children:t.message})})]})}const $c=n.createContext({});function Fc({children:e}){const[t,i]=n.useState({});return n.useEffect((()=>{const e=Xs("/updates",{transports:["websocket"]});return e.on("connect",(()=>{})),e.on("data_updated",(e=>{i((t=>({...t,...e})))})),e.on("task_changed",(e=>{i((t=>({...t,taskChange:e,timestamp:Date.now()})))})),e.on("disconnect",(()=>{})),()=>e.disconnect()}),[]),s.jsx($c.Provider,{value:t,children:e})}function Hc(){return n.useContext($c)}Fc.propTypes={children:m.node.isRequired};const Nc=localStorage.getItem("access_token");function Wc(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?decodeURIComponent(t[2]):null}Nc&&(en.defaults.headers.common.Authorization=`Bearer ${Nc}`);const qc=n.createContext({user:null,login:async()=>!1,register:async()=>!1,logout:async()=>{},fetchCurrentUser:async()=>{}});function Uc({children:e}){const[t,i]=n.useState(null),[r,o]=n.useState(!0),a=n.useCallback((async()=>{const e=localStorage.getItem("refresh_token");if(!e)return!1;try{const{data:t}=await en.post("/api/refresh",{},{headers:{Authorization:`Bearer ${e}`}});return localStorage.setItem("access_token",t.access_token),en.defaults.headers.common.Authorization=`Bearer ${t.access_token}`,!0}catch(hu){return localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),!1}}),[]),l=n.useCallback((async()=>{var e;const t=localStorage.getItem("access_token");if(!t)return o(!1),i(null),null;en.defaults.headers.common.Authorization=`Bearer ${t}`;try{const{data:e}=await en.get("/api/user",{timeout:5e3});return i(e),o(!1),e}catch(hu){if(401===(null==(e=hu.response)?void 0:e.status)){if(await a())return l()}return i(null),o(!1),null}}),[a]),c=n.useCallback((async(e,t)=>{var n,s;try{const{data:n}=await en.post("/api/login",{username:e,password:t},{headers:{"X-CSRFToken":Wc("csrf_token")}});return localStorage.setItem("access_token",n.access_token),localStorage.setItem("refresh_token",n.refresh_token),en.defaults.headers.common.Authorization=`Bearer ${n.access_token}`,i(n.user),null}catch(hu){return(null==(s=null==(n=null==hu?void 0:hu.response)?void 0:n.data)?void 0:s.error)||"Login failed"}}),[]),d=n.useCallback((async(e,t,n)=>{var s,r;try{const{data:s}=await en.post("/api/register",{username:e,email:t,password:n},{headers:{"X-CSRFToken":Wc("csrf_token")}});return localStorage.setItem("access_token",s.access_token),localStorage.setItem("refresh_token",s.refresh_token),en.defaults.headers.common.Authorization=`Bearer ${s.access_token}`,i(s.user),null}catch(hu){return(null==(r=null==(s=null==hu?void 0:hu.response)?void 0:s.data)?void 0:r.error)||"Registration failed"}}),[]),u=n.useCallback((async()=>{try{await en.post("/api/logout")}finally{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),delete en.defaults.headers.common.Authorization,i(null)}}),[]);return n.useEffect((()=>{const e=en.interceptors.response.use((e=>e),(async e=>{var t;if(401===(null==(t=e.response)?void 0:t.status)&&!e.config._retry){e.config._retry=!0;if(await a())return en(e.config)}return Promise.reject(e)}));return()=>en.interceptors.response.eject(e)}),[a]),n.useEffect((()=>{l()}),[l]),s.jsx(qc.Provider,{value:{user:t,isLoading:r,login:c,register:d,logout:u,fetchCurrentUser:l},children:e})}const Yc=n.createContext(),Gc=async(e,t="GET",n=null)=>{const s=localStorage.getItem("access_token"),i={"Content-Type":"application/json"};s&&(i.Authorization=`Bearer ${s}`);const r={method:t,headers:i};n&&(r.body=JSON.stringify(n));const o=await fetch(e,r);if(!o.ok)throw new Error(`Failed to fetch ${e}, status ${o.status}`);return o.json()},Vc=({children:e,onError:t,setLoading:i})=>{const[r,o]=n.useState({lists:[],projects:[],default_lists:[],loading:!1,error:null}),[a,l]=n.useState(null),[c,d]=n.useState(null),[u,h]=n.useState(null),p=n.useRef(!1),f=n.useCallback((async()=>{if(!p.current){i&&i(!0),p.current=!0,o((e=>({...e,loading:!0,error:null})));try{const e=await Gc(`/tasks/get_lists?time_zone=${(new Date).getTimezoneOffset()}`);return o({lists:e.lists,default_lists:e.default_lists,projects:e.projects,version:e.tasksVersion,loading:!1,error:null}),i&&i(!1),p.current=!1,e}catch(hu){t&&t(hu),o((t=>({...t,loading:!1,error:hu}))),i&&i(!1),p.current=!1}}}),[t,i]),m=n.useCallback((async e=>{const t=await Gc("/tasks/add_list","POST",e);return await f(),t}),[f]),g=n.useCallback((async e=>{const t=await Gc("/tasks/edit_list","PUT",e);return await f(),t}),[f]),x=n.useCallback((async e=>{const t=await Gc("/tasks/del_list","DELETE",e);return await f(),t}),[f]),y=n.useCallback((async e=>{const t=await Gc("/tasks/link_group_list","PUT",e);return await f(),t}),[f]),v=n.useCallback((async e=>{const t=await Gc("/tasks/delete_from_childes","DELETE",e);return await f(),t}),[f]),b=n.useCallback((async e=>{const t=await Gc("/tasks/link_task","PUT",e);return await f(),t}),[f]),k=n.useCallback((async e=>{const t=await Gc("/tasks/change_childes_order","PUT",e);return await f(),t}),[f]),w=n.useCallback((e=>{l(e)}),[]);n.useEffect((()=>{if(null!=a){const e=[...r.lists,...r.projects,...r.default_lists].find((e=>e.id===a));d(e||null)}else d(null)}),[a,r]);const{tasksVersion:T}=Hc();n.useEffect((()=>{T&&(f(),h(T))}),[T,f,h]);const{user:j,isLoading:S}=n.useContext(qc);n.useEffect((()=>{!S&&j&&f()}),[j,S,f]);const C=n.useMemo((()=>({lists:r,selectedListId:a,setSelectedListId:w,selectedList:c,setSelectedList:d,addList:m,updateList:g,deleteList:x,linkListGroup:y,deleteFromChildes:v,linkTaskList:b,changeChildesOrder:k,version:u,setVersion:h,fetchLists:f,loading:r.loading})),[r,a,c,f,m,g,x,y,v,b,k,u]);return s.jsx(Yc.Provider,{value:C,children:e})};Vc.propTypes={children:m.node.isRequired};const Kc=()=>n.useContext(Yc),Jc=n.createContext(),Xc=async(e,t="GET",n=null)=>{const s=localStorage.getItem("access_token"),i={"Content-Type":"application/json"};s&&(i.Authorization=`Bearer ${s}`);const r={method:t,headers:i};n&&(r.body=JSON.stringify(n));const o=await fetch(e,r);if(!o.ok)throw new Error(`Failed to fetch ${e}, status ${o.status}`);return o.json()},Zc=({children:e,onError:t,setLoading:i})=>{const[r,o]=n.useState({data:[],loading:!1,error:null}),{fetchLists:a,selectedListId:l}=Kc(),[c,d]=n.useState({}),[u,h]=n.useState(null),[p,f]=n.useState(null),m=n.useRef(!1),g=n.useCallback((async e=>{if(e){for(;m.current;)await new Promise((e=>setTimeout(e,50)));i&&i(!0),m.current=!0,o((e=>({...e,loading:!0,error:null})));try{const t=await Xc(`/tasks/get_tasks?list_id=${e}&time_zone=${(new Date).getTimezoneOffset()}`);return o({data:t.tasks||[],version:t.tasksVersion,loading:!1,error:null}),i&&i(!1),m.current=!1,t}catch(hu){t&&t(hu),o((t=>({...t,loading:!1,error:hu}))),i&&i(!1),m.current=!1}}}),[t,i]),x=n.useCallback((async e=>{const t=await Xc("/tasks/add_task","POST",e);return await a(),t.task&&(e.listId===l||"tasks"===l&&!e.listId||"my_day"===l&&"my_day"===e.listId||"important"===l&&"important"===e.listId||"background"===l&&"background"===e.listId)&&o((e=>({...e,data:[t.task,...e.data]}))),t}),[a,l]),y=n.useCallback((async e=>{const t=await Xc("/tasks/edit_task","PUT",e);return a&&await a(),!t.task||e.listId!==l&&e.listId||o((n=>({...n,data:n.data.map((n=>n.id==e.taskId?{...n,...t.task}:n))}))),t}),[a,l]),v=n.useCallback((async e=>{const t=await Xc("/tasks/change_status","PUT",e);return a&&await a(),e.listId===l&&o((t=>({...t,data:t.data.map((t=>t.id===e.taskId?{...t,status:e.status}:t))}))),t}),[a,l]),b=n.useCallback((async e=>{const t=await Xc("/tasks/add_subtask","POST",e);return a&&await a(),t.subtask&&e.listId===l&&o((n=>({...n,data:n.data.map((n=>n.id===e.parentTaskId?{...n,subtasks:[...n.subtasks||[],t.subtask]}:n))}))),t}),[a,l]),k=n.useCallback((async e=>{const t=await Xc("/tasks/del_task","DELETE",e);return a&&await a(),e.listId===l&&o((t=>({...t,data:t.data.filter((t=>t.id!==e.taskId))}))),t}),[a,l]),w=n.useCallback((async e=>{const t=await Xc("/tasks/link_task","PUT",e);return a&&await a(),l&&l===e.fromListId&&await g(l),t}),[a,g,l]),T=n.useCallback((async()=>{l&&await g(l)}),[l,g]),j=n.useCallback((async()=>{try{const e=await Xc("/tasks/fields_config");d(e)}catch(e){d({error:e})}}),[]),{user:S,isLoading:C}=n.useContext(qc);n.useEffect((()=>{!C&&S&&j()}),[j,S,C]);const{tasksVersion:E,taskChange:_}=Hc();n.useEffect((()=>{if(_&&_.listId===l){const{action:e,task:t}=_;switch(e){case"added":o((e=>({...e,data:[...e.data,t]})));break;case"updated":o((e=>({...e,data:e.data.map((e=>e.id===t.id?{...e,...t}:e))})));break;case"deleted":o((e=>({...e,data:e.data.filter((e=>e.id!==t.id))})));break;case"status_changed":o((e=>({...e,data:e.data.map((e=>e.id===t.id?{...e,status:t.status}:e))})))}}}),[_,l]),n.useEffect((()=>{E&&E!==p&&f(E)}),[E,p]);const I=n.useMemo((()=>({tasks:r,taskFields:c,selectedTaskId:u,setSelectedTaskId:h,fetchTasks:g,forceRefreshTasks:T,addTask:x,updateTask:y,changeTaskStatus:v,addSubTask:b,deleteTask:k,linkTaskList:w,version:p,setVersion:f,loading:r.loading})),[r,c,u,g,T,x,y,v,b,k,w,p,l]);return s.jsx(Jc.Provider,{value:I,children:e})};Zc.propTypes={children:m.node.isRequired};const Qc=()=>n.useContext(Jc),ed=n.createContext(),td=async(e,t="GET",n=null)=>{const s=localStorage.getItem("access_token"),i={"Content-Type":"application/json"};s&&(i.Authorization=`Bearer ${s}`);const r={method:t,headers:i};n&&(r.body=JSON.stringify(n));const o=await fetch(e,r);if(!o.ok)throw new Error(`Failed to fetch ${e}, status ${o.status}`);return o.json()},nd=({children:e})=>{const[t,i]=n.useState({data:[],loading:!1,error:null}),[r,o]=n.useState(null),a=n.useRef(!1),l=n.useCallback((async()=>{if(!a.current){a.current=!0,i((e=>({...e,loading:!0,error:null})));try{const e=await td(`/tasks/get_tasks?list_id=events&version=${r}`);return i({data:e.tasks||e,loading:!1,error:null}),o(e.tasksVersion||r),e.tasks||e}catch(e){return i((t=>({...t,loading:!1,error:e}))),[]}finally{a.current=!1}}}),[r]),{tasksVersion:c}=Hc();n.useEffect((()=>{c&&c!==r&&(l(),o(c))}),[c,r,l]),n.useEffect((()=>{l()}),[]);const d=n.useCallback((e=>td("/tasks/edit_task","PUT",e)),[]),u=n.useCallback((e=>td("/tasks/add_task","POST",e)),[]),h=n.useCallback((e=>td("/tasks/del_task","DELETE",e)),[]),p=n.useMemo((()=>({calendarEvents:t,fetchCalendarEvents:l,updateCalendarEvent:d,addCalendarEvent:u,deleteCalendarEvent:h,version:r,setVersion:o})),[t,l,d,u,h,r]);return s.jsx(ed.Provider,{value:p,children:e})};nd.propTypes={children:m.node.isRequired};const sd=()=>n.useContext(ed),id=["#FF0000","#009900","#0000FF","#FF00FF","#A52A2A","#000080","#800000","#808000","#800080","#008080","#FFA500","#DFD030","#3788D8"],rd=({fieldKey:e,fieldName:t,selectedColorProp:r,onColorChange:o})=>{const[a,l]=n.useState(null),[c,d]=n.useState(r||"#3788D8"),h=Boolean(a);n.useEffect((()=>{r&&d(r)}),[r]);const f=n.useCallback((e=>{l((t=>t?null:e.currentTarget))}),[]),m=n.useCallback((t=>{d(t),o(e,t),l(null)}),[e,o]),g=n.useCallback((()=>{l(null)}),[]);return s.jsxs(i,{sx:{position:"relative"},children:[s.jsxs(p,{variant:"outlined",onClick:f,sx:{display:"flex",alignItems:"center",width:"100%",justifyContent:"flex-start",border:"1px solid",borderColor:"grey.400",pl:.7},children:[s.jsx($e,{sx:{color:c,fontSize:24,ml:0}})," ",s.jsx(u,{variant:"body1",sx:{ml:1,textTransform:"none",color:"grey"},children:t})]}),s.jsx(Fe,{id:e,open:h,anchorEl:a,onClose:g,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx(i,{sx:{p:1,bgcolor:"background.paper",borderRadius:1,boxShadow:3},children:s.jsx(Re,{container:!0,spacing:1,sx:{width:150},children:id.map((e=>s.jsx(Re,{item:!0,xs:3,children:s.jsx(p,{onClick:()=>m(e),sx:{minWidth:0,padding:0,borderRadius:"50%",backgroundColor:e,width:24,height:24}})},e)))})})})]})};function od({taskFields:e,tasks:t=[],selectedTaskId:l=null,updateTask:c=null,changeTaskStatus:d=null,addSubTask:h=null,deleteTask:f=null,selectedListId:m=null}){var g;const[x,y]=n.useState({}),[v,b]=n.useState({}),[k,w]=n.useState(""),[T,j]=n.useState(!1),{fetchCalendarEvents:S}=sd(),C=n.useMemo((()=>new Map(t.map((e=>[e.id,e])))),[t]),E=C.get(+l)||null,[_,I]=n.useState((null==E?void 0:E.status_id)||1);n.useEffect((()=>{E&&I(E.status_id)}),[E]),n.useEffect((()=>{if(!E||!e)return;const t=Object.entries(e).sort((([,e],[,t])=>(e.id||0)-(t.id||0))),n={};t.forEach((([e,t])=>{"toggle"===t.type?n[e]="boolean"==typeof E[e]?E[e]:!!E[e]:"color"===t.type?n[e]="string"==typeof E[e]?E[e]:"":"multiselect"===t.type?n[e]=Array.isArray(E[e])?E[e]:[]:n[e]=E[e]??""})),n.title=E.title,y(n)}),[E,e]),n.useEffect((()=>{if(!E||!E.childes_order)return;const e=E.childes_order.reduce(((e,t)=>{const n=C.get(t);return n&&(e[t]=n.title),e}),{});b(e)}),[E,C]);const L=n.useCallback((async(e,t)=>{if(y((n=>({...n,[e]:t}))),E[e]!==t){let n=null;Array.isArray(E.lists)&&E.lists.length>0?n=E.lists[0].id:m&&(n=m),await c({taskId:E.id,[e]:t,listId:n}),S&&await S()}}),[E,c,m,S]),D=n.useCallback((async(e,t)=>{const n=t?2:1;let s=null;if(e===E.id)Array.isArray(E.lists)&&E.lists.length>0?s=E.lists[0].id:m&&(s=m),I(n);else{const t=C.get(e);Array.isArray(null==t?void 0:t.lists)&&t.lists.length>0?s=t.lists[0].id:m&&(s=m)}const i={taskId:e,status_id:n,listId:s};if(2===n){i.end_date=Yl().toISOString();new Audio("/sounds/isComplited.wav").play()}await d(i),S&&await S()}),[d,E,C,m,S]),R=n.useCallback((async e=>{var t;const n=null==(t=v[e])?void 0:t.trim(),s=C.get(e);if(!s||s.title===n)return;let i=null;Array.isArray(null==s?void 0:s.lists)&&s.lists.length>0?i=s.lists[0].id:m&&(i=m),await c({taskId:e,title:n,listId:i}),S&&await S()}),[v,C,c,m,S]),M=n.useCallback(((e,t,n=null)=>{"Enter"===e.key&&(e.preventDefault(),n?R(n):L(t,e.target.value))}),[R,L]),A=n.useCallback((async()=>{if(k.trim()){let e=null;Array.isArray(E.lists)&&E.lists.length>0?e=E.lists[0].id:m&&(e=m),await h({title:k,parentTaskId:E.id,listId:e}),S&&await S(),w("")}}),[k,h,E,m,S]),P=n.useCallback((async e=>{let t=null;const n=C.get(e);Array.isArray(null==n?void 0:n.lists)&&n.lists.length>0?t=n.lists[0].id:m&&(t=m),await f({taskId:e,listId:t}),S&&await S()}),[f,C,m,S]),z=n.useCallback((async()=>{let e=null;Array.isArray(E.lists)&&E.lists.length>0?e=E.lists[0].id:m&&(e=m),await f({taskId:E.id,listId:e}),S&&await S()}),[f,E,m,S]);return E?s.jsxs(i,{sx:{width:"100%",height:"96%",pb:2},children:[s.jsxs(Se,{variant:"outlined",sx:{p:1,my:1},children:[s.jsxs(i,{sx:{display:"flex",alignItems:"center"},children:[s.jsx(ae,{checked:2===_,sx:{mr:1,p:0},onChange:e=>D(E.id,e.target.checked)}),s.jsx(a,{label:"Название задачи",sx:{width:"100%",my:1},value:x.title||"",onChange:e=>y((t=>({...t,title:e.target.value}))),onBlur:e=>L("title",e.target.value),onKeyDown:e=>M(e,"title"),multiline:!0,maxRows:3,variant:"outlined"})]}),s.jsx(i,{sx:{marginY:0},children:null==(g=E.childes_order)?void 0:g.map((e=>{const t=C.get(e);return t?s.jsx(Re,{container:!0,alignItems:"center",spacing:.5,sx:{marginY:.5},children:s.jsxs(Re,{item:!0,xs:!0,width:"100%",children:[s.jsxs(i,{component:"form",sx:{display:"flex",alignItems:"center",width:"100%"},children:[s.jsx(ae,{checked:2===t.status_id,sx:{m:0,p:0},onChange:e=>D(t.id,e.target.checked)}),s.jsx(He,{sx:{ml:1,flex:1,textDecoration:2===t.status_id?"line-through":"none",width:"100%"},placeholder:"Подзадача",value:v[t.id]||"",onChange:e=>b((n=>({...n,[t.id]:e.target.value}))),onBlur:()=>R(t.id),onKeyDown:e=>M(e,"title",t.id),inputProps:{"aria-label":"subtask"}}),s.jsx(O,{sx:{height:15,m:.5},orientation:"vertical"}),s.jsx(r,{sx:{m:0,p:0},onClick:()=>P(t.id),children:s.jsx(o,{})})]}),s.jsx(O,{sx:{m:.5}})]})},e):null}))}),s.jsx(Re,{item:!0,xs:!0,children:s.jsxs(i,{component:"form",sx:{display:"flex",alignItems:"center",width:"100%"},children:[s.jsx(r,{sx:{m:0,p:0},onClick:A,children:s.jsx(Ne,{})}),s.jsx(He,{sx:{ml:1,flex:1},placeholder:"Добавить подзадачу",value:k,onChange:e=>w(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),A())},inputProps:{"aria-label":"add subtask"}})]})})]}),2===_&&s.jsxs(u,{variant:"body2",sx:{mt:2,textAlign:"center"},children:["Завершено: ",E.end_date?Yl(E.end_date).format("DD/MM/YYYY HH:mm"):""]}),s.jsxs(Se,{variant:"outlined",sx:{p:1,display:"flex",flexDirection:"column",gap:1.5,paddingY:2},children:[s.jsx(p,{variant:"outlined",onClick:()=>j(!0),children:"Добавить запись в журнал проекта"}),Object.entries(e).sort((([,e],[,t])=>(e.id||0)-(t.id||0))).map((([e,t])=>{if(!t)return null;if("divider"===t.type)return s.jsx(O,{sx:{my:.5}},e);const n="datetime"===t.type&&x[e]?Yl(x[e]):null;return s.jsx(i,{sx:{mt:1},children:"datetime"===t.type?s.jsx(se,{fullWidth:!0,children:s.jsx(cn,{dateAdapter:mc,children:s.jsx(un,{viewRenderers:{hours:hn,minutes:hn,seconds:hn},ampm:!1,label:t.name,value:n,format:"DD/MM/YYYY HH:mm",onChange:t=>{t&&t.isValid()&&L(e,t.toISOString())},onAccept:t=>L(e,t.toISOString()),slotProps:{textField:{onBlur:()=>L(e,x[e])}},onKeyDown:t=>M(t,e)})})}):"select"===t.type?s.jsx(J,{options:t.groupBy?[...t.options].sort(((e,t)=>{const n=e.groupLabel||"",s=t.groupLabel||"";return n!==s?n.localeCompare(s):(e.label||"").localeCompare(t.label||"")})):t.options,groupBy:t.groupBy?e=>e.groupLabel||"Без группы":void 0,getOptionLabel:e=>e.label||"",value:t.options.find((t=>t.value===x[e]))||null,onChange:(t,n)=>L(e,n?n.value:null),renderInput:e=>s.jsx(a,{...e,label:t.name})}):"text"===t.type?s.jsx(a,{fullWidth:!0,label:t.name,multiline:!0,rows:5,value:x[e]||"",onChange:t=>y((n=>({...n,[e]:t.target.value}))),onBlur:t=>L(e,t.target.value),variant:"outlined"}):"toggle"===t.type?s.jsx(se,{fullWidth:!0,children:s.jsxs(_e,{value:"check",size:"small",selected:!!x[e],onChange:()=>L(e,!x[e]),sx:{border:"1px solid",borderColor:x[e]?"darkgrey":"grey.400",justifyContent:"flex-start",p:0},children:[s.jsx(ae,{checked:!!x[e]}),s.jsx(u,{sx:{ml:1,textTransform:"none"},children:t.name})]})}):"color"===t.type?s.jsx(rd,{fieldKey:e,fieldName:t.name,selectedColorProp:x[e]||"",onColorChange:(t,n)=>L(e,n)}):"multiselect"===t.type?s.jsx(J,{multiple:!0,options:t.options,getOptionLabel:e=>e.title,isOptionEqualToValue:(e,t)=>e.id===t.id,value:Array.isArray(x[e])?x[e]:[],onChange:(t,n)=>L(e,n),renderInput:e=>s.jsx(a,{...e,label:t.name}),renderTags:(e,t)=>e.map(((e,n)=>s.jsx(We,{label:e.title,...t({idx:n})},e.id)))}):s.jsx(a,{fullWidth:!0,label:t.name,type:t.type,value:x[e]||"",onChange:t=>y((n=>({...n,[e]:t.target.value}))),onBlur:t=>L(e,t.target.value),variant:"outlined"})},e)}))]}),s.jsx(bc,{open:T,handleClose:()=>j(!1),taskId:l}),s.jsx(i,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end",mb:1},children:s.jsx(p,{variant:"outlined",color:"error",onClick:z,children:"Удалить задачу"})})]}):null}function ad({open:e,handleClose:t,handleDelDateClick:i,scroll:r,setSelectedTaskId:o,tasks:a,selectedTaskId:l,taskFields:c,addSubTask:d=null,updateTask:u=null,changeTaskStatus:h=null,deleteTask:f=null}){const m=n.useRef(null);if(n.useEffect((()=>{if(e){const{current:e}=m;null!==e&&e.focus()}}),[e]),!l)return null;function g(){"function"==typeof o&&o(null),t()}return s.jsxs(Q,{open:e,onClose:g,scroll:r,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",sx:{maxWidth:"100%"},children:[s.jsx(ee,{id:"scroll-dialog-title",children:"Изменить задачу"}),s.jsx(te,{dividers:"paper"===r,style:{width:"500px",maxWidth:"100%"},children:s.jsx(od,{tasks:a,selectedTaskId:l,taskFields:c,addSubTask:d,updateTask:u,changeTaskStatus:h,deleteTask:f})}),s.jsxs(ne,{children:[s.jsx(p,{onClick:function(){i&&i(l),"function"==typeof o&&o(null)},children:"Удалить дату выполнения"}),s.jsx(p,{onClick:g,children:"Close"})]})]})}rd.propTypes={fieldKey:m.string,fieldName:m.string,selectedColorProp:m.string,onColorChange:m.func},od.propTypes={taskFields:m.object,tasks:m.array,selectedTaskId:m.oneOfType([m.string,m.number]),updateTask:m.func,changeTaskStatus:m.func,addSubTask:m.func,deleteTask:m.func,selectedListId:m.oneOfType([m.string,m.number])},ad.propTypes={open:t.PropTypes.bool.isRequired,handleClose:t.PropTypes.func,handleDelDateClick:t.PropTypes.func,scroll:t.PropTypes.string,setSelectedTaskId:t.PropTypes.func,tasks:t.PropTypes.array,selectedTaskId:t.PropTypes.oneOfType([t.PropTypes.string,t.PropTypes.number]),taskFields:t.PropTypes.object,addSubTask:t.PropTypes.func,updateTask:t.PropTypes.func,changeTaskStatus:t.PropTypes.func,deleteTask:t.PropTypes.func};var ld={code:"ru",week:{dow:1,doy:4},buttonText:{prev:"Пред",next:"След",today:"Сегодня",year:"Год",month:"Месяц",week:"Неделя",day:"День",list:"Повестка дня"},weekText:"Нед",allDayText:"Весь день",moreLinkText:e=>"+ ещё "+e,noEventsText:"Нет событий для отображения"};function cd({item:e,isSelected:t,isEditing:n,onSelect:i,onEdit:r,onCancelEdit:o,isDraggable:l=!0,showProgress:c=!1,onContextMenu:d,inputRef:u,handleKeyDown:h,handleBlur:p,handleTitleChange:f,editingTitle:m,selectedTaskId:g,onTaskDrop:x,onDragStart:y}){let v=0;if(c&&Array.isArray(e.childes_order)&&e.childes_order.length>0){const t="number"==typeof e.unfinished_tasks_count?e.unfinished_tasks_count:0;v=(e.childes_order.length-t)/e.childes_order.length*100}return s.jsxs("div",{children:[s.jsxs(G,{selected:t,onClick:i,onContextMenu:d,children:[s.jsx(V,{sx:{minWidth:35},children:s.jsx(qe,{})}),n?s.jsx(a,{size:"small",sx:{p:0,m:0,width:"100%"},value:m,onChange:f,onKeyDown:h,onBlur:p,inputRef:u}):s.jsx(K,{primary:e.title,sx:{mr:2}}),e.childes_order&&0!==e.childes_order.length&&(0!==e.unfinished_tasks_count?s.jsx(Ue,{badgeContent:e.unfinished_tasks_count,color:"primary",sx:{mr:1}}):s.jsx(I,{fontSize:"small",style:{color:"green"}}))]}),c&&0!==e.unfinished_tasks_count&&s.jsx(R,{variant:"determinate",value:v,sx:{m:0}},e.id)]},`div_${e.id}`)}function dd({item:e,isOpen:t,onToggle:n,isEditing:i,onEdit:r,onCancelEdit:o,childrenLists:l,isDraggable:c=!0,showProgress:d=!1,onContextMenu:u,inputRef:h,handleKeyDown:p,handleBlur:f,handleTitleChange:m,editingTitle:g,renderListItem:x,renderGroupItem:y,onDragStart:v,onListDrop:b}){let k=0;d&&(k=(e.tasks_count-e.unfinished_tasks_count)/e.tasks_count*100);return s.jsxs("div",{children:[s.jsxs(G,{onClick:n,onContextMenu:u,children:[s.jsx(V,{sx:{minWidth:35},children:"project"===e.type?s.jsx(Ye,{}):s.jsx(Ge,{})}),i?s.jsx(a,{size:"small",sx:{p:0,m:0,width:"100%"},value:g,onClick:e=>e.stopPropagation(),onChange:m,onKeyDown:p,onBlur:f,inputRef:h}):s.jsx(K,{primary:e.title}),100===k?s.jsx(I,{fontSize:"small",style:{color:"green"}}):null,t?s.jsx(we,{}):s.jsx(C,{})]}),d&&100!==k&&0!==e.tasks_count&&s.jsx(R,{variant:"determinate",value:k,sx:{m:0}}),s.jsx(E,{in:t,timeout:"auto",unmountOnExit:!0,children:s.jsx(ke,{component:"nav",sx:{ml:1.5},children:e.childes_order.map((e=>{const t=null==l?void 0:l.find((t=>(null==t?void 0:t.id)===e));return t?"group"===t.type?y(t):x(t):null}))})})]},e.id)}function ud({items:e,sectionType:t,selectedListId:n,selectedTaskId:i,openGroups:r,onSelect:o,onToggleGroup:a,isNeedContextMenu:l,editingItemId:c,onContextMenu:d,inputRef:u,handleKeyDown:h,handleBlur:p,handleTitleChange:f,editingTitle:m,listsList:g,projects:x,onTaskDrop:y,onDragStart:v,onListDrop:b}){const k=(e,w=null)=>{const T={item:e,isEditing:c===e.id,onContextMenu:l?t=>d(t,e,w):void 0,inputRef:u,handleKeyDown:h,handleBlur:p,handleTitleChange:f,editingTitle:m,onDragStart:v};return"group"===e.type||"project"===e.type?s.jsx(dd,{isOpen:r[e.id],onToggle:()=>a(e.id),childrenLists:g.concat(x),showProgress:"projects"===t,renderListItem:t=>k(t,e.id),renderGroupItem:t=>k(t,e.id),isDraggable:"default"!==t,onListDrop:b,...T},e.id):s.jsx(cd,{isSelected:n===e.id,selectedTaskId:i,onSelect:t=>o(t,e.id),showProgress:!1,isDraggable:"default"!==t,onTaskDrop:y,...T},e.id)};return s.jsx(ke,{sx:{width:"100%",pt:0},component:"nav",children:null==e?void 0:e.map((e=>"lists"===t?e.inGeneralList&&!e.deleted?k(e):null:k(e)))})}function hd({anchorEl:e,item:t,groupId:n,onClose:i,onEditClick:r,onOpenGroupMenu:o,onOpenProjectMenu:a,onDeleteFromChildes:l,onChangeChildesOrder:c,onAddToGeneralList:d,listsList:u,projects:h}){const p="list"===(null==t?void 0:t.type),f="group"===(null==t?void 0:t.type),m="project"===(null==t?void 0:t.type),g=e=>{e(),i()},x=()=>[s.jsx(oe,{onClick:()=>g((()=>r(t.id))),children:"Переименовать"},"rename"),s.jsx(O,{},"divider"),s.jsx(oe,{onClick:()=>g((()=>c(t.id,"up",n))),children:"Переместить выше"},"moveUp"),s.jsx(oe,{onClick:()=>g((()=>c(t.id,"down",n))),children:"Переместить ниже"},"moveDown")];return s.jsxs(Te,{anchorEl:e,open:Boolean(e),onClose:i,children:[t&&p&&[...x(),s.jsx(oe,{onClick:e=>g((()=>o(e,"move"))),children:"Переместить в группу"},"moveToGroup"),s.jsx(oe,{onClick:e=>g((()=>o(e,"link"))),children:"Связать с группой"},"linkToGroup"),s.jsx(oe,{onClick:e=>g((()=>a(e,"move"))),children:"Переместить в проект"},"moveToProject"),s.jsx(oe,{onClick:e=>g((()=>a(e,"link"))),children:"Связать с проектом"},"linkToProject"),s.jsx(O,{},"divider2"),s.jsx(oe,{onClick:()=>g((()=>l(t.id,n))),children:"Удалить из этой группы"},"deleteFromGroup")],t&&f&&[...x(),s.jsx(oe,{onClick:e=>g((()=>a(e,"move"))),children:"Переместить в проект"},"moveToProject"),s.jsx(oe,{onClick:e=>g((()=>a(e,"link"))),children:"Связать с проектом"},"linkToProject"),s.jsx(O,{},"divider3"),s.jsx(oe,{onClick:()=>g((()=>l(t.id,n))),children:"Удалить из этой группы"},"deleteFromGroup")],t&&!t.inGeneralList&&!p&&!f&&!m&&[s.jsx(oe,{onClick:()=>g((()=>d(t.id))),children:"Добавить в основной список"},"addToGeneral")],t&&m&&[s.jsx(oe,{onClick:()=>g((()=>r(t.id))),children:"Переименовать"},"rename"),s.jsx(O,{},"divider"),s.jsx(oe,{onClick:()=>g((()=>c(t.id,"up"))),children:"Переместить выше"},"moveUp"),s.jsx(oe,{onClick:()=>g((()=>c(t.id,"down"))),children:"Переместить ниже"},"moveDown")]]})}function pd({listsList:e=[],defaultLists:t=[],projects:r=[],isNeedContextMenu:o=!1,setSelectedTaskId:a=null,selectedTaskId:l=null,updateAll:c=null,updateEvents:d=null,selectedListId:u=null,setSelectedListId:h=null,fetchLists:f=null,addList:m=null,deleteList:g=null,linkListGroup:x=null,deleteFromChildes:y=null,linkTaskList:v=null,changeChildesOrder:b=null,selectedList:k=null,setSelectedList:w=null}){const[T,j]=n.useState({}),[S,C]=n.useState(null),[E,_]=n.useState(null),[I,L]=n.useState(null),[D,R]=n.useState(""),[M,A]=n.useState(null),[P,z]=n.useState(null),[B,$]=n.useState(null),[F,H]=n.useState(null),[N,W]=n.useState(null),[q,U]=n.useState(null),[Y,G]=n.useState(null),[V,K]=n.useState(null),[J,X]=n.useState(null),[Z,Q]=n.useState(null),ee=n.useRef(null),{fetchTasks:te}=Qc(),{fetchLists:ne,updateList:se}=Kc(),{fetchCalendarEvents:ie}=sd();function re(e){j((t=>({...t,[e]:!t[e]})))}function ae(e,t){E||(I!==t&&(L(null),_(null)),"function"==typeof h&&h(t),"function"==typeof a&&a(null))}function le(e,t,n){e.preventDefault(),_(null),C(e.currentTarget),A(n),L(t.id),R(t.title)}function ce(){C(null),A(null)}function de(e){R(e.target.value)}async function ue(e){z(null),$(null),C(null),H(null),ce(),"move"===F?("function"==typeof x&&await x({source_id:I,target_id:e}),"function"==typeof y&&await y({source_id:I,group_id:M})):"link"===F&&"function"==typeof x&&x({source_id:I,target_id:e})}function he(e){"Enter"===e.key&&(e.preventDefault(),se({listId:E,title:D}),_(null),ee.current=null)}function pe(){se({listId:E,title:D}),_(null),ee.current=null}function fe(e,t){e.preventDefault();const n=e.dataTransfer.getData("task");n&&(U(JSON.parse(n)),G(t),W(e.currentTarget))}function me(e,t){e.dataTransfer.setData("list",JSON.stringify(t))}async function ge(e,t){e.preventDefault();const n=e.dataTransfer.getData("list");if(!n)return;const s=JSON.parse(n);X(s),Q(t),K(e.currentTarget)}async function xe(e){var t;if(!q)return;const n={task_id:q.id,list_id:Y,action:e};"move"===e&&(null==(t=q.lists_ids)?void 0:t.length)&&(n.source_list_id=q.lists_ids[0]),"function"==typeof v&&await v(n),ye()}function ye(){W(null),U(null),G(null)}async function ve(t){if(J){if("function"==typeof x&&await x({source_id:J.id,target_id:Z}),"move"===t&&"function"==typeof y){const t=function(t){const n=e.find((e=>Array.isArray(e.childes_order)&&e.childes_order.includes(t)));if(n)return n.id;const s=null==r?void 0:r.find((e=>Array.isArray(e.childes_order)&&e.childes_order.includes(t)));return s?s.id:null}(J.id);t&&await y({source_id:J.id,group_id:t})}"function"==typeof c&&await c(),be()}}function be(){K(null),X(null),Q(null)}return n.useEffect((()=>{null!==ee.current&&ee.current.focus()}),[E]),s.jsxs(s.Fragment,{children:[s.jsx(p,{variant:"outlined",onClick:async function(){"function"==typeof f?await f():"function"==typeof ne&&await ne(),"function"==typeof te&&u&&await te(u),"function"==typeof ie&&await ie()},sx:{mb:1},children:"Обновить"}),s.jsxs(i,{sx:{height:"calc(100% - 50px)",overflowY:"auto"},children:[s.jsx(ud,{items:t,sectionType:"default",selectedListId:u,selectedTaskId:l,openGroups:T,onSelect:ae,onToggleGroup:re,isNeedContextMenu:!1,editingItemId:E,onContextMenu:le,inputRef:ee,handleKeyDown:he,handleBlur:pe,handleTitleChange:de,editingTitle:D,listsList:e,onTaskDrop:fe,onDragStart:me,onListDrop:ge}),s.jsx(O,{}),s.jsx(ud,{items:r,sectionType:"projects",selectedListId:u,selectedTaskId:l,openGroups:T,onSelect:ae,onToggleGroup:re,isNeedContextMenu:o,editingItemId:E,onContextMenu:le,inputRef:ee,handleKeyDown:he,handleBlur:pe,handleTitleChange:de,editingTitle:D,listsList:e,onTaskDrop:fe,onDragStart:me,onListDrop:ge}),s.jsx(O,{}),s.jsx(ud,{items:e,sectionType:"lists",selectedListId:u,selectedTaskId:l,openGroups:T,onSelect:ae,onToggleGroup:re,isNeedContextMenu:o,editingItemId:E,onContextMenu:le,inputRef:ee,handleKeyDown:he,handleBlur:pe,handleTitleChange:de,editingTitle:D,listsList:e,onTaskDrop:fe,onDragStart:me,onListDrop:ge})]}),s.jsx(hd,{anchorEl:S,item:(null==e?void 0:e.find((e=>e.id===I)))||(null==r?void 0:r.find((e=>e.id===I))),groupId:M,onClose:ce,onEditClick:function(e){_(e),C(null)},onOpenGroupMenu:function(e,t){H(t),z(e.currentTarget)},onOpenProjectMenu:function(e,t){H(t),$(e.currentTarget)},onDeleteFromChildes:function(e,t){C(null),"function"==typeof y&&y({source_id:e,group_id:t})},onChangeChildesOrder:async function(n,s,i){if(C(null),!i||String(n).startsWith("project_")){let i=String(n).startsWith("project_")?e:t.filter((e=>1==e.inGeneralList&&!e.deleted));const r=i.findIndex((e=>e.id===n));if(-1===r||"up"===s&&0===r||"down"===s&&r===i.length-1)return;let o=i[r].order,a=i["up"===s?r-1:r+1],l=a.order;return"function"==typeof se&&(await se({listId:n,order:l}),await se({listId:a.id,order:o})),"function"==typeof c&&await c(),void("function"==typeof d&&await d())}let r=e.find((e=>e.id===i))||e.find((e=>e.id===i));if(!r)return;const o=r.childes_order.indexOf(n);-1!==o&&("up"===s&&o>0?[r.childes_order[o-1],r.childes_order[o]]=[r.childes_order[o],r.childes_order[o-1]]:"down"===s&&o<r.childes_order.length-1&&([r.childes_order[o+1],r.childes_order[o]]=[r.childes_order[o],r.childes_order[o+1]]),se({listId:r.id,childes_order:r.childes_order}))},onAddToGeneralList:function(e){se({listId:e,inGeneralList:1}),C(null)},listsList:e}),s.jsx(Te,{anchorEl:P,open:Boolean(P),onClose:function(){z(null)},children:e&&e.filter((e=>"group"===e.type&&!e.deleted)).map((e=>s.jsx(oe,{onClick:()=>ue(e.id),children:e.title},e.id)))}),s.jsx(Te,{anchorEl:B,open:Boolean(B),onClose:function(){$(null)},children:null==r?void 0:r.map((e=>s.jsx(oe,{onClick:()=>ue(e.id),children:e.title},e.id)))}),s.jsxs(Te,{anchorEl:N,open:Boolean(N),onClose:ye,children:[s.jsx(oe,{onClick:()=>xe("link"),children:"Связать"}),s.jsx(oe,{onClick:()=>xe("move"),children:"Переместить"})]}),s.jsxs(Te,{anchorEl:V,open:Boolean(V),onClose:be,children:[s.jsx(oe,{onClick:()=>ve("link"),children:"Связать"}),s.jsx(oe,{onClick:()=>ve("move"),children:"Переместить"})]})]})}function fd({open:e,handleClose:t,scroll:i,selectedDate:r,addTask:o}){const[l,c]=n.useState("");function d(){t&&t()}return s.jsxs(Q,{open:e,onClose:d,scroll:i,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[s.jsx(ee,{id:"scroll-dialog-title",children:"Создать задачу"}),s.jsx(te,{dividers:"paper"===i,style:{width:"500px",maxWidth:"100%"},children:s.jsx(Y,{children:s.jsx(a,{id:"createTask-input",fullWidth:!0,label:"Введите название задачи",value:l,onChange:e=>c(e.target.value),variant:"outlined"})})}),s.jsxs(ne,{children:[s.jsx(p,{onClick:function(){l&&r&&(o({title:l,listId:"tasks",start:r.start,end:r.end?r.end:null,type:"event"}),c(""),d())},children:"Создать задачу"}),s.jsx(p,{onClick:d,children:"Отмена"})]})]})}function md({open:e,onClose:t,onApply:r,slotDuration:o,timeRange:a,timeOffset:l}){const[c,d]=n.useState(o),[f,m]=n.useState(a),[g,x]=n.useState(l);return s.jsxs(Q,{open:e,onClose:t,sx:{maxWidth:"100%"},children:[s.jsx(ee,{children:"Настройки календаря"}),s.jsxs(te,{sx:{padding:"24px"},children:[s.jsxs(i,{sx:{marginBottom:3},children:[s.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Интервал сетки (минуты)"}),s.jsx(h,{value:c,onChange:(e,t)=>{d(t)},"aria-labelledby":"slot-duration-slider",valueLabelDisplay:"auto",step:5,min:5,max:60,marks:!0})]}),s.jsxs(i,{sx:{marginBottom:3},children:[s.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Временной диапазон (часы)"}),s.jsx(h,{value:f,onChange:(e,t)=>{m(t)},"aria-labelledby":"time-range-slider",valueLabelDisplay:"auto",min:0,max:24,step:1,marks:!0})]}),s.jsxs(i,{sx:{marginBottom:3},children:[s.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Смещение времени (часы)"}),s.jsx(h,{value:g,onChange:(e,t)=>{x(t)},"aria-labelledby":"time-offset-slider",valueLabelDisplay:"auto",min:-12,max:12,step:1,marks:!0})]})]}),s.jsxs(ne,{sx:{padding:"16px 24px"},children:[s.jsx(p,{onClick:t,sx:{marginRight:"auto",color:"grey.600"},children:"Отмена"}),s.jsx(p,{variant:"contained",onClick:()=>{r(c,f,g)},sx:{backgroundColor:"primary.main"},children:"Применить"})]})]})}function gd({calendarRef:e,events:t=[],tasks:r=[],lists:o={},fetchTasks:a=()=>{},fetchEvents:l=()=>{},addTask:c=()=>{},newSettings:d,saveSettings:u,handleEventClick:h,handleEventChange:f,eventReceive:m,datesSet:g=null}){var x;const y=n.useRef(null),v=n.useRef(null),[b,k]=n.useState(null),[w,T]=n.useState(!0),[j,S]=n.useState(!1),[C,E]=n.useState("paper"),[_,I]=n.useState(null),[L,D]=n.useState(!1),R=pe(),O=n.useCallback((e=>{S(!0),E(e)}),[]),M=(null==d?void 0:d.timeOffset)||0,A=(null==d?void 0:d.isToggledBGTasksEdit)||!1,P=(null==d?void 0:d.currentView)||"timeGridMonth",z=(null==d?void 0:d.slotDuration)||30,B=(null==d?void 0:d.timeRange)||[8,24],$=n.useMemo((()=>{const e=Number(M)||0,n=t=>{if(!t)return null;const n=new Date(t);return isNaN(n.getTime())||0!==e&&(n.setHours(n.getHours()-e),isNaN(n.getTime()))?null:n};let s=(Array.isArray(t)?t:[]).map((e=>{if(!e)return null;const t={...e};t.extendedProps={...e.extendedProps||{},originalStart:e.start,originalEnd:e.end};const s=n(e.start);t.start=s?s.toISOString():null;let i=null;if(e.end)i=n(e.end);else if(s&&!e.allDay){const e=new Date(s);e.setHours(e.getHours()+1),i=e}t.end=i?i.toISOString():null,e.rrule&&t.start&&"object"==typeof t.rrule&&null!==t.rrule&&(t.rrule={...t.rrule,dtstart:t.start});const r=2==(null==e?void 0:e.status_id)?"#008000":3==(null==e?void 0:e.priority_id)?"#A52A2A":(null==e?void 0:e.color)?e.color:"#3788D8";return t.color=r,t.backgroundColor=r,t.borderColor=r,t})).filter((e=>null!==e));return d&&d.isToggledBGTasksEdit&&(s=null==s?void 0:s.filter((e=>"background"==(null==e?void 0:e.display))),null==s||s.forEach((e=>{e&&(e.display="block")}))),s}),[t,M,null==d?void 0:d.isToggledBGTasksEdit,null==d?void 0:d.currentView]);n.useEffect((()=>{null!==b&&a(b)}),[b,a]),n.useEffect((()=>{l()}),[l]),n.useEffect((()=>{w||l()}),[w,l]),n.useEffect((()=>{var t;const n=null==(t=e.current)?void 0:t.getApi();n&&(n.removeAllEvents(),n.addEventSource($))}),[$,e]),n.useEffect((()=>(y.current&&(null==r?void 0:r.length)>0&&(v.current&&v.current.destroy(),v.current=new mn(y.current,{itemSelector:".draggable-task",eventData:e=>{const t=e.getAttribute("data-id"),n=r.find((e=>String(null==e?void 0:e.id)===t));return n?(T(!0),{title:n.title,id:n.id,start:n.start,end:n.end_date,allDay:!n.start}):null}})),()=>{v.current&&(v.current.destroy(),v.current=null)})),[r]);const F=()=>D(!1);const H=n.useCallback((e=>{const t=new Date(e.date);t.setHours(t.getHours()+(Number(M)||0));return{html:t.toLocaleTimeString(navigator.language,{hour:"numeric",minute:"2-digit",hour12:!1})}}),[M]);const N={locale:ld,slotDuration:`00:${String(z).padStart(2,"0")}:00`,slotLabelInterval:`00:${String(z).padStart(2,"0")}:00`,slotMinTime:`${String(B[0]).padStart(2,"0")}:00:00`,slotMaxTime:`${String(B[1]).padStart(2,"0")}:00:00`,initialView:P,height:"100%",plugins:[xn,yn,vn,bn,kn],headerToolbar:{left:"prev,next today",center:"title",right:(null==d?void 0:d.views)||"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},droppable:!0,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,events:$,slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:"short"},slotLabelContent:H,select:function(e){const t=Number(M)||0,n=e=>{if(!e)return null;const n=new Date(e);return isNaN(n.getTime())||0!==t&&(n.setHours(n.getHours()+t),isNaN(n.getTime()))?null:n.toISOString()},s=n(e.startStr),i=n(e.endStr);I({start:s,end:i,allDay:e.allDay}),O("paper")},datesSet:()=>{var t;const n=null==(t=null==e?void 0:e.current)?void 0:t.getApi();if(!n)return;const s=n.view.type,i=n.getDate();l(),d.currentView!==s&&u({...d,currentView:s}),g&&"function"==typeof g&&g(s,i)},eventClick:h,eventChange:f,eventReceive:function(e){m&&"function"==typeof m&&m(e),e.event.remove()},eventDragStart:()=>T(!0),nowIndicator:!0};return((null==(x=null==d?void 0:d.currentView)?void 0:x.startsWith("timeGrid"))||"dayGridDay"==(null==d?void 0:d.currentView))&&(N.eventContent=e=>function(e){var t,n;if("background"===e.event.display&&!A)return{html:`<div class="fc-event-title fc-sticky">${e.event.title}</div>`};const s=e=>{if(!e)return"";try{const t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?"":t.toLocaleTimeString(navigator.language,{hour:"numeric",minute:"2-digit",hour12:!1})}catch(jn){return""}},i=(null==(t=e.event.extendedProps)?void 0:t.originalStart)||e.event.start,r=(null==(n=e.event.extendedProps)?void 0:n.originalEnd)||e.event.end,o=s(i),a=s(r);return{html:`<div class="fc-event-title fc-sticky">${o}${a?" - "+a:""} - ${e.event.title}</div>`}}(e)),s.jsxs(i,{sx:{height:"100%",display:"flex",flexDirection:"column",width:"100%"},children:[s.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",paddingTop:1,paddingX:1},children:[s.jsxs(i,{children:[s.jsx(p,{onClick:()=>D(!0),children:"Настройки"}),s.jsxs(_e,{onClick:()=>{u({...d,isToggledBGTasksEdit:!d.isToggledBGTasksEdit})},selected:A,value:"backgroundsEdit",children:[A?s.jsx(Ke,{}):s.jsx(Ve,{})," Фоновые задачи"]})]}),s.jsx(p,{onClick:()=>{k(null),T(!w)},children:w?"Показать задачи":"Скрыть задачи"})]}),s.jsxs(Re,{container:!0,sx:{flexGrow:1,overflowY:"auto",overflowX:"hidden",height:"100%",position:"relative"},children:[s.jsx(Re,{width:"100%",children:s.jsxs(Se,{sx:{p:3,flexGrow:1,overflowY:"auto",height:"100%"},children:[s.jsx(gn,{ref:e,...N}),s.jsx(fd,{open:j,handleClose:()=>S(!1),scroll:C,selectedDate:_,addTask:c}),s.jsx(md,{open:L,onClose:function(){F()},onApply:function(e,t,n){F();const s={...d,slotDuration:e,timeRange:t,timeOffset:n};u(s)},slotDuration:z,timeRange:B,timeOffset:M})]})}),s.jsxs(Re,{sx:{position:"absolute",top:0,bottom:0,right:0,width:"500px",maxWidth:"100%",transform:w?"translateX(100%)":"translateX(0)",transition:"transform 0.3s ease",zIndex:10,backgroundColor:R.palette.background.paper},children:[s.jsx(Se,{sx:{p:3,display:b?"none":"block",flexGrow:1,overflowY:"auto",height:"100%"},children:s.jsx(pd,{selectedListId:b,listsList:o.lists,defaultLists:o.default_lists,projects:o.projects,isNeedContextMenu:!1,setSelectedListId:k},b)}),b&&s.jsxs(Se,{sx:{p:3,flexGrow:1,overflowY:"auto",height:"100%"},children:[s.jsx(p,{onClick:()=>k(null),children:"Back"}),s.jsx(ke,{ref:y,children:r&&r.length>0?s.jsxs(s.Fragment,{children:[r.filter((e=>2!==e.status_id)).map((e=>s.jsx(je,{className:"draggable-task","data-id":e.id,sx:{cursor:"pointer"},children:s.jsx(K,{primary:e.title})},e.id))),r.filter((e=>2===e.status_id)).length>0&&s.jsxs(s.Fragment,{children:[s.jsx(je,{children:s.jsx(K,{primary:"Выполненные задачи:",sx:{fontWeight:"bold",marginTop:2}})}),r.filter((e=>2===e.status_id)).map((e=>s.jsx(je,{className:"draggable-task","data-id":e.id,sx:{cursor:"pointer",textDecoration:"line-through",color:"gray"},children:s.jsx(K,{primary:e.title})},e.id)))]})]}):s.jsx(je,{children:s.jsx(K,{primary:"No tasks available"})})})]})]})]})]})}cd.propTypes={item:m.object.isRequired,isSelected:m.bool,isEditing:m.bool,onSelect:m.func,onEdit:m.func,onCancelEdit:m.func,isDraggable:m.bool,showProgress:m.bool,onContextMenu:m.func,inputRef:m.object,handleKeyDown:m.func,handleBlur:m.func,handleTitleChange:m.func,editingTitle:m.string,selectedTaskId:m.oneOfType([m.string,m.number]),onTaskDrop:m.func,onDragStart:m.func},dd.propTypes={item:m.object.isRequired,isOpen:m.bool,onToggle:m.func,isEditing:m.bool,onEdit:m.func,onCancelEdit:m.func,childrenLists:m.array,isDraggable:m.bool,showProgress:m.bool,onContextMenu:m.func,inputRef:m.object,handleKeyDown:m.func,handleBlur:m.func,handleTitleChange:m.func,editingTitle:m.string,renderListItem:m.func.isRequired,renderGroupItem:m.func.isRequired,onDragStart:m.func,onListDrop:m.func},ud.propTypes={items:m.array,sectionType:m.oneOf(["default","projects","lists"]).isRequired,selectedListId:m.oneOfType([m.string,m.number]),selectedTaskId:m.oneOfType([m.string,m.number]),openGroups:m.object.isRequired,onSelect:m.func.isRequired,onToggleGroup:m.func.isRequired,isNeedContextMenu:m.bool,editingItemId:m.oneOfType([m.string,m.number]),onContextMenu:m.func.isRequired,inputRef:m.object,handleKeyDown:m.func.isRequired,handleBlur:m.func.isRequired,handleTitleChange:m.func.isRequired,editingTitle:m.string,listsList:m.array.isRequired,projects:m.array.isRequired,onTaskDrop:m.func,onDragStart:m.func,onListDrop:m.func},hd.propTypes={anchorEl:m.object,item:m.object,groupId:m.oneOfType([m.string,m.number]),onClose:m.func.isRequired,onEditClick:m.func.isRequired,onOpenGroupMenu:m.func.isRequired,onOpenProjectMenu:m.func.isRequired,onDeleteFromChildes:m.func.isRequired,onChangeChildesOrder:m.func.isRequired,onAddToGeneralList:m.func.isRequired,listsList:m.array.isRequired,projects:m.array.isRequired},pd.propTypes={selectedListId:m.oneOfType([m.string,m.number]),setSelectedListId:m.func,setSelectedTaskId:m.func,isNeedContextMenu:m.bool,updateAll:m.func,listsList:m.array,projects:m.array,defaultLists:m.array,updateList:m.func,updateEvents:m.func,linkListGroup:m.func,deleteFromChildes:m.func,linkTaskList:m.func,changeChildesOrder:m.func},fd.propTypes={open:t.PropTypes.bool.isRequired,handleClose:t.PropTypes.func,scroll:t.PropTypes.string.isRequired,selectedDate:t.PropTypes.object,addTask:t.PropTypes.func.isRequired},md.propTypes={open:t.PropTypes.bool.isRequired,onClose:t.PropTypes.func.isRequired,onApply:t.PropTypes.func.isRequired,slotDuration:t.PropTypes.number,timeRange:t.PropTypes.array,timeOffset:t.PropTypes.number},gd.propTypes={calendarRef:m.object,events:m.array,tasks:m.array,lists:m.object,fetchTasks:m.func,fetchEvents:m.func,addTask:m.func,newSettings:m.object.isRequired,saveSettings:m.func.isRequired,handleEventClick:m.func,handleEventChange:m.func,eventReceive:m.func,datesSet:m.func};const xd=L.memo(gd);function yd({containerId:e=null,handleDatesSet:t=null,calendarSettingsProp:i=null,onSuccess:r=null,onError:o=null}){const{updateTask:a,addTask:l,fetchTasks:c,tasks:d,taskFields:u,addSubTask:h,changeTaskStatus:p,deleteTask:f}=Qc(),{lists:m,selectedListId:g,selectedList:x}=Kc(),{calendarEvents:y,fetchCalendarEvents:v}=sd(),{setUpdates:b,handleUpdateContent:k}=Ad(),w=n.useRef(null),[T,j]=n.useState(!1),[S,C]=n.useState("paper"),[E,_]=n.useState(null),[I,L]=n.useState(i||{slotDuration:30,timeRange:[8,24],timeOffset:0,currentView:"timeGridWeek",views:"timeGridWeek,timeGridDay,dayGridMonth,listWeek",isToggledBGTasksEdit:!1});n.useEffect((()=>{i&&L(i)}),[i]),n.useEffect((()=>{d.error&&o&&o(d.error)}),[d.error,o]),n.useEffect((()=>{y.error&&o&&o(y.error)}),[y.error,o]);async function D(e){var t;const n=Number(null==I?void 0:I.timeOffset)||0,s=e=>{if(!e)return null;const t=new Date(e);return t instanceof Date&&!isNaN(t.getTime())?0!==n&&(t.setHours(t.getHours()+n),isNaN(t.getTime()))?null:t.toISOString():null},i={title:e.event.title,allDay:e.event.allDay};if(e.event.start){const t=s(e.event.start);t&&(i.start=t)}if(e.event.end){const t=s(e.event.end);t&&(i.end=t)}else if(e.event.start&&!e.event.allDay){const t=new Date(e.event.start);if(!isNaN(t.getTime())){t.setHours(t.getHours()+1);const e=s(t);e&&(i.end=e)}}const l=null==(t=null==y?void 0:y.data)?void 0:t.find((t=>t&&t.id==e.event.id));l&&l.rrule&&i.start&&"object"==typeof l.rrule&&null!==l.rrule&&(i.rrule={...l.rrule,dtstart:i.start});try{await a({taskId:e.event.id,...i}),b&&"function"==typeof b&&b((e=>[...e,"todo","calendar"])),v&&"function"==typeof v&&await v(),r&&r("Событие обновлено")}catch(hu){o&&o(hu)}}return s.jsxs(s.Fragment,{children:[s.jsx(xd,{calendarRef:w,newSettings:I,saveSettings:t=>{try{L(t),k&&e&&k(e,{calendarSettingsProp:t}),r&&r("Настройки сохранены")}catch(hu){o&&o(hu)}},events:y.data,tasks:d.data,lists:m,handleEventClick:async function(e){var t,n;_((null==(t=null==e?void 0:e.event)?void 0:t.id)||null);try{n="paper",j(!0),C(n)}catch(s){}},handleEventChange:D,eventReceive:D,addTask:l,fetchTasks:c,fetchEvents:v,datesSet:t}),s.jsx(ad,{open:T,handleClose:()=>{j(!1),b((e=>[...e,"todo","calendar"]))},handleDelDateClick:async function(e){try{await a({taskId:e,start:null,end:null}),b((e=>[...e,"todo","calendar"])),r&&r("Дата удалена")}catch(hu){o&&o(hu)}},scroll:S,setSelectedTaskId:_,tasks:y.data,selectedTaskId:E,taskFields:u,addSubTask:h,updateTask:a,changeTaskStatus:p,deleteTask:f})]})}function vd(e){const{setError:t,setSuccess:i}=n.useContext(zc);return s.jsx(yd,{...e,onError:t,onSuccess:i})}yd.propTypes={containerId:t.PropTypes.string,handleDatesSet:t.PropTypes.func,calendarSettingsProp:t.PropTypes.object,onSuccess:t.PropTypes.func,onError:t.PropTypes.func};const bd=Je(),kd=({tasks:e})=>{const[t,i]=n.useState(e||null);n.useEffect((()=>{i(e)}),[e]);const r=n.useMemo((()=>{if(!t)return null;const e=t.reduce(((e,t)=>{var n,s;const i=(null==(n=t.type)?void 0:n.group_label)||"Не указано",r=(null==(s=t.type)?void 0:s.type_name)||"Другое";e[i]||(e[i]={totalTime:0,tasks:{}}),e[i].tasks[r]||(e[i].tasks[r]=0);const o=((e,t)=>{const n=new Date(e);return(new Date(t)-n)/6e4})(t.start,t.end);return e[i].totalTime+=o,e[i].tasks[r]+=o,e}),{}),n={};return Object.keys(e).sort(((e,t)=>"Не указано"===e?1:"Не указано"===t?-1:e.localeCompare(t,"ru"))).forEach((t=>{n[t]=e[t]})),n}),[t]);return t?s.jsx(Xe,{theme:bd,children:s.jsx(pn,{"aria-label":"Task Statistics",defaultExpandedItems:["root"],slots:{expandIcon:Qe,collapseIcon:Ze},sx:{flexGrow:1,maxWidth:400},children:s.jsx(fn,{itemId:"root",label:"Подсчет времени",children:Object.entries(r).map((([e,t],n)=>s.jsx(fn,{itemId:`period-${n}`,label:s.jsxs(Y,{sx:{flex:1,display:"flex",flexDirection:"row",justifyContent:"space-between",padding:1},children:[s.jsx(u,{children:e}),s.jsxs(u,{sx:{marginLeft:"auto",fontWeight:"bold"},children:[Math.round(t.totalTime)," мин."]})]}),children:Object.entries(t.tasks).map((([e,t],i)=>s.jsx(fn,{itemId:`task-${n}-${i}`,label:s.jsxs(Y,{sx:{flex:1,display:"flex",flexDirection:"row",justifyContent:"space-between",padding:1},children:[s.jsx(u,{children:e}),s.jsxs(u,{sx:{marginLeft:"auto"},children:[Math.round(t)," мин."]})]})},i)))},n)))})})}):null};function wd({containerId:e,mode:t,isMobile:n,setIsMobile:o,handleSetMode:a,handleNewRecordDialogOpen:l,handleTaskClick:c,handleAdditionalButtonClick:d,calendarRef:u,newSettings:h,setNewSettings:f,saveSettings:m,focusSettings:g,saveFocusSettings:x,updatedCalendarEvents:y,myDayTasks:v,listsList:b,defaultLists:k,projects:w,myDayList:T,handleEventClick:j,handleEventChange:S,handleEventReceive:C,handleAddAntiTask:E,fetchTasks:_,fetchAntiSchedule:I,handleDatesSet:L,selectedDayTasks:D,taskDialogOpen:R,handleDialogClose:O,handleDelDateClick:M,dialogScroll:A,setSelectedTaskId:P,currentTasks:z,selectedTaskId:B,currentTaskFields:$,handleUpdateTask:F,currentTaskType:H,handleChangeTaskStatus:N,handleChangeEventStatus:W,deleteTask:q,newRecordDialogOpen:U,handleNewRecordDialogClose:Y,updateTask:G}){return s.jsxs(i,{sx:{flexGrow:1,padding:2,height:"100%",width:"100%",display:"flex",flexDirection:"row"},children:[s.jsxs(i,{sx:{minWidth:"500px",display:"flex",flexDirection:"column"},children:[s.jsxs(i,{sx:{minWidth:"500px",display:"flex",flexDirection:"row"},children:[s.jsx(_e,{value:"focus",selected:"focus"===t,onChange:()=>a(),children:"Фокус"}),s.jsx(r,{onClick:()=>o(!n),color:"inherit",children:s.jsx(et,{})}),s.jsx(p,{onClick:l,children:"Добавить запись в журнал"})]}),s.jsx(i,{sx:{height:"95%",width:"100%"},children:"focus"!==t&&n?s.jsx(xd,{calendarRef:u,newSettings:h,saveSettings:m,events:y,tasks:v,lists:{lists:b,default_lists:k,projects:w},handleEventClick:j,handleEventChange:S,eventReceive:C,addTask:E,fetchTasks:_,fetchEvents:I,datesSet:L}):s.jsx(Pc,{containerId:e,saveSettings:x,settingsProp:g,tasks:v,selectedList:T,updateTask:G,changeTaskStatus:N,fetchTasks:_,onTaskClick:c,additionalButtonClick:d})})]}),"focus"!==t&&!n&&s.jsxs(i,{sx:{width:"100%",height:"98%",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[s.jsx(xd,{calendarRef:u,newSettings:h,setNewSettings:f,saveSettings:m,events:y,lists:{lists:b,default_lists:k,projects:w},handleEventClick:j,handleEventChange:S,eventReceive:C,addTask:E,fetchTasks:_,fetchEvents:I,datesSet:L}),D&&s.jsx(i,{sx:{width:"100%"},children:s.jsx(kd,{tasks:D})})]}),s.jsx(ad,{open:R,handleClose:O,handleDelDateClick:M,scroll:A,setSelectedTaskId:P,tasks:z,selectedTaskId:B,taskFields:$,updateTask:F,changeTaskStatus:"task"===H?N:W,deleteTask:q}),s.jsx(bc,{open:U,handleClose:Y})]})}kd.propTypes={tasks:t.PropTypes.array},wd.propTypes={containerId:m.oneOfType([m.string,m.number]),mode:m.string,isMobile:m.bool,setIsMobile:m.func,handleSetMode:m.func,handleNewRecordDialogOpen:m.func,handleTaskClick:m.func,handleAdditionalButtonClick:m.func,calendarRef:m.object,newSettings:m.object,setNewSettings:m.func,saveSettings:m.func,focusSettings:m.object,saveFocusSettings:m.func,updatedCalendarEvents:m.array,myDayTasks:m.array,listsList:m.array,defaultLists:m.array,projects:m.array,myDayList:m.object,handleEventClick:m.func,handleEventChange:m.func,handleEventReceive:m.func,handleAddAntiTask:m.func,fetchTasks:m.func,fetchAntiSchedule:m.func,handleDatesSet:m.func,selectedDayTasks:m.array,taskDialogOpen:m.bool,handleDialogClose:m.func,handleDelDateClick:m.func,dialogScroll:m.string,setSelectedTaskId:m.func,currentTasks:m.array,selectedTaskId:m.oneOfType([m.string,m.number]),currentTaskFields:m.object,handleUpdateTask:m.func,updateTask:m.func,currentTaskType:m.string,handleChangeTaskStatus:m.func,handleChangeEventStatus:m.func,deleteTask:m.func,newRecordDialogOpen:m.bool,handleNewRecordDialogClose:m.func};const Td=n.createContext(),jd=async(e,t="GET",n=null)=>{const s=localStorage.getItem("access_token"),i={"Content-Type":"application/json"};s&&(i.Authorization=`Bearer ${s}`);const r={method:t,headers:i};n&&(r.body=JSON.stringify(n));const o=await fetch(e,r);if(!o.ok)throw new Error(`Failed to fetch ${e}, status ${o.status}`);return o.json()},Sd=({children:e,onError:t,setLoading:i})=>{const[r,o]=n.useState({data:[],loading:!1,error:null}),[a,l]=n.useState(null),c=n.useRef(!1),d=n.useCallback((async()=>{if(!c.current){i&&i(!0),c.current=!0,o((e=>({...e,loading:!0,error:null})));try{const e=await jd("/tasks/get_anti_schedule");return o({data:e.anti_schedule||e,loading:!1,error:null}),i&&i(!1),c.current=!1,e.anti_schedule||e}catch(hu){t&&t(hu),o((t=>({...t,loading:!1,error:hu}))),i&&i(!1),c.current=!1}}}),[t,i]),u=n.useCallback((async e=>{const t=await jd("/tasks/add_anti_task","POST",e);return await d(),t}),[d]),h=n.useCallback((async e=>{const t=await jd("/tasks/edit_anti_task","PUT",e);return await d(),t}),[d]),p=n.useCallback((async e=>{const t=await jd("/tasks/del_anti_task","DELETE",e);return await d(),t}),[d]),{tasksVersion:f}=Hc();n.useEffect((()=>{f&&(d(),l(f))}),[f,d]);const m=n.useMemo((()=>({antiSchedule:r,fetchAntiSchedule:d,addAntiTask:u,updateAntiTask:h,deleteAntiTask:p,version:a,setVersion:l,loading:r.loading})),[r,d,u,h,p,a]);return s.jsx(Td.Provider,{value:m,children:e})};Sd.propTypes={children:m.node.isRequired};function Cd({containerId:e,antiScheduleSettingsProp:t=null,focusSettingsProp:i=null,onError:r=null,onSuccess:o=null}){const{lists:a,setSelectedListId:l}=Kc(),{fetchTasks:c,updateTask:d,changeTaskStatus:u,deleteTask:h,taskFields:p}=Qc(),{antiSchedule:f,fetchAntiSchedule:m,addAntiTask:g,updateAntiTask:x,deleteAntiTask:y}=n.useContext(Td),v=(null==a?void 0:a.lists)||[],b=(null==a?void 0:a.default_lists)||[],k=(null==a?void 0:a.projects)||[],[w,T]=n.useState("focus"),j=n.useRef(null),[S,C]=n.useState([]),[E,_]=n.useState(null),[I,L]=n.useState([]),[D,R]=n.useState(null),[O,M]=n.useState(!1),[A,P]=n.useState("paper"),[z,B]=n.useState(null),[$,F]=n.useState(null),[H,N]=n.useState({}),[W,q]=n.useState(null),[U,Y]=n.useState(!1),[G,V]=n.useState(null),[K,J]=n.useState(Yl()),X=tt("(max-width: 1100px)"),[Z,Q]=n.useState(X);n.useEffect((()=>{he(Z?"focus":"calendar")}),[]),n.useEffect((()=>{Q(X)}),[X]);const ee=n.useRef({start:{type:"datetime",name:"Дата начала"},end:{type:"datetime",name:"Дата завершения"},divider1:{type:"divider"},color:{type:"color",name:"Цвет на календаре"},is_background:{type:"toggle",name:"Фоновая задача"},type_id:{type:"select",name:"Тип задачи",groupBy:"type",options:[{value:1,type:"work",label:"Продуктивная работа",groupLabel:"Работа"},{value:2,type:"work",label:"Повседневные задачи",groupLabel:"Работа"},{value:3,type:"rest",label:"Перерыв",groupLabel:"Отдых"},{value:4,type:"meals",label:"Обед",groupLabel:"Питание"},{value:5,type:"study",label:"Учеба",groupLabel:"Учёба"},{value:6,type:"rest",label:"Прогулка",groupLabel:"Отдых"},{value:7,type:"personal",label:"Личные дела",groupLabel:"Личное"},{value:8,type:"personal",label:"Домашние дела",groupLabel:"Личное"},{value:9,type:"rest",label:"Сон",groupLabel:"Отдых"},{value:10,type:"social",label:"Переписки",groupLabel:"Общение"},{value:11,type:"everyday",label:"Планирование",groupLabel:"Повседневное"},{value:12,type:"work",label:"Составление отчетов",groupLabel:"Работа"},{value:13,type:"meals",label:"Ужин",groupLabel:"Питание"},{value:14,type:"meals",label:"Перекус",groupLabel:"Питание"},{value:15,type:"study",label:"Чтение",groupLabel:"Учёба"},{value:16,type:"personal",label:"Анализ записей",groupLabel:"Личное"},{value:17,type:"study",label:"Изучение языков",groupLabel:"Учёба"},{value:18,type:"personal",label:"Покупки",groupLabel:"Личное"},{value:19,type:"everyday",label:"Умывание",groupLabel:"Повседневное"},{value:20,type:"rest",label:"Отдых",groupLabel:"Отдых"},{value:21,type:"rest",label:"Развлечения",groupLabel:"Отдых"},{value:22,type:"work",label:"Совещание",groupLabel:"Работа"},{value:null,label:"Без типа",groupLabel:"Без группы"}]},divider3:{type:"divider"},files:{type:"string",name:"Добавить файл"},note:{type:"text",name:"Заметка"}}),[te,ne]=n.useState(t||{slotDuration:30,timeRange:[8,24],timeOffset:0,currentView:"timeGridDay",views:"timeGridWeek,timeGridDay"}),[se,ie]=n.useState(i||{workIntervalDuration:1800,breakDuration:300,additionalBreakDuration:900,isBackgroundTasks:!0});n.useEffect((()=>{t&&ne(t)}),[t]),n.useEffect((()=>{i&&ie(i)}),[i]);const{handleContainerResize:re,handleUpdateContent:oe}=Ad();n.useEffect((()=>{(async()=>{if(!(null==S?void 0:S.loading))try{const e=await c("my_day");e&&Array.isArray(e)?C(e):e&&Array.isArray(e.tasks)?C(e.tasks):C([])}catch(hu){r&&r(hu)}})(),(async()=>{if(!(null==D?void 0:D.loading))try{const e=await m();R(e||[])}catch(hu){r&&r(hu)}})()}),[]),n.useEffect((()=>{if(null==a?void 0:a.default_lists){const e=a.default_lists.find((e=>"my_day"===e.id));_(e)}}),[a]),n.useEffect((()=>{R(f.data||[])}),[f.data]);const ae=e=>{M(!0),P(e)};function le(e,t){if(!e)return null;return null==e?void 0:e.map((e=>{const n={...e},s=e=>{const n=new Date(e);return n.setHours(n.getHours()-t),n};e.start&&(n.start=s(e.start).toISOString()),e.end&&(n.end=s(e.end).toISOString());const i=2==(null==e?void 0:e.status_id)?"#008000":3==(null==e?void 0:e.priority_id)?"#A52A2A":(null==e?void 0:e.color)?e.color:"#3788D8";n.color=i;const r=e.is_background?"background":"block";return n.display=r,n}))}async function ce(e){try{e.is_background=0;let t={};g&&"function"==typeof g&&(t=await g(e)),t&&(R((e=>[...e,t])),o&&o("Событие добавлено"))}catch(hu){r&&r(hu)}}const de=(e,t)=>{const n=new Date(e);return n.setHours(n.getHours()+t),n.toISOString()};const ue=async e=>{try{x&&"function"==typeof x&&await x(e);const t=null==D?void 0:D.map((t=>t.id==e.taskId?{...t,...e}:t));R(t),L(t);const n=le(t,null==te?void 0:te.timeOffset);if(F(n),n){const e=n.filter((e=>Yl(e.start).isSame(K,"day")));V(e)}o&&o("Событие обновлено")}catch(t){r&&r(t)}};function he(t=null){t||(t=w),"focus"==w?(T("calendar"),Z||re(e,{width:1230})):(T("focus"),re(e,{width:540}))}return n.useEffect((()=>{let e=le(D,null==te?void 0:te.timeOffset);if(te&&te.isToggledBGTasksEdit&&(e=null==e?void 0:e.filter((e=>"background"==e.display)),e.forEach((e=>{e.display="block"}))),F(e),e){const t=e.filter((e=>Yl(e.start).isSame(K,"day")));V(t)}}),[te,D,S,K]),n.useEffect((()=>{if($){const e=$.filter((e=>Yl(e.start).isSame(K,"day")));V(e)}}),[$,K]),s.jsx(wd,{containerId:e,mode:w,isMobile:Z,setIsMobile:Q,handleSetMode:he,handleNewRecordDialogOpen:()=>{Y(!0)},handleTaskClick:function(e){N(p),L(S),B(e||null),q("task");try{ae("paper")}catch(t){}},handleAdditionalButtonClick:function(e){ce(e)},calendarRef:j,newSettings:te,saveSettings:t=>{try{ne(t),oe&&e&&oe(e,{antiScheduleSettingsProp:t}),o&&o("Настройки сохранены")}catch(hu){r&&r(hu)}},focusSettings:se,saveFocusSettings:t=>{try{ie(t),oe&&e&&oe(e,{focusSettingsProp:t}),o&&o("Настройки сохранены")}catch(hu){r&&r(hu)}},updatedCalendarEvents:$,myDayTasks:S,myDayList:E,listsList:v,defaultLists:b,projects:k,handleEventClick:async function(e){var t;N(ee.current),L(D),B((null==(t=null==e?void 0:e.event)?void 0:t.id)||null),q("event");try{ae("paper")}catch(n){}},handleEventChange:async function(e){const t={title:e.event.title};if(e.event.start&&(t.start=de(e.event.start,null==te?void 0:te.timeOffset)),e.event.end)t.end=de(e.event.end,null==te?void 0:te.timeOffset);else{const n=new Date(e.event.start);n.setHours(n.getHours()+1),t.end=de(n,null==te?void 0:te.timeOffset)}try{R((n=>n.map((n=>n.id==e.event.id?{...n,...t}:n)))),x&&"function"==typeof x&&await x({taskId:e.event.id,...t}),o&&o("Событие обновлено")}catch(hu){r&&r(hu)}},eventReceive:function(e){let t=e.event.start.toISOString(),n=e.event.end;e.event.end||(n=Yl(e.event.start).add(60,"minute").toISOString()),te&&te.timeOffset&&(t=de(e.event.start,te.timeOffset),n=de(e.event.end,te.timeOffset)),ce({title:e.event.title,start:t,end:n})},handleAddAntiTask:ce,fetchTasks:c,fetchAntiSchedule:m,handleDatesSet:function(e,t){J(t);let n=null;"timeGridDay"!==e&&"dayGridDay"!==e||(n=null==$?void 0:$.filter((e=>Yl(e.start).isSame(t,"day")))),V(n)},selectedDayTasks:G,taskDialogOpen:O,handleDialogClose:()=>{M(!1)},handleDelDateClick:async function(e){try{await y({taskId:e}),M(!1);const t=null==D?void 0:D.filter((t=>t.id!=e));R(t),o&&o("Дата удалена")}catch(hu){r&&r(hu)}},dialogScroll:A,setSelectedTaskId:B,currentTasks:I,selectedTaskId:z,currentTaskFields:H,handleUpdateTask:async function(e,t){"event"===W?await ue(e):"task"===W&&await(async(e,t)=>{try{await d(e,t);const n=null==S?void 0:S.map((n=>n.id==e?{...n,...t}:n));C(n),L(n),o&&o("Задача обновлена")}catch(n){r&&r(n)}})(e,t)},currentTaskType:W,handleChangeTaskStatus:function(e,t){const n=2==t.status_id?"green":"#3788D8",s=S.map((s=>s.id==e?{...s,...t,color:n}:s));C(s),L(s);try{u&&"function"==typeof u&&u(e,t),o&&o("Статус обновлен")}catch(hu){r&&r(hu)}},handleChangeEventStatus:function(e,t){const n=2==t.status_id?"green":"#3788D8",s=D.map((s=>s.id==e?{...s,...t,color:n}:s));R(s),L(s);const i=le(s,null==te?void 0:te.timeOffset);F(i);try{x&&"function"==typeof x&&x({taskId:e,...t}),o&&o("Статус обновлен")}catch(hu){r&&r(hu)}},deleteTask:h,newRecordDialogOpen:U,handleNewRecordDialogClose:()=>{Y(!1)},updateTask:d,updateAntiTask:ue,changeTaskStatus:u})}function Ed(e){const{setError:t,setSuccess:i}=n.useContext(zc);return s.jsx(Cd,{...e,onError:t,onSuccess:i})}function _d({mobile:e=!1,setSelectedListId:t}){const{lists:n,setSelectedListId:o,deleteFromChildes:a,linkListGroup:l,linkTaskList:c,addList:d,fetchLists:u}=Kc(),{selectedTaskId:h,setSelectedTaskId:f}=Qc();return s.jsxs(i,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",width:"100%"},children:[s.jsx(i,{sx:{flexGrow:1,overflowY:"auto",height:e?"90%":"100%"},children:s.jsx(pd,{listsList:n.lists,defaultLists:n.default_lists,projects:n.projects,isNeedContextMenu:!0,setSelectedListId:o,deleteFromChildes:a,setSelectedTaskId:f,selectedTaskId:h,linkListGroup:l,linkTaskList:c,fetchLists:u})}),s.jsxs(i,{sx:{display:"flex",flexDirection:"row",width:"100%",mt:1},children:[s.jsx(p,{variant:"outlined",sx:{width:"100%"},onClick:()=>{d({type:"list",order:n.lists.length}),o&&o(null)},children:"Создать список"}),s.jsx(r,{variant:"outlined",sx:{alignSelf:"center"},onClick:()=>{d({type:"group",order:n.lists.length}),o&&o(null)},children:s.jsx(nt,{})}),s.jsx(r,{variant:"outlined",sx:{alignSelf:"center"},onClick:()=>{d({type:"project",order:n.lists.length}),o&&o(null)},children:s.jsx(Ye,{})})]})]})}function Id({mobile:e=!1,setSelectedListId:t,additionalButtonClick:o=null,additionalButton:l=null,onSuccess:c=null,onError:d=null}){const{tasks:h,selectedTaskId:f,setSelectedTaskId:m,addTask:g,updateTask:x,changeTaskStatus:y,deleteTask:v,linkTaskList:b}=Qc(),{lists:k,selectedListId:w,selectedList:T,updateList:j,linkListGroup:S,deleteFromChildes:C}=Kc(),[E,_]=n.useState(""),[I,L]=n.useState(!1),D=T&&(null==k?void 0:k.default_lists)&&k.default_lists.some((e=>e.id===T.id)),[R,O]=n.useState(""),M=()=>{""!==E.trim()&&T&&(j({listId:T.id,title:E.trim()}),L(!1))},A="group"===(null==T?void 0:T.type),P="project"===(null==T?void 0:T.type);return A||P?s.jsx(i,{sx:{p:2,height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsxs(u,{variant:"h6",align:"center",children:[A&&"Описание группы (заглушка)",P&&"Описание проекта (заглушка)"]})}):s.jsxs(i,{sx:{position:"relative",height:"100%",display:"flex",flexDirection:"column"},children:[T&&s.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:e?1:4,py:2,my:1,borderBottom:"1px solid #ddd",minWidth:0},children:[s.jsxs(i,{sx:{display:"flex",alignItems:"center",flexGrow:1,minWidth:0},children:[s.jsx(st,{sx:{mr:1,flexShrink:0}}),I?s.jsx(a,{value:E,onChange:e=>_(e.target.value),onBlur:M,onKeyDown:e=>{"Enter"===e.key&&E.length>0&&M()},autoFocus:!0,variant:"standard",size:"small",error:0===E.length,helperText:0===E.length?"Title cannot be empty":"",sx:{flex:1,minWidth:0}}):s.jsx(u,{variant:"h6",onClick:()=>{D||(_(T.title),L(!0))},sx:{cursor:D?"default":"pointer","&:hover":{opacity:D?1:.8},flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:T.title})]}),s.jsx(p,{variant:"outlined",sx:{flexShrink:0,ml:1},children:s.jsx(it,{})})]}),s.jsxs(i,{sx:{flexGrow:1,overflowY:"auto",minHeight:0},children:[e&&s.jsx(p,{onClick:()=>t&&t(null),children:"Назад"}),s.jsx(Ic,{containerId:w,tasks:h.data,selectedTaskId:f,listsList:k.lists,projects:k.projects,selectedList:T,isNeedContextMenu:!0,setSelectedTaskId:m,updateList:j,updateTask:x,changeTaskStatus:y,linkTaskList:b,deleteFromChildes:C,additionalButtonClick:o,additionalButton:l,onSuccess:c,onError:d})]}),s.jsx(i,{sx:{position:"sticky",bottom:0,left:0,width:"100%",zIndex:2,p:1},children:s.jsxs(Se,{component:"form",sx:{display:"flex",flexDirection:"row",flexGrow:1,alignItems:"center",mt:1,mx:1},children:[s.jsx(r,{"aria-label":"menu",onClick:()=>{""!==R.trim()&&(g({title:R,listId:null==T?void 0:T.id}),O(""))},children:s.jsx(Ne,{})}),s.jsx(He,{sx:{flex:1},placeholder:"Добавить задачу",inputProps:{"aria-label":"add task"},value:R,onKeyDown:e=>{if("Enter"===e.key){if(e.preventDefault(),""===R.trim())return;g({title:R,listId:null==T?void 0:T.id}),O("")}},onChange:e=>O(e.target.value)})]})})]})}function Ld({mobile:e=!1,setSelectedTaskId:t}){const{tasks:a,selectedTaskId:l,taskFields:c,addSubTask:d,updateTask:h,changeTaskStatus:p,deleteTask:f,setSelectedTaskId:m}=Qc(),{selectedListId:g}=Kc();return n.useCallback(((e,t)=>{d({title:e,parentId:t}),setNewSubTask&&setNewSubTask("")}),[d]),l?s.jsxs(i,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",width:"100%"},children:[s.jsx(i,{sx:{width:"100%",display:"flex",justifyContent:"flex-end"},children:s.jsx(r,{onClick:()=>t?t(null):m(null),children:s.jsx(o,{})})}),s.jsx(i,{sx:{px:1,flexGrow:1,overflowY:"auto",height:"100%"},children:0===Object.keys(c).length?s.jsx(u,{variant:"body2",sx:{mt:2,textAlign:"center"},children:"Загрузка полей задачи..."}):s.jsx(od,{tasks:a.data,selectedTaskId:l,taskFields:c,addSubTask:d,updateTask:h,changeTaskStatus:p,deleteTask:f,selectedListId:g},l)})]}):null}function Dd(){const e=rt("(max-width:600px)"),{addTask:t,addSubTask:r,updateTask:o,fetchTasks:a,selectedTaskId:l,tasks:c}=Qc(),d=c.loading,{selectedListId:h,fetchLists:p,lists:f}=Kc(),m=f.loading,{setError:g,setSuccess:x}=n.useContext(zc),[y,v]=n.useState(""),b=Boolean(l),k=d||m;n.useEffect((()=>{p()}),[p]),n.useEffect((()=>{h&&a(h)}),[h,a]);const w=n.useCallback((async e=>{const t=3===e.priority_id?1:3;try{"function"==typeof o&&(await o({taskId:e.id,priority_id:t,listId:h}),x("Приоритет обновлен"))}catch(hu){g(hu)}}),[o,h,g,x]);n.useCallback((async e=>{if("Enter"===e.key){if(e.preventDefault(),""===y.trim())return;try{await t({title:y}),x("Задача добавлена"),v("")}catch(hu){g(hu)}}}),[y,t,g,x]),n.useCallback((async()=>{if(""!==y.trim())try{await t({title:y}),x("Задача добавлена"),v("")}catch(hu){g(hu)}}),[y,t,g,x]);const T=e?s.jsxs(i,{sx:{height:"100%",width:"100%"},children:[s.jsx(_d,{mobile:!0}),s.jsx(Id,{mobile:!0,additionalButtonClick:w,onSuccess:x,onError:g}),b&&s.jsx(Ld,{mobile:!0})]}):s.jsx(i,{sx:{padding:2,height:"100%",width:"100%"},children:s.jsxs(Re,{container:!0,spacing:.5,sx:{height:"100%"},children:[s.jsx(Re,{item:!0,xs:12,md:3,sx:{height:"100%",display:"flex",flexDirection:"column",width:"350px"},children:s.jsx(_d,{})}),s.jsx(Re,{item:!0,xs:12,md:b?5:9,sx:{height:"100%",display:"flex",flexDirection:"column",minWidth:0,flex:1},children:s.jsx(Id,{additionalButtonClick:w,onSuccess:x,onError:g})}),b&&s.jsx(Re,{item:!0,xs:12,md:4,sx:{height:"100%",display:"flex",flexDirection:"column",width:"400px"},children:s.jsx(Ld,{})})]})});return s.jsxs(i,{sx:{position:"relative",width:"100%",height:"100%"},children:[s.jsx(i,{sx:{opacity:k?.5:1,pointerEvents:k?"none":"auto",height:"100%"},children:T}),k&&s.jsx(i,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(255,255,255,0.7)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(u,{variant:"h5",children:"Загрузка..."})})]})}Yl.extend(vc),Yl.extend(Oc),Cd.propTypes={containerId:m.oneOfType([m.string,m.number]),antiScheduleSettingsProp:m.object,focusSettingsProp:m.object,onError:m.func,onSuccess:m.func};const Rd={timer:{type:"timer",name:"Timer",position:{x:0,y:0},size:{width:354,height:244},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:s.jsx(Cn,{})},timersToolbar:{type:"timersToolbar",name:"timersToolbar",position:{x:1540,y:0},size:{width:360,height:900},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:s.jsx(Pl,{})},metronome:{type:"metronome",name:"Metronome",position:{x:500,y:0},size:{width:277,height:320},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:s.jsx(En,{})},chatCollapsed:{type:"chatCollapsed",name:"Chat",position:{x:0,y:600},size:{width:400,height:130},maxSize:{width:600,height:130},minSize:{width:300,height:130},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:s.jsx(hl,{})},chat:{type:"chat",name:"Chat",position:{x:0,y:600},size:{width:400,height:500},minSize:{width:300,height:200},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:s.jsx(Ul,{})},tasks:{type:"tasks",name:"ToDo",position:{x:600,y:100},size:{width:1400,height:800},minSize:{width:1100,height:700},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:s.jsx(Dd,{})},tasksMobile:{type:"tasksMobile",name:"ToDo",position:{x:600,y:100},size:{width:1400,height:800},minSize:{width:1100,height:700},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:s.jsx(Dd,{})},calendar:{type:"Calendar",name:"Calendar",position:{x:400,y:50},size:{width:800,height:800},minSize:{width:1100,height:700},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:s.jsx(vd,{})},memory:{type:"Memory",name:"Memory",position:{x:400,y:50},size:{width:615,height:865},minSize:{width:615,height:865},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isMinimized:!1,isLocked:!1,content:s.jsx(Al,{})},Scenario:{type:"Scenario",name:"Scenario",position:{x:800,y:0},size:{width:380,height:600},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:s.jsx(Fl,{})},SecretaryGIF:{type:"SecretaryGIF",name:"SecretaryGIF",position:{x:0,y:0},size:{width:240,height:290},isLockAspectRatio:!1,isResizable:!1,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:s.jsx(Hl,{})},JournalEditorDrawer:{type:"JournalEditorDrawer",name:"JournalEditor",position:{x:320,y:200},size:{width:1400,height:830},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:s.jsx(_c,{})},FocusMode:{type:"FocusMode",name:"FocusMode",position:{x:0,y:0},size:{width:520,height:800},minSize:{width:450,height:500},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:s.jsx(Pc,{})},AntiSchedule:{type:"AntiSchedule",name:"AntiSchedule",position:{x:0,y:0},size:{width:540,height:800},minSize:{width:500,height:500},isLockAspectRatio:!1,isResizable:!0,isDisableDragging:!1,isLocked:!1,isMinimized:!1,content:s.jsx(Ed,{})}},Od=n.createContext(),Md=({children:e})=>{const[t,i]=n.useState({id:0,name:"dashboard 1"}),[r,o]=n.useState([]),[a,l]=n.useState([]),[c,d]=n.useState(null),[u,h]=n.useState([]),[p,f]=n.useState("light"),[m,g]=n.useState([]),[x,y]=n.useState(!1),[v,b]=n.useState([]);function k(e,t,n){var s,i,r;const o=Rd[e];if(!o)return null;const a=null==(s=o.content)?void 0:s.type,l={...null==(i=o.content)?void 0:i.props,containerId:t,...null==(r=n.content)?void 0:r.props,...n};return{...n,id:t,type:e,name:n.name||o.name,position:n.position||o.position,size:n.size||o.size,maxSize:o.maxSize,minSize:o.minSize,isLockAspectRatio:n.isLockAspectRatio??o.isLockAspectRatio,isResizable:o.isResizable,isDisableDragging:o.isDisableDragging,isLocked:n.isLocked??o.isLocked,isMinimized:n.isMinimized??o.isMinimized,componentType:a,componentProps:l,content:a?null:o.content}}const{user:w,isLoading:T}=n.useContext(qc);n.useEffect((()=>{if(!w)return;(async()=>{try{const e=localStorage.getItem("access_token"),t=await fetch("/dashboard/last",{headers:e?{Authorization:`Bearer ${e}`}:{}});if(!t.ok)throw new Error("Network response was not ok");const n=await t.json();i({id:n.id,name:n.name});const s=n.timers||[];l(s);const r=(n.containers||[]).map((e=>k(e.type,e.id,e)));o(r),f(n.themeMode||"light")}catch(e){i({id:dashboardId,name:"dashboard 1"}),o([]),l([]),f("light")}})()}),[w]);n.useEffect((()=>{h(r)}),[r]);const[j,S]=n.useReducer(((e,t)=>{switch(t.type){case"SET_QUEUE":return{...e,queue:t.queue};case"PLAY":return{...e,isPlaying:!0};case"PAUSE":return{...e,isPlaying:!1};case"NEXT_TRACK":return{...e,currentTrackIndex:(e.currentTrackIndex+1)%e.queue.length,isPlaying:!0};default:return e}}),{queue:["track1.mp3","track2.mp3","track3.mp3"],currentTrackIndex:0,isPlaying:!1});function C(e){const n=localStorage.getItem("access_token");fetch("/post_timers",{method:"POST",headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:JSON.stringify({dashboardId:t.id,timers:e})}).then((e=>e.json())).then((e=>{})).catch((e=>{}))}return n.useEffect((()=>{if(j.queue.length>0){const e=new Audio(j.queue[j.currentTrackIndex]);j.isPlaying?e.play():e.pause()}}),[j.queue,j.currentTrackIndex,j.isPlaying]),s.jsx(Od.Provider,{value:{windowOrder:v,dashboardData:t,containers:r,activeId:c,minimizedContainers:u,timers:a,setTimers:l,sendTimersToServer:C,themeMode:p,state:j,updates:m,setUpdates:g,dispatch:S,setThemeMode:f,addContainer:function(e,t={}){if(r.length>=20)return;const n=Date.now().toString()+Math.floor(1e3+9e3*Math.random()).toString();if("timersToolbar"===e){0===Object.keys(t).length&&(t={isRunningProp:!1,initialTimeProp:1});const e=[...a,{id:n,...t}];return l(e),void C(e)}const s=k(e,n,{containerId:n,...t});s&&(o((e=>[...e,s])),b((e=>[...e.filter((e=>e!==n)),n])))},handleActive:e=>{d(e),b((t=>[...t.filter((t=>t!==e)),e]))},handleClose:e=>{o(r.filter((t=>t.id!==e))),h(u.filter((t=>t.id!==e))),b((t=>t.filter((t=>t!==e))))},handleMinimizeToggle:e=>{d(e),o((t=>t.map((t=>t.id===e?{...t,isMinimized:!t.isMinimized}:t)))),b((t=>[...t.filter((t=>t!==e)),e]))},sendContainersToServer:async()=>{const e=r.filter((e=>"timersToolbar"!==e.type));try{const n=localStorage.getItem("access_token");if(!(await fetch("/dashboard",{method:"POST",headers:{"Content-Type":"application/json",...n?{Authorization:`Bearer ${n}`}:{}},body:JSON.stringify({dashboard_data:t,containers:e.map((e=>{const{componentType:t,content:n,componentProps:s,...i}=e;return i})),themeMode:p,timers:a})})).ok)throw new Error("Network response was not ok")}catch(n){}},handleLock:e=>{o((t=>t.map((t=>t.id===e?{...t,isLocked:!t.isLocked}:t))))},handleContainerResize:(e,t={},n={})=>{o(r.map((s=>s.id===e?{...s,size:{...s.size,...t},position:{...s.position,...n}}:s)))},handleContainerPosition:(e,t)=>{o(r.map((n=>n.id===e?{...n,position:t}:n)))},handleUpdateContent:(e,t)=>{o((n=>n.map((n=>{if(n.id===e){const e={...n.componentProps,...t};return{...n,...t,componentProps:e}}return n}))))},isSecretarySpeak:x,setIsSecretarySpeak:y,createComponentFromType:k},children:e})};Md.propTypes={children:m.node.isRequired};const Ad=()=>{const e=n.useContext(Od);if(!e)throw new Error("useContainer must be used within a ContainerProvider");return e};function Pd({containerData:e}){const{handleActive:t,handleClose:n,handleMinimizeToggle:a,handleLock:l,handleContainerResize:c,handleContainerPosition:d,themeMode:h,windowOrder:p}=Ad(),{id:f,size:m,position:g,isLocked:x,isResizable:y,isDisableDragging:v,isMinimized:b,maxSize:k,minSize:w,name:T,content:j,isLockAspectRatio:S,componentType:C,componentProps:E}=e;return s.jsx(qt,{id:f,size:{width:m.width,height:m.height},position:{x:g.x,y:g.y},onDragStop:(e,t)=>d(f,{x:t.x,y:t.y}),onResizeStop:(e,t,n,s,i)=>{c(f,{width:n.offsetWidth,height:n.offsetHeight},i)},enableResizing:!x&&y,disableDragging:x||v,style:{display:b?"none":"block",zIndex:p.indexOf(f)+1,borderRadius:8,border:"1px solid"},bounds:"parent",onMouseDown:()=>t(f),lockAspectRatio:S,dragHandleClassName:"drag-handle",maxWidth:null==k?void 0:k.width,maxHeight:null==k?void 0:k.height,minWidth:(null==w?void 0:w.width)||150,minHeight:(null==w?void 0:w.height)||150,children:s.jsxs(Se,{sx:{borderRadius:2,boxShadow:3,overflow:"hidden",display:"flex",flexDirection:"column",height:"100%",width:"100%"},children:[s.jsxs(Se,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:1,backgroundColor:"dark"===h?"#292929":"initial"},children:[s.jsx(i,{className:"drag-handle",sx:{display:"flex",alignItems:"center",flexGrow:1,cursor:"move"},children:s.jsx(u,{variant:"body2",children:T})}),s.jsxs(i,{sx:{display:"flex"},children:[s.jsx(r,{size:"small",onClick:()=>a(f),children:s.jsx(we,{})}),s.jsx(r,{size:"small",onClick:()=>l(f),children:x?s.jsx(ot,{}):s.jsx(at,{})}),s.jsx(r,{size:"small",onClick:()=>n(f),children:s.jsx(o,{})})]})]}),s.jsx(i,{sx:{flexGrow:1,overflow:"auto",borderBottomLeftRadius:8,borderBottomRightRadius:8},children:C?s.jsx(C,{...E}):j})]})})}Pd.propTypes={containerData:m.shape({id:m.oneOfType([m.string,m.number]).isRequired,size:m.shape({width:m.oneOfType([m.string,m.number]).isRequired,height:m.oneOfType([m.string,m.number]).isRequired}).isRequired,position:m.shape({x:m.oneOfType([m.string,m.number]).isRequired,y:m.oneOfType([m.string,m.number]).isRequired}).isRequired,isLocked:m.bool,isResizable:m.bool,isDisableDragging:m.bool,isMinimized:m.bool,maxSize:m.shape({width:m.oneOfType([m.string,m.number]),height:m.oneOfType([m.string,m.number])}),minSize:m.shape({width:m.oneOfType([m.string,m.number]),height:m.oneOfType([m.string,m.number])}),name:m.string,content:m.node,isLockAspectRatio:m.bool,componentType:m.elementType,componentProps:m.object}).isRequired};const zd=[{icon:s.jsx(ut,{}),name:"Metronome",type:"metronome"},{icon:s.jsx(ht,{}),name:"tasks",type:"tasks"},{icon:s.jsx(pt,{}),name:"calendar",type:"calendar"},{icon:s.jsx(ft,{}),name:"Memory",type:"memory"},{icon:s.jsx(mt,{}),name:"Scenario",type:"Scenario"},{icon:s.jsx(gt,{}),name:"SecretaryGIF",type:"SecretaryGIF"},{icon:s.jsx(xt,{}),name:"JournalEditor",type:"JournalEditorDrawer"},{icon:s.jsx(yt,{}),name:"AntiSchedule",type:"AntiSchedule"}];function Bd(){const{addContainer:e,containers:t}=Ad(),{hasAccess:n,canAddContainer:i}=Wl(),r=zd.filter((e=>n(e.type)));return s.jsx(lt,{ariaLabel:"Add Container",sx:{position:"absolute",bottom:80,left:16},icon:s.jsx(dt,{}),children:r.map((n=>s.jsx(ct,{icon:n.icon,tooltipTitle:n.name,onClick:()=>{i(t.length)?e(n.type):alert("Достигнут лимит контейнеров для вашего тарифа")}},n.name)))})}function $d(){const{minimizedContainers:e,handleMinimizeToggle:t}=Ad();return s.jsx(i,{sx:{display:"flex",overflowX:"auto",padding:1},children:e.map(((e,n)=>s.jsx(p,{onClick:()=>t(e.id),sx:{margin:.5},children:e.name},n)))})}function Fd(){const{listening:e,resetTranscript:t}=al();return s.jsx(vt,{color:"primary","aria-label":"microphone",onClick:()=>{e||(t(),ll.startListening({continuous:!0}))},sx:{position:"absolute",bottom:20,left:16},children:s.jsx(w,{children:e?"stop":"mic"})})}function Hd(e){const{timers:t,addContainer:o}=Ad(),[a,l]=n.useState(!1),[c,d]=n.useState(t);n.useEffect((()=>{const e=setInterval((()=>{d([...t])}),1e3);return()=>clearInterval(e)}),[t]);const h=e=>{const t=e/1e3%60|0,n=e/1e3/60%60|0,s=e/36e5%24|0;return Math.abs(s)>0?`${s} h`:Math.abs(n)>0?`${n} m`:`${t} s`};return c&&0!==c.length?s.jsxs(i,{sx:{overflowX:"auto",maxWidth:"50vw"},children:[s.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:1},children:[c.map((t=>{const{progress:n,remainingTime:r,isPaused:o}=(e=>{let t,n;if(!e.isRunningProp&&e.initialTimeProp)t=1e3*e.initialTimeProp,n=!0;else{const s=(new Date).getTime();t=(new Date(e.initialEndTimeProp).getTime()||null)-s+2e3,n=!1}const s=36e5;let i=t<=s?t/s*100:100;return t<0&&(i=100),{progress:Math.max(i,0),remainingTime:t,isPaused:n}})(t);return s.jsxs(i,{sx:{position:"relative",display:"inline-flex",margin:1},onClick:()=>l(!a),children:[s.jsx(g,{variant:"determinate",...e,value:n,color:o?"warning":r<0?"error":"primary"}),s.jsx(i,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:o?s.jsx(w,{color:"action",children:"pause"}):s.jsx(u,{variant:"caption",component:"div",color:"text.secondary",children:h(r)})})]},t.id)})),s.jsx(r,{onClick:()=>l(!a),color:"inherit",children:a?s.jsx(w,{children:"expand_less"}):s.jsx(w,{children:"expand_more"})})]}),s.jsx(E,{in:a,sx:{position:"absolute",zIndex:999,minWidth:"360px",right:"30px"},children:s.jsx(Se,{sx:{padding:1,border:"1px solid #ccc"},children:s.jsx(Pl,{})})})]}):s.jsx(p,{onClick:()=>o("timersToolbar"),children:"Запустить таймер"})}function Nd(){var e;const{user:t,logout:i}=n.useContext(qc),o=nn(),[a,l]=n.useState(null),c=Boolean(a),d=()=>{l(null)};return t?s.jsxs(s.Fragment,{children:[s.jsx(r,{onClick:e=>{l(e.currentTarget)},size:"small",children:s.jsx(T,{sx:{width:32,height:32},children:null==(e=t.user_name)?void 0:e.charAt(0).toUpperCase()})}),s.jsxs(Te,{anchorEl:a,open:c,onClose:d,onClick:d,children:[s.jsxs(oe,{onClick:()=>{o("/account"),d()},children:[s.jsx(bt,{sx:{mr:1}}),"Профиль"]}),s.jsxs(oe,{onClick:async()=>{await i(),o("/login"),d()},children:[s.jsx(kt,{sx:{mr:1}}),"Выход"]})]})]}):null}const Wd=n.createContext({toggleColorMode:()=>{}}),qd=n.memo((({mode:e,colorMode:t,theme:n,onNavigateMobile:o,onSave:a})=>s.jsxs(Se,{sx:{width:"100%",height:"60px",position:"relative",margin:"0px",px:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs(i,{sx:{display:"flex",alignItems:"center",maxWidth:"40vw"},children:[s.jsx(Nd,{}),s.jsx($d,{})]}),s.jsxs(i,{sx:{marginLeft:"auto",display:"flex",alignItems:"center"},children:[s.jsx(Hd,{}),s.jsx(r,{onClick:t.toggleColorMode,color:"inherit",children:"dark"===n.palette.mode?s.jsx(wt,{}):s.jsx(Tt,{})}),s.jsx(r,{onClick:o,color:"inherit",children:s.jsx(et,{})}),s.jsx(p,{onClick:a,children:"Save"})]})]}))),Ud=n.memo((({containers:e})=>s.jsxs(i,{sx:{width:"99vw",height:"92vh",position:"relative",margin:"0px"},children:[e.map((e=>!e.isMinimized&&s.jsx(Pd,{containerData:e},e.id))),s.jsx(Bd,{}),s.jsx(Fd,{})]})));const Yd=n.memo((function(){const{containers:e,sendContainersToServer:t,themeMode:i,setThemeMode:r}=Ad(),o=nn(),[a,l]=n.useState(i),c=n.useMemo((()=>({toggleColorMode:()=>{const e="light"===a?"dark":"light";l(e),r(e)}})),[a,r]),d=n.useMemo((()=>Je({palette:{mode:a}})),[a]),u=n.useCallback((()=>{o("/mobile")}),[o]),h=n.useCallback((()=>{t()}),[t]);return s.jsx(Wd.Provider,{value:c,children:s.jsxs(Xe,{theme:d,children:[s.jsx(fe,{}),s.jsx(qd,{mode:a,colorMode:c,theme:d,onNavigateMobile:u,onSave:h}),s.jsx(Ud,{containers:e}),s.jsx(hl,{})]})})}));function Gd(){return s.jsx("div",{children:s.jsx(Yd,{})})}const Vd=Je({palette:{primary:{main:jt[500]}}}),Kd=()=>{const{containers:e}=Ad();return s.jsxs(Xe,{theme:Vd,children:[s.jsxs(Y,{sx:{width:"100%",height:"100vh",backgroundColor:"primary.main",p:0},children:[s.jsx(u,{variant:"h1",color:"primary",children:"Second Page"}),e.map((e=>!e.isMinimized&&s.jsx(Pd,{containerData:e},e.id)))]}),s.jsx(Fd,{})]})};function Jd(){const{updateTask:e,addTask:t,fetchTasks:r,taskFields:o,addSubTask:a,changeTaskStatus:l,deleteTask:c}=Qc(),{lists:d,updateList:u,deleteFromChildes:h,linkListGroup:f}=Kc(),{calendarEvents:m,fetchCalendarEvents:g}=sd(),{setUpdates:x}=Ad(),y=n.useRef(null),v=n.useRef(null),b=n.useRef(null),[k,w]=n.useState(null),[T,j]=n.useState(!0),[S,C]=n.useState(!1),[E,_]=n.useState(!1),[I,L]=n.useState(!1),[D,R]=n.useState("paper"),[O,M]=n.useState(null),[A,P]=n.useState(!1),[z,B]=n.useState(30),[$,F]=n.useState([8,24]),H=n.useRef(0),N=pe(),[W,q]=n.useState("dayGridMonth"),[U,Y]=n.useState([]),[G,V]=n.useState(null);function J(e,t){if(0==e){return void document.querySelectorAll(".newTimeElement").forEach((e=>{e.remove()}))}document.querySelectorAll(".fc-timegrid-slot-label").forEach((n=>{const s=n.querySelector(".fc-timegrid-slot-label-cushion");if(s){let i=n.getAttribute("data-original-time");i||(i=s.textContent,n.setAttribute("data-original-time",i));const r=i.split(":");if(r.length>1){const i=parseInt(r[0],10),o=parseInt(r[1],10),a=new Date;a.setHours(i),a.setMinutes(o),0!==e&&a.setHours(a.getHours()+e);const l=String(a.getHours()).padStart(2,"0"),c=String(a.getMinutes()).padStart(2,"0"),d=document.createElement("div");d.className="MuiPaper-root newTimeElemet",d.style.backgroundColor=t.palette.background.paper,d.style.position="absolute",d.style.top="0",d.style.left="0",d.style.width="100%",d.style.height="100%",d.style.display="flex",d.style.alignItems="center",d.style.justifyContent="center";const u=document.createElement("div");u.className="MuiTypography-root",u.textContent=`${l}:${c}`,d.appendChild(u);const h=document.createElement("div");h.style.position="relative",n.innerHTML="",h.appendChild(s),h.appendChild(d),n.appendChild(h)}}}))}n.useEffect((()=>{(async()=>{const e=await r(k);Y(e)})()}),[k]),n.useEffect((()=>{var e;let t=null==m?void 0:m.map((e=>{const t={...e},n=e=>{const t=new Date(e);return t.setHours(t.getHours()-H.current),t};e.start&&(t.start=n(e.start).toISOString()),e.deadline&&(t.end=n(e.deadline).toISOString()),e.rrule&&(t.rrule.dtstart=t.start);const s=2==(null==e?void 0:e.status_id)?"#008000":3==(null==e?void 0:e.priority_id)?"#A52A2A":(null==e?void 0:e.color)?e.color:"#3788D8";return t.color=s,t}));const n=null==(e=y.current)?void 0:e.getApi();n&&n.removeAllEvents(),E?(t=null==t?void 0:t.filter((e=>"background"==e.display)),t.forEach((e=>{e.display="block"})),n.addEventSource(t)):n.addEventSource(t)}),[H.current,E,W,m]),n.useEffect((()=>{var e;const t=null==(e=y.current)?void 0:e.getApi();if(t){q(t.view.type);const e=()=>{const e=t.view.type;q(e)};return t.on("datesSet",e),()=>{t.off("datesSet",e)}}}),[]),n.useEffect((()=>{J(H.current,N)}),[N,W,$,z]);const X=()=>{C(!1),L(!1),x((e=>[...e,"todo","calendar"]))};async function Z(t){const n=(e,t)=>{const n=new Date(e);return n.setHours(n.getHours()+t),n.toISOString()},s={taskId:t.event.id,listId:k,title:t.event.title,allDay:t.event.allDay};if(t.event.start&&(s.start=n(t.event.start,H.current)),t.event.end)s.deadline=n(t.event.end,H.current);else if(t.event.start){const e=new Date(t.event.start);e.setHours(e.getHours()+1),s.deadline=n(e,H.current)}const i=m.find((e=>e.id==t.event.id));i&&i.rrule&&(s.rrule={...i.rrule,dtstart:n(t.event.start,H.current)}),await e(t.event.id,s),x((e=>[...e,"todo","calendar"])),r&&await r(k),g&&await g()}n.useEffect((()=>{v.current&&(b.current&&b.current.destroy(),b.current=new mn(v.current,{itemSelector:".draggable-task",eventData:e=>{const t=e.getAttribute("data-id"),n=U.find((e=>String(e.id)===t));return j(!0),{title:n.title,id:n.id,start:n.start,end:n.end_date,allDay:!n.start}}}))}),[U]);const Q=()=>P(!1);function ee(e,t){const n=new Date(e.start),s=e.end?new Date(e.end):null;0!==t&&(n.setHours(n.getHours()+t),s&&s.setHours(s.getHours()+t));const i=e=>`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`;return{startTime:i(n),endTime:s?i(s):null}}const te=String(z).padStart(2,"0"),ne={locale:ld,slotDuration:`00:${te}:00`,slotLabelInterval:`00:${te}:00`,slotMinTime:`${String($[0]).padStart(2,"0")}:00:00`,slotMaxTime:`${String($[1]).padStart(2,"0")}:00:00`,height:"100%",plugins:[xn,yn,vn,bn,kn],headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},droppable:!0,editable:!0,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0,initialEvents:m,datesSet:e=>q(e.view.type),slotLabelFormat:{hour:"numeric",minute:"2-digit",omitZeroMinute:!1,meridiem:"short"},select:function(e){const t=(e,t)=>{const n=new Date(e);return n.setHours(n.getHours()+t),n.toISOString()},n=t(e.startStr,H.current),s=e.endStr?t(e.endStr,H.current):null;var i;M({start:n,end:s,allDay:e.allDay}),i="paper",L(!0),R(i)},eventClick:async function(e){var t,n;V((null==(t=null==e?void 0:e.event)?void 0:t.id)||null);try{n="paper",C(!0),R(n)}catch(s){}},eventChange:Z,eventReceive:function(e){Z(e)},eventDragStart:()=>j(!0)};return"dayGridMonth"==W?ne.eventContent=function(e){const{startTime:t}=ee(e.event,H.current),n=m.find((t=>t.id==e.event.id));return{html:`<div class="fc-daygrid-event-dot" style="border-color: ${2==(null==n?void 0:n.status_id)?"#008000":3==(null==n?void 0:n.priority_id)?"#A52A2A":(null==n?void 0:n.color)?n.color:"#3788D8"};"></div>\n            <div class="fc-event-time">${t}</div>\n            <div class="fc-event-title">${e.event.title}</div>`}}:"listWeek"!==W&&(ne.eventContent=function(e){const t=m.find((t=>t.id==e.event.id));if(t&&t.display&&"background"==t.display&&!E)return{html:`<div class="fc-event-main-frame">\n                <div class="fc-event-title-container">\n                  <div class="fc-event-title fc-sticky">${e.event.title}</div>\n                </div>\n            `};const{startTime:n,endTime:s}=ee(e.event,H.current);return{html:`<div class="fc-event-main-frame">\n              <div class="fc-event-time">${n}${s?" - "+s:""}</div>\n              <div class="fc-event-title-container">\n                <div class="fc-event-title fc-sticky">${e.event.title}</div>\n              </div>\n            </div>`}}),0==H.current&&(ne.nowIndicator=!0),s.jsxs(i,{sx:{height:"100%",display:"flex",flexDirection:"column",width:"100%"},children:[s.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",paddingTop:1,paddingX:1},children:[s.jsxs(i,{children:[s.jsx(p,{onClick:()=>P(!0),children:"Настройки"}),s.jsxs(_e,{onClick:()=>{_(!E)},selected:E,value:"backgroundsEdit",children:[E?s.jsx(Ke,{}):s.jsx(Ve,{})," Фоновые задачи"]})]}),s.jsx(p,{onClick:()=>{w(null),j(!T)},children:T?"Показать задачи":"Скрыть задачи"})]}),s.jsxs(Re,{container:!0,sx:{flexGrow:1,overflowY:"auto",height:"100%",position:"relative"},children:[s.jsx(Re,{item:!0,width:"100%",children:s.jsxs(Se,{sx:{p:3,flexGrow:1,overflowY:"auto",height:"100%"},children:[s.jsx(gn,{ref:y,...ne}),s.jsx(ad,{open:S,handleClose:X,handleDelDateClick:async function(t){await e(t,{start:null,deadline:null}),x((e=>[...e,"todo","calendar"]))},scroll:D,setSelectedTaskId:V,tasks:m,selectedTaskId:G,taskFields:o,addSubTask:a,updateTask:e,changeTaskStatus:l,deleteTask:c}),s.jsx(fd,{open:I,handleClose:X,scroll:D,selectedDate:O,addTask:t}),s.jsx(md,{open:A,onClose:function(){Q()},onApply:function(e,t,n){B(e),F(t),H.current=n,Q(),J(n,N)},slotDuration:z,timeRange:$,timeOffset:H.current})]})}),!T&&s.jsxs(Re,{item:!0,sx:{position:"absolute",top:0,bottom:0,right:T?"-100%":"0",width:"500px",maxWidth:"100%",transition:"right 0.3s ease",zIndex:10,backgroundColor:N.palette.background.paper},children:[s.jsx(Se,{sx:{p:3,display:k?"none":"block",flexGrow:1,overflowY:"auto",height:"100%"},children:s.jsx(pd,{selectedListId:k,lists:d,defaultLists:d.default_lists,projects:d.projects,updateList:u,isNeedContextMenu:!0,setSelectedListId:w,deleteFromChildes:h,setSelectedTaskId:V,linkListGroup:f},k)}),k&&s.jsxs(Se,{sx:{p:3,flexGrow:1,overflowY:"auto",height:"100%"},children:[s.jsx(p,{onClick:()=>w(null),children:"Back"}),s.jsx(ke,{ref:v,children:U&&U.length>0?s.jsxs(s.Fragment,{children:[U.filter((e=>2!==e.status_id)).map((e=>s.jsx(je,{className:"draggable-task","data-id":e.id,sx:{cursor:"pointer"},children:s.jsx(K,{primary:e.title})},e.id))),U.filter((e=>2===e.status_id)).length>0&&s.jsxs(s.Fragment,{children:[s.jsx(je,{children:s.jsx(K,{primary:"Выполненные задачи:",sx:{fontWeight:"bold",marginTop:2}})}),U.filter((e=>2===e.status_id)).map((e=>s.jsx(je,{className:"draggable-task","data-id":e.id,sx:{cursor:"pointer",textDecoration:"line-through",color:"gray"},children:s.jsx(K,{primary:e.title})},e.id)))]})]}):s.jsx(je,{children:s.jsx(K,{primary:"No tasks available"})})})]})]})]})]})}function Xd(){return s.jsx("div",{children:s.jsx(qt,{size:{width:"1400px",height:"900px"},enableResizing:!0,disableDragging:!0,style:{display:"block",zIndex:60,borderRadius:8,border:"1px solid"},bounds:"parent",onMouseDown:()=>{},lockAspectRatio:!1,dragHandleClassName:"drag-handle",maxWidth:1400,maxHeight:900,minWidth:150,minHeight:150,children:s.jsxs(Se,{sx:{borderRadius:2,boxShadow:3,overflow:"hidden",display:"flex",flexDirection:"column",height:"100%",width:"100%"},children:[s.jsxs(Se,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",px:1,backgroundColor:"initial"},children:[s.jsx(Y,{className:"drag-handle",sx:{display:"flex",alignItems:"center",flexGrow:1,cursor:"move"},children:s.jsx(u,{variant:"body2",children:name})}),s.jsxs(Y,{sx:{display:"flex"},children:[s.jsx(r,{size:"small",children:"1"}),s.jsx(r,{size:"small",children:"2"}),s.jsx(r,{size:"small",children:"3"})]})]}),s.jsx(Y,{sx:{flexGrow:1,overflow:"auto",borderBottomLeftRadius:8,borderBottomRightRadius:8},children:s.jsx(Jd,{})})]})})})}const Zd=[{icon:s.jsx(ut,{}),name:"Метроном",type:"metronome"},{icon:s.jsx(ht,{}),name:"Список задач",type:"tasks"},{icon:s.jsx(pt,{}),name:"Календарь",type:"calendar"},{icon:s.jsx(ft,{}),name:"Память",type:"memory"},{icon:s.jsx(mt,{}),name:"Сценарий",type:"Scenario"},{icon:s.jsx(xt,{}),name:"Журналы",type:"JournalEditorDrawer"},{icon:s.jsx(Et,{}),name:"Chat",type:"chat"},{icon:s.jsx(yt,{}),name:"Режим фокусировки",type:"AntiSchedule"}];function Qd(){const[e,t]=n.useState("light"),[o,a]=n.useState(!1),[l,c]=n.useState(null),[d,u]=n.useState("chat"),h=rt("(max-width: 1100px)"),[p,f]=n.useState(h),m=n.useMemo((()=>({toggleColorMode:()=>{t((e=>"light"===e?"dark":"light"))}})),[]),g=n.useMemo((()=>Je({palette:{mode:e}})),[e]);n.useEffect((()=>{f(h)}),[h]),n.useEffect((()=>{y(d)}),[p]);const x=()=>{a(!o)},y=e=>{const t=function(e){var t;"tasks"===e&&p&&(e="tasksMobile");const n=Rd[e];if(!n)return null;const i=null==(t=n.content)?void 0:t.type;return s.jsx(i,{})}(e);c(t),a(!1),u(e)};return s.jsxs(Xe,{theme:g,children:[s.jsx(fe,{}),s.jsxs(Se,{sx:{width:"100%",height:"60px",position:"relative",margin:"0px",px:1,display:"flex",justifyContent:"end",alignItems:"center"},children:[s.jsx(r,{onClick:x,color:"inherit",sx:{position:"absolute",left:"10px"},children:s.jsx(St,{})}),s.jsx(Hd,{})]}),s.jsxs(ge,{anchor:"left",open:o,onClose:x,sx:{width:"400px"},PaperProps:{sx:{width:"inherit"}},children:[s.jsx(ke,{children:Zd.map(((e,t)=>s.jsxs(G,{onClick:()=>y(e.type),selected:d===e.type,sx:{height:"70px",borderBottom:"1px solid #ccc"},children:[s.jsx(V,{children:e.icon}),s.jsx(K,{primary:e.name})]},`component${t}`)))}),s.jsxs(i,{sx:{position:"absolute",bottom:"10px",right:"10px",width:"100%",justifyContent:"space-between",display:"flex",padding:"10px"},children:[s.jsx(r,{onClick:m.toggleColorMode,color:"inherit",children:"dark"===g.palette.mode?s.jsx(wt,{}):s.jsx(Tt,{})}),s.jsx(r,{onClick:function(){f(!p)},color:"inherit",children:p?s.jsx(Ct,{}):s.jsx(et,{})}),"v.1.3"]})]}),s.jsxs(i,{sx:{width:"98vw",height:"91vh",position:"relative",margin:"0px",justifyContent:"center",alignItems:"center",display:"flex"},children:[l?s.jsx(i,{sx:{height:"100%",position:"relative",p:2,overflowY:"auto",width:"100%",display:"flex",justifyContent:"center"},children:l}):s.jsx(i,{sx:{textAlign:"center",mt:4},children:"Добро пожаловать!"}),"chat"!==d&&s.jsx(Fd,{})]})]})}function eu(){const[e,t]=n.useState(""),[r,o]=n.useState(""),[l,c]=n.useState(""),d=nn(),{login:h}=n.useContext(qc);return s.jsx(_t,{component:"main",maxWidth:"xs",children:s.jsxs(i,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[s.jsx(T,{sx:{m:1,bgcolor:"secondary.main"},children:s.jsx(It,{})}),s.jsx(u,{component:"h1",variant:"h5",children:"Sign in"}),s.jsxs(i,{component:"form",onSubmit:async t=>{t.preventDefault();const n=await h(e,r);n?c(n):d("/")},sx:{mt:1},children:[s.jsx(a,{margin:"normal",required:!0,fullWidth:!0,label:"Username",autoFocus:!0,value:e,onChange:e=>t(e.target.value)}),s.jsx(a,{margin:"normal",required:!0,fullWidth:!0,label:"Password",type:"password",value:r,onChange:e=>o(e.target.value)}),l&&s.jsx(u,{color:"error",variant:"body2",sx:{mt:1},children:l}),s.jsx(p,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Sign In"}),s.jsx(p,{fullWidth:!0,variant:"outlined",onClick:()=>d("/register"),sx:{mb:2},children:"Register"})]})]})})}const tu=[{value:"text",label:"Текст"},{value:"textarea",label:"Многострочный текст"},{value:"number",label:"Число"},{value:"date",label:"Дата"},{value:"select",label:"Выбор из списка"},{value:"tags",label:"Теги"},{value:"checkbox",label:"Флажок"}];function nu(){const[e,t]=n.useState([]),[l,c]=n.useState(!0),[d,h]=n.useState(""),[f,m]=n.useState(!1),[g,x]=n.useState(null),[y,b]=n.useState({name:"",display_name:"",fields:[]});n.useEffect((()=>{k()}),[]);const k=async()=>{try{const e=await en.get("/api/journals/schemas");t(e.data)}catch(hu){h("Ошибка загрузки журналов")}finally{c(!1)}},w=(e,t)=>{const n=[...y.fields];n[e]=t,b({...y,fields:n})};return l?s.jsx(u,{children:"Загрузка..."}):s.jsxs(i,{children:[s.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[s.jsx(u,{variant:"h5",children:"Мои журналы"}),s.jsx(p,{variant:"contained",startIcon:s.jsx(Ne,{}),onClick:()=>{x(null),b({name:"",display_name:"",fields:[{name:"content",type:"textarea",label:"Содержание",required:!0}]}),m(!0)},children:"Создать журнал"})]}),d&&s.jsx(_,{severity:"error",sx:{mb:2},onClose:()=>h(""),children:d}),s.jsx(ke,{children:e.map((e=>s.jsx(je,{sx:{p:0,mb:2},children:s.jsx(v,{sx:{width:"100%"},children:s.jsx(j,{children:s.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[s.jsxs(i,{children:[s.jsxs(u,{variant:"h6",children:[e.display_name,e.is_default&&s.jsx(We,{label:"Системный",size:"small",sx:{ml:1}})]}),s.jsxs(u,{variant:"body2",color:"text.secondary",children:["Поля: ",e.fields.map((e=>e.label)).join(", ")]})]}),s.jsx(i,{children:!e.is_default&&s.jsxs(s.Fragment,{children:[s.jsx(r,{onClick:()=>(e=>{x(e),b({name:e.name,display_name:e.display_name,fields:e.fields}),m(!0)})(e),children:s.jsx(Ve,{})}),s.jsx(r,{onClick:()=>(async e=>{var t,n;if(window.confirm("Вы уверены, что хотите удалить этот журнал? Все записи будут удалены."))try{await en.delete(`/api/journals/schemas/${e}`),k()}catch(hu){h((null==(n=null==(t=hu.response)?void 0:t.data)?void 0:n.error)||"Ошибка удаления журнала")}})(e.id),children:s.jsx(Lt,{})})]})})]})})})},e.id)))}),s.jsxs(Q,{open:f,onClose:()=>m(!1),maxWidth:"md",fullWidth:!0,children:[s.jsxs(ee,{children:[g?"Редактировать журнал":"Создать журнал",s.jsx(r,{onClick:()=>m(!1),sx:{position:"absolute",right:8,top:8},children:s.jsx(o,{})})]}),s.jsx(te,{children:s.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[!g&&s.jsx(a,{label:"Системное имя",value:y.name,onChange:e=>b({...y,name:e.target.value}),helperText:"Используется в URL, только латинские буквы и подчеркивания",required:!0}),s.jsx(a,{label:"Отображаемое название",value:y.display_name,onChange:e=>b({...y,display_name:e.target.value}),required:!0}),s.jsx(u,{variant:"h6",sx:{mt:2},children:"Поля журнала"}),y.fields.map(((e,t)=>{var n;return s.jsxs(v,{variant:"outlined",sx:{p:2},children:[s.jsxs(i,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[s.jsx(a,{label:"Название поля",value:e.name,onChange:n=>w(t,{...e,name:n.target.value}),size:"small",sx:{flex:1}}),s.jsx(a,{label:"Отображаемое название",value:e.label,onChange:n=>w(t,{...e,label:n.target.value}),size:"small",sx:{flex:1}}),s.jsxs(se,{size:"small",sx:{minWidth:120},children:[s.jsx(ie,{children:"Тип"}),s.jsx(re,{value:e.type,onChange:n=>w(t,{...e,type:n.target.value}),children:tu.map((e=>s.jsx(oe,{value:e.value,children:e.label},e.value)))})]}),s.jsx(Dt,{control:s.jsx(ae,{checked:e.required||!1,onChange:n=>w(t,{...e,required:n.target.checked})}),label:"Обязательное"}),s.jsx(r,{onClick:()=>(e=>{const t=y.fields.filter(((t,n)=>n!==e));b({...y,fields:t})})(t),color:"error",children:s.jsx(Lt,{})})]}),"select"===e.type&&s.jsx(a,{label:"Варианты (через запятую)",value:e.optionsString||(null==(n=e.options)?void 0:n.join(", "))||"",onChange:e=>((e,t)=>{const n=[...y.fields];n[e]={...n[e],optionsString:t,options:t?t.split(",").map((e=>e.trim())).filter((e=>e)):[]},b({...y,fields:n})})(t,e.target.value),fullWidth:!0,sx:{mt:1},size:"small"})]},t)})),s.jsx(p,{variant:"outlined",startIcon:s.jsx(Ne,{}),onClick:()=>{b({...y,fields:[...y.fields,{name:"",type:"text",label:"",required:!1}]})},children:"Добавить поле"})]})}),s.jsxs(ne,{children:[s.jsx(p,{onClick:()=>m(!1),children:"Отмена"}),s.jsx(p,{onClick:async()=>{var e,t;try{g?await en.put(`/api/journals/schemas/${g.id}`,y):await en.post("/api/journals/schemas",y),m(!1),k()}catch(hu){h((null==(t=null==(e=hu.response)?void 0:e.data)?void 0:t.error)||"Ошибка сохранения журнала")}},variant:"contained",children:g?"Сохранить":"Создать"})]})]})]})}function su(){const{user:e,fetchCurrentUser:t,logout:r}=n.useContext(qc),{hasAccess:o}=Wl(),a=nn(),[l,c]=n.useState(null),[d,h]=n.useState(0);n.useEffect((()=>{e||t(),f()}),[e,t]);const f=async()=>{try{const e=await en.get("/api/user/subscription");c(e.data)}catch(e){}};if(!e)return null;return s.jsxs(_t,{sx:{mt:8},children:[s.jsx(i,{sx:{mb:3},children:s.jsx(p,{startIcon:s.jsx(Rt,{}),onClick:()=>a("/"),variant:"outlined",children:"Назад"})}),s.jsx(u,{variant:"h4",gutterBottom:!0,children:e.user_name}),s.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:e.email}),s.jsx(i,{sx:{borderBottom:1,borderColor:"divider",mt:3},children:s.jsxs(Ot,{value:d,onChange:(e,t)=>h(t),children:[s.jsx(Mt,{label:"Профиль"}),s.jsx(Mt,{label:"Мои журналы"})]})}),0===d&&s.jsxs(i,{sx:{mt:3},children:[l&&s.jsx(v,{sx:{mb:3},children:s.jsxs(j,{children:[s.jsx(u,{variant:"h6",gutterBottom:!0,children:"Текущий тариф"}),s.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(We,{label:l.plan_name,color:l.is_active?"primary":"default",variant:l.is_active?"filled":"outlined"}),s.jsx(p,{variant:"text",color:"primary",onClick:()=>a("/pricing"),children:"Изменить тариф"})]}),l.end_date&&s.jsxs(u,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Действует до: ",new Date(l.end_date).toLocaleDateString("ru-RU")]})]})}),s.jsxs(i,{sx:{display:"flex",gap:2},children:[o("admin")&&s.jsx(p,{variant:"contained",color:"primary",onClick:()=>a("/admin"),children:"Панель администратора"}),s.jsx(p,{variant:"outlined",onClick:async()=>{await r(),a("/login")},children:"Logout"})]})]}),1===d&&s.jsx(i,{sx:{mt:3},children:s.jsx(nu,{})})]})}function iu(){const[e,t]=n.useState(""),[r,o]=n.useState(""),[l,c]=n.useState(""),[d,h]=n.useState(""),f=nn(),{register:m}=n.useContext(qc);return s.jsx(_t,{component:"main",maxWidth:"xs",children:s.jsxs(i,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center"},children:[s.jsx(T,{sx:{m:1,bgcolor:"secondary.main"},children:s.jsx(It,{})}),s.jsx(u,{component:"h1",variant:"h5",children:"Register"}),s.jsxs(i,{component:"form",onSubmit:async t=>{t.preventDefault();const n=await m(e,r,l);n?h(n):f("/")},sx:{mt:1},children:[s.jsx(a,{margin:"normal",required:!0,fullWidth:!0,label:"Username",autoFocus:!0,value:e,onChange:e=>t(e.target.value)}),s.jsx(a,{margin:"normal",required:!0,fullWidth:!0,label:"Email",value:r,onChange:e=>o(e.target.value)}),s.jsx(a,{margin:"normal",required:!0,fullWidth:!0,label:"Password",type:"password",value:l,onChange:e=>c(e.target.value)}),d&&s.jsx(u,{color:"error",variant:"body2",sx:{mt:1},children:d}),s.jsx(p,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},children:"Register"})]})]})})}function ru({children:e}){const{user:t,isLoading:i}=n.useContext(qc);return i?s.jsx("div",{children:"Loading..."}):t?e||s.jsx(rn,{}):s.jsx(sn,{to:"/login",replace:!0})}const ou={1:{name:"Free",color:"default"},2:{name:"Basic",color:"primary"},3:{name:"Premium",color:"secondary"},4:{name:"Admin",color:"error"}};function au(){const{hasAccess:e}=Wl(),[t,r]=n.useState([]),[o,a]=n.useState(!0);if(!e("admin"))return s.jsxs(i,{sx:{p:3,textAlign:"center"},children:[s.jsx(u,{variant:"h5",color:"error",children:"Доступ запрещен"}),s.jsx(u,{variant:"body1",children:"У вас нет прав для доступа к панели администратора"})]});n.useEffect((()=>{l()}),[]);const l=async()=>{try{const e=await en.get("/api/admin/users");r(e.data)}catch(e){}finally{a(!1)}};return o?s.jsx(u,{children:"Загрузка..."}):s.jsxs(i,{sx:{p:3},children:[s.jsx(u,{variant:"h4",gutterBottom:!0,children:"Панель администратора"}),s.jsx(Se,{sx:{mt:2},children:s.jsx(At,{children:s.jsxs(Pt,{children:[s.jsx(zt,{children:s.jsxs(Bt,{children:[s.jsx($t,{children:"ID"}),s.jsx($t,{children:"Имя пользователя"}),s.jsx($t,{children:"Email"}),s.jsx($t,{children:"Уровень доступа"}),s.jsx($t,{children:"Действия"})]})}),s.jsx(Ft,{children:t.map((e=>{var t,n;return s.jsxs(Bt,{children:[s.jsx($t,{children:e.id}),s.jsx($t,{children:e.username}),s.jsx($t,{children:e.email}),s.jsx($t,{children:s.jsx(We,{label:(null==(t=ou[e.access_level_id])?void 0:t.name)||"Free",color:(null==(n=ou[e.access_level_id])?void 0:n.color)||"default"})}),s.jsx($t,{children:s.jsx(re,{value:e.access_level_id||1,onChange:t=>(async(e,t)=>{try{await en.post(`/api/admin/users/${e}/access-level`,{access_level:t}),l()}catch(n){}})(e.id,t.target.value),size:"small",children:Object.entries(ou).map((([e,t])=>s.jsx(oe,{value:parseInt(e),children:t.name},e)))})})]},e.id)}))})]})})})]})}function lu(){const[e,t]=n.useState([]),[r,o]=n.useState(!0),a=nn();n.useEffect((()=>{l()}),[]);const l=async()=>{try{const e=await en.get("/api/subscription-plans");t(e.data)}catch(e){}finally{o(!1)}};return r?s.jsx(u,{children:"Загрузка тарифов..."}):s.jsxs(i,{sx:{p:3},children:[s.jsx(i,{sx:{mb:3},children:s.jsx(p,{startIcon:s.jsx(Rt,{}),onClick:()=>a("/account"),variant:"outlined",children:"Назад"})}),s.jsx(u,{variant:"h4",align:"center",gutterBottom:!0,children:"Выберите тариф"}),s.jsx(Re,{container:!0,spacing:3,sx:{mt:8,display:"flex",justifyContent:"center"},children:e.map((e=>s.jsx(Re,{item:!0,xs:12,md:4,children:s.jsxs(v,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[s.jsxs(j,{sx:{flexGrow:1},children:[s.jsxs(u,{variant:"h5",component:"h2",gutterBottom:!0,children:[e.name,"Premium"===e.name&&s.jsx(We,{label:"Популярный",color:"secondary",size:"small",sx:{ml:1}})]}),s.jsx(u,{variant:"h4",color:"primary",gutterBottom:!0,children:0===e.price?"Бесплатно":`${e.price}₽/мес`}),s.jsxs(ke,{dense:!0,children:[s.jsxs(je,{children:[s.jsx(V,{children:s.jsx(I,{color:"primary"})}),s.jsx(K,{primary:`До ${-1===e.max_containers?"∞":e.max_containers} контейнеров`})]}),e.features.map(((e,t)=>s.jsxs(je,{children:[s.jsx(V,{children:s.jsx(I,{color:"primary"})}),s.jsx(K,{primary:e})]},t)))]})]}),s.jsx(i,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:0===e.price?s.jsx(p,{variant:"outlined",fullWidth:!0,disabled:!0,children:"Текущий план"}):s.jsxs(s.Fragment,{children:[s.jsxs(p,{variant:"contained",fullWidth:!0,onClick:()=>{return e.id,t=e.name,n=e.price,void alert(`Переход к оплате тарифа "${t}" за ${n}₽`);var t,n},color:"primary",children:["Оплатить ",e.price,"₽"]}),s.jsx(p,{variant:"outlined",fullWidth:!0,onClick:()=>(async e=>{try{await en.post(`/api/subscribe/${e}`),alert("Подписка оформлена!"),a("/account")}catch(t){alert("Ошибка при оформлении подписки")}})(e.id),size:"small",children:"Активировать бесплатно"})]})})]})},e.id)))})]})}const cu=n.memo((()=>s.jsxs(on,{children:[s.jsxs(an,{element:s.jsx(ru,{}),children:[s.jsx(an,{path:"/",element:s.jsx(Gd,{})}),s.jsx(an,{path:"/second",element:s.jsx(Kd,{})}),s.jsx(an,{path:"/test",element:s.jsx(Xd,{})}),s.jsx(an,{path:"/mobile",element:s.jsx(Qd,{})}),s.jsx(an,{path:"/account",element:s.jsx(su,{})}),s.jsx(an,{path:"/admin",element:s.jsx(au,{})}),s.jsx(an,{path:"/pricing",element:s.jsx(lu,{})})]}),s.jsx(an,{path:"/login",element:s.jsx(eu,{})}),s.jsx(an,{path:"/register",element:s.jsx(iu,{})})]})));const du=n.memo((function(){return s.jsx("div",{className:"App",children:s.jsx(Bc,{children:s.jsx(Uc,{children:s.jsx(ql,{children:s.jsx(Fc,{children:s.jsx(Md,{children:s.jsx(Vc,{children:s.jsx(Zc,{children:s.jsx(nd,{children:s.jsx(Sd,{children:s.jsx(ln,{future:{v7_fetcherPersist:!0,v7_normalizeFormMethod:!0,v7_partialHydration:!0,v7_relativeSplatPath:!0,v7_skipActionErrorRevalidation:!0,v7_startTransition:!0},children:s.jsx(cu,{})})})})})})})})})})})})}));"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/sw.js").then((e=>{})).catch((e=>{}))}));const uu=window.fetch;window.fetch=(e,t={})=>{const n=localStorage.getItem("access_token"),s=new Headers(t.headers||{});return n&&s.set("Authorization",`Bearer ${n}`),uu(e,{...t,headers:s})},Wt.createRoot(document.getElementById("root")).render(s.jsx(L.StrictMode,{children:s.jsx(du,{})}));
